{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/js/isArray.js","webpack:///../commons/js/isObject.js","webpack:///../commons/js/isFunction.js","webpack:///../commons/arr/from.js","webpack:///../commons/js/isEmpty.js","webpack:///../commons/js/isTypeArray.js","webpack:///../commons/js/isString.js","webpack:///../commons/js/isNumeric.js","webpack:///../commons/obj/each.js","webpack:///../commons/js/isUndefined.js","webpack:///../commons/js/isTypeObject.js","webpack:///../commons/obj/from.js","webpack:///../commons/js/isNull.js","webpack:///../commons/obj/copy.js","webpack:///../commons/obj/with.js","webpack:///../commons/obj/getAllPropertyNames.js","webpack:///../commons/obj/getPrototypeChain.js","webpack:///../commons/obj/mergeCallback.js","webpack:///../commons/arr/flatten.js","webpack:///../commons/obj/get.js","webpack:///../commons/arr/remove.js","webpack:///../commons/obj/even.js","webpack:///../commons/obj/compareCallback.js","webpack:///../commons/arr/pushUnique.js","webpack:///../commons/obj/merge.js","webpack:///../commons/js/isObservable.js","webpack:///../commons/arr/unique.js","webpack:///../commons/arr/intersect.js","webpack:///../commons/js/isProxy.js","webpack:///../commons/obj/inherit.js","webpack:///../commons/js/isNumber.js","webpack:///../commons/arr/concatUnique.js","webpack:///../observable/src/Event.js","webpack:///../observable/src/EventController.js","webpack:///../commons/js/getType.js","webpack:///../observable/src/Observable.js","webpack:///../commons/js/proxy.js","webpack:///../observable/src/index.js","webpack:///../commons/js/getProxyTarget.js","webpack:///../commons/js/isBoolean.js","webpack:///../commons/arr/exclude.js","webpack:///../commons/js/isTypeFunction.js","webpack:///../commons/obj/copyPlain.js","webpack:///../commons/arr/difference.js","webpack:///../commons/arr/all.js","webpack:///../commons/str/toTitle.js","webpack:///../commons/str/toCamel.js","webpack:///./src/Element/Reflow.js","webpack:///./src/Element/Dom.js","webpack:///./src/App/Client.js","webpack:///../commons/str/fromCamel.js","webpack:///./src/Element/Transaction.js","webpack:///./src/Element/Css/TransformRule.js","webpack:///./src/Element/Css/Css.js","webpack:///../commons/obj/find.js","webpack:///./src/Element/Event/CustomEvents.js","webpack:///./src/Element/Event/EventController.js","webpack:///./src/Element/Anim/Anim.js","webpack:///../commons/arr/any.js","webpack:///./src/Element/Geometry/Rect.js","webpack:///./src/Element/Element.js","webpack:///./src/browser-elem-entry.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Array","isArray","val","toString","keys","length","slice","values","isNaN","returnValue","undefined","obj","forEach","k","callback","parseFloat","arguments","depth","filter","obj1","obj2","indexOf","entriesOrKey","keysAll","until","prototypalChain","push","getPrototypeOf","getOwnPropertyNames","objs","shift","Error","deepProps","valAtObj1","valAtObj2","isReplace","withSymbols","getOwnPropertyDescriptor","e","_flatten","arr","withObjects","reduce","acc","concat","detectObservables","path","_ctxt","ctxt","_key","isObsvble","reciever","exists","itm","limit","splice","_even","assertion","result","contn","v1","testPass","v2","netComparison","contrast","returnOnFirstFalse","items","input","method","index","self","arr2","val1","val2","__proxyTargetByCommons","arrs","_arr","params","this","$","propagationStopped","defaultPrevented","promisesInstance","promises","promise","Promise","all","listeners","eventNames","tag","listener","remove","success","removeCallback","eventsAll","details","currentlyFiring","eventNamesAntiRecursion","listenerParams","listenerEventNames","map","str","replace","listenerEventName","bubbling","allowBubbling","firingEventName","startsWith","_shouldFire","proms","dispostn","_doFire","stopPropagation","preventDefault","context","_context","data","_data","eventName","split","Observable","state","super","bubblers","_state","prop","_incoming","args","addListener","removeListener","changedProps","parseInt","entries","_outgoing","_value","observersDisposition","fire","exits","props","methodPrefix","ownMethod","substr","asOwnMethod","copy","ret","apply","changedKeys","passes","failures","CACHE","_CACHE","existsReciever","_existsReciever","existence","diff","diffing","pulse","unobserve","getOffsetParent","setOffsetParent","observe","_getBubbler","offsetParent","changes","_changes","_e","subFieldName","msg","console","error","strictDebug","trapByCommons","target","trap","Proxy","proxy","set","has","deleteProperty","del","ownKeys","descriptor","getOwnPropertySymbols","instance","itms","prevTest","txt","charAt","toUpperCase","strict","toLowerCase","fromStart","Reflow","readCallbacks","writeCallbacks","_run","requestAnimationFrame","onread","withPromise","resolve","reject","onwrite","cycle","read","write","prevTransaction","readReturn","callWrite","writeReturn","repeatTransaction","window","then","find","selector","document","_find","matchedItems","Element","matches","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","ownerDocument","querySelectorAll","item","domData","el","requestOrPayload","dataset","__customDatasetKey","customDatasets","customDataset","vals","payload","domAttr","valOrMutation","subValMutation","getAttribute","request","trim","currentVal","currentValArray","includes","setAttribute","join","removeAttribute","domHtml","content","innerHTML","append","domText","innerText","domAppend","domPrepend","prepend","vendorPrefix","styles","getComputedStyle","documentElement","prefix","match","Olink","css","api","RegExp","delimiter","readCallback","writeCallback","$savepoints","readerDisposition","savepoint","getRollbackData","currentRead","savepoints","toSavepoint","fromSavepoint","pop","param","TransformRule","transformRules","rule","round","Math","r2d","radians","deg","PI","transformStr","WebKitCSSMatrix","a","b","f","rdigit","exec","stom","A","B","C","D","scaleX","sqrt","skew","scaleY","translate","scale","rotate","atan2","atan","cssRead","psuedo","style","ruleCallback","rawProp","getPropertyValue","vendorize","parse","cssWrite","nameOrProps","destructables","inset","margin","padding","destructableProp","meaning","autopx","cssReadAsync","cssWriteAsync","cssComputeAsync","propsToRead","inlineSavepoint","cssReadInline","computedValues","withVendorVersion","cssReadKeyframes","noCache","normalize","cacheKey","stylesheetKeyframesCache","allKeyframes","stylesheetRuleCallback","ruleDefinition","type","CSSRule","KEYFRAMES_RULE","keyframes","cssRules","keyframeRule","keyframe","parseRules","cssText","keyText","offsets","normalizeToWAAPI","_keyframe","offset","sort","parseKeyframes","animationProps","pref","easing","fill","iterations","Infinity","valsList","propsList","normalProp","vendorizedProp","callCallback","reversed","stylesheets","styleSheets","stylesheetCallback","stylesheet","camelCasedProp","body","deep","subKey","prev","curr","CustomEvents","Multitap","fireCallback","hammertime","allSetup","recognizers","events","tapType","recognizer","Hammer","Tap","event","taps","add","recgzr","recgzrs","recognizeWith","recgzr2","recgzrs2","requireFailure","on","off","EventController","activeHooks","Manager","NAME","setup","firedEvents","firedEventsDetails","validate","recognizeGesture","gestureName","mainGestureName","addEventListener","teardown","removeEventListener","_setup","_teardown","gestureIndex","press","pinch","pan","swipe","tap","list","Anim","effect","readyCallbacks","finishCallbacks","cancelCallbacks","duration","cssVarRead","init","firstFrame","lastFrame","transform","anim","animate","reverse","onfinish","cancelForCss","cancel","oncancel","createCallback","succes","to","ready","currentTime","min","play","pause","finish","animationName","keyframesWithAutoSizes","height","width","getBoundingClientRect","size","offsetOrigin","rectProps","_isElement","HTMLElement","HTMLDocument","_rect","left","clientX","top","clientY","offsetX","offsetY","pageX","pageY","innerWidth","innerHeight","pageXOffset","scrollLeft","pageYOffset","scrollTop","toJSON","x","y","right","bottom","contextOffset","coordsAtRect","options","_intersection","intersection","using","start","end","coords","_alignment","axis","rect1Length","rect1","parsePlacement","keyword","delta","predicates","evalPredicates","alignment","rect2","leftline","max","rightline","topline","bottomline","withAngle","_delta","z","pow","deltaAngle","angleOfElevation","acos","asin","angleOfDepression","angle","angle2","isHorizontal","isVertical","positioningOffsets","anchors","inverses","currentOffsets","intersectionWithAnchor","position","scrollParent","excludeStaticParent","overflowRegex","parent","parentElement","test","overflow","overflowY","overflowX","scrolls","scrollHeight","clientHeight","expr","regPlacement","regModifiers","modifiers","percentageContext","total","modifier","endsWith","temp","createElement","innerHtml","firstChild","_ret","_el","cssAsync","domAttrAsync","domHtmlAsync","domTextAsync","domAppendAsync","domPrependAsync","cssTransaction","reference","refPoint","trans","el2","_coords","_coordsFormatted","from","current","progress","activeTransform","abs","translateTo","_offsets","alternateAnchors","_offsetsFormatted","offsetTo","viewport","scrollAnchor","currentScroll","axisProp","scrollTo","log","OnePhrase","Rosewell"],"mappings":"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","file":"elem.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 42);\n","\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n","\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isTypeArray from '../js/isTypeArray.js';\r\nimport _isEmpty from '../js/isEmpty.js';\r\nimport _isObject from '../js/isObject.js';\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n *\r\n * @return array\r\n */\r\nexport default function(val) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from './isNull.js';\r\nimport _isUndefined from './isUndefined.js';\r\nimport _isTypeObject from './isTypeObject.js';\r\n\r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from './isString.js';\r\nimport _isUndefined from './isUndefined.js';\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nexport default function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach(k => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k]);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isString from '../js/isString.js';\r\n\r\n/**\r\n * Return an object for the given pair(s) of input.\r\n *\r\n * @param string|array \t\t\tkey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nexport default function(key, val = null) {\r\n\tvar obj = {};\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(key)) {\r\n\t\t\tobj[key] = val;\r\n\t\t} else if (_isArray(key) && _isArray(val)) {\r\n\t\t\tkey.forEach((k, i) => obj[k] = val[i]);\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '../js/isObject.js';\r\nimport _from from './from.js';\r\nimport _merge from './merge.js';\r\n\r\n/**\r\n * Return the input object with additional entries.\r\n *\r\n * @param object\t \t\t\tobj\r\n * @param string|array \t\t\tentriesOrKey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nexport default function(obj, entriesOrKey, val = null) {\r\n\treturn _merge(obj, _isObject(entriesOrKey) ? entriesOrKey : _from(entriesOrKey, val));\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from '../arr/pushUnique.js';\r\nimport _getPrototypeChain from './getPrototypeChain.js';\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nexport default function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _getAllPropertyNames from './getAllPropertyNames.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(objs, callback, deepProps = false, isReplace = false, withSymbols = false) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\t_mergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (withSymbols) {\r\n\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// In case we're setting a read-only property\r\n\t\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t\t} catch(e) {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Flattens a nested array to the given depth.\r\n *\r\n * @param array \tarr\r\n * @param int \t \tdepth\r\n * @param bool \t \twithObjects\r\n *\r\n * @return array\r\n */\r\nconst _flatten = function(arr, depth = 1, withObjects = true) {\r\n\tif (!_isNumeric(depth) || depth <= 0) {\r\n\t\treturn arr;\r\n\t};\r\n\tif (!_isArray(arr) && _isObject(arr) && withObjects) {\r\n\t\tarr = Object.values(arr);\r\n\t};\r\n\tif (!_isArray(arr)) {\r\n\t\treturn arr;\r\n\t};\r\n\treturn arr.reduce((acc, val) => _isArray(val) || (_isObject(val) && withObjects) \r\n\t\t? acc.concat(_flatten(!_isArray(val) ? Object.values(val) : val, depth - 1, withObjects)) \r\n\t\t: acc.concat(val), []);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _flatten;","\r\n/**\r\n * @imports\r\n */\r\nimport _isObservable from '../js/isObservable.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isUndefined from '../js/isUndefined.js';\r\nimport _isNull from '../js/isNull.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false.\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\treciever\r\n * @param bool\t \t\t\t\tdetectObservables\r\n *\r\n * @return mixed\r\n */\r\nexport default function(ctxt, path, reciever = {}, detectObservables = true) {\r\n\tpath = _arrFrom(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tvar isObsvble = detectObservables && _isObservable(_ctxt);\r\n\t\tif (!(isObsvble ? _ctxt.get(_key) : (_isTypeObject(_ctxt) ? _key in _ctxt : _ctxt[_key]))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = isObsvble ? _ctxt.get(_key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n","\r\n/**\r\n * Removes instances of reference up to <limit> times.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \titm\r\n * @param int|bool \tlimit\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, itm, limit = false) {\r\n\tvar i = arr.indexOf(itm);\r\n\twhile (i > -1 && (limit || limit === false)) {\r\n\t\tarr.splice(i, 1);\r\n\t\tif (limit > 0) {\r\n\t\t\tlimit --;\r\n\t\t};\r\n\t\ti = arr.indexOf(itm);\r\n\t};\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _compareCallback from './compareCallback.js';\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif ((_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length)\r\n\t|| (_isObject(obj1) && _isObject(obj2) && Object.keys(obj1).length !== Object.keys(obj2).length)) {\r\n\t\treturn false;\r\n\t}\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif (depth > 0 && ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2)))) {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\treturn _isArray(result) ? result.length === obj1.length\r\n\t\t: (_isObject(result) ? Object.keys(result).length === Object.keys(obj1).length : result);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _even;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isBoolean from '../js/isBoolean.js';\r\nimport _each from './each.js';\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nexport default function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);;\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n","\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t});\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _all from '../arr/all.js';\r\nimport _isFunction from './isFunction.js';\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if a given object has observability methods.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nexport default function(input) {\r\n\treturn _isObject(input) && _all([\r\n\t\t'observe',\r\n\t\t'unobserve',\r\n\t\t'get',\r\n\t\t'set',\r\n\t\t'has',\r\n\t\t'del',\r\n\t], method => _isFunction(input[method]));\r\n};\r\n","\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nexport default function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if a given object instance has been proxied.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nexport default function(input) {\r\n\treturn (_isObject(input) && input.__proxyTargetByCommons) || false;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects into first array/object but only when not set;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (key, obj1, obj2) => {\r\n\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\tif (obj1.indexOf(obj2[key]) === -1) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (!(key in obj1)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from './pushUnique.js';\r\nimport _from from './from.js';\r\n\r\n/**\r\n * Adds items that do not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...arrs\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...arrs) {\r\n\tarrs.forEach(_arr => {\r\n\t\t_arr.forEach(itm => _pushUnique(arr, ..._from(_arr)));\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nconst Event = class {\r\n\r\n\t/**\r\n\t * Initializes an Event instance.\r\n\t *\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(params) {\r\n\t\tthis.$ = {\r\n\t\t\tpropagationStopped: false,\r\n\t\t\tdefaultPrevented: false,\r\n\t\t\tpromisesInstance: null,\r\n\t\t\tpromises: [],\r\n\t\t};\r\n\t\t_each(params, (name, value) => {\r\n\t\t\tthis[name] = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.propagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget propagationStopped() {\r\n\t\treturn this.$.propagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.defaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget defaultPrevented() {\r\n\t\treturn this.$.defaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t\tthis.$.promisesInstance = null;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\tif (!this.$.promisesInstance && this.$.promises.length) {\r\n\t\t\tthis.$.promisesInstance = Promise.all(this.$.promises);\r\n\t\t}\r\n\t\treturn this.$.promisesInstance;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Event;","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _concatUnique from '@onephrase/commons/arr/concatUnique.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _difference from '@onephrase/commons/arr/difference.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\nimport _exclude from '@onephrase/commons/arr/exclude.js';\r\nimport _isNull from '@onephrase/commons/js/isNull.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _getType from '@onephrase/commons/js/getType.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nconst EventController = class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.$ = {\r\n\t\t\tlisteners: [],\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a listener object.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return void\r\n\t */\r\n\taddListener(eventNames, callback, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback;\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t\t}\r\n\t\tvar listener = {\r\n\t\t\teventNames: eventNames, \r\n\t\t\tcallback: callback, \r\n\t\t\tparams: params,\r\n\t\t\ttag: tag,\r\n\t\t\tremove: () => {\r\n\t\t\t\t_remove(this.$.listeners, listener);\r\n\t\t\t},\r\n\t\t};\r\n\t\tthis.$.listeners.push(listener);\r\n\t\treturn listener;\r\n\t}\r\n\r\n\t/**\r\n\t * Unregisters an listener.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tremoveListener(eventNames, callback = null, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback || {};\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tvar success = false;\r\n\t\tfor (var i = 0; i < this.$.listeners.length; i ++) {\r\n\t\t\tif ((_isNull(eventNames) || _even(_arrFrom(this.$.listeners[i].eventNames), _arrFrom(eventNames))) \r\n\t\t\t&& (_isNull(callback) || this.$.listeners[i].callback === callback)\r\n\t\t\t&& (_isNull(params) || _even(this.$.listeners[i].params, params))\r\n\t\t\t&& (_isNull(tag) || this.$.listeners[i].tag === tag)) {\r\n\t\t\t\tif (this.$.listeners[i].removeCallback) {\r\n\t\t\t\t\tthis.$.listeners[i].removeCallback();\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.listeners[i].remove();\r\n\t\t\t\tsuccess = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Returns the list of params being listend.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\teventsAll() {\r\n\t\tvar eventsAll = [];\r\n\t\t(this.$.listeners || []).forEach(listener => {\r\n\t\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t\teventsAll = _concatUnique(eventsAll, _arrFrom(listener.eventNames));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn eventsAll;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires listeners that are bound to the given events.\r\n\t *\r\n\t * @param string|array\t \teventNames\r\n\t * @param object \t\t\tdetails\r\n\t *\r\n\t * @return bool|Promise\r\n\t */\r\n\tfire(eventNames, details) {\r\n\t\tvar e = details instanceof Event ? details : new Event(details);\r\n\t\t// We handle multiple events actually...\r\n\t\teventNames = _arrFrom(eventNames);\r\n\t\t// And fields already firing should trigger a refire\r\n\t\tthis.$.currentlyFiring = this.$.currentlyFiring || [];\r\n\t\tvar eventNamesAntiRecursion = _difference(eventNames, this.$.currentlyFiring);\r\n\t\tif (!eventNamesAntiRecursion.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_concatUnique(this.$.currentlyFiring, eventNamesAntiRecursion)\r\n\t\t// Initialize evteters for \"return\"\r\n\t\tfor (var i = 0; i < (this.$.listeners || []).length; i ++) {\r\n\t\t\tif (e.propagationStopped) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar listener = this.$.listeners[i];\r\n\t\t\tvar listenerParams = listener.params || {};\r\n\t\t\tvar listenerEventNames = _arrFrom(listener.eventNames).map(str => str.replace(/\\`/g, ''));\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-1 filtering...\r\n\t\t\t// Match listenerEventNames to firingEventNames\r\n\t\t\t// --------------------------\r\n\t\t\tvar matches;\r\n\t\t\tif (listenerEventNames.length) {\r\n\t\t\t\tmatches = listenerEventNames.filter(listenerEventName => {\r\n\t\t\t\t\tvar firingEventNames = e.bubbling && listenerEventName.indexOf('.') > -1 ? e.bubbling\r\n\t\t\t\t\t\t: (!e.bubbling || listenerParams.allowBubbling ? eventNamesAntiRecursion : []);\r\n\t\t\t\t\treturn firingEventNames.filter(firingEventName => (listenerEventName + '.').startsWith(firingEventName + '.')).length;\r\n\t\t\t\t}).length;\r\n\t\t\t} else {\r\n\t\t\t\tmatches = !e.bubbling || listenerParams.allowBubbling;\r\n\t\t\t}\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-2 filtering...\r\n\t\t\t// --------------------------\r\n\t\t\tif (matches && this._shouldFire(listener, eventNames, e)) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar dispostn = this._doFire(listener, eventNames, e), proms;\r\n\t\t\t\tif ((dispostn === false) || (dispostn instanceof Event && dispostn.propagationStopped)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t} else if ((dispostn === false) || (dispostn instanceof Event && dispostn.defaultPrevented)) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t} else if ((dispostn instanceof Promise && (proms = dispostn))\r\n\t\t\t\t|| (dispostn instanceof Event && (proms = dispostn.promises))) {\r\n\t\t\t\t\te.promise(proms);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t_exclude(this.$.currentlyFiring, ...eventNamesAntiRecursion)\r\n\t\t// -----------------------------\r\n\t\t// The overall return value\r\n\t\t// -----------------------------\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Fires the listener at entry \"i\".\r\n\t * Returns listener's disposition.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\t_doFire(listener, eventNames, e) {\r\n\t\tvar context = e.context || {};\r\n\t\tvar _context = e._context || {};\r\n\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t// Call listener...\r\n\t\t\tvar data = [];\r\n\t\t\tvar _data = [];\r\n\t\t\tvar result = _arrFrom(listener.eventNames).forEach(eventName => {\r\n\t\t\t\teventName = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\t\tdata.push(_get(context, eventName));\r\n\t\t\t\t_data.push(_get(_context, eventName));\r\n\t\t\t});\r\n\t\t\treturn _isArray(listener.eventNames) \r\n\t\t\t\t? listener.callback(data, _data, e)\r\n\t\t\t\t: listener.callback(data[0], _data[0], e);\r\n\t\t}\r\n\t\tvar data = {};\r\n\t\tvar _data = {};\r\n\t\teventNames.forEach(eventName => {\r\n\t\t\tvar path = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\tdata[eventName] = _get(context, path);\r\n\t\t\t_data[eventName] = _get(_context, path);\r\n\t\t});\r\n\t\t// Call listener...\r\n\t\treturn listener.callback(data, _data, e);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default EventController;","\r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nexport default function(val) {\r\n\treturn typeof val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from '@onephrase/commons/js/isNull.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumber from '@onephrase/commons/js/isNumber.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isObservable from '@onephrase/commons/js/isObservable.js';\r\nimport _getProxyTarget from '@onephrase/commons/js/getProxyTarget.js';\r\nimport _isProxy from '@onephrase/commons/js/isProxy.js';\r\nimport _proxy from '@onephrase/commons/js/proxy.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport _inherit from '@onephrase/commons/obj/inherit.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport EventController from './EventController.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observable\r\n * ---------------------------\r\n */\r\n \r\nconst Observable = class extends EventController {\r\n\r\n\t/**\r\n\t * Handles initializations.\r\n\t *\r\n\t * @param object\t\t\tstate\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper();\r\n\t\t// @see ObservableCore.init()\r\n\t\tthis.$.params = _inherit({}, params, Observable.params);\r\n\t\tthis.$.bubblers = {};\r\n\t\tthis.$.state = state;\r\n\t\tthis.$._state = _isArray(state) ? state.slice() : _copy(1, state);\r\n\t\t_each(this.$.state, (prop, value) => {\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of addListener.\r\n\t *\r\n\t * @see addListener()\r\n\t */\r\n\tobserve(...args) {\r\n\t\treturn this.addListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of removeListener.\r\n\t *\r\n\t * @see removeListener()\r\n\t */\r\n\tunobserve(...args) {\r\n\t\treturn this.removeListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Pushes data into a given property, or list of properties.\r\n\t *\r\n\t * @param string\t\tprops\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tset(prop, value) {\r\n\t\tvar data = {};\r\n\t\tif (_isString(prop) || _isNumber(prop)) {\r\n\t\t\tdata[prop] = value;\r\n\t\t} else if (_isArray(prop)) {\r\n\t\t\tprop.forEach(p => {\r\n\t\t\t\tdata[p] = value;\r\n\t\t\t})\r\n\t\t} else if (_isObject(prop)) {\r\n\t\t\tdata = prop;\r\n\t\t}\r\n\t\tvar changedProps = Object.keys(data);\r\n\t\tif (_isArray(this.$.state)) {\r\n\t\t\tchangedProps = changedProps.map(key => parseInt(key));\r\n\t\t}\r\n\t\t// ------------------\r\n\t\tvar entries = [];\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t} else {\r\n\t\t\t\tentries.push(prop);\r\n\t\t\t}\r\n\t\t\t// Incoming...\r\n\t\t\t// ------------------\r\n\t\t\tvar value = data[prop];\r\n\t\t\t// When observables come as proxies,\r\n\t\t\t// we'll save them real\r\n\t\t\tif (_isProxy(value)) {\r\n\t\t\t\tvar _value = _getProxyTarget(value);\r\n\t\t\t\tif (_isObservable(_value)) {\r\n\t\t\t\t\tvalue = _value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t\t// Set now...\r\n\t\t\t// ------------------\r\n\t\t\tthis.$.state[prop] = value;\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(changedProps, {context: this.$.state, _context: this.$._state, entries: entries, exits: []});\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tthis.$._state[prop] = this.$.state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Unsets the property or list of properties from the object.\r\n\t *\r\n\t * @param string|array\t\tprop\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tdel(prop) {\r\n\t\tvar props = _arrFrom(prop);\r\n\t\tvar exits = [];\r\n\t\tprops.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\texits.push(prop);\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t}\r\n\t\t\tdelete this.$.state[prop];\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(props, {context: this.$.state, _context: this.$._state, entries: [], exits: exits});\r\n\t\tprops.forEach(prop => {\r\n\t\t\tdelete this.$._state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Evaluates a property name to see if it's a request for instance method\r\n\t * as against state property.\r\n\t *\r\n\t * @param string\t\t\tprop\r\n\t *\r\n\t * @return function|undefined\r\n\t */\r\n\tasOwnMethod(prop) {\r\n\t\tif (_isString(prop) && this.$.params.methodPrefix && prop.startsWith(this.$.params.methodPrefix)) {\r\n\t\t\tvar ownMethod = prop.substr(this.$.params.methodPrefix.length);\r\n\t\t\tif (ownMethod && _isFunction(ownMethod = this[ownMethod])) {\r\n\t\t\t\treturn ownMethod.bind(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns a field's value.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(prop) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(prop);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tvar value = this.$.state[prop];\r\n\t\tif (_isArray(this.$.state) && !_isNumeric(prop) && _isFunction(value)) {\r\n\t\t\treturn (...args) => {\r\n\t\t\t\tvar copy = this.$.state.slice();\r\n\t\t\t\tvar ret = value.apply(this.$.state, args);\r\n\t\t\t\tvar changedKeys = _unique(Object.keys(copy).concat(Object.keys(this.$.state))).filter(k => {\r\n\t\t\t\t\tk = parseInt(k);\r\n\t\t\t\t\tif (this.$.state[k] !== copy[k]) {\r\n\t\t\t\t\t\tif (!(k in this.$.state)) {\r\n\t\t\t\t\t\t\t// Outgoing...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._outgoing(k, copy[k]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Incoming...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._incoming(k, this.$.state[k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (changedKeys.length) {\r\n\t\t\t\t\tthis.fire(changedKeys, {context: this.$.state, _context: this.$._state});\r\n\t\t\t\t\tthis.$._state = this.$.state.slice();\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Tells if a a field exists.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\thas(prop) {\r\n\t\treturn (prop in this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Keys of current entries.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tkeys() {\r\n\t\treturn Object.keys(this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\tvar passes = 0, failures = 0;\r\n\t\t// One CACHE across listeners\r\n\t\t// IMPORTANT: This cache must\r\n\t\t// be destroyed before bubbling the (e) object\r\n\t\tif (!('CACHE' in e.$)) {\r\n\t\t\te.$.CACHE = {};\r\n\t\t\te.$._CACHE = {};\r\n\t\t}\r\n\t\tvar listenerParams = listener.params || {};\r\n\t\t(!_isNull(listener.eventNames) ? _arrFrom(listener.eventNames) : eventNames).forEach(prop => {\r\n\t\t\tif (!(prop in e.$.CACHE)) {\r\n\t\t\t\te.$.CACHE[prop] = {};\r\n\t\t\t\te.$._CACHE[prop] = {};\r\n\t\t\t\t// > ACCESS\r\n\t\t\t\tvar existsReciever = {};\r\n\t\t\t\tvar _existsReciever = {};\r\n\t\t\t\tvar path = _isString(prop) ? prop.split('.') : prop;\r\n\t\t\t\te.$.CACHE[prop].val = _get(e.context, path, existsReciever);\r\n\t\t\t\te.$._CACHE[prop].val = _get(e._context, path, _existsReciever);\r\n\t\t\t\te.$.CACHE[prop].existence = existsReciever.exists;\r\n\t\t\t\te.$._CACHE[prop].existence = _existsReciever.exists;\r\n\t\t\t\t// > DIFFING\r\n\t\t\t\tif (listenerParams.diff !== false && !('diffing' in e.$.CACHE[prop])) {\r\n\t\t\t\t\te.$.CACHE[prop].diffing = e.bubbling\r\n\t\t\t\t\t|| e.$.CACHE[prop].existence !== e.$._CACHE[prop].existence \r\n\t\t\t\t\t|| (_isObject(e.$.CACHE[prop].val) && _isObject(e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t? !_even(e.$.CACHE[prop].val, e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t: e.$.CACHE[prop].val !== e.$._CACHE[prop].val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Delta...\r\n\t\t\tif (_isNumeric(listenerParams.pulse) && e.context && e._context) {\r\n\t\t\t\tif (listenerParams.pulse === 0 && e.$.CACHE[prop].val && !e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t} else if (listenerParams.pulse === 1 && !e.$.CACHE[prop].val && e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Diff...\r\n\t\t\tif (listenerParams.diff === false || e.$.CACHE[prop].diffing) {\r\n\t\t\t\tpasses ++;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn !failures && passes && super._shouldFire(listener, eventNames, e);\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures outgoing objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_outgoing(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tif (prop in this.$.bubblers) {\r\n\t\t\t\tvalue.unobserve(this.$.bubblers[prop], {allowBubbling:true});\r\n\t\t\t}\r\n\t\t\tif (_isFunction(value.getOffsetParent) && value.getOffsetParent() === this) {\r\n\t\t\t\tvalue.setOffsetParent(null);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures incoming objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_incoming(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tvalue.observe(this._getBubbler(prop), {allowBubbling:true});\r\n\t\t\tif (_isFunction(value.getOffsetParent) && !value.getOffsetParent()) {\r\n\t\t\t\tvalue.setOffsetParent(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @param object|null\t\toffsetParent\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tsetOffsetParent(offsetParent) {\r\n\t\tthis.$.offsetParent = offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @return object|null\r\n\t */\r\n\tgetOffsetParent() {\r\n\t\treturn this.$.offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a function that observes changes in child observables and bubble them up here.\r\n\t *\r\n\t * @param string\t\tname\r\n\t *\r\n\t * @return function\r\n\t */\r\n\t_getBubbler(prop) {\r\n\t\tthis.$.bubblers = this.$.bubblers || {};\r\n\t\tthis.$.bubblers[prop] = (changes, _changes, e) => {\r\n\t\t\tvar _e = {};\r\n\t\t\t_e.context = this.$.state;\r\n\t\t\t_e._context = this.$._state;\r\n\t\t\t_e.entries = (e.entries || []).slice();\r\n\t\t\t_e.exits = (e.exits || []).slice();\r\n\t\t\t_e.bubbling = (e.bubbling ? _arrFrom(e.bubbling) : Object.keys(changes))\r\n\t\t\t\t.map(subFieldName => prop + '.' + subFieldName);\r\n\t\t\treturn this.fire(prop, _e);\r\n\t\t};\r\n\t\treturn this.$.bubblers[prop];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Warning handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\twarn(msg) {\r\n\t\tconsole.error(msg);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Error handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\terror(msg) {\r\n\t\tif (this.$.params.strictDebug) {\r\n\t\t\tthrow new Error(msg);\r\n\t\t} else {\r\n\t\t\tconsole.error(msg);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Constructs a proxy wrapper for the target.\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tproxy() {\r\n\t\treturn _proxy(this, {\r\n\t\t\t// -----------------------\r\n\t\t\t// The 4 cardinal points...\r\n\t\t\t// -----------------------\r\n\t\t\tget: function(target, prop) {\r\n\t\t\t\tvar value = target.get(prop);\r\n\t\t\t\tif (_isObject(value) && _isFunction(value.proxy)) {\r\n\t\t\t\t\tvalue = value.proxy();\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\t\t\tset: function(target, prop, val) {\r\n\t\t\t\ttarget.set(prop, val);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\thas: function(target, prop) {\r\n\t\t\t\treturn target.has(prop);\r\n\t\t\t},\r\n\t\t\tdeleteProperty: function(target, prop) {\r\n\t\t\t\treturn target.del(prop);\r\n\t\t\t},\r\n\t\t\t// -----------------------\r\n\t\t\t// Unimportant additions...\r\n\t\t\t// -----------------------\r\n\t\t\townKeys: function(target) {\r\n\t\t\t\t//TODO:return Reflect.ownKeys(target.$.state);\r\n\t\t\t\treturn Object.keys(target.$.state);\r\n\t\t\t},\r\n\t\t\tdefineProperty: function(target, prop, descriptor) {\r\n\t\t\t\tObject.defineProperty(target.$.state, prop, descriptor);\r\n\t\t\t\ttarget.set(prop, target.$.state[prop]);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyDescriptor: function(target, prop) {\r\n\t\t\t\treturn Object.getOwnPropertyDescriptor(target.$.state, prop);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertySymbols: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertySymbols(target.$.state);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyNames: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertyNames(target.$.state);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nObservable.params = {\r\n\tmethodPrefix: '$',\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport _merge from '../obj/merge.js';\r\n\r\n/**\r\n * Creats a proxy and keeps special reference to it.\r\n *\r\n * @param object\t target\r\n * @param object\t trap\r\n *\r\n * @return Proxy\r\n */\r\nexport default function(target, trap) {\r\n\tvar trapByCommons = {\r\n\t\tget: (target, prop) => {\r\n\t\t\tif (prop === '__proxyTargetByCommons') {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t\tif (prop === '__proxyTrapByCommons') {\r\n\t\t\t\treturn trap;\r\n\t\t\t}\r\n\t\t\treturn trap.get ? trap.get(target, prop) : target[prop];\r\n\t\t},\r\n\t};\r\n\treturn new Proxy(target, _merge({}, trap, trapByCommons));\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Observable from './Observable.js';\r\nimport EventController from './EventController.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tEventController,\r\n\tEvent\r\n};\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport _isProxy from './isProxy.js';\r\n\r\n/**\r\n * Returns the proxy's target object as earlier saved.\r\n *\r\n * @param mixed\t\tproxy\r\n *\r\n * @return mixed\r\n */\r\nexport default function(instance) {\r\n\treturn _isProxy(instance) ? instance.__proxyTargetByCommons : undefined;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _remove from './remove.js';\r\n\r\n/**\r\n * Removes all instances of each item.\r\n *\r\n * @param array \tarr\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...itms) {\r\n\titms.forEach(itm => _remove(arr, itm));\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies only properties of an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tonly\r\n * @param array\t\t \texcept\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\treturn _mergeCallback([{}, obj], (key, obj1, obj2) => {\r\n\t\tif (!_isFunction(obj2[key])) {\r\n\t\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t\t}\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the difference of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) === -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n","\r\n/**\r\n * Converts a string to title case.\r\n *\r\n * @param string \tstr\r\n * @param bool \t\tstrict\r\n *\r\n * @return string\r\n */\r\nexport default function(str, strict) {\r\n\tif (typeof str !== 'string') {\r\n\t\treturn str;\r\n\t}\r\n\treturn str.replace(/\\w\\S*/g,  function(txt) { return txt.charAt(0).toUpperCase() + ((typeof strict !== undefined && strict) ? txt.substr(1).toLowerCase() : txt.substr(1)); })\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _toTitle from './toTitle.js';\r\n\r\n/**\r\n * Makes a string camel-cased.\r\n *\r\n * @param string \tstr\r\n * @param bool\t \tfromStart\r\n *\r\n * @return string\r\n */\r\nexport default function(str, fromStart) {\r\n\t// Make disting words\r\n\tstr = _toTitle(str.replace(/-/g, ' ')).replace(/ /g, '');\r\n\treturn fromStart ? str : str[0].toLowerCase() + str.substr(1);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Binds callbacks to requestAnimationFrame()\r\n * to create a central \"read/write\" phases for DOM access.\r\n * ---------------------------\r\n */\r\n\t\t\t\r\nconst Reflow = {\r\n\t\r\n\t/**\r\n\t * Holds all callbacks bound to the \"read\" phase.\r\n\t *\r\n\t * @var array\r\n\t */\r\n\treadCallbacks: [],\r\n\t\r\n\t/**\r\n\t * Holds all callbacks bound to the \"write\" phase.\r\n\t *\r\n\t * @var array\r\n\t */\r\n\twriteCallbacks: [],\r\n\r\n\t/**\r\n\t * Starts the loop.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\t_run: function() {\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tReflow.readCallbacks.forEach((callback, i) => {\r\n\t\t\t\tif (callback && !callback()) {\r\n\t\t\t\t\tReflow.readCallbacks[i] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tReflow.writeCallbacks.forEach((callback, i) => {\r\n\t\t\t\tif (callback && !callback()) {\r\n\t\t\t\t\tReflow.writeCallbacks[i] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tReflow._run();\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Binds a callback to the \"read\" phase.\r\n\t *\r\n\t * @param function \tcallback\r\n\t * @param bool\t\twithPromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tonread: function(callback, withPromise = false) {\r\n\t\tif (withPromise) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tReflow.readCallbacks.push(() => {\r\n\t\t\t\t\tcallback(resolve, reject);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tReflow.readCallbacks.push(callback);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Binds a callback to the \"write\" phase.\r\n\t *\r\n\t * @param function \tcallback\r\n\t * @param bool\t\twithPromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tonwrite: function(callback, withPromise = false) {\r\n\t\tif (withPromise) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tReflow.writeCallbacks.push(() => {\r\n\t\t\t\t\tcallback(resolve, reject);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tReflow.writeCallbacks.push(callback);\r\n\t},\r\n\t\r\n\t/**\r\n\t * A special construct for DOM manipulations that span\r\n\t * one or more read/write cycles.\r\n\t *\r\n\t * @param function \tread\r\n\t * @param function \twrite\r\n\t * @param mixed\t\tprevTransaction\r\n\t *\r\n\t * @return void|mixed\r\n\t */\r\n\tcycle: function(read, write, prevTransaction) {\r\n\t\tReflow.onread(() => {\r\n\t\t\t// Record initial values\r\n\t\t\tvar readReturn = read(prevTransaction);\r\n\t\t\tif (readReturn) {\r\n\t\t\t\t// Call erite, the transation\r\n\t\t\t\tvar callWrite = (readReturn) => {\r\n\t\t\t\t\tReflow.onwrite(() => {\r\n\t\t\t\t\t\tvar writeReturn = write(readReturn, prevTransaction);\r\n\t\t\t\t\t\tif (writeReturn) {\r\n\t\t\t\t\t\t\t// Repeat transaction\r\n\t\t\t\t\t\t\tvar repeatTransaction = (writeReturn) => {\r\n\t\t\t\t\t\t\t\tReflow.cycle(read, write, writeReturn);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t// ---------------------------------------\r\n\t\t\t\t\t\t\t// If \"write\" returns a promise, we wait until it is resolved\r\n\t\t\t\t\t\t\t// ---------------------------------------\r\n\t\t\t\t\t\t\tif (writeReturn instanceof window.Promise) {\r\n\t\t\t\t\t\t\t\twriteReturn.then(repeatTransaction);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trepeatTransaction();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\t// ---------------------------------------\r\n\t\t\t\t// If \"read\" returns a promise, we wait until it is resolved\r\n\t\t\t\t// ---------------------------------------\r\n\t\t\t\tif (readReturn instanceof window.Promise) {\r\n\t\t\t\t\treadReturn.then(callWrite);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallWrite();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n};\r\nReflow._run();\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reflow;","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isBoolean from '@onephrase/commons/js/isBoolean.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _toCamel from '@onephrase/commons/str/toCamel.js';\r\nimport Reflow from './Reflow.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Element manipulation utilites.\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Creates a DOM element\r\n * from any of markup, selector, HTMLElement.\r\n *\r\n * @param mixed \t\t\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst from = function(input) {\r\n\tif (_isString(input)) {\r\n\t\tvar el;\r\n\t\tif (input.trim().startsWith('<')) {\r\n\t\t\t// Create a node from markup\r\n\t\t\tvar temp = document.createElement('div');\r\n\t\t\ttemp.innerHtml = input;\r\n\t\t\tel = temp.firstChild;\r\n\t\t} else {\r\n\t\t\tel = find(input);\r\n\t\t}\r\n\t\treturn el;\r\n\t}\r\n\treturn input;\r\n};\r\n\r\n/**\r\n * Queries a DOM context for the first element matching\r\n * the given selector.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n *\r\n * @return HTMLElement\r\n */\r\nconst find = function(selector, context = document) {\r\n\treturn _find(selector, context, false/*all*/);\r\n};\r\n\r\n/**\r\n * Queries a DOM context for all elements matching\r\n * the given selector.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n *\r\n * @return DOMNodeList\r\n */\r\nconst findAll = function(selector, context = document) {\r\n\treturn _find(selector, context);\r\n};\r\n\r\n/**\r\n * DOM query.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n * @param bool\t\t \t\t\tall\r\n *\r\n * @return DOMNodeList|HTMLElement\r\n */\r\nconst _find = function(selector, context = document, all = true) {\r\n\tvar matchedItems, method = all ? 'querySelectorAll' : 'querySelector';\r\n\ttry {\r\n\t\tmatchedItems = context[method](selector);\r\n\t} catch(e) {\r\n\t\ttry {\r\n\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':matches('));\r\n\t\t} catch(e) {\r\n\t\t\ttry {\r\n\t\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':-webkit-any('));\r\n\t\t\t} catch(e) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':-moz-any('));\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn matchedItems;\r\n};\r\n\r\n/**\r\n * @polyfills\r\n */\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = \r\n\tElement.prototype.matchesSelector || \r\n\tElement.prototype.mozMatchesSelector ||\r\n\tElement.prototype.msMatchesSelector || \r\n\tElement.prototype.oMatchesSelector || \r\n\tElement.prototype.webkitMatchesSelector ||\r\n\tfunction(s) {\r\n\t\tvar matches = (this.document || this.ownerDocument).querySelectorAll(s),\r\n\t\t\ti = matches.length;\r\n\t\twhile (--i >= 0 && matches.item(i) !== this) {}\r\n\t\treturn i > -1;            \r\n\t};\r\n}\r\n\r\n/**\r\n * Gets or sets custom data.\r\n *\r\n * @param DOMElement\t\t\tel \r\n * @param string|array|object\trequestOrPayload\r\n * @param mixed|void\t\t\tval\r\n *\r\n * @return mixed\r\n */\r\nconst domData = function(el, requestOrPayload, val = null) {\r\n\tif (!el.dataset.__customDatasetKey) {\r\n\t\tel.dataset.__customDatasetKey = customDatasets.length;\r\n\t\tcustomDatasets[el.dataset.__customDatasetKey] = {};\r\n\t}\r\n\tvar customDataset = customDatasets[el.dataset.__customDatasetKey];\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(requestOrPayload)) {\r\n\t\t\treturn customDataset[_toCamel(requestOrPayload)];\r\n\t\t}\r\n\t\tif (_isArray(requestOrPayload)) {\r\n\t\t\tvar vals = {};\r\n\t\t\trequestOrPayload.forEach(key => {\r\n\t\t\t\tvals[key] = customDataset[_toCamel(key)];\r\n\t\t\t});\r\n\t\t\treturn vals;\r\n\t\t}\r\n\t}\r\n\tvar payload = requestOrPayload;\r\n\tif (!_isObject(requestOrPayload)) {\r\n\t\tpayload = _objFrom(requestOrPayload, val);\r\n\t}\r\n\t_each(payload, (key, val) => {\r\n\t\tcustomDataset[_toCamel(key)] = val;\r\n\t});\r\n};\r\nconst customDatasets = [];\r\n \r\n/**\r\n * ---------------------\r\n * MANIPULATION METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * Gets an attribute or a list of attributes,\r\n * or sets an attribute or a list of attributes.\r\n *\r\n * @param DOMElement\t\t\tel \r\n * @param string|array|object\trequestOrPayload\r\n * @param string|bool|void\t\tvalOrMutation\r\n * @param bool|void\t\t\t\tsubValMutation\r\n *\r\n * @return mixed\r\n */\r\nconst domAttr = function(el, requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(requestOrPayload)) {\r\n\t\t\treturn el.getAttribute(requestOrPayload);\r\n\t\t}\r\n\t\tif (_isArray(requestOrPayload)) {\r\n\t\t\tvar vals = {};\r\n\t\t\trequestOrPayload.forEach(request => {\r\n\t\t\t\tvals[request] = el.getAttribute(request);\r\n\t\t\t});\r\n\t\t\treturn vals;\r\n\t\t}\r\n\t}\r\n\tvar payload = requestOrPayload;\r\n\tif (!_isObject(payload)) {\r\n\t\tpayload = _objFrom(requestOrPayload, valOrMutation);\r\n\t} else {\r\n\t\tsubValMutation = valOrMutation;\r\n\t}\r\n\t_each(payload, (name, valOrMutation) => {\r\n\t\tif (arguments.length > 3 || (_isObject(payload) && arguments.length > 2)) {\r\n\t\t\tvar substr = _isString(valOrMutation) ? valOrMutation.trim() : valOrMutation;\r\n\t\t\tvar currentVal = el.getAttribute(name);\r\n\t\t\tvar currentValArray = currentVal ? currentVal.split(' ').map(val => val.trim()) : [];\r\n\t\t\tif (!subValMutation && currentValArray.includes(substr)) {\r\n\t\t\t\t// Add...\r\n\t\t\t\tel.setAttribute(name, _remove(currentValArray, substr).join(' '));\r\n\t\t\t} else if (subValMutation && !currentValArray.includes(substr)) {\r\n\t\t\t\t// Remove...\r\n\t\t\t\tel.setAttribute(name, currentValArray.concat(substr).join(' '));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (valOrMutation === false) {\r\n\t\t\t\tel.removeAttribute(name);\r\n\t\t\t} else {\r\n\t\t\t\tel.setAttribute(name, valOrMutation === true ? 'true' : valOrMutation);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn el;\r\n};\r\n\r\n/**\r\n * Sets or gets HTML content.\r\n *\r\n * @param string|HTMLElement\tcontent\r\n *\r\n * @return void|string\r\n */\r\nconst domHtml = function(el, content = null) {\r\n\tif (arguments.length > 1) {\r\n\t\tif (_isString(content)) {\r\n\t\t\tel.innerHTML = content;\r\n\t\t} else {\r\n\t\t\tel.innerHTML = '';\r\n\t\t\tif (!_isUndefined(content)) {\r\n\t\t\t\tel.append(content);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn el;\r\n\t}\r\n\treturn el.innerHTML;  \r\n};\r\n\r\n/**\r\n * Sets or gets text content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return void|string\r\n */\r\nconst domText = function(el, content = null) {\r\n\tif (arguments.length > 1) {\r\n\t\tel.innerText = _isUndefined(content) ? '' : content;\r\n\t\treturn el;\r\n\t}\r\n\treturn el.innerText;  \r\n};\r\n\r\n/**\r\n * Appends new content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return HTMLElement\r\n */\r\nconst domAppend = function(el, content) {\r\n\tel.append(_isUndefined(content) ? '' : content); \r\n\treturn el; \r\n};\r\n\r\n/**\r\n * Prepends new content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return HTMLElement\r\n */\r\nconst domPrepend = function(el, content) {\r\n\tel.prepend(_isUndefined(content) ? '' : content);  \r\n\treturn el; \r\n};\r\n \r\n/**\r\n * ---------------------\r\n * ASYNC METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * The async type of domAttr().\r\n *\r\n * @see domAttr()\r\n *\r\n * @return Promise\r\n */\r\nconst domAttrAsync = function(el, requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\tif (arguments.length === 2) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domAttr(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domAttr(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domHtml().\r\n *\r\n * @see domHtml()\r\n *\r\n * @return Promise\r\n */\r\nconst domHtmlAsync = function(el, write = null) {\r\n\tif (arguments.length > 1) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domHtml(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domHtml(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domText().\r\n *\r\n * @see domText()\r\n *\r\n * @return Promise\r\n */\r\nconst domTextAsync = function(el, write = null) {\r\n\tif (arguments.length > 1) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domText(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domText(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domAppend().\r\n *\r\n * @see domAppend()\r\n *\r\n * @return Promise\r\n */\r\nconst domAppendAsync = function(el, write) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domAppend(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domPrepend().\r\n *\r\n * @see domPrepend()\r\n *\r\n * @return Promise\r\n */\r\nconst domPrependAsync = function(el, write) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domPrepend(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n \r\n/**\r\n * ---------------------\r\n * OTHER METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * Returns all, only text nodes.\r\n *\r\n * @param DOMElement \t\t\tel\r\n *\r\n * @return array\r\n */\r\nconst domTextNodes = function(el) {\r\n\t// Filter\r\n\tvar rejectScriptTextFilter = {\r\n\t\tacceptNode: function(node) {\r\n\t\t\tif (node.parentNode.nodeName !== 'SCRIPT') {\r\n\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t// Walker\r\n\tvar walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, rejectScriptTextFilter, false);\r\n\tvar node;\r\n\tvar textNodes = [];\r\n\twhile(node = walker.nextNode()) {\r\n\t\ttextNodes.push(node.nodeValue);\r\n\t}\r\n\treturn textNodes;\r\n};\r\n\r\n/**\r\n * Observes when the given elements or selectors are added or removed\r\n * from the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param int\t\t\t\t\t\ttest\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domMutationCallback = function(els, callback, test = null, context = null, observeContext = true) {\r\n\tvar search = (el, nodeListArray) => {\r\n\t\tif (_isString(el)) {\r\n\t\t\t// Is directly mutated...\r\n\t\t\tvar matches = nodeListArray.filter(node => node.matches(el));\r\n\t\t\tif (matches.length) {\r\n\t\t\t\treturn matches;\r\n\t\t\t}\r\n\t\t\t// Is contextly mutated...\r\n\t\t\tif (observeContext) {\r\n\t\t\t\tmatches = nodeListArray\r\n\t\t\t\t\t.reduce((collection, node) => collection.concat(_arrFrom(node.querySelectorAll(el))), []);\r\n\t\t\t\tif (matches.length) {\r\n\t\t\t\t\treturn matches;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Is directly mutated...\r\n\t\t\tif (nodeListArray.includes(el)) {\r\n\t\t\t\treturn el;\r\n\t\t\t}\r\n\t\t\t// Is contextly mutated...\r\n\t\t\tif (observeContext && nodeListArray.length) {\r\n\t\t\t\tvar parentNode = el;\r\n\t\t\t\twhile(!success && (parentNode = parentNode.parentNode)) {\r\n\t\t\t\t\tif (nodeListArray.includes(parentNode)) {\r\n\t\t\t\t\t\treturn el;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar mo = new MutationObserver(mutations => {\r\n\t\tif (test !== 0) {\r\n\t\t\tvar matchedAddedNodes = [];\r\n\t\t\t_arrFrom(els).forEach(el => {\r\n\t\t\t\tif (_isString(el)) {\r\n\t\t\t\t\tmatchedAddedNodes = mutations\r\n\t\t\t\t\t\t.reduce((matches, mut) => matches.concat(search(el, _arrFrom(mut.addedNodes)), matchedAddedNodes));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar matchedAsAddedNode = mutations\r\n\t\t\t\t\t\t.reduce((match, mut) => match || search(el, _arrFrom(mut.addedNodes)), null);\r\n\t\t\t\t\tif (matchedAsAddedNode) {\r\n\t\t\t\t\t\tmatchedAddedNodes.push(matchedAsAddedNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (matchedAddedNodes.length) {\r\n\t\t\t\tcallback(1, ...matchedAddedNodes);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (test !== 1) {\r\n\t\t\tvar matchedRemovedNodes = [];\r\n\t\t\t_arrFrom(els).forEach(el => {\r\n\t\t\t\tif (_isString(el)) {\r\n\t\t\t\t\tmatchedRemovedNodes = mutations\r\n\t\t\t\t\t\t.reduce((matches, mut) => matches.concat(search(el, _arrFrom(mut.removedNodes)), matchedRemovedNodes));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar matchedAsRemovedNode = mutations\r\n\t\t\t\t\t\t.reduce((match, mut) => match || search(el, _arrFrom(mut.removedNodes)), null);\r\n\t\t\t\t\tif (matchedAsRemovedNode) {\r\n\t\t\t\t\t\tmatchedRemovedNodes.push(matchedAsRemovedNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (matchedRemovedNodes.length) {\r\n\t\t\t\tcallback(0, ...matchedRemovedNodes);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tmo.observe(context || document.body, {childList:true, subtree:true});\r\n\treturn mo;\r\n};\r\n\r\n/**\r\n * Shortcut function to connectedCallback().\r\n *\r\n * Observes when the given elements or selectors are added\r\n * to the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domConnectedCallback = function(els, callback, context = null, observeContext = true) {\r\n\treturn connectedCallback(els, (test, ...els) => {\r\n\t\tcallback(...els);\r\n\t}, 1/*test*/, context, observeContext);\r\n};\r\n\r\n/**\r\n * Shortcut function to connectedCallback().\r\n *\r\n * Observes when the given elements or selectors are removed\r\n * from the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domDisconnectedCallback = function(els, callback, context = null, observeContext = true) {\r\n\treturn connectedCallback(els, (test, ...els) => {\r\n\t\tcallback(...els);\r\n\t}, 0/*test*/, context, observeContext);\r\n};\r\n\r\n/**\r\n * Observes changes in attributes of the given element.\r\n *\r\n * @param HTMLElement\t\t\t\tel\r\n * @param function\t\t\t\t\tcallback\r\n * @param array\t\t\t\t\t\tfilter\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domAttrChangeCallback = function(el, callback, filter = []) {\r\n\tvar observer = new MutationObserver(mutations => {\r\n\t\tmutations.forEach(m => {\r\n\t\t\tcallback(m);\r\n\t\t});\r\n\t});\r\n\tvar params = {attributes:true, attributeOldValue:true};\r\n\tif (filter) {\r\n\t\tparams.attributeFilter = filter;\r\n\t}\r\n\tobserver.observe(el, params);\r\n\treturn observer;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tfrom,\r\n\tfind,\r\n\tfindAll,\r\n\tdomData,\r\n\tdomAttr,\r\n\tdomHtml,\r\n\tdomText,\r\n\tdomAppend,\r\n\tdomPrepend,\r\n\tdomAttrAsync,\r\n\tdomHtmlAsync,\r\n\tdomTextAsync,\r\n\tdomAppendAsync,\r\n\tdomPrependAsync,\r\n\tdomTextNodes,\r\n\tdomMutationCallback,\r\n\tdomConnectedCallback,\r\n\tdomDisconnectedCallback,\r\n\tdomAttrChangeCallback,\r\n};","\r\n/**\r\n * ---------------------------\r\n * A collection of Vendor utilities.\r\n * ---------------------------\r\n */\r\n \t\r\n/**\r\n* The vendor prefix in different format.\r\n*\r\n* @param object\r\n*/\r\nconst vendorPrefix = (function() {\r\n\tvar styles = window.getComputedStyle(document.documentElement, '');\r\n\tvar prefix = (Array.prototype.slice.call(styles).join('').match(/-(moz|webkit|ms)-/) || styles.Olink === '' && ['', 'o'])[1];\r\n\tvar api = ('WebKit|Moz|Ms|O').match(new RegExp('(' + prefix + ')', 'i'))[1];\r\n\treturn {prefix:prefix, css:'-' + prefix + '-', api:api,};\r\n})();\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tvendorPrefix,\r\n}","\r\n/**\r\n * Splits a camel-cased string.\r\n *\r\n * @param string \tstr\r\n * @param string \tdelimiter\r\n *\r\n * @return string\r\n */\r\nexport default function(str, delimiter) {\r\n\treturn str === undefined ? '' : str.split(/(?=[A-Z])/).join(delimiter ? delimiter : ' '); // positive lookahead to keep the capital letters\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\n\r\n/**\r\n * ----------------------------------------\r\n * Establishes an operatiom that can be rolledback\r\n * without altering similar operation by other code.\r\n * ----------------------------------------\r\n */\r\n \r\nconst Transaction = class {\r\n\r\n\t/**\r\n\t * Creates a new transaction instance.\r\n\t *\r\n\t * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel \r\n\t * @param string|array|object\tparams\r\n\t * @param function\t \t\t\treadCallback\r\n\t * @param function\t \t\t\twriteCallback\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params, readCallback, writeCallback) {\r\n\t\tthis.el = el;\r\n\t\tthis.params = _arrFrom(params);\r\n\t\tthis.readCallback = readCallback;\r\n\t\tthis.writeCallback = writeCallback;\r\n\t\tthis.$savepoints = [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a savepoint that can be later rolled back to.\r\n\t *\r\n\t * @return Promise|mixed\r\n\t */\r\n\tsave() {\r\n\t\tvar readerDisposition = this.readCallback(this.el, this.params);\r\n\t\tif (readerDisposition instanceof Promise) {\r\n\t\t\treturn readerDisposition.then(data => this.$savepoints.push(data));\r\n\t\t} else if (_isObject(readerDisposition)) {\r\n\t\t\treturn this.$savepoints.push(readerDisposition);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Marks recods a commited.\r\n\t *\r\n\t * @param int\tsavepoint\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tcommit(savepoint = 0) {\r\n\t\tfor (var i = 0; i <= savepoint && savepoint < this.$savepoints.length; i ++) {\r\n\t\t\tthis.$savepoints[i] = null;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Rolls the transaction back to a savepoint.\r\n\t *\r\n\t * @param int\tsavepoint\r\n\t *\r\n\t * @return void}Promise\r\n\t */\r\n\trollback(savepoint = 0) {\r\n\t\tif (!_isNumeric(savepoint)) {\r\n\t\t\tthrow new Error('A valid transaction ID transaction must be provided!');\r\n\t\t}\r\n\t\t// -----------------------\r\n\t\tvar getRollbackData = currentRead => {\r\n\t\t\tvar savepoints = this.$savepoints.splice(savepoint);\r\n\t\t\t// ToSavepoint is our target point\r\n\t\t\tvar toSavepoint = savepoints.shift();\r\n\t\t\tif (!toSavepoint) {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t\t// FromSavepoint is our last point before current,\r\n\t\t\t// which we need to validate with current\r\n\t\t\tvar fromSavepoint = savepoints.pop();\r\n\t\t\tvar data = {};\r\n\t\t\t// Restore only what's applicable.\r\n\t\t\tthis.params.forEach(param => {\r\n\t\t\t\t// We'll restore only values that have\r\n\t\t\t\t// NOT changed from what we earlier COMMITTED...\r\n\t\t\t\tif (fromSavepoint && currentRead[param] !== fromSavepoint[param]) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// We'll restore only values that\r\n\t\t\t\t// HAVE changed from what we earlier RECORDED...\r\n\t\t\t\tif (currentRead[param] !== toSavepoint[param]) {\r\n\t\t\t\t\tdata[param] = toSavepoint[param];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn data;\r\n\t\t};\r\n\t\t// -----------------------\r\n\t\tvar currentRead = this.readCallback(this.el, this.params);\r\n\t\tif (currentRead instanceof Promise) {\r\n\t\t\treturn currentRead.then(currentRead => this.writeCallback(this.el, getRollbackData(currentRead)));\r\n\t\t}\r\n\t\treturn this.writeCallback(this.el, getRollbackData(currentRead));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns the number of pushes.\r\n\t *\r\n\t * @return int\r\n\t */\r\n\tdepth() {\r\n\t\treturn this.$savepoints.length;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Transaction;","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\n\r\n/**\r\n * ------------------------------\r\n * The little transform utility class\r\n * and stringifyer classes.\r\n * ------------------------------\r\n */\r\nconst TransformRule = class {\r\n\t\r\n\t/**\r\n\t * Creates a new TransformRule instance\r\n\t * and each rule's appropriate class.\r\n\t *\r\n\t * @param object\t\t transformRules\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(transformRules) {\r\n\t\t_each(transformRules, (rule, value) => {\r\n\t\t\tif (['rotate', 'scale', 'skew', 'translate'].includes(rule)) {\r\n\t\t\t\tthis[rule] = _isArray(value)\r\n\t\t\t\t\t? new TransformRule[rule](...value)\r\n\t\t\t\t\t: new TransformRule[rule](value);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Stringifies the transformRules in a CSS-compatible format.\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\treturn ['rotate', 'scale', 'skew', 'translate'].reduce(\r\n\t\t\t(str, rule) => str + (this[rule] && this[rule].length ? ' ' + this[rule] : ''), ''\r\n\t\t).trim();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Unmatrix: parse the values of the matrix\r\n\t *\r\n\t * Algorithm from:\r\n\t *\r\n\t * https://github.com/matthewmueller/unmatrix/blob/master/index.js\r\n\t * @see http://hg.mozilla.org/mozilla-central/file/7cb3e9795d04/layout/style/nsStyleAnimation.cpp\r\n\t *\r\n\t * @param string \t str\r\n\t *\r\n\t * @return {Object}\r\n\t */\r\n\tstatic parse(str) {\r\n\t\t// String to matrix\r\n\t\tvar stom = function(transformStr) {\r\n\t\t\tvar m = [];\r\n\t\t\tif (window.WebKitCSSMatrix) {\r\n\t\t\t\tm = new window.WebKitCSSMatrix(transformStr);\r\n\t\t\t\treturn [m.a, m.b, m.c, m.d, m.e, m.f];\r\n\t\t\t}\r\n\t\t\tvar rdigit = /[\\d\\.\\-]+/g;\r\n\t\t\tvar n;\r\n\t\t\twhile(n = rdigit.exec(transformStr)) {\r\n\t\t\t\tm.push(+n);\r\n\t\t\t}\r\n\t\t\treturn m;\r\n\t\t};\r\n\t\t// Round to the nearest hundredth\r\n\t\tvar round = function(n) {\r\n\t\t\treturn Math.round(n * 100) / 100;\r\n\t\t};\r\n\t\t// Radians to degrees\r\n\t\tvar r2d = function(radians) {\r\n\t\t\tvar deg = radians * 180 / Math.PI;\r\n\t\t\treturn round(deg);\r\n\t\t};\r\n\t\t// ---------------------------------\r\n\t\tvar m = stom(str);\r\n\t\tvar A = m[0];\r\n\t\tvar B = m[1];\r\n\t\tvar C = m[2];\r\n\t\tvar D = m[3];\r\n\t\tif (A * D == B * C) throw new Error('Dramatic.parseTransform: matrix is singular');\r\n\t\t// step (3)\r\n\t\tvar scaleX = Math.sqrt(A * A + B * B);\r\n\t\tA /= scaleX;\r\n\t\tB /= scaleX;\r\n\t\t// step (4)\r\n\t\tvar skew = A * C + B * D;\r\n\t\tC -= A * skew;\r\n\t\tD -= B * skew;\r\n\t\t// step (5)\r\n\t\tvar scaleY = Math.sqrt(C * C + D * D);\r\n\t\tC /= scaleY;\r\n\t\tD /= scaleY;\r\n\t\tskew /= scaleY;\r\n\t\t// step (6)\r\n\t\tif ( A * D < B * C ) {\r\n\t\t\tA = -A;\r\n\t\t\tB = -B;\r\n\t\t\tskew = -skew;\r\n\t\t\tscaleX = -scaleX;\r\n\t\t}\r\n\t\treturn new TransformRule({\r\n\t\t\ttranslate: [/*x*/m[4], /*y*/m[5],],\r\n\t\t\tscale: [/*x*/round(scaleX), /*y*/round(scaleY),],\r\n\t\t\trotate: r2d(Math.atan2(B, A)),\r\n\t\t\tskew: r2d(Math.atan(skew)),\r\n\t\t});\r\n\t};\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"rotate\" value class\r\n * -------------\r\n */\r\nTransformRule.rotate = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"rotate\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'deg' : val);\r\n\t\treturn 'rotate(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"scale\" array class\r\n * -------------\r\n */\r\nTransformRule.scale = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"scale\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\treturn 'scale(' + this.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"skew\" array class\r\n * -------------\r\n */\r\nTransformRule.skew = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"skew\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'deg' : val);\r\n\t\treturn 'skew(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"translate\" array class\r\n * -------------\r\n */\r\nTransformRule.translate = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"translate\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'px' : val);\r\n\t\treturn 'translate(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default TransformRule;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tvendorPrefix\r\n} from '../../App/Client.js';\r\nimport _fromCamel from '@onephrase/commons/str/fromCamel.js';\r\nimport _toCamel from '@onephrase/commons/str/toCamel.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _replace from '@onephrase/commons/arr/replace.js';\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\nimport _copyPlain from '@onephrase/commons/obj/copyPlain.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport Transaction from '../Transaction.js';\r\nimport Reflow from '../Reflow.js';\r\nimport TransformRule from './TransformRule.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Returns computed CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|array\t\tprops\r\n * @param string\t\t\tpsuedo\r\n *\r\n * @return object|string\r\n */\r\nconst cssRead = function(el, props, psuedo = null) {\r\n\tvar style = window.getComputedStyle(el, psuedo), rect;\r\n\treturn ruleCallback(props, (prop, rawProp) => {\r\n\t\tvar val = style.getPropertyValue(vendorize(prop) || prop);\r\n\t\tif ((prop === 'width' || prop === 'height') && val === '') {\r\n\t\t\tval = '0px';\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// We return an object for the \"transform\" property\r\n\t\t// -----------------------------\r\n\t\tif (prop === 'transform') {\r\n\t\t\tval = TransformRule.parse(val);\r\n\t\t}\r\n\t\treturn val;\r\n\t}, false/*withVendorVersion*/);\r\n};\r\n\r\n/**\r\n * Sets new CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tnameOrProps\r\n * @param string|number\t\tval\r\n *\r\n * @return HTMLElement\r\n */\r\nconst cssWrite = function(el, nameOrProps, val = null) {\r\n\tnameOrProps = typeof nameOrProps === 'string' \r\n\t\t? _objFrom(nameOrProps, val)\r\n\t\t: nameOrProps;\r\n\tvar destructables = {\r\n\t\tinset: ['top', 'right', 'bottom', 'left'],\r\n\t\tmargin: ['top', 'right', 'bottom', 'left'],\r\n\t\tpadding: ['top', 'right', 'bottom', 'left'],\r\n\t};\r\n\truleCallback(Object.keys(nameOrProps), (prop, rawProp) => {\r\n\t\tvar val = nameOrProps[rawProp];\r\n\t\t// -----------------------------\r\n\t\t// We can destucture things like \"inset\"(\"left\", \"top\", \"right\", \"bottom\"), etc\r\n\t\t// -----------------------------\r\n\t\t_each(destructables, (destructableProp, meaning) => {\r\n\t\t\tif (prop === destructableProp) {\r\n\t\t\t\tif (_isObject(val)) {\r\n\t\t\t\t\tval = meaning.map(key => val[key]).filter(val => !_isUndefined(val));\r\n\t\t\t\t}\r\n\t\t\t\tif (_isArray(val)) {\r\n\t\t\t\t\tval = val.join(' ');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t// -----------------------------\r\n\t\t// We accept an object for the \"transform\" property\r\n\t\t// -----------------------------\r\n\t\tif (prop === 'transform' && _isObject(val) && !(val instanceof TransformRule)) {\r\n\t\t\tval = (new TransformRule(val)).toString();\r\n\t\t}\r\n\t\tel.style[prop] = autopx.includes(prop) && _isNumeric(val)\r\n\t\t\t? val + 'px'\r\n\t\t\t: val;\r\n\t}, 'auto'/*withVendorVersion*/);\r\n\treturn el;\r\n};\r\n \r\n/**\r\n * The cssRead() and cssWrite() function in one signature.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param array\t\t\t\t...args\r\n *\r\n * @return mixed\r\n */\r\nconst css = function(el, ...args) {\r\n\tif ((args.length > 1 && _isString(args[0])) || _isObject(args[0])) {\r\n\t\treturn cssWrite(el, ...args);\r\n\t}\r\n\treturn cssRead(el, ...args);\r\n};\r\n \r\n/**\r\n * ---------------------\r\n * ASYNC METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * The async type of cssRead().\r\n *\r\n * @see cssRead()\r\n *\r\n * @return Promise\r\n */\r\nconst cssReadAsync = function(el, props, psuedo = null) {\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(_isFunction(props) ? props(el) : cssRead(el, props, psuedo));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of cssWrite().\r\n *\r\n * @see cssWrite()\r\n *\r\n * @return Promise\r\n */\r\nconst cssWriteAsync = function(el, nameOrProps, val = null) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(cssWrite(el, nameOrProps, val));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n \r\n/**\r\n * The async type of css().\r\n *\r\n * @see css()\r\n *\r\n * @return Promise\r\n */\r\nconst cssAsync = function(el, ...args) {\r\n\tif ((args.length > 1 && _isString(args[0])) || _isObject(args[0])) {\r\n\t\treturn cssWriteAsync(el, ...args);\r\n\t}\r\n\treturn cssReadAsync(el, ...args);\r\n};\r\n\r\n/**\r\n * Applies some CSS within a transaction, gets computed values for use before rolling back.\r\n * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n *\r\n * @param HTMLElement\t\tel \r\n * @param string|object\t\tnameOrProps\r\n * @param string|number\t\tval\r\n * @param function\t\t\treadCallback\r\n *\r\n * @return Promise\r\n */\r\nconst cssComputeAsync = function(el, nameOrProps, val = null, readCallback = null) {\r\n\tvar propsToRead = _isObject(nameOrProps) ? Object.keys(nameOrProps) : nameOrProps;\r\n\treadCallback = _isObject(nameOrProps) ? val : readCallback;\r\n\t// -------------\r\n\tvar inlineSavepoint = cssReadInline(el, propsToRead);\r\n\treturn cssWriteAsync(el, nameOrProps, val).then(() => {\r\n\t\treturn cssReadAsync(el, readCallback || propsToRead).then(computedValues => {\r\n\t\t\t// We return the computedValues in a promise\r\n\t\t\treturn cssWriteAsync(el, inlineSavepoint).then(() => {\r\n\t\t\t\treturn computedValues;\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n};\r\n\r\n/**\r\n * Establishes a CSS operatiom that can be rolledback without altering similar operation by other code.\r\n * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n *\r\n * @param HTMLElement\t\t\tel \r\n * @param string|array\t\t\tprops\r\n *\r\n * @return Transaction\r\n */\r\nconst cssTransaction = function(el, props) {\r\n\treturn new Transaction(el, props, (el, props) => {\r\n\t\treturn cssReadInline(el, props);\r\n\t}, (el, data) => {\r\n\t\treturn cssWriteAsync(el, data);\r\n\t});\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Stylesheet functions.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Returns inline-only CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tprop\r\n * @param bool|string\t\twithVendorVersions\r\n *\r\n * @return mixed\r\n */\r\nconst cssReadInline = function(el, props, withVendorVersion = 'auto') {\r\n\tvar style = el.getAttribute('style');\r\n\tif (props === 'all') {\r\n\t\tprops = style.split(';').map(str => str.split(':')[0]);\r\n\t}\r\n\treturn ruleCallback(props, prop => {\r\n\t\tvar regex = new RegExp(';[ ]*?' + prop + ':([^;]+);?', 'g');\r\n\t\treturn (regex.exec(';' + style) || ['', ''])[1].trim();\r\n\t}, withVendorVersion);\r\n};\r\n\r\n/**\r\n * Returns inline-only CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tprop\r\n * @param bool\t\t\t\tnoCache\r\n * @param bool\t\t\t\twithVendorVersions\r\n *\r\n * @return jQuery|object|string\r\n */\r\nconst cssReadStylesheet = function(el, props, noCache, withVendorVersion = 'auto') {\r\n\t// Ask cache first...\r\n\tvar cacheKey = _isArray(props) ? props.join('|') : props;\r\n\tif (!noCache && stylesheetCache[cacheKey] && stylesheetCache[cacheKey].el === el) {\r\n\t\treturn stylesheetCache[cacheKey]._remove(el);\r\n\t}\r\n\t// Find rules\r\n\tvar allRules = [];\r\n\tstylesheetRuleCallback(ruleDefinition => {\r\n\t\tif (ruleDefinition.type === window.CSSRule.STYLE_RULE && el.matches(ruleDefinition.selectorText)) {\r\n\t\t\tvar propsList = props;\r\n\t\t\tif (!props/*original*/) {\r\n\t\t\t\tpropsList = [];\r\n\t\t\t\tfor (var i = 0; i < ruleDefinition.style.length; i ++) {\r\n\t\t\t\t\tpropsList.push(ruleDefinition.style[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tallRules.push(ruleCallback(propsList, prop => {\r\n\t\t\t\treturn ruleDefinition.style[prop];\r\n\t\t\t}, withVendorVersion));\r\n\t\t}\r\n\t});\r\n\t// Handle priority\r\n\tallRules.forEach(rules => {});\r\n\t// Save\r\n\tif (!stylesheetCache) {\r\n\t\tstylesheetCache = {};\r\n\t}\r\n\tstylesheetCache[cacheKey] = allRules.slice();\r\n\tstylesheetCache[cacheKey].el = el;\r\n\treturn allRules;\r\n};\r\n\t\t\r\n/**\r\n * FInds the keyframes of the given animation name(s) across all stylesheets.\r\n *\r\n * @param string|array\t\tname\r\n * @param bool\t\t\t\tnoCache\r\n * @param bool\t\t\t\tnormalize\r\n *\r\n * @return NULL|bool\r\n */\r\nconst cssReadKeyframes = function(name, noCache, normalize = true) {\r\n\t// Ask cache first...\r\n\tvar cacheKey = _isArray(name) ? name.join('|') : name;\r\n\tif (!noCache && stylesheetKeyframesCache[cacheKey]) {\r\n\t\treturn stylesheetKeyframesCache[cacheKey];\r\n\t}\r\n\t// Parse keyframes rule\r\n\tvar parseKeyframes = function(ruleDefinition) {\r\n\t\tvar keyframes = [];\r\n\t\tfor (var i = 0; i < ruleDefinition.cssRules.length; i ++) {\r\n\t\t\tvar keyframeRule = ruleDefinition.cssRules[i];\r\n\t\t\tvar keyframe = parseRules(keyframeRule.cssText\r\n\t\t\t\t.replace(keyframeRule.keyText, '').replace('{', '').replace('}', '').trim()\r\n\t\t\t);\r\n\t\t\tvar offsets = (keyframeRule.keyText || ' ').split(',').map(key => key === 'from' ? 0 : (key === 'to' ? 1 : (parseInt(key) / 100)));\r\n\t\t\tif (normalize) {\r\n\t\t\t\tnormalizeToWAAPI(keyframe, ['animation-', 'transition-']);\r\n\t\t\t\twhile(offsets.length) {\r\n\t\t\t\t\tvar _keyframe = _copyPlain(keyframe);\r\n\t\t\t\t\t_keyframe.offset = offsets.shift();\r\n\t\t\t\t\tkeyframes.push(_keyframe);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tkeyframe.offset = offsets.length > 1 ? offsets : offsets[0];\r\n\t\t\t\tkeyframes.push(keyframe);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn keyframes.sort((a, b) => a.offset === b.offset ? 0 : a.offset > b.offset ? 1 : -1);\r\n\t};\r\n\t// Find keyframes\r\n\tvar allKeyframes = [];\r\n\tstylesheetRuleCallback(ruleDefinition => {\r\n\t\tif ((ruleDefinition.type === window.CSSRule.KEYFRAMES_RULE || ruleDefinition.type === window.CSSRule[vendorPrefix.api.toUpperCase() + '_KEYFRAMES_RULE'])\r\n\t\t&& (_isArray(name) ? name : [name]).indexOf(ruleDefinition.name) > -1) {\r\n\t\t\tallKeyframes = allKeyframes.concat(allKeyframes, parseKeyframes(ruleDefinition));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}, true/*reversed*/);\r\n\t// Save\r\n\tstylesheetKeyframesCache[cacheKey] = allKeyframes;\r\n\treturn allKeyframes;\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Other utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Tells if the element's width is defined as auto.\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return bool\r\n */\r\nconst isAutoWidth = function(el) {\r\n};\r\n\r\n/**\r\n * Tells if the element's height is defined as auto.\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return bool\r\n */\r\nconst isAutoHeight = function(el) {\r\n};\r\n\r\n/**\r\n * Parses/decodes the element's transform rule\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return object\r\n */\r\nconst transformRule = function(el) {\r\n};\r\n\t\t\r\n/**\r\n * Returns preset easing functions from CSS variables.\r\n *\r\n * @param string \tname\r\n *\r\n * @return string|NULL\r\n */\r\nconst cssVarRead = function(name) {\r\n\t var name = !name.indexOf('-') ? _fromCamel(name, '-') : name;\r\n\treturn window.getComputedStyle(document.body).getPropertyValue('--' + name);\r\n};\r\n\r\n// -----------------------------------------\r\n// -----------------------------------------\r\n\r\n/**\r\n * Normalizes CSS animation properties to WAAPI compatible properties\r\n *\r\n * @param object\t\t\tanimationProps\r\n * @param string|arrau\t\tprefix\r\n * @param string|arrau\t\toffset\r\n *\r\n * @return null\r\n */\r\nconst normalizeToWAAPI = function(animationProps, offset, prefix = '') {\r\n\tif (_isArray(prefix)) {\r\n\t\tprefix.forEach(pref => {normalizeToWAAPI(animationProps, pref)});\r\n\t\treturn;\r\n\t}\r\n\tif (animationProps[prefix + 'timing-function']) {\r\n\t\tanimationProps.easing = animationProps[prefix + 'timing-function'];\r\n\t\tdelete animationProps[prefix + 'timing-function'];\r\n\t}\r\n\tif (animationProps[prefix + 'fill-mode']) {\r\n\t\tanimationProps.fill = animationProps[prefix + 'fill-mode'];\r\n\t\tdelete animationProps[prefix + 'fill-mode'];\r\n\t}\r\n\tif (animationProps[prefix + 'iteration-count']) {\r\n\t\tanimationProps.iterations = animationProps[prefix + 'iteration-count'];\r\n\t\tdelete animationProps[prefix + 'iteration-count'];\r\n\t\tif (animationProps.iterations === 'infinite') {\r\n\t\t\tanimationProps.iterations = Infinity;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Loops thru all keys in props calls callback to obtain their value.\r\n *\r\n * @param string|array\t\tprops\r\n * @param function\t\t\tcallback\r\n * @param bool\t\t\t\twithVendorVersion\r\n *\r\n * @return NULL|bool\r\n */\r\nconst ruleCallback = function(props, callback, withVendorVersion) {\r\n\tvar valsList = {};\r\n\tvar propsList = _arrFrom(props);\r\n\tvar callCallback = (i, prop) => {\r\n\t\t// We use the key as given, but we obtain value with\r\n\t\t// We support camel cases, but return their normalized versions\r\n\t\tvar normalProp = _fromCamel(prop, '-').toLowerCase();\r\n\t\t// With vendor verison?\r\n\t\t// We set the vendor version first if support for this property\r\n\t\tif (withVendorVersion === 'auto') {\r\n\t\t\tvalsList[normalProp] = callback(vendorize(normalProp) || normalProp, propsList[i]);\r\n\t\t} else {\r\n\t\t\tif (withVendorVersion) {\r\n\t\t\t\tvar vendorizedProp = vendorize(normalProp);\r\n\t\t\t\tif (vendorizedProp) {\r\n\t\t\t\t\tvalsList[vendorizedProp] = callback(vendorizedProp, propsList[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalsList[normalProp] = callback(normalProp, propsList[i]);\r\n\t\t}\r\n\t};\r\n\t_each(propsList, (i, prop) => {\r\n\t\tcallCallback(i, prop);\r\n\t});\r\n\treturn _isArray(props) || withVendorVersion || props === 'size' || props === 'offsets' \r\n\t\t? valsList \r\n\t\t: valsList[props];\r\n};\r\n\r\n/**\r\n * Loops thru all rules in all stylesheets (in reverse order possible).\r\n *\r\n * @param function\t\t\tcallback\r\n * @param bool\t\t\t\treversed\r\n *\r\n * @return NULL|bool\r\n */\r\nconst stylesheetRuleCallback = function(callback, reversed) {\r\n\tvar stylesheets = document.styleSheets;\r\n\tvar stylesheetCallback = function(stylesheet) {\r\n\t\ttry {\r\n\t\t\tfor (var k = 0; k < stylesheet.cssRules.length; k ++) {\r\n\t\t\t\tvar ruleDefinition = stylesheet.cssRules[k];\r\n\t\t\t\tif (callback(ruleDefinition) === true) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {}\r\n\t}\r\n\tif (reversed) {\r\n\t\tfor (var i = stylesheets.length - 1; i >= 0; i --) {\r\n\t\t\tif (stylesheetCallback(stylesheets[i]) === true) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var i = 0; i < stylesheets.length; i ++) {\r\n\t\t\tif (stylesheetCallback(stylesheets[i]) === true) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Parses/decodes transform rule\r\n *\r\n * @param string str\r\n *\r\n * @return object\r\n */\r\nconst stylesheetTransformRuleParse = function(str) {\r\n\tvar transform = {};\r\n\tvar regex = /(\\w+)\\((.+?)\\)/g;\r\n\tvar match = null;\r\n\twhile(match = regex.exec(str)) {\r\n\t\ttransform[match[1]] = (match[2].indexOf(',') > -1 ? match[2].replace(' ', '').split(',') : match[2]);\r\n\t}\r\n\treturn transform;\r\n};\r\n\t\t\r\n/**\r\n * Helper method: parses a CSS string into an associative array.\r\n *\r\n * @param string\t \tcss\r\n *\r\n * @return object\r\n */\r\nconst parseRules = function(css) {\r\n\tvar split = {};\r\n\t_each(css.split(';'), (i, rule) => {\r\n\t\trule = rule.split(':');\r\n\t\tsplit[rule[0].trim()] = rule[1].trim();\r\n\t});\r\n\treturn split;\r\n};\r\n\r\n/**\r\n * Helper method: stringifies an associative array into a CSS string.\r\n *\r\n * @param object\t \tcss\r\n *\r\n * @return string\r\n */\r\nconst stringifyRules = function(css) {\r\n\tvar str = [];\r\n\t_each(css, (propName, value) => {\r\n\t\tstr.push(propName + ': ' + value);\r\n\t});\r\n\treturn str.join('; ');\r\n};\r\n\t\t\r\n/**\r\n * Gets an accurate width of the device scrollbar by running a test.\r\n * (Adapted from bootstrap.js)\r\n *\r\n * @return int\r\n */\r\nconst standardScrollbarWidth = function() {\r\n\tvar style = 'position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll';\r\n\tvar d = $('<div style=\"' + style + '\"></div>');\r\n\tdocument.body.appendChild(d);\r\n\t// Answer 2\r\n\tc = d[0].offsetWidth - d[0].clientWidth;\r\n\tdocument.body.removeChild(d);\r\n\treturn c;\r\n};\r\n\r\n/**\r\n * Returns the vendor-specific css property if supported. NULL if not.\r\n *\r\n * @param string \tprop\r\n *\r\n * @return string|NULL\r\n */\r\nconst vendorize = function(prop) {\r\n\tvar camelCasedProp = _toCamel(prop, true);\r\n\tif (vendorPrefix.api + camelCasedProp in document.body.style) {\r\n\t\treturn vendorPrefix.css + _fromCamel(prop, '-');\r\n\t}\r\n};\r\n\r\n/**\r\n * CSS properties that must have a default pixel unit.\r\n *\r\n * @var array\r\n */\r\nconst autopx = ['width', 'height', 'top', 'left', 'right', 'bottom',\r\n\t'padding', 'padding-top', 'padding-left', 'padding-right', 'padding-bottom',\r\n\t'margin', 'margin-top', 'margin-left', 'margin-right', 'margin-bottom',\r\n\t'border-width', 'border-top-width', 'border-left-width', 'border-right-width', 'border-bottom-width',\r\n\t'outline-width', 'outline-top-width', 'outline-left-width', 'outline-right-width', 'outline-bottom-width',\r\n];\r\n\t\r\n/**\r\n * @var object\r\n */\r\nconst stylesheetCache = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nconst stylesheetKeyframesCache = {};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tcssRead,\r\n\tcssWrite,\r\n\tcss,\r\n\tcssReadAsync,\r\n\tcssWriteAsync,\r\n\tcssAsync,\r\n\tcssReadInline,\r\n\tcssComputeAsync,\r\n\tcssTransaction,\r\n\tcssReadStylesheet,\r\n\tcssReadKeyframes,\r\n\tisAutoWidth,\r\n\tisAutoHeight,\r\n\ttransformRule,\r\n\tcssVarRead,\r\n\tstandardScrollbarWidth,\r\n\tvendorize,\r\n\tautopx,\r\n};\r\nexport default css;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Finds a value in an array/object and returns the key (or path when found deep).\r\n *\r\n * @param array}object \tobj\r\n * @param function\t\tcallback\r\n * @param bool\t\t\tdeep\r\n *\r\n * @return number|string|array\r\n */\r\nconst _find = function(obj, callback, deep = false) {\r\n\tvar keys = null;\r\n\tvar values = obj;\r\n\tif (!_isArray(obj)) {\r\n\t\tkeys = Object.keys(obj);\r\n\t\tvalues = Object.values(obj);\r\n\t}\r\n\tvar subKey = undefined;\r\n\tvar value = values.reduce((prev, curr) => {\r\n\t\tif (subKey === undefined) {\r\n\t\t\tif (callback(curr, prev)) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t\tif (deep && (_isTypeObject(curr) || _isFunction(curr)) && (subKey = _find(curr, callback, deep)) !== undefined) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn prev;\r\n\t}, undefined);\r\n\tif (value !== undefined) {\r\n\t\tvar key = keys ? keys[values.indexOf(value)] : values.indexOf(value);\r\n\t\treturn subKey !== undefined ? [key].concat(_arrFrom(subKey)) : key;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _find;","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Custom events\r\n * ---------------------------\r\n *\r\n * @var object\r\n */\t\t\t\t\r\nconst CustomEvents = {};\r\n\r\n/**\r\n * Multitap events\r\n */\r\nconst Multitap = {\r\n\t\r\n\t/**\r\n\t * Binds all multitap events.\r\n\t */\r\n\tsetup(fireCallback, el, hammertime, eventName) {\r\n\t\tvar allSetup = true;\r\n\t\tvar recognizers = Multitap.events.map((tapType, i) => {\r\n\t\t\tvar recognizer = hammertime.get(tapType);\r\n\t\t\tif (!recognizer) {\r\n\t\t\t\tallSetup = false;\r\n\t\t\t\trecognizer = new Hammer.Tap({\r\n\t\t\t\t\tevent: tapType,\r\n\t\t\t\t\ttaps: Multitap.events.length - i,\r\n\t\t\t\t});\r\n\t\t\t\thammertime.add(recognizer);\r\n\t\t\t}\r\n\t\t\treturn recognizer;\r\n\t\t});\r\n\t\tif (!allSetup) {\r\n\t\t\t// From left to right, recognizeWith all others ahead\r\n\t\t\tvar recgzr, recgzrs = recognizers.slice();\r\n\t\t\twhile((recgzr = recgzrs.shift()) && recgzrs.length) {\r\n\t\t\t\trecgzr.recognizeWith(recgzrs);\r\n\t\t\t}\r\n\t\t\t// From right to left, recognizeWith all others behind\r\n\t\t\tvar recgzr2, recgzrs2 = recognizers.slice();\r\n\t\t\twhile((recgzr2 = recgzrs2.pop()) && recgzrs2.length) {\r\n\t\t\t\trecgzr2.requireFailure(recgzrs2);\r\n\t\t\t}\r\n\t\t}\r\n\t\thammertime.on(eventName, e => fireCallback(e.type, {\r\n\t\t\tcontext:_objFrom(e.type, e)\r\n\t\t}));\r\n\t},\r\n\t\r\n\t/**\r\n\t * Unbinds all multitap events.\r\n\t */\r\n\tteardown(el, hammertime, eventName) {\r\n\t\thammertime.off(eventName);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Now additional taps is achieved by\r\n\t * simply prepending to this array.\r\n\t */\r\n\tevents: ['tripletap', 'doubletap', 'singletap'],\r\n};\r\n// Add all to CustomEvents\r\nMultitap.events.forEach(event => {\r\n\tCustomEvents[event] = Multitap;\r\n});\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tMultitap\r\n};\r\nexport default CustomEvents;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tdomData\r\n} from '../Dom.js';\r\nimport {\r\n\tEventController as _EventController,\r\n\tEvent\r\n} from '@onephrase/observable';\r\nimport _toTitle from '@onephrase/commons/str/toTitle.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\nimport _find from '@onephrase/commons/obj/find.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport CustomEvents from './CustomEvents.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Router class\r\n * ---------------------------\r\n *\r\n * This class provides additional functionality over native events.\r\n * \r\n * The EventController.fire() method has support for a listener's \"return false\"\r\n * and the consolidated Promise of \"sync\" listeners.\r\n *\r\n * EventController.addListener() can also be used to observe other \"events\" that the native addEventListener() does not support:\r\n * customEvents, @ownMutationEvents, @attributeMutationEvents, #childTreeMutationEvents, :states, ~gestures.\r\n *\r\n * EventController.unobserve() goes with a decision to use EventController.observe().\r\n */\t\t\t\t\r\nconst EventController = class extends _EventController {\r\n\r\n\t/**\r\n\t * Constructs a new observable and returns a proxy wrapper.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.el = el;\r\n\t\tthis.$.params = params;\r\n\t\tthis.$.activeHooks = {};\r\n\t\tthis.$.hammertime = new Hammer.Manager(this.el);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up an event type when its first listener is added.\r\n\t *\r\n\t * @param string NAME \r\n\t * @param object params \r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_setup(NAME, params) {\r\n\t\t// We register an event only once.\r\n\t\tif (this.$.activeHooks[NAME]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (CustomEvents[NAME]) {\r\n\t\t\tif (_isString(CustomEvents[NAME])) {\r\n\t\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_objFrom(NAME, e)});\r\n\t\t\t\t// Setup: we'll observe CustomEvents[NAME] to process and push the CUSTOM event/state.\r\n\t\t\t\tthis.addListener(CustomEvents[NAME], this.$.activeHooks[NAME]);\r\n\t\t\t} else if (_isFunction(CustomEvents[NAME].setup)) {\r\n\t\t\t\tthis.$.activeHooks[NAME] = true;\r\n\t\t\t\t// Custom setup. We supply the this.observe, this.trigger methods incase they'll be needed.\r\n\t\t\t\tCustomEvents[NAME].setup((firedEvents, firedEventsDetails) => {\r\n\t\t\t\t\tif (!_isFunction(CustomEvents[NAME].validate) \r\n\t\t\t\t\t|| CustomEvents[NAME].validate(firedEvents, firedEventsDetails, NAME, params)) {\r\n\t\t\t\t\t\tthis.fire(firedEvents, firedEventsDetails)\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this.el, this.$.hammertime, NAME);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('The \"' + NAME + '\" event hook must have a \"setup\" function!');\r\n\t\t\t}\r\n\t\t} else if (recognizeGesture(NAME.split('+')[0])) {\r\n\t\t\t// Lets work as if if always a list\r\n\t\t\tvar recognizers = NAME.split('+').map(gestureName => {\r\n\t\t\t\tvar mainGestureName = recognizeGesture(gestureName);\r\n\t\t\t\tvar recognizer = this.$.hammertime.get(mainGestureName);\r\n\t\t\t\tif (!recognizer) {\r\n\t\t\t\t\trecognizer = new Hammer[_toTitle(mainGestureName)];\r\n\t\t\t\t\tthis.$.hammertime.add(recognizer);\r\n\t\t\t\t}\r\n\t\t\t\treturn recognizer;\r\n\t\t\t});\r\n\t\t\t// From right to left, recognizeWith all others ahead\r\n\t\t\trecognizers.forEach((recognizer, i) => {\r\n\t\t\t\trecognizer.recognizeWith(recognizers.slice(i + 1));\r\n\t\t\t});\r\n\t\t\t// Listen now...\r\n\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_objFrom(NAME, e)});\r\n\t\t\tthis.$.hammertime.on(NAME.split('+').join(' '), this.$.activeHooks[NAME]);\r\n\t\t} else {\r\n\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_objFrom(NAME, e)});\r\n\t\t\t// Setup: we'll observe a native event to process and push ours.\r\n\t\t\tthis.el.addEventListener(NAME, this.$.activeHooks[NAME]);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * Tears down an event type when its last listener is removed.\r\n\t *\r\n\t * @param string NAME \r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_teardown(NAME) {\r\n\t\t// We register an event only once.\r\n\t\tif (!this.$.activeHooks[NAME]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (CustomEvents[NAME]) {\r\n\t\t\tif (_isString(CustomEvents[NAME])) {\r\n\t\t\t\t// Level1 custom event\r\n\t\t\t\tthis.removeListener(CustomEvents[NAME], this.$.activeHooks[NAME]);\r\n\t\t\t} else if (_isFunction(CustomEvents[NAME].teardown)) {\r\n\t\t\t\t// Level2 custom event. We supply the this.unobserve method incase it'll be needed.\r\n\t\t\t\tCustomEvents[NAME].teardown(this.el, this.$.hammertime, NAME);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('The \"' + NAME + '\" event hook must have a \"teardown\" function!');\r\n\t\t\t}\r\n\t\t} else if (recognizeGesture(NAME.split('+')[0])) {\r\n\t\t\tthis.$.hammertime.off(NAME.split('+').join(' '), this.$.activeHooks[NAME]);\r\n\t\t} else {\r\n\t\t\t// Native event\r\n\t\t\tthis.el.removeEventListener(NAME, this.$.activeHooks[NAME]);\r\n\t\t}\r\n\t\tdelete this.$.activeHooks[NAME];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see super.observe()\r\n\t *\r\n\t * Captures the params being observed and sets up their hooks\r\n\t * when their first listener just gets added.\r\n\t */\r\n\taddListener(...args) {\r\n\t\tvar listener = super.addListener(...args);\r\n\t\t_arrFrom(listener.eventNames).forEach(NAME => {\r\n\t\t\tthis._setup(NAME, listener.params);\r\n\t\t});\r\n\t\tlistener.removeCallback = () => {\r\n\t\t\t_arrFrom(listener.eventNames).forEach(NAME => {\r\n\t\t\t\tthis._teardown(NAME);\r\n\t\t\t});\r\n\t\t};\r\n\t\treturn listener;\r\n\t}\r\n};\r\n\r\n/**\r\n * Gesture reference.\r\n */\r\nconst gestureIndex = {\r\n\tpress: \t['press', 'pressup',], \r\n\trotate:\t['rotate', 'rotatestart', 'rotatemove', 'rotateend', 'rotatecancel',],\r\n\tpinch: \t['pinch', 'pinchstart', 'pinchmove', 'pinchend', 'pinchcancel', 'pinchin', 'pinchout',], \r\n\tpan: \t['pan', 'panstart', 'panmove', 'panend', 'pancancel', 'panleft', 'panright', 'panup', 'pandown',],\r\n\tswipe: \t['swipe', 'swipeleft', 'swiperight', 'swipeup', 'swipedown',],\r\n\ttap: \t['tap',],\r\n};\r\n\r\n/**\r\n * Finds the recognizer for a gestureName.\r\n *\r\n * @param string\tgestureName\r\n *\r\n * @return string\r\n */\r\nconst recognizeGesture = function(gestureName) {\r\n\treturn _find(gestureIndex, list => list.includes(gestureName), false/*deep*/);\r\n};\r\n\r\n/**\r\n * Binds listeners to an element's event controller.\r\n *\r\n * @param DOMElement \t\t\tel\r\n * @param array\t\t \t\t\t...args\r\n *\r\n * @return object\r\n */\r\nconst addListener = function(el, ...args) {\r\n\tif (!domData(el, 'eventController')) {\r\n\t\tdomData(el, 'eventController', new EventController(el));\r\n\t}\r\n\treturn domData(el, 'eventController').addListener(...args);\r\n};\r\n\r\n/**\r\n * Unbinds listeners from an element's event controller.\r\n *\r\n * @param DOMElement \t\t\tel\r\n * @param array\t\t \t\t\t...args\r\n *\r\n * @return bool\r\n */\r\nconst removeListener = function(el, ...args) {\r\n\tif (domData(el, 'eventController')) {\r\n\t\treturn domData(el, 'eventController').removeListener(...args);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\taddListener,\r\n\tremoveListener,\r\n};\r\nexport default EventController;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tcssRead,\r\n\tcssWrite,\r\n\tcssComputeAsync,\r\n\tcssReadKeyframes,\r\n\tcssVarRead,\r\n\tautopx as cssAutopx\r\n} from '../Css/Css.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _exclude from '@onephrase/commons/arr/exclude.js';\r\nimport _pushUnique from '@onephrase/commons/arr/pushUnique.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumber from '@onephrase/commons/js/isNumber.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport TransformRule from '../Css/TransformRule.js';\r\nimport Reflow from '../Reflow.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\t\t\t\r\nconst Anim = class {\r\n\t\r\n\t/**\r\n\t * Creates an amiation from\r\n\t * any of keyframes, CSS keyframe name, or CSS object.\r\n\t *\r\n\t * @param DOMNode\t\t\t\tel\r\n\t * @param array|object|string\teffect\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el, effect, params = {}) {\r\n\t\t// Private properties\r\n\t\tthis.el = el;\r\n\t\tthis.$ = {\r\n\t\t\treadyCallbacks: [],\r\n\t\t\tfinishCallbacks: [],\r\n\t\t\tcancelCallbacks: [],\r\n\t\t\tparams: params,\r\n\t\t};\r\n\t\t// -----------------------------\r\n\t\t// Normalize params...\r\n\t\t// -----------------------------\r\n\t\tparams.fill = params.fill || 'both';\r\n\t\tif (!('duration' in params)) {\r\n\t\t\tparams.duration = 400;\r\n\t\t}\r\n\t\t// Convert certain easing strings to beizier curves\r\n\t\tif (params.easing && ['ease-in', 'ease-out', 'ease-in-out'].indexOf(params.easing) === -1 && params.easing.indexOf('(') === -1) {\r\n\t\t\t// Native easings, custom cubic-beziers, or Dramatic's cubic-beziers\r\n\t\t\tparams.easing = cssVarRead(params.easing) || params.easing;\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Normalize keyframes...\r\n\t\t// -----------------------------\r\n\t\tvar destructables = {\r\n\t\t\tinset: ['top', 'right', 'bottom', 'left'],\r\n\t\t\tmargin: ['top', 'right', 'bottom', 'left'],\r\n\t\t\tpadding: ['top', 'right', 'bottom', 'left'],\r\n\t\t};\r\n\t\tconst init = keyframes => {\r\n\t\t\tkeyframes = keyframes.slice();\r\n\t\t\t// Mine out end-state properties\r\n\t\t\tvar firstFrame = {};\r\n\t\t\tvar lastFrame = {};\r\n\t\t\t_each(keyframes, (i, keyframe) => {\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t// We can destucture things like \"inset\"(\"left\", \"top\", \"right\", \"bottom\"), etc\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t_each(destructables, (destructableProp, meaning) => {\r\n\t\t\t\t\tif (keyframe[destructableProp]) {\r\n\t\t\t\t\t\tif (_isObject(keyframe[destructableProp])) {\r\n\t\t\t\t\t\t\tkeyframe[destructableProp] = meaning.map(key => keyframe[destructableProp][key]).filter(val => !_isUndefined(val));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (_isArray(keyframe[destructableProp])) {\r\n\t\t\t\t\t\t\tkeyframe[destructableProp] = keyframe[destructableProp].join(' ');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t// We accept an object for the \"transform\" property\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\tif (keyframe.transform && _isObject(keyframe.transform) && !(keyframe.transform instanceof TransformRule)) {\r\n\t\t\t\t\tkeyframe.transform = (new TransformRule(keyframe.transform)).toString();\r\n\t\t\t\t}\r\n\t\t\t\t// Marshal out its properties\r\n\t\t\t\t_exclude(Object.keys(keyframe), 'offset', 'easing').forEach(prop => {\r\n\t\t\t\t\t// Auto-px\r\n\t\t\t\t\tif (cssAutopx.includes(prop) && _isNumeric(keyframe[prop])) {\r\n\t\t\t\t\t\tkeyframe[prop] += 'px';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Save last seen value of this property\r\n\t\t\t\t\t// across all keyframes...\r\n\t\t\t\t\tfirstFrame[prop] = typeof firstFrame[prop] === 'undefined' ? keyframe[prop] : firstFrame[prop];\r\n\t\t\t\t\tlastFrame[prop] = keyframe[prop];\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t// -----------------------------\r\n\t\t\t// The animation...\r\n\t\t\t// -----------------------------\r\n\t\t\ttry {\r\n\t\t\t\tvar anim = this.el.animate(keyframes, params);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tthis.$.error = e;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Reverse\r\n\t\t\tif (params.reverse) {\r\n\t\t\t\tanim.reverse();\r\n\t\t\t}\r\n\t\t\t// A little polifyll\r\n\t\t\tif (!anim.effect) {\r\n\t\t\t\tanim.effect = {};\r\n\t\t\t}\r\n\t\t\tif (!anim.effect.duration) {\r\n\t\t\t\tanim.effect.duration = params.duration;\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\t// \"onfinish\" and \"oncancel\" listener\r\n\t\t\t// -----------------------------\r\n\t\t\tanim.onfinish = () => {\r\n\t\t\t\t// As getter, as it were\r\n\t\t\t\tif (params.cancelForCss) {\r\n\t\t\t\t\tanim.cancel();\r\n\t\t\t\t\tif (params.fill === 'forwards' || params.fill === 'both') {\r\n\t\t\t\t\t\tcssWrite(this.el, lastFrame);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.finishCallbacks.forEach(callback => {\r\n\t\t\t\t\tcallback(this.el);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// oncancel listener\r\n\t\t\tanim.oncancel = () => {\r\n\t\t\t\t// As getter, as it were\r\n\t\t\t\tthis.$.cancelCallbacks.forEach(callback => {\r\n\t\t\t\t\tcallback(this.el);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// -------------------\r\n\t\t\tthis.$.anim = anim;\r\n\t\t\tthis.$.firstFrame = firstFrame;\r\n\t\t\tthis.$.lastFrame = lastFrame;\r\n\t\t\tif (this.$.readyCallbacks.length) {\r\n\t\t\t\tthis.$.readyCallbacks.forEach(callback => callback(anim, params, firstFrame, lastFrame));\r\n\t\t\t}\r\n\t\t\t// -------------------\r\n\t\t};\r\n\t\tif (_isFunction(effect)) {\r\n\t\t\teffect(el, init);\r\n\t\t} else {\r\n\t\t\tAnim.createCallback(el, effect, init, error => {\r\n\t\t\t\t// -------------------\r\n\t\t\t\tthis.$.error = error;\r\n\t\t\t\t// -------------------\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Animation-ready callback.\r\n\t *\r\n\t * @param function\t\tsucces\r\n\t * @param function\t\terror\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tready(succes, error) {\r\n\t\tif (this.$.error) {\r\n\t\t\tif (error) {\r\n\t\t\t\terror(this.$.error);\r\n\t\t\t}\r\n\t\t} else if (this.$.anim) {\r\n\t\t\tsucces(this.$.anim, this.$.params, this.$.firstFrame, this.$.lastFrame);\r\n\t\t} else {\r\n\t\t\tthis.$.readyCallbacks.push(succes);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a function to the \"onfinish\" event.\r\n\t *\r\n\t * @param function callback\r\n\t *\r\n\t * @return this\r\n\t *\r\n\t */\r\n\tonfinish(callback) {\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error(\"Onfinish() accepts only a function.\");\r\n\t\t}\r\n\t\tthis.$.finishCallbacks.push(callback);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a function to the \"oncancel\" event.\r\n\t *\r\n\t * @param function callback\r\n\t *\r\n\t * @return this\r\n\t *\r\n\t */\r\n\toncancel(callback) {\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error(\"Oncancel() accepts only a function.\");\r\n\t\t}\r\n\t\tthis.$.cancelCallbacks.push(callback);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Seeks the animation to a time.\r\n\t *\r\n\t * @param number to\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tseek(to) {\r\n\t\tif (!_isNumber(to)) {\r\n\t\t\tthrow new Error(\"Seek() accepts only a numeric value.\");\r\n\t\t}\r\n\t\tthis.ready((anim, effect) => {\r\n\t\t\tanim.currentTime = Math.min(to * effect.duration, effect.duration);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns the animation's progress.\r\n\t *\r\n\t * @return number\r\n\t */\r\n\tprogress() {\r\n\t\tif (this.$.anim) {\r\n\t\t\treturn this.$.anim.currentTime / this.$.anim.effect.duration;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Reverses the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\treverse() {\r\n\t\tthis.ready(anim => anim.reverse());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Plays the animation.\r\n\t * Returns an \"onfinish\" promise.\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tplay() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.ready(anim => {\r\n\t\t\t\tanim.play();\r\n\t\t\t\tthis.onfinish(() => resolve(this));\r\n\t\t\t\tthis.oncancel(() => reject(this));\r\n\t\t\t}, reject);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pauses the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tpause() {\r\n\t\tthis.ready(anim => anim.pause());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finishes the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tfinish() {\r\n\t\tthis.ready(anim => anim.finish());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cancels the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tcancel() {\r\n\t\tthis.ready(anim => anim.cancel());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves the given effect into valid keyframes.\r\n\t *\r\n\t * Effect can be CSS animation name,\r\n\t * or an object of CSS properties that represent the end keyframe.\r\n\t *\r\n\t * @param DOMNode\t\t\t\tel\r\n\t * @param array|object|string\teffect\r\n\t * @param function\t\t\t\tready\r\n\t * @param function\t\t\t\terror\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic createCallback(el, effect, ready, error) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve firstFrame from current state?\r\n\t\t// -----------------------------\r\n\t\tif (_isObject(effect)) {\r\n\t\t\t// Get first keyframe from current state\r\n\t\t\tReflow.onread(() => {\r\n\t\t\t\tAnim.createCallback(el, [cssRead(el, Object.keys(effect)), effect], ready, error);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Create keyframes from CSS animation name...\r\n\t\t// -----------------------------\r\n\t\tif (_isString(effect)) {\r\n\t\t\t// Retrieve keyframes of the given animation name from css\r\n\t\t\tvar animationName = effect;\r\n\t\t\teffect = cssReadKeyframes(el, animationName);\r\n\t\t\tif (!effect.length && error) {\r\n\t\t\t\terror('Animation name \"' + animationName + '\" not found in any stylesheet!');\r\n\t\t\t}\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Resolve auto pixels...\r\n\t\t// -----------------------------\r\n\t\tif (_isArray(effect)) {\r\n\t\t\tvar keyframesWithAutoSizes = [];\r\n\t\t\t_each(effect, (i, keyframe) => {\r\n\t\t\t\t// We can animate to auto width and height\r\n\t\t\t\tif (keyframe.height === 'auto') {\r\n\t\t\t\t\t_pushUnique(keyframesWithAutoSizes, i);\r\n\t\t\t\t}\r\n\t\t\t\tif (keyframe.width === 'auto') {\r\n\t\t\t\t\t_pushUnique(keyframesWithAutoSizes, i);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (keyframesWithAutoSizes.length) {\r\n\t\t\t\t// apply() will be called when ready\r\n\t\t\t\t// We return cssComputeAsync(), which in itself returns the return of apply()\r\n\t\t\t\tcssComputeAsync(el, {width:'auto', height:'auto'}, el => el.getBoundingClientRect()).then(result => {\r\n\t\t\t\t\tkeyframesWithAutoSizes.forEach(i => {\r\n\t\t\t\t\t\tif (effect[i].width === 'auto') {\r\n\t\t\t\t\t\t\teffect[i].width = result.width + 'px';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (effect[i].height === 'auto') {\r\n\t\t\t\t\t\t\teffect[i].height = result.height + 'px';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tready(effect);\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Return result...\r\n\t\t// -----------------------------\r\n\t\t// We return the return of success()\r\n\t\tready(effect);\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Anim;","\r\n/**\r\n * Tells if ANY items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest || callback(itm), false);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _any from '@onephrase/commons/arr/any.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _merge from '@onephrase/commons/obj/merge.js';\r\nimport _with from '@onephrase/commons/obj/with.js';\r\nimport {\r\n\tcssRead\r\n} from '../Css/Css.js';\r\nimport TransformRule from '../Css/TransformRule.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\t\t\t\r\n/**\r\n * Gets the element's width/height values or left/top offsets or both.\r\n *\r\n * A context can be specified from which to resolve left/top distances.\r\n * document origins are used by default.\r\n *\r\n * This function can calculate the rect of 3 different types of object:\r\n * - DOM element: offsets are calculated from el.getBoundingClientRect() and resolved relative to the specified offsetOrigin.\r\n *\t\twidth and height are calculated from el.getBoundingClientRect().\r\n * - Event object: offsets are calculated as the event's (client|offset|page) x/y, depending on the specified offsetOrigin.\r\n *\t\twidth and height are always 0, 0.\r\n * - Window object: offsets are calculated as the current left/top scroll, as determined by the value of offsetOrigin.\r\n *\t\twidth and height are always the window's inner width/height values.\r\n *\r\n * @param DOMElement|Event|window \tel\r\n * @param bool\t \t\t\t\t\tsize\r\n * @param DOMElement|window\t \t\toffsetOrigin\r\n *\r\n * @return object\r\n */\r\nconst rect = function(el, size = true, offsetOrigin = null) {\r\n\tvar rectProps = ['width', 'height', 'top', 'right', 'bottom', 'left'];\r\n\tvar eventProps = ['clientX', 'clientY', 'offsetX', 'offsetY', 'pageX', 'pageY', 'screenX', 'screenY'];\r\n\tvar _isElement = obj => obj instanceof HTMLElement || obj instanceof HTMLDocument;\r\n\tvar _rect = {};\r\n\tif (_isObject(el) && _any(eventProps, prop => prop in el)) {\r\n\t\t_rect = size !== false ? {width:0, height:0,} : {};\r\n\t\tif (offsetOrigin === window || _isElement(offsetOrigin)) {\r\n\t\t\t_rect.left = el.clientX;\r\n\t\t\t_rect.top = el.clientY;\r\n\t\t} else if (offsetOrigin === true) {\r\n\t\t\t_rect.left = el.offsetX;\r\n\t\t\t_rect.top = el.offsetY;\r\n\t\t} else if (offsetOrigin !== false) {\r\n\t\t\t_rect.left = el.pageX;\r\n\t\t\t_rect.top = el.pageY;\r\n\t\t}\r\n\t} else if (el === window) {\r\n\t\t_rect = size !== false ? {width:window.innerWidth, height:window.innerHeight,} : {};\r\n\t\tif (offsetOrigin === window || offsetOrigin === true || _isElement(offsetOrigin)) {\r\n\t\t\t_rect.left = 0;\r\n\t\t\t_rect.top = 0;\r\n\t\t} else if (offsetOrigin !== false) {\r\n\t\t\t_rect.left = window.pageXOffset || document.documentElement.scrollLeft;\r\n\t\t\t_rect.top = window.pageYOffset || document.documentElement.scrollTop;\r\n\t\t}\r\n\t} else if (_isElement(el)) {\r\n\t\t_rect = el.getBoundingClientRect().toJSON();\r\n\t\tdelete _rect.x;\r\n\t\tdelete _rect.y;\r\n\t\tdelete _rect.right;\r\n\t\tdelete _rect.bottom;\r\n\t\tif (size === false) {\r\n\t\t\tdelete _rect.width;\r\n\t\t\tdelete _rect.height;\r\n\t\t}\r\n\t\tif (offsetOrigin === true) {\r\n\t\t\toffsetOrigin = el.offsetParent;\r\n\t\t} else if (offsetOrigin === false) {\r\n\t\t\tdelete _rect.left;\r\n\t\t\tdelete _rect.top;\r\n\t\t} else if (offsetOrigin !== window && !_isElement(offsetOrigin)) {\r\n\t\t\t_rect.left += (window.pageXOffset || document.documentElement.scrollLeft);\r\n\t\t\t_rect.top += (window.pageYOffset || document.documentElement.scrollTop);\r\n\t\t}\r\n\t} else if (_isObject(el) && _any(rectProps, prop => prop in el)) {\r\n\t\t_rect = _copy(el, rectProps);\r\n\t} else {\r\n\t\tthrow new Error('Unknown object type!');\r\n\t}\r\n\tif (_isElement(offsetOrigin)) {\r\n\t\tvar contextOffset = rect(offsetOrigin, false, window);\r\n\t\t_rect.left -= contextOffset.left;\r\n\t\t_rect.top -= contextOffset.top;\r\n\t}\r\n\treturn _rect;\r\n};\r\n\r\n/**\r\n * Returns an object containing the element's width or height or both.\r\n *\r\n * @param DOMElement\t\tel \r\n * @param object\t\t\taxis \r\n *\r\n * @return object\r\n */\r\nconst size = function(el, axis) {\r\n\tvar _size = rect(el, true, false);\r\n\tvar axes = axis ? _arrFrom(axis) : ['x', 'y'];\r\n\tif (!axes.includes('x')) {\r\n\t\tdelete _size.width;\r\n\t}\r\n\tif (!axes.includes('y')) {\r\n\t\tdelete _size.height;\r\n\t}\r\n\treturn _size;\r\n};\r\n\r\n/**\r\n * Returns an object containing the element's left/top.\r\n *\r\n * @param DOMElement\t\tel \r\n * @param object\t\t\taxis \r\n * @param string|bool\t\toffsetOrigin \r\n *\r\n * @return object\r\n */\r\nconst offsets = function(el, axis, origin = null) {\r\n\tvar _offsets = rect(el, false, origin);\r\n\tvar axes = axis ? _arrFrom(axis) : ['x', 'y'];\r\n\tif (!axes.includes('x')) {\r\n\t\tdelete _offsets.left;\r\n\t}\r\n\tif (!axes.includes('y')) {\r\n\t\tdelete _offsets.top;\r\n\t}\r\n\treturn _offsets;\r\n};\r\n\r\n/**\r\n * Simulates, does not actually effect, a DOMElement to a some CSS position and\r\n * uses rect() to calculate its rects at that virtual position.\r\n *\r\n * @param DOMElement\t\t\t\tel \r\n * @param object \t\t\t\t\toffsets\r\n *\r\n * @return object\r\n */\r\nconst rectAtOffsets = function(el, offsets) {\r\n\tvar _rect = rect(el);\r\n\tvar positionType = cssRead(el, 'position');\r\n\tif (positionType !== 'static') {\r\n\t\tif (positionType === 'absolute') {\r\n\t\t\tvar offsetParentRect = rect(el.offsetParent);\r\n\t\t\t_rect.top = offsetParentRect.top;\r\n\t\t\t_rect.left = offsetParentRect.left;\r\n\t\t} else if (positionType === 'fixed') {\r\n\t\t\tvar offsetParentRect = rect(window);\r\n\t\t\t_rect.top = 0;\r\n\t\t\t_rect.left = 0;\r\n\t\t}\r\n\t\t_rect.top = _isNumeric(offsets.top) ? _rect.top + parseFloat(offsets.top) \r\n\t\t\t: (_isNumeric(offsets.bottom) ? (offsetParentRect \r\n\t\t\t\t? (offsetParentRect.top + offsetParentRect.height) - (_rect.height + offsets.bottom)\r\n\t\t\t\t: _rect.top - offsets.bottom\r\n\t\t\t) : 0);\r\n\t\t_rect.left = _isNumeric(offsets.left) ? _rect.left + parseFloat(offsets.left) \r\n\t\t\t: (_isNumeric(offsets.right) ? (offsetParentRect \r\n\t\t\t\t? (offsetParentRect.left + offsetParentRect.width) - (_rect.width + offsets.right)\r\n\t\t\t\t: _rect.left - offsets.right\r\n\t\t\t) : 0);\r\n\t}\r\n\treturn _rect;\r\n};\r\n\r\n/**\r\n * Calculates the length on an axis of an intersection.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param object\t\t \t\t\t_rect\r\n * @param object\t\t \t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst coordsAtRect = function(el, _rect, options = {}) {\r\n\tvar _intersection = intersection(rect(options.using || el), _rect);\r\n\tvar length = {x:'width', y:'height'};\r\n\tvar start = {x:'left', y:'top'};\r\n\tvar end = {x:'right', y:'bottom'};\r\n\tvar coords = {};\r\n\tvar _alignment = {};\r\n\t['x', 'y'].forEach(axis => {\r\n\t\tif (options[axis] === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rect1Length = _intersection.rect1[length[axis]/*height*/];\r\n\t\t// Distinguish and predicate\r\n\t\t_alignment[axis] = parsePlacement(options[axis] || '');\r\n\t\tswitch(_alignment[axis].keyword) {\r\n\t\t\tcase 'before':\r\n\t\t\t\t// Pull beyond start\r\n\t\t\t\tcoords[axis] = - (_intersection[start[axis]/*top*/] + rect1Length);\r\n\t\t\tbreak;\r\n\t\t\tcase 'after':\r\n\t\t\t\t// Push beyond end\r\n\t\t\t\tcoords[axis] = _intersection[end[axis]/*bottom*/] + rect1Length;\r\n\t\t\tbreak;\r\n\t\t\tcase 'start':\r\n\t\t\t\t// Pull to start\r\n\t\t\t\tcoords[axis] = - _intersection[start[axis]/*top*/];\r\n\t\t\tbreak;\r\n\t\t\tcase 'end':\r\n\t\t\t\t// Push to end\r\n\t\t\t\tcoords[axis] = _intersection[end[axis]/*bottom*/];\r\n\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\t// Align to center\r\n\t\t\t\tcoords[axis] = _intersection.delta[axis];\r\n\t\t}\r\n\t\t// Apply predicates\r\n\t\tif (_alignment[axis].predicates) {\r\n\t\t\tcoords[axis] += evalPredicates(_alignment[axis].predicates, rect1Length);\r\n\t\t}\r\n\t});\r\n\tcoords.alignment = _alignment;\r\n\tcoords.intersection = _intersection;\r\n\treturn coords;\r\n};\r\n\r\n/**\r\n * Manipulates an element's translate.translate to place it with another element.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst translateTo = function(el, el2, options = {}) {\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar _coordsFormatted = {\r\n\t\tfrom: new TransformRule({translate: [],}),\r\n\t\tto: new TransformRule({translate: [],}),\r\n\t\tcurrent: {\r\n\t\t\tfrom: new TransformRule({translate: [],}),\r\n\t\t\tto: new TransformRule({translate: [],}),\r\n\t\t\tprogress: {},\r\n\t\t},\r\n\t};\r\n\t// -----------\r\n\tvar activeTransform = cssRead(el, 'transform');\r\n\t['x', 'y'].forEach((axis, i) => {\r\n\t\tif (axis in _coords) {\r\n\t\t\t_coordsFormatted.from.translate[i] = 0;\r\n\t\t\t_coordsFormatted.to.translate[i] = _coords[axis] + activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.current.to.translate[i] = _coords[axis];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = Math.abs(activeTransform.translate[i] / (_coords[axis] + activeTransform.translate[i]));\r\n\t\t} else {\r\n\t\t\t_coordsFormatted.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.to.translate[i] = activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.current.to.translate[i] = activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = 0;\r\n\t\t}\r\n\t});\r\n\treturn _coordsFormatted;\r\n};\r\n\r\n/**\r\n * Calculates an element's offset where it to be at the given rect.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst offsetTo = function(el, el2, options = {}) {\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar start = {x:'left', y:'top'};\r\n\tvar end = {x:'right', y:'bottom'};\r\n\tvar _offsets = _intersect(['x', 'y'], Object.keys(_coords)).reduce((obj, axis) => {\r\n\t\tswitch(_coords.alignment[axis].keyword) {\r\n\t\t\tcase 'before':\r\n\t\t\t\treturn options.alternateAnchors ? _with(obj, start[axis], _coords[axis]) : _with(obj, end[axis], - _coords[axis]);\r\n\t\t\tcase 'after':\r\n\t\t\t\treturn options.alternateAnchors ? _with(obj, end[axis], - _coords[axis]) : _with(obj, start[axis], _coords[axis]);\r\n\t\t\tcase 'end':\r\n\t\t\t\treturn _with(obj, end[axis], - _coords[axis]);\r\n\t\t\tdefault: // center,start\r\n\t\t\t\treturn _with(obj, start[axis], _coords[axis]);\r\n\t\t}\r\n\t}, {});\r\n\t// -----------\r\n\tvar _offsetsFormatted = {from: {}, to: {}, current: {\r\n\t\t\tfrom: {}, to: {}, progress: {},\r\n\t\t},\r\n\t};\r\n\t// -----------\r\n\tvar currentOffsets = positioningOffsets(el, Object.keys(_offsets));\r\n\t['left', 'right', 'top', 'bottom'].forEach(name => {\r\n\t\tif (name in _offsets) {\r\n\t\t\t_offsetsFormatted.from[name] = 0;\r\n\t\t\t_offsetsFormatted.to[name] = _offsets[name] + currentOffsets[name];\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.from[name] = currentOffsets[name];\r\n\t\t\t_offsetsFormatted.current.to[name] = _offsets[name];\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.progress[name] = Math.abs(currentOffsets[name] / (_offsets[name] + currentOffsets[name]));\r\n\t\t} else {\r\n\t\t\t_offsetsFormatted.from[name] = 'auto';\r\n\t\t\t_offsetsFormatted.to[name] = 'auto';\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.from[name] = 'auto';\r\n\t\t\t_offsetsFormatted.current.to[name] = 'auto';\r\n\t\t}\r\n\t});\r\n\treturn _offsetsFormatted;\r\n};\r\n\r\n/**\r\n * Scrolls an element to the position of another element\r\n * within its scrollable parent.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst scrollTo = function(el, el2, options = {}) {\r\n\tvar viewport = options.scrollAnchor || scrollParent(el);\r\n\tviewport = viewport === document.body ? window : viewport;\r\n\tif (!scrolls(viewport)) {\r\n\t\treturn;\r\n\t}\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar _offsetsFormatted = {from: {}, to: {}, current: {\r\n\t\t\tfrom: {}, to: {}, progress: {},\r\n\t\t},\r\n\t\tviewport: viewport,\r\n\t};\r\n\t// -----------\r\n\tvar currentScroll = {\r\n\t\tscrollLeft: viewport[viewport === window ? 'pageXOffset' : 'scrollLeft'],\r\n\t\tscrollTop: viewport[viewport === window ? 'pageYOffset' : 'scrollTop'],\r\n\t};\r\n\t['x', 'y'].forEach((axis, i) => {\r\n\t\tvar axisProp = axis === 'x' ? 'scrollLeft' : 'scrollTop';\r\n\t\tif (axis in _coords) {\r\n\t\t\t_coordsFormatted.from[axisProp] = 0;\r\n\t\t\t_coordsFormatted.to[axisProp] = _coords[axis] + currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.current.to[axisProp] = _coords[axis];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = Math.abs(currentScroll[axisProp] / (_coords[axis] + currentScroll[axisProp]));\r\n\t\t} else {\r\n\t\t\t_coordsFormatted.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.to[axisProp] = currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.current.to[axisProp] = currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = 0;\r\n\t\t}\r\n\t});\r\n\treturn _coordsFormatted;\r\n};\r\n\r\n/**\r\n * Observes when any of the given elements\r\n * changes in size.\r\n *\r\n * @param [HTMLElement]\t\t\t \tels\r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return ResizeObserver\r\n */\r\nconst resizeCallback = function(els, callback) {\r\n\tvar sizings = Object.keys(els);\r\n\tvar ro = new ResizeObserver(entries => {\r\n\t\tfor (let entry of entries) {\r\n\t\t\tsizings[els.indexOf(entry.target)] = {\r\n\t\t\t\twidth: entry.contentRect.left + entry.contentRect.right, \r\n\t\t\t\theight: entry.contentRect.top + entry.contentRect.bottom,\r\n\t\t\t};\r\n\t\t}\r\n\t\tsizings = sizings.map((sizing, i) => !_isObject(sizing) ? _copyPlain(rect(els[i]), ['width', 'height',]) : sizing);\r\n\t\tcallback.call(...sizings);\r\n\t});\r\n\tels.forEach(el => {\r\n\t\tro.observe(el);\r\n\t});\r\n\treturn ro;\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * A set of utilities for processing rects.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Computes the percentage proximity between two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n * @param string|array\taxis\r\n * @param object\t\tpreviousProximity\r\n *\r\n * @return object\r\n */\r\nconst proximity = function(rect1, rect2, axis, previousProximity) {\r\n\tvar _proximity = {intersection: intersection(rect1, rect2)};\t\t\t\t\r\n\t_proximity.x = _proximity.x || {};\r\n\t_proximity.y = _proximity.y || {};\r\n\tpreviousProximity = _copy(previousProximity);\r\n\t// X,Y processing...\r\n\t(axis ? _arrFrom(axis) : ['x', 'y']).forEach(axis => {\r\n\t\t// In the context of the given axis...\r\n\t\tvar distanceBefore = axis === 'x' ? 'left' : 'top';\r\n\t\tvar distanceAfter = axis === 'x' ? 'right' : 'bottom';\r\n\t\tvar rect1Length = rect1[axis === 'x' ? 'width' : 'height'];\r\n\t\tvar rect2Length = rect2[axis === 'x' ? 'width' : 'height'];\r\n\t\t// ----- In which direction are we moving\r\n\t\t_proximity[axis].moving = 'positive';\r\n\t\tif (previousProximity.intersection) {\r\n\t\t\t_proximity[axis].moving = previousProximity.intersection[distanceBefore] > _proximity.intersection[distanceBefore] \r\n\t\t\t\t? 'negative' : (previousProximity.intersection[distanceBefore] < _proximity.intersection[distanceBefore] \r\n\t\t\t\t\t? 'positive' : previousProximity[axis].moving);\r\n\t\t}\r\n\t\t// ----- Cross-in percentage\r\n\t\tvar percentageIn = 0;\r\n\t\t// Element topline touches or passes Anchor bottom line\r\n\t\tif (_proximity.intersection[distanceBefore] <= rect2Length\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor bottom line\r\n\t\t&& _proximity.intersection[distanceAfter] <= 0) {\r\n\t\t\tpercentageIn = (rect1Length - Math.abs(_proximity.intersection[distanceAfter])) / rect1Length;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > 0) {\r\n\t\t\tpercentageIn = 1;\r\n\t\t}\r\n\t\t// ----- Cross-out percentage\r\n\t\tvar percentageOut = 0;\r\n\t\t// Element topline touches or passes Anchor top line\r\n\t\tif (_proximity.intersection[distanceBefore] <= 0\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor top line\r\n\t\t&& _proximity.intersection[distanceAfter] <= rect2Length) {\r\n\t\t\tpercentageOut = Math.abs(_proximity.intersection[distanceBefore]) / rect1Length;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > rect2Length) {\r\n\t\t\tpercentageOut = 1;\r\n\t\t}\r\n\t\t// ----- Cross-pass percentage\r\n\t\tvar percentagePass = 0;\r\n\t\t// Element topline touches or passes Anchor bottom line\r\n\t\tif (_proximity.intersection[distanceBefore] <= rect2Length\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor top line\r\n\t\t&& _proximity.intersection[distanceAfter] <= rect2Length) {\r\n\t\t\tvar totalDistance = rect2Length + rect1Length;\r\n\t\t\tvar currentPass = proximity.intersection[distanceBefore] + rect1Length;\r\n\t\t\tpercentagePass = (totalDistance - currentPass) / totalDistance;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > rect2Length) {\r\n\t\t\tpercentagePass = 1;\r\n\t\t}\r\n\t\t// ----- Cross-overflow percentage\r\n\t\tvar percentageContained = 0;\r\n\t\tif (rect1Length > rect2Length) {\r\n\t\t\t// Element is larger than, and covering Anchor top/bottom lines\r\n\t\t\tif (_proximity.intersection[distanceBefore] <= 0\r\n\t\t\t&& _proximity.intersection[distanceAfter] <= 0) {\r\n\t\t\t\tvar lengthDifference = rect1Length - rect2Length;\r\n\t\t\t\tpercentageContained = Math.abs(_proximity.intersection[distanceBefore]) / lengthDifference;\r\n\t\t\t} else if (_proximity.intersection[distanceAfter] > 0) {\r\n\t\t\t\tpercentageContained = 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Element is smaller than, and within Anchor top/bottom lines\r\n\t\t\tif (_proximity.intersection[distanceBefore] >= 0\r\n\t\t\t&& _proximity.intersection[distanceAfter] >= 0) {\r\n\t\t\t\tvar lengthDifference = rect2Length - rect1Length;\r\n\t\t\t\tpercentageContained = _proximity.intersection[distanceAfter] / lengthDifference;\r\n\t\t\t} else if (_proximity.intersection[distanceBefore] < 0) {\r\n\t\t\t\tpercentageContained = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ------ Bind the values to the instance object\r\n\t\tif (_proximity[axis].moving === 'negative') {\r\n\t\t\t_proximity[axis].percentageIn = percentageIn;\r\n\t\t\t_proximity[axis].percentageOut = percentageOut;\r\n\t\t\t_proximity[axis].percentagePass = percentagePass;\r\n\t\t\t_proximity[axis].percentageContained = percentageContained;\r\n\t\t} else {\r\n\t\t\t_proximity[axis].percentageIn = 1 - percentageOut;\r\n\t\t\t_proximity[axis].percentageOut = 1 - percentageIn;\r\n\t\t\t_proximity[axis].percentagePass = 1 - percentagePass;\r\n\t\t\t_proximity[axis].percentageContained = 1 - percentageContained;\r\n\t\t}\r\n\t\tif (rect1Length > rect2Length) {\r\n\t\t\t_proximity[axis].percentageContained *= -1;\r\n\t\t}\r\n\t});\r\n\treturn _proximity;\r\n};\r\n\r\n/**\r\n * Returns coordinates of the intersection between two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n *\r\n * @return object\r\n */\r\nconst intersection = function(rect1, rect2) {\r\n\tvar _intersection = {\r\n\t\tleft: rect1.left - rect2.left,\r\n\t\ttop: rect1.top - rect2.top,\r\n\t\tright: (rect2.left + rect2.width) - (rect1.left + rect1.width),\r\n\t\tbottom: (rect2.top + rect2.height) - (rect1.top + rect1.height),\r\n\t};\r\n\t// More offsets\r\n\tvar leftline = Math.max(rect1.left, rect2.left);\r\n\tvar rightline = Math.min(rect1.left + rect1.width, rect2.left + rect2.width);\r\n\tvar topline = Math.max(rect1.top, rect2.top);\r\n\tvar bottomline = Math.min(rect1.top + rect1.height, rect2.top + rect2.height);\r\n\t_intersection.width = rightline > leftline ? rightline - leftline : 0;\r\n\t_intersection.height = bottomline > topline ? bottomline - topline : 0;\r\n\t// The raw values\r\n\t_intersection.rect1 = rect1;\r\n\t_intersection.rect2 = rect2;\r\n\t_intersection.delta = delta(rect1, rect2);\r\n\treturn _intersection;\r\n};\r\n\r\n/**\r\n * Returns coordinates of two rects as one.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n *\r\n * @return object\r\n */\r\nconst union = function(rect1, rect2) {\r\n\tvar _union = {\r\n\t\tleft: Math.min(rect1.left, rect2.left),\r\n\t\ttop: Math.min(rect1.top, rect2.top),\r\n\t\tright: Math.max((rect1.left + rect1.width), (rect2.left + rect2.width)),\r\n\t\tbottom: Math.max((rect1.top + rect1.height), (rect2.top + rect2.height)),\r\n\t};\r\n\t// More offsets\r\n\t_union.width = _union.right - _union.left;\r\n\t_union.height = _union.bottom - _union.top;\r\n\t// The raw values\r\n\t_union.rect1 = rect1;\r\n\t_union.rect2 = rect2;\r\n\t_union.delta = delta(rect1, rect2);\r\n\treturn _union;\r\n};\r\n\r\n/**\r\n * Returns distances in x, y, and z between the centers of two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n * @param bool\t\t\twithAngle\r\n *\r\n * @return object\r\n */\r\nconst delta = function(rect1, rect2, withAngle = false) {\r\n\tvar _delta = {};\r\n\t_delta.x = (rect2.left + (rect2.width / 2)) - (rect1.left + (rect1.width / 2));\r\n\t_delta.y = (rect2.top + (rect2.height / 2)) - (rect1.top + (rect1.height / 2));\r\n\t_delta.z = Math.sqrt(Math.pow(_delta.x, 2) + Math.pow(_delta.y, 2));\r\n\tif (withAngle) {\r\n\t\t_delta = _merge(_delta, deltaAngle(_delta));\r\n\t}\r\n\treturn _delta;\r\n};\r\n\r\n/**\r\n * Returns distances in x, y, and z between the centers of two rects.\r\n *\r\n * @param object\t\tdelta\r\n *\r\n * @return object\r\n */\r\nconst deltaAngle = function(delta) {\r\n\tif (_isNumeric(delta.y) && _isNumeric(delta.x)) {\r\n\t\tvar angleOfElevation = Math.atan(delta.y/delta.x);\r\n\t} else if (_isNumeric(delta.x) && _isNumeric(delta.z)) {\r\n\t\tvar angleOfElevation = Math.acos(delta.x/delta.z);\r\n\t} else if (_isNumeric(delta.y) && _isNumeric(delta.z)) {\r\n\t\tvar angleOfElevation = Math.asin(delta.y/delta.z);\r\n\t}\r\n\tvar angleOfDepression = 180 - 90 - angleOfElevation;\r\n\treturn {\r\n\t\tangle:angleOfElevation, \r\n\t\tangle2:angleOfDepression, \r\n\t\tisHorizontal:angleOfElevation < 45, \r\n\t\tisVertical:angleOfDepression < 45,\r\n\t};\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Other Utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Gets the element's left,top,bottom,right values\r\n * with \"auto\"s resolved.\r\n *\r\n * @param HTMLElement\t\t\tel \r\n * @param array\t\t\t\t\tanchors \r\n *\r\n * @return object\r\n */\r\nconst positioningOffsets = function(el, anchors = ['left', 'top', 'right', 'bottom']) {\r\n\tvar inverses = {right:'left', left:'right', bottom:'top', top:'bottom'};\r\n\tvar currentOffsets = cssRead(el, anchors.concat('position'));\r\n\tvar intersectionWithAnchor = null;\r\n\tanchors.forEach(name => {\r\n\t\tif (currentOffsets[name] === 'auto') {\r\n\t\t\t// Get what anchor value would be...\r\n\t\t\t// on current position type\r\n\t\t\tif (currentOffsets.position === 'relative') {\r\n\t\t\t\tcurrentOffsets[name] = - parseFloat(currentOffsets[inverses[name]]);\r\n\t\t\t} else if (currentOffsets.position === 'fixed') {\r\n\t\t\t\tintersectionWithAnchor = intersectionWithAnchor || intersection(rect(el), rect(window));\r\n\t\t\t\tcurrentOffsets[name] = intersectionWithAnchor[name];\r\n\t\t\t} else if (currentOffsets.position === 'absolute') {\r\n\t\t\t\tintersectionWithAnchor = intersectionWithAnchor || intersection(rect(el), rect(el.offsetParent));\r\n\t\t\t\tcurrentOffsets[name] = intersectionWithAnchor[name];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurrentOffsets[name] = parseFloat(currentOffsets[name]);\r\n\t\t}\r\n\t});\r\n\tdelete currentOffsets.position;\r\n\treturn currentOffsets;\r\n};\r\n\r\n/**\r\n * Returns the heighest z-index attained by any of its descendants,\r\n * starting from its stacking context.\r\n *\r\n * @param DOMElement\t\tel \r\n *\r\n * @return int\r\n */\r\nconst zHeight = function(el) {\r\n\tvar zIndex = 0;\r\n\t_arrFrom(el.children).forEach((el, i) => {\r\n\t\tzIndex = Math.max(zIndex, parseInt(cssRead(el, 'z-index')) || 0);\r\n\t});\r\n\treturn zIndex;\r\n};\r\n\r\n/**\r\n * Parses the total width of the element's vertical borders.\r\n *\r\n * @param DOMElement \t\tel\r\n *\r\n * @return int\r\n */\r\nconst yBorders = function(el) {\r\n\tvar borderWidth = 0;\r\n\tborderWidth += parseInt(cssRead(el, 'border-left-width'));\r\n\tborderWidth += parseInt(cssRead(el, 'border-right-width'));\r\n\treturn borderWidth;\r\n};\r\n\r\n/**\r\n * Parses the total height of the element's horizontal borders.\r\n *\r\n * @param DOMElement \t\tel\r\n *\r\n * @return int\r\n */\r\nconst xBorders = function(el) {\r\n\tvar borderHeight = 0;\r\n\tborderHeight += parseInt(cssRead(el, 'border-top-width'));\r\n\tborderHeight += parseInt(cssRead(el, 'border-bottom-width'));\r\n\treturn borderHeight;\r\n};\r\n\r\n/**\r\n * Gets an element's nearest scrollable parent.\r\n *\r\n * @param DOMNode\t\tel\r\n *\r\n * @return jQuery\r\n */\r\nconst scrollParent = function(el) {\r\n\tvar style = window.getComputedStyle(el);\r\n\tvar excludeStaticParent = style.position === 'absolute';\r\n\tvar overflowRegex = false/*includeHidden*/ ? /(auto|scroll|hidden)/ : /(auto|scroll)/;\r\n\tif (style.position !== 'fixed') {\r\n\t\tfor (var parent = el; (parent = parent.parentElement);) {\r\n\t\t\tstyle = window.getComputedStyle(parent);\r\n\t\t\tif (excludeStaticParent && style.position === 'static') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) {\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn document.body;\r\n};\r\n\r\n/**\r\n * Tells if an element is scrollable due to overflowing content.\r\n *\r\n * @param DOMNode\t\tel\r\n *\r\n * @return bool\r\n */\r\nconst scrolls = function(el) {\r\n\treturn el === window \r\n\t\t? (el.pageYOffset || el.pageYOffset) \r\n\t\t: (el.scrollHeight > el.clientHeight);\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Still other Utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Parses a directive to obtain a placement keyword and modifiers.\r\n *\r\n * @param string\t\t\t \texpr\r\n *\r\n * @return object\r\n */\r\nconst parsePlacement = function(expr) {\r\n\tvar regPlacement = new RegExp('(before|after|start|end|center)', 'g');\r\n\tvar regModifiers = new RegExp('[\\-\\+][0-9]+(%)?', 'g');\r\n\treturn {\r\n\t\tkeyword: (expr.match(regPlacement) || [])[0],\r\n\t\tpredicates: expr.match(regModifiers),\r\n\t};\r\n};\r\n\r\n/**\r\n * Sums a list of Mathematical expressions.\r\n *\r\n * @param array\t\t\t\t \tmodifiers\r\n * @param number \t\t\t\tpercentageContext\r\n *\r\n * @return number\r\n */\r\nconst evalPredicates = function(modifiers, percentageContext) {\r\n\treturn modifiers.reduce((total, modifier) => total + (modifier.endsWith('%') \r\n\t\t? parseFloat(modifier) / 100 * percentageContext\r\n\t\t: parseFloat(modifier)\r\n\t), 0);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\trect,\r\n\tsize,\r\n\toffsets,\r\n\trectAtOffsets,\r\n\tcoordsAtRect,\r\n\ttranslateTo,\r\n\toffsetTo,\r\n\tscrollTo,\r\n\tresizeCallback,\r\n\tproximity,\r\n\tunion,\r\n\tintersection,\r\n\tdelta,\r\n\tdeltaAngle,\r\n\tzHeight,\r\n\tyBorders,\r\n\txBorders,\r\n\tscrollParent,\r\n\tscrolls,\r\n};\r\nexport default rect;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tfrom as domFrom,\r\n\tfind as domFind,\r\n\tdomData,\r\n\tdomAttr,\r\n\tdomHtml,\r\n\tdomText,\r\n\tdomAppend,\r\n\tdomPrepend,\r\n\tdomAttrAsync,\r\n\tdomHtmlAsync,\r\n\tdomTextAsync,\r\n\tdomAppendAsync,\r\n\tdomPrependAsync,\r\n} from './Dom.js';\r\nimport {\r\n\tcss,\r\n\tcssAsync,\r\n\tcssComputeAsync,\r\n\tcssTransaction,\r\n} from './Css/Css.js';\r\nimport {\r\n\taddListener,\r\n\tremoveListener,\r\n} from './Event/EventController.js';\r\nimport Anim from './Anim/Anim.js';\r\nimport Reflow from './Reflow.js';\r\nimport {\r\n\ttranslateTo,\r\n\toffsetTo,\r\n\tscrollTo,\r\n} from './Geometry/Rect.js';\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Element manipulation library.\r\n * ---------------------------\r\n */\r\nconst Element = class {\r\n\t\r\n\t/**\r\n\t * General element creator.\r\n\t * Accepts any of markup, selector, HTMLElement.\r\n\t *\r\n\t * @param string \t\t\t\tinput\r\n\t *\r\n\t * @return Element\r\n\t */\r\n\tstatic from(input) {\r\n\t\treturn new Element(domFrom(input));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Creates an instance over an element.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el) {\r\n\t\tthis.el = el;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Strategically returns a HTMLElement.\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\t_el() {\r\n\t\treturn this.el || document.createElement('div');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Automatically returns the current instance in place\r\n\t * of the element.\r\n\t *\r\n\t * @param mixed\t\t\t\t\tret\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_ret(ret) {\r\n\t\treturn this.el && ret === this.el ? this : ret;\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Queries the current element.\r\n\t *\r\n\t * @param string \t\t\t\tselector\r\n\t *\r\n\t * @return DOMNodeList\r\n\t */\r\n\tfind(selector) {\r\n\t\treturn new Element(this.el ? domFind(selector, this.el) : undefined);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see domData\r\n\t *\r\n\t * @return mixed|this\r\n\t */\r\n\tdata(requestOrPayload, val = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domData function is sensitive to argument count\r\n\t\treturn this._ret(domData(this._el(), ...arguments));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see css\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcss(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// css function is sensitive to argument count\r\n\t\treturn this._ret(css(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAttr\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tattr(requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domAttr function is sensitive to argument count\r\n\t\treturn this._ret(domAttr(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domHtml\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\thtml(content = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domHtml function is sensitive to argument count\r\n\t\treturn this._ret(domHtml(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domText\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\ttext(content = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domText function is sensitive to argument count\r\n\t\treturn this._ret(domText(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAppend\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tappend(content) {\r\n\t\treturn this._ret(domAppend(this._el(), content));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domPrepend\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tprepend(content) {\r\n\t\treturn this._ret(domPrepend(this._el(), content));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see cssAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcssAsync(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// cssAsync function is sensitive to argument count\r\n\t\treturn cssAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAttrAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tattrAsync(requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domAttrAsync function is sensitive to argument count\r\n\t\treturn domAttrAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domHtmlAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\thtmlAsync(content) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domHtmlAsync function is sensitive to argument count\r\n\t\treturn domHtmlAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domTextAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\ttextAsync(content) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domTextAsync function is sensitive to argument count\r\n\t\treturn domTextAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAppendAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tappendAsync(content) {\r\n\t\treturn domAppendAsync(this._el(), ...arguments).then(() => {\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domPrependAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tprependAsync(content) {\r\n\t\treturn domPrependAsync(this._el(), ...arguments).then(() => {\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see cssComputeAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcssComputeAsync(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// cssComputeAsync function is sensitive to argument count\r\n\t\treturn cssComputeAsync(this._el(), ...arguments);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Establishes a CSS operatiom that can be rolledback without altering similar operation by other code.\r\n\t * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n\t *\r\n\t * @param string|array\t\t\tprops\r\n\t *\r\n\t * @return Transaction\r\n\t */\r\n\tcssTransaction(props) {\r\n\t\treturn cssTransaction(this._el(), props);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see addListener\r\n\t */\r\n\tobserve(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// addListener function is sensitive to argument count\r\n\t\treturn addListener(this._el(), ...arguments);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see removeListener\r\n\t */\r\n\tunobserve(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// removeListener function is sensitive to argument count\r\n\t\treturn removeListener(this._el(), ...arguments);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Creates and plays an amiation.\r\n\t * @see Animation\r\n\t *\r\n\t * @param array|object|string\teffect\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tplay(effect, params = {}) {\r\n\t\tif (!('cancelForCss' in params)) {\r\n\t\t\tparams.cancelForCss = true;\r\n\t\t}\r\n\t\treturn (new Anim(this._el(), effect, params)).play();\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Translates an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\ttranslateTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = translateTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tresolve(this.play([\r\n\t\t\t\t\t{transform: trans.current.from},\r\n\t\t\t\t\t{transform: trans.to},\r\n\t\t\t\t], options.play));\r\n\t\t\t} else {\r\n\t\t\t\tresolve(this.css({transform: trans.to}));\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Offsets an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\toffsetTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = offsetTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tresolve(this.play([trans.current.from, trans.to], options.play));\r\n\t\t\t} else {\r\n\t\t\t\tresolve(this.css(trans.to));\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Scrolls an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tscrollTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = scrollTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tconsole.log('scrollTo() does not currently support animation.');\r\n\t\t\t}\r\n\t\t\tresolve(trans.viewport.scrollTo(trans.to.scrollLeft, trans.to.scrollTop));\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Element;","\r\n/**\r\n * @imports\r\n */\r\nimport Element from './Element/Element.js';\r\n\r\n// As globals\r\nif (!window.OnePhrase) {\r\n\twindow.OnePhrase = {};\r\n}\r\nif (!window.OnePhrase.Rosewell) {\r\n\twindow.OnePhrase.Rosewell = {};\r\n}\r\nwindow.OnePhrase.Rosewell.Element = Element;\r\n"],"sourceRoot":""}