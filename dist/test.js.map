{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/js/isArray.js","webpack:///../commons/js/isObject.js","webpack:///../commons/js/isFunction.js","webpack:///../commons/arr/from.js","webpack:///../commons/js/isEmpty.js","webpack:///../commons/js/isTypeArray.js","webpack:///../commons/js/isString.js","webpack:///../commons/js/isNumeric.js","webpack:///../commons/obj/each.js","webpack:///../commons/js/isUndefined.js","webpack:///../commons/js/isTypeObject.js","webpack:///../commons/obj/from.js","webpack:///../commons/js/isNull.js","webpack:///../commons/obj/copy.js","webpack:///../commons/obj/with.js","webpack:///../commons/arr/first.js","webpack:///../commons/obj/getAllPropertyNames.js","webpack:///../commons/obj/getPrototypeChain.js","webpack:///../commons/obj/mergeCallback.js","webpack:///../commons/arr/flatten.js","webpack:///../commons/obj/get.js","webpack:///../commons/arr/remove.js","webpack:///../commons/obj/even.js","webpack:///../commons/obj/compareCallback.js","webpack:///../commons/arr/pushUnique.js","webpack:///../commons/obj/merge.js","webpack:///../commons/js/isObservable.js","webpack:///./src/Component.js","webpack:///../commons/arr/unique.js","webpack:///../commons/arr/intersect.js","webpack:///../commons/js/isProxy.js","webpack:///../commons/obj/inherit.js","webpack:///../commons/js/isNumber.js","webpack:///../commons/arr/concatUnique.js","webpack:///../observable/src/Event.js","webpack:///../observable/src/EventController.js","webpack:///../commons/js/getType.js","webpack:///../observable/src/Observable.js","webpack:///../commons/js/proxy.js","webpack:///../observable/src/index.js","webpack:///../commons/js/getProxyTarget.js","webpack:///../commons/js/isBoolean.js","webpack:///../commons/arr/exclude.js","webpack:///../commons/js/isTypeFunction.js","webpack:///../commons/obj/copyPlain.js","webpack:///../commons/arr/difference.js","webpack:///../commons/arr/all.js","webpack:///../commons/str/toTitle.js","webpack:///../commons/str/toCamel.js","webpack:///./src/Element/Reflow.js","webpack:///./src/Element/Dom.js","webpack:///./src/App/Client.js","webpack:///../commons/str/fromCamel.js","webpack:///./src/Element/Transaction.js","webpack:///./src/Element/Css/TransformRule.js","webpack:///./src/Element/Css/Css.js","webpack:///../commons/obj/find.js","webpack:///./src/Element/Event/CustomEvents.js","webpack:///./src/Element/Event/EventController.js","webpack:///./src/Element/Anim/Anim.js","webpack:///../commons/arr/any.js","webpack:///./src/Element/Geometry/Rect.js","webpack:///./src/Element/Element.js","webpack:///../commons/js/isClass.js","webpack:///../commons/str/before.js","webpack:///../chtml/src/Schema.js","webpack:///../chtml/src/Def/Matrix.js","webpack:///../commons/js/instanceof.js","webpack:///../jsen/src/ExprInterface.js","webpack:///../jsen/src/Expr/AssignmentInterface.js","webpack:///../jsen/src/Expr/ReferenceInterface.js","webpack:///../jsen/src/Expr/DeletionInterface.js","webpack:///../jsen/src/Expr/CallInterface.js","webpack:///../jsen/src/Jsen.js","webpack:///../commons/arr/last.js","webpack:///../jsen/src/Lexer.js","webpack:///../jsen/src/Contexts.js","webpack:///../commons/str/wrapped.js","webpack:///../commons/str/after.js","webpack:///../commons/str/beforeLast.js","webpack:///../commons/str/unwrap.js","webpack:///../jsen/src/Expr/AbstractionInterface.js","webpack:///../jsen/src/Expr/Abstraction.js","webpack:///../jsen/src/Expr/ArrInterface.js","webpack:///../jsen/src/Expr/Arr.js","webpack:///../jsen/src/Expr/ArgumentsInterface.js","webpack:///../jsen/src/Expr/Arguments.js","webpack:///../jsen/src/Expr/AssertionInterface.js","webpack:///../jsen/src/Expr/Assertion.js","webpack:///../jsen/src/Expr/Assignment.js","webpack:///../jsen/src/Expr/BoolInterface.js","webpack:///../jsen/src/Expr/Bool.js","webpack:///../jsen/src/Expr/Call.js","webpack:///../jsen/src/Expr/CommentsInterface.js","webpack:///../jsen/src/Expr/Comments.js","webpack:///../jsen/src/Expr/ComparisonInterface.js","webpack:///../jsen/src/Expr/Comparison.js","webpack:///../jsen/src/Expr/ConditionInterface.js","webpack:///../jsen/src/Expr/Condition.js","webpack:///../jsen/src/Expr/Deletion.js","webpack:///../jsen/src/Expr/FuncInterface.js","webpack:///../jsen/src/Expr/Func.js","webpack:///../jsen/src/Expr/MathInterface.js","webpack:///../jsen/src/Expr/Math.js","webpack:///../jsen/src/Expr/NumInterface.js","webpack:///../jsen/src/Expr/Num.js","webpack:///../jsen/src/Expr/ObjInterface.js","webpack:///../jsen/src/Expr/Obj.js","webpack:///../jsen/src/Expr/Reference.js","webpack:///../jsen/src/Expr/ReturnInterface.js","webpack:///../jsen/src/Expr/Return.js","webpack:///../jsen/src/Expr/StatementsInterface.js","webpack:///../jsen/src/Expr/Statements.js","webpack:///../jsen/src/Expr/StrInterface.js","webpack:///../jsen/src/Expr/Str.js","webpack:///../jsen/src/index.js","webpack:///../chtml/src/Def/Def.js","webpack:///../chtml/src/Def/DefBlock.js","webpack:///../chtml/src/Def/DefSheet.js","webpack:///../chtml/src/ChtmlCore.js","webpack:///../chtml/src/Chtml.js","webpack:///../commons/arr/following.js","webpack:///../chtml/src/index.js","webpack:///./src/Chtml.js","webpack:///./src/App/Router.js","webpack:///../commons/arr/sort.js","webpack:///./src/App/Frameset.js","webpack:///./src/App/Frame.js","webpack:///../commons/obj/first.js","webpack:///./tests/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Array","isArray","val","toString","keys","length","slice","values","isNaN","returnValue","undefined","obj","forEach","k","callback","parseFloat","arguments","depth","filter","obj1","obj2","indexOf","entriesOrKey","count","arr","itm","firsts","amount","keysAll","until","prototypalChain","push","getPrototypeOf","getOwnPropertyNames","objs","shift","Error","deepProps","valAtObj1","valAtObj2","isReplace","withSymbols","getOwnPropertyDescriptor","e","_flatten","withObjects","reduce","acc","concat","detectObservables","path","_ctxt","ctxt","_key","isObsvble","reciever","exists","limit","splice","_even","assertion","result","contn","v1","testPass","v2","netComparison","contrast","returnOnFirstFalse","items","input","method","Component","state","params","super","args","construtor","instance","registry","singletonInstance","component","singleton","index","self","arr2","val1","val2","__proxyTargetByCommons","arrs","_arr","this","$","propagationStopped","defaultPrevented","promisesInstance","promises","promise","Promise","all","listeners","eventNames","tag","listener","remove","success","removeCallback","eventsAll","details","currentlyFiring","eventNamesAntiRecursion","listenerParams","listenerEventNames","map","str","replace","listenerEventName","bubbling","allowBubbling","firingEventName","startsWith","_shouldFire","proms","dispostn","_doFire","stopPropagation","preventDefault","context","_context","data","_data","eventName","split","Observable","bubblers","_state","prop","_incoming","addListener","removeListener","changedProps","parseInt","entries","_outgoing","_value","observersDisposition","fire","exits","props","methodPrefix","ownMethod","substr","asOwnMethod","copy","ret","apply","changedKeys","passes","failures","CACHE","_CACHE","existsReciever","_existsReciever","existence","diff","diffing","pulse","unobserve","getOffsetParent","setOffsetParent","observe","_getBubbler","offsetParent","changes","_changes","_e","subFieldName","msg","console","error","strictDebug","trapByCommons","target","trap","Proxy","proxy","set","has","deleteProperty","del","ownKeys","descriptor","getOwnPropertySymbols","itms","prevTest","txt","charAt","toUpperCase","strict","toLowerCase","fromStart","Reflow","readCallbacks","writeCallbacks","_run","requestAnimationFrame","onread","withPromise","resolve","reject","onwrite","cycle","read","write","prevTransaction","readReturn","callWrite","writeReturn","repeatTransaction","window","then","find","selector","document","_find","matchedItems","Element","matches","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","ownerDocument","querySelectorAll","item","domData","el","requestOrPayload","dataset","__customDatasetKey","customDatasets","customDataset","vals","payload","domAttr","valOrMutation","subValMutation","getAttribute","request","trim","currentVal","currentValArray","includes","setAttribute","join","removeAttribute","domHtml","content","innerHTML","append","domText","innerText","domAppend","domPrepend","prepend","vendorPrefix","styles","getComputedStyle","documentElement","prefix","match","Olink","css","api","RegExp","delimiter","readCallback","writeCallback","$savepoints","readerDisposition","savepoint","getRollbackData","currentRead","savepoints","toSavepoint","fromSavepoint","pop","param","TransformRule","transformRules","rule","round","Math","r2d","radians","deg","PI","transformStr","WebKitCSSMatrix","a","b","f","rdigit","exec","stom","A","B","C","D","scaleX","sqrt","skew","scaleY","translate","scale","rotate","atan2","atan","cssRead","psuedo","style","ruleCallback","rawProp","getPropertyValue","vendorize","parse","cssWrite","nameOrProps","destructables","inset","margin","padding","destructableProp","meaning","autopx","cssReadAsync","cssWriteAsync","cssComputeAsync","propsToRead","inlineSavepoint","cssReadInline","computedValues","withVendorVersion","cssReadKeyframes","noCache","normalize","cacheKey","stylesheetKeyframesCache","allKeyframes","stylesheetRuleCallback","ruleDefinition","type","CSSRule","KEYFRAMES_RULE","keyframes","cssRules","keyframeRule","keyframe","parseRules","cssText","keyText","offsets","normalizeToWAAPI","_keyframe","offset","sort","parseKeyframes","animationProps","pref","easing","fill","iterations","Infinity","valsList","propsList","normalProp","vendorizedProp","callCallback","reversed","stylesheets","styleSheets","stylesheetCallback","stylesheet","camelCasedProp","body","deep","subKey","prev","curr","CustomEvents","Multitap","fireCallback","hammertime","allSetup","recognizers","events","tapType","recognizer","Hammer","Tap","event","taps","add","recgzr","recgzrs","recognizeWith","recgzr2","recgzrs2","requireFailure","on","off","EventController","activeHooks","Manager","NAME","setup","firedEvents","firedEventsDetails","validate","recognizeGesture","gestureName","mainGestureName","addEventListener","teardown","removeEventListener","_setup","_teardown","gestureIndex","press","pinch","pan","swipe","tap","list","Anim","effect","readyCallbacks","finishCallbacks","cancelCallbacks","duration","cssVarRead","init","firstFrame","lastFrame","transform","anim","animate","reverse","onfinish","cancelForCss","cancel","oncancel","createCallback","succes","to","ready","currentTime","min","play","pause","finish","animationName","keyframesWithAutoSizes","height","width","getBoundingClientRect","size","offsetOrigin","rectProps","_isElement","HTMLElement","HTMLDocument","_rect","left","clientX","top","clientY","offsetX","offsetY","pageX","pageY","innerWidth","innerHeight","pageXOffset","scrollLeft","pageYOffset","scrollTop","toJSON","x","y","right","bottom","contextOffset","coordsAtRect","options","_intersection","intersection","using","start","end","coords","_alignment","axis","rect1Length","rect1","parsePlacement","keyword","delta","predicates","evalPredicates","alignment","rect2","leftline","max","rightline","topline","bottomline","withAngle","_delta","z","pow","deltaAngle","angleOfElevation","acos","asin","angleOfDepression","angle","angle2","isHorizontal","isVertical","positioningOffsets","anchors","inverses","currentOffsets","intersectionWithAnchor","position","scrollParent","excludeStaticParent","overflowRegex","parent","parentElement","test","overflow","overflowY","overflowX","scrolls","scrollHeight","clientHeight","expr","regPlacement","regModifiers","modifiers","percentageContext","total","modifier","endsWith","temp","createElement","innerHtml","firstChild","_ret","_el","cssAsync","domAttrAsync","domHtmlAsync","domTextAsync","domAppendAsync","domPrependAsync","cssTransaction","reference","refPoint","trans","el2","_coords","_coordsFormatted","from","current","progress","activeTransform","abs","translateTo","_offsets","alternateAnchors","_offsetsFormatted","offsetTo","viewport","scrollAnchor","currentScroll","axisProp","scrollTo","log","Function","search","subject","pos","beforeLast","lastIndexOf","Schema","std","html","model","caption","col","colgroup","dd","implicitRole","dt","figcaption","head","legend","li","optgroup","option","rp","rt","source","summary","track","tbody","td","tfoot","thead","tr","abbr","address","area","article","acceptableRoles","aside","audio","base","bdi","bdo","blockquote","br","button","canvas","cite","code","datalist","dfn","dialog","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","img","ins","kbd","label","link","main","mark","math","menu","meta","names","meter","nav","noscript","ol","output","picture","pre","q","ruby","samp","script","section","select","slot","small","span","strong","sub","sup","svg","table","template","textarea","time","title","u","ul","var","video","wbr","aria","banner","contentinfo","complementary","navigation","listitem","elTagName","nodeName","expandRules","roleInclusive","elSchema","currentElCategories","hasAttribute","role","node","valid","contextModel","getContentModelFor","nodeCategories","getCategoriesFor","allowedNode","disallowedNode","scope","nodeSchema","closest","contextCategories","parentNode","assertNodeBelongsInContentModel","rules","rles","categories","Matrix","sources","namespace","carry","collections","subMatrix","nsKey","nsArray","nsDrill","enter","cloneNode","classB","mixinTest","classA","prototypes","prevAns","constructor","Expr","jsenType","Super","comments","vars","Interface","ExprInterface","Jsen","Parsers","Static","parsers","grammars","varsScope","parsed","_expr","_Parsers","ReferenceInterface","CallInterface","explain","AssignmentInterface","DeletionInterface","mutates","assert","Lexer","delims","$cache","lex","tokens","$str","$options","blocks","$blocks","quotes","$quotes","$comments","runtime","nesting","maxDepth","matchesi","cache","_evalCharsAt","charWidth","commentTest","quoteTest","nestingTest","openComment","_testQuotes","openQuote","_testComments","ending","_push","chars","starting","preserveComments","_testNesting","stopChar","_testChars","stopChars","stopCharForward","matchedDelim","preserveDelims","quote","block","testList","useRegex","ci","splitSeries","regParse","varName","bindThis","cntxt","openingTag","closingTag","afterLast","Abstraction","AbstractionInterface","eval","parseCallback","Arr","ArrInterface","exprs","newExprs","exprA","uniqueSoFar","exprB","even","Arguments","ArgumentsInterface","arg","Assertion","AssertionInterface","logic","operators","isOr","or","isNor","nor","isAnd","and","isNand","nand","lastResult","trues","Assignment","operator","getEval","Bool","BoolInterface","Call","_contexts","func","_cntxts","handler","utils","Num","Str","Obj","unshift","Comments","CommentsInterface","_comments","commentPlacement","splits","_beforeLast","line","commenta","Comparison","ComparisonInterface","operand1","operand2","compare","oper","allItemsMatch","entry1Keys","entry2Keys","allEntriesMatch","exact","is","isNull","equalsTo","notEqualsTo","relative","lesserThan","greaterThan","lesserThanOrEqualsTo","greaterThanOrEqualsTo","between","partial","contains","any","in","Condition","ConditionInterface","onTrue","onFalse","Deletion","red","Func","FuncInterface","paramters","statements","arrowFunctionFormatting","parentParams","ownParams","nameInParent","nameInSelf","defaultValInParent","defaultValInSelf","localContext","defaultVal","multipleContexts","headNoWrap","bodyNoWrap","funcHead","funcBody","paramSplit","MathInterface","currentTotal","NumInterface","int","dec","ObjInterface","_entriesSplit","entry","Reference","backticks","sourceContext","parts","subjectContext","separator","nameSplit","isContext","Return","ReturnInterface","exprLc","Statements","StatementsInterface","stmts","delim","StrInterface","Def","flag","opts","_opts","defSplit","vf","flags","DefBlock","withDuplicate","withOverRidden","isDuplicate","overridden","def","newDef","existingDef","key_a","value_a","value_aUnwrapped","key_b","value_b","value_bUnwrapped","incase_a","important_a","incase_b","important_b","DefSheet","defBlock","defSheet","applyTo","ChtmlCore","root","querySelector","parseNamespace","defs","parseCascadedDefSheet","free","getCpsBlock","directive","bindingsListeners","binding","observeOnly","listenerObj","newState","oldState","evalReturn","cleanCopy","componentCallback","dataBlockScript","attrCache","paramsAttrs","attr","attributeMap","attrValue","children","elementMap","defsheet","$defs","asDirectives","cpsBlockDefs","directives","argsExpr","chainableDirectives","_directive","explainJsen","requestNodeName","computeQuery","computedRelated","toElement","roles","superrole","rolecase","matchedNode","closestSuper","_matchedNode","closestSuperSelector","CSS","escape","nodeSelector","subrole","shadowRoot","isSameNode","tries","schema","tagname","trie","assertNodeBelongsInScopeAs","_node","drilldown","alias","nodeCallback","disconnectedCallback","getRelatedNode","implicitOnly","getExplicitNode","explicitOnly","getImplicitNode","createNode","namespaceParse","roadmap","subnamespace","textContent","elTo","elFrom","import","elToNs","elFromNs","elFromRoles","recomposeDefs","replacementNode","applicableContextRoles","applicableReplacementNodeRoles","replacementNodeRole","_applicableContextRoles","contextRole","slotNodes","contextSelector","slotNodeSelector","replaceWith","appendOrPrepend","norecompose","nocompose","recomposeCallback","disposition","b_attr","a_attr","jointList","jointDefs","attributes","elToDefs","elFromDefs","called","MutationObserver","mutations","removedNodes","childList","bundle","related","Chtml","dataKey","populate","itemCallback","listContext","onlyKeys","unbindReturn","catch","isNewItem","itemNamespaceArray","itemEl","following","lastReference","after","_k","before","resolveInheritance","bundles","superNs","superEl","isImport","recompose","warn","contentLoadedPromise","readyState","waitForBundles","initObj","loadingBundlesPromise","remoteBundles","loadingBundles","warnedEarlyBundleAccess","anticyclicBundlesQuery","bundleIndex","_namespace","message","customElements","define","HTMLTemplateElement","oldValue","newValue","load","src","fetch","response","ok","text","statusText","dispatchEvent","Event","extends","processed","shouldResolve","replacement","namespaceAttr","__namespace","resolved","attachShadow","innnerText","useAs","componentInstance","use","Router","getProps","urlObj","urlProperties","parsePath","pathname","query","parseQuery","setTimeout","location","history","anchor","href","route","parseUrl","listenersDisposition","replaceState","pushState","back","forward","go","pathArr","pathStr","pathnaming","localeCompare","order","_pathnames","_path","pathObj","pathItem","Frameset","selectExpr","filterCallback","frame","active","successCallback","failureCallback","getFrames","frames","framesList","frameConstructor","Frame","routerInstance","routePathSlot","routePathSlotVal","activeChild","hasActiveChild","_children","states","register","Main","documentation","intro","download"],"mappings":"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","file":"test.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 43);\n","\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n","\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isTypeArray from '../js/isTypeArray.js';\r\nimport _isEmpty from '../js/isEmpty.js';\r\nimport _isObject from '../js/isObject.js';\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n *\r\n * @return array\r\n */\r\nexport default function(val) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from './isNull.js';\r\nimport _isUndefined from './isUndefined.js';\r\nimport _isTypeObject from './isTypeObject.js';\r\n\r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from './isString.js';\r\nimport _isUndefined from './isUndefined.js';\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nexport default function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach(k => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k]);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isString from '../js/isString.js';\r\n\r\n/**\r\n * Return an object for the given pair(s) of input.\r\n *\r\n * @param string|array \t\t\tkey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nexport default function(key, val = null) {\r\n\tvar obj = {};\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(key)) {\r\n\t\t\tobj[key] = val;\r\n\t\t} else if (_isArray(key) && _isArray(val)) {\r\n\t\t\tkey.forEach((k, i) => obj[k] = val[i]);\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '../js/isObject.js';\r\nimport _from from './from.js';\r\nimport _merge from './merge.js';\r\n\r\n/**\r\n * Return the input object with additional entries.\r\n *\r\n * @param object\t \t\t\tobj\r\n * @param string|array \t\t\tentriesOrKey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nexport default function(obj, entriesOrKey, val = null) {\r\n\treturn _merge(obj, _isObject(entriesOrKey) ? entriesOrKey : _from(entriesOrKey, val));\r\n};\r\n","\r\n/**\r\n * Returns THE FIRST ENTRY OR A NUMBER OF ENTRIES counting forward from the begining.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, amount = 1) {\r\n\tvar count = 0;\r\n\tarr.forEach(itm => {\r\n\t\tcount ++;\r\n\t});\r\n\tvar firsts = arr.slice(arr.length - count, amount);\r\n\treturn arguments.length > 1 ? firsts : firsts[0];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from '../arr/pushUnique.js';\r\nimport _getPrototypeChain from './getPrototypeChain.js';\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nexport default function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _getAllPropertyNames from './getAllPropertyNames.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(objs, callback, deepProps = false, isReplace = false, withSymbols = false) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\t_mergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (withSymbols) {\r\n\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// In case we're setting a read-only property\r\n\t\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t\t} catch(e) {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Flattens a nested array to the given depth.\r\n *\r\n * @param array \tarr\r\n * @param int \t \tdepth\r\n * @param bool \t \twithObjects\r\n *\r\n * @return array\r\n */\r\nconst _flatten = function(arr, depth = 1, withObjects = true) {\r\n\tif (!_isNumeric(depth) || depth <= 0) {\r\n\t\treturn arr;\r\n\t};\r\n\tif (!_isArray(arr) && _isObject(arr) && withObjects) {\r\n\t\tarr = Object.values(arr);\r\n\t};\r\n\tif (!_isArray(arr)) {\r\n\t\treturn arr;\r\n\t};\r\n\treturn arr.reduce((acc, val) => _isArray(val) || (_isObject(val) && withObjects) \r\n\t\t? acc.concat(_flatten(!_isArray(val) ? Object.values(val) : val, depth - 1, withObjects)) \r\n\t\t: acc.concat(val), []);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _flatten;","\r\n/**\r\n * @imports\r\n */\r\nimport _isObservable from '../js/isObservable.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isUndefined from '../js/isUndefined.js';\r\nimport _isNull from '../js/isNull.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false.\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\treciever\r\n * @param bool\t \t\t\t\tdetectObservables\r\n *\r\n * @return mixed\r\n */\r\nexport default function(ctxt, path, reciever = {}, detectObservables = true) {\r\n\tpath = _arrFrom(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tvar isObsvble = detectObservables && _isObservable(_ctxt);\r\n\t\tif (!(isObsvble ? _ctxt.get(_key) : (_isTypeObject(_ctxt) ? _key in _ctxt : _ctxt[_key]))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = isObsvble ? _ctxt.get(_key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n","\r\n/**\r\n * Removes instances of reference up to <limit> times.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \titm\r\n * @param int|bool \tlimit\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, itm, limit = false) {\r\n\tvar i = arr.indexOf(itm);\r\n\twhile (i > -1 && (limit || limit === false)) {\r\n\t\tarr.splice(i, 1);\r\n\t\tif (limit > 0) {\r\n\t\t\tlimit --;\r\n\t\t};\r\n\t\ti = arr.indexOf(itm);\r\n\t};\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _compareCallback from './compareCallback.js';\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif ((_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length)\r\n\t|| (_isObject(obj1) && _isObject(obj2) && Object.keys(obj1).length !== Object.keys(obj2).length)) {\r\n\t\treturn false;\r\n\t}\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif (depth > 0 && ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2)))) {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\treturn _isArray(result) ? result.length === obj1.length\r\n\t\t: (_isObject(result) ? Object.keys(result).length === Object.keys(obj1).length : result);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _even;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isBoolean from '../js/isBoolean.js';\r\nimport _each from './each.js';\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nexport default function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);;\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n","\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t});\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _all from '../arr/all.js';\r\nimport _isFunction from './isFunction.js';\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if a given object has observability methods.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nexport default function(input) {\r\n\treturn _isObject(input) && _all([\r\n\t\t'observe',\r\n\t\t'unobserve',\r\n\t\t'get',\r\n\t\t'set',\r\n\t\t'has',\r\n\t\t'del',\r\n\t], method => _isFunction(input[method]));\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isClass from '@onephrase/commons/js/isClass.js';\r\nimport _inherit from '@onephrase/commons/obj/inherit.js';\r\nimport Observable from '@onephrase/observable';\r\n\r\n/**\r\n * ---------------------------\r\n * The App class\r\n * ---------------------------\r\n *\r\n * This class provides window-like functionality as a component.\r\n */\r\n\t\t\t\r\nconst Component = class extends Observable {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper(state, _inherit({}, params, Component.params));\r\n\t}\r\n\t\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Finds and instantiates a registered component.\r\n\t *\r\n\t * @param string\t\t\t\tname\r\n\t * @param array\t\t\t\t\t...args\r\n\t *\r\n\t * @return Component\r\n\t */\r\n\tstatic use(name, ...args) {\r\n\t\tvar construtor, instance;\r\n\t\tif (construtor = Component.registry[name]) {\r\n\t\t\tif (construtor.singletonInstance) {\r\n\t\t\t\treturn construtor.singletonInstance;\r\n\t\t\t}\r\n\t\t\tif (_isClass(construtor.component)) {\r\n\t\t\t\tinstance = new construtor.component(...args);\r\n\t\t\t} else {\r\n\t\t\t\tinstance = construtor.component(...args);\r\n\t\t\t}\r\n\t\t\tif (construtor.singleton) {\r\n\t\t\t\tconstrutor.singletonInstance = instance;\r\n\t\t\t}\r\n\t\t\treturn instance;\r\n\t\t}\r\n\t\tthrow new Error('The \"' + name + '\" component is undefined!');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Registers a logical component.\r\n\t *\r\n\t * @param string\t\t\t\tname\r\n\t * @param Component|function\tcomponent\r\n\t * @param bool\t\t\t\t\tsingleton\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic register(name, component, singleton = false) {\r\n\t\tComponent.registry[name] = {component:component, singleton:singleton};\r\n\t}\r\n};\r\n\r\n/**\r\n * @object\r\n */\r\nComponent.registry = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nComponent.params = {\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Component;","\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nexport default function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if a given object instance has been proxied.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nexport default function(input) {\r\n\treturn (_isObject(input) && input.__proxyTargetByCommons) || false;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects into first array/object but only when not set;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (key, obj1, obj2) => {\r\n\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\tif (obj1.indexOf(obj2[key]) === -1) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (!(key in obj1)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from './pushUnique.js';\r\nimport _from from './from.js';\r\n\r\n/**\r\n * Adds items that do not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...arrs\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...arrs) {\r\n\tarrs.forEach(_arr => {\r\n\t\t_arr.forEach(itm => _pushUnique(arr, ..._from(_arr)));\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nconst Event = class {\r\n\r\n\t/**\r\n\t * Initializes an Event instance.\r\n\t *\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(params) {\r\n\t\tthis.$ = {\r\n\t\t\tpropagationStopped: false,\r\n\t\t\tdefaultPrevented: false,\r\n\t\t\tpromisesInstance: null,\r\n\t\t\tpromises: [],\r\n\t\t};\r\n\t\t_each(params, (name, value) => {\r\n\t\t\tthis[name] = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.propagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget propagationStopped() {\r\n\t\treturn this.$.propagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.defaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget defaultPrevented() {\r\n\t\treturn this.$.defaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t\tthis.$.promisesInstance = null;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\tif (!this.$.promisesInstance && this.$.promises.length) {\r\n\t\t\tthis.$.promisesInstance = Promise.all(this.$.promises);\r\n\t\t}\r\n\t\treturn this.$.promisesInstance;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Event;","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _concatUnique from '@onephrase/commons/arr/concatUnique.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _difference from '@onephrase/commons/arr/difference.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\nimport _exclude from '@onephrase/commons/arr/exclude.js';\r\nimport _isNull from '@onephrase/commons/js/isNull.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _getType from '@onephrase/commons/js/getType.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nconst EventController = class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.$ = {\r\n\t\t\tlisteners: [],\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a listener object.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return void\r\n\t */\r\n\taddListener(eventNames, callback, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback;\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t\t}\r\n\t\tvar listener = {\r\n\t\t\teventNames: eventNames, \r\n\t\t\tcallback: callback, \r\n\t\t\tparams: params,\r\n\t\t\ttag: tag,\r\n\t\t\tremove: () => {\r\n\t\t\t\t_remove(this.$.listeners, listener);\r\n\t\t\t},\r\n\t\t};\r\n\t\tthis.$.listeners.push(listener);\r\n\t\treturn listener;\r\n\t}\r\n\r\n\t/**\r\n\t * Unregisters an listener.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tremoveListener(eventNames, callback = null, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback || {};\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tvar success = false;\r\n\t\tfor (var i = 0; i < this.$.listeners.length; i ++) {\r\n\t\t\tif ((_isNull(eventNames) || _even(_arrFrom(this.$.listeners[i].eventNames), _arrFrom(eventNames))) \r\n\t\t\t&& (_isNull(callback) || this.$.listeners[i].callback === callback)\r\n\t\t\t&& (_isNull(params) || _even(this.$.listeners[i].params, params))\r\n\t\t\t&& (_isNull(tag) || this.$.listeners[i].tag === tag)) {\r\n\t\t\t\tif (this.$.listeners[i].removeCallback) {\r\n\t\t\t\t\tthis.$.listeners[i].removeCallback();\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.listeners[i].remove();\r\n\t\t\t\tsuccess = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Returns the list of params being listend.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\teventsAll() {\r\n\t\tvar eventsAll = [];\r\n\t\t(this.$.listeners || []).forEach(listener => {\r\n\t\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t\teventsAll = _concatUnique(eventsAll, _arrFrom(listener.eventNames));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn eventsAll;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires listeners that are bound to the given events.\r\n\t *\r\n\t * @param string|array\t \teventNames\r\n\t * @param object \t\t\tdetails\r\n\t *\r\n\t * @return bool|Promise\r\n\t */\r\n\tfire(eventNames, details) {\r\n\t\tvar e = details instanceof Event ? details : new Event(details);\r\n\t\t// We handle multiple events actually...\r\n\t\teventNames = _arrFrom(eventNames);\r\n\t\t// And fields already firing should trigger a refire\r\n\t\tthis.$.currentlyFiring = this.$.currentlyFiring || [];\r\n\t\tvar eventNamesAntiRecursion = _difference(eventNames, this.$.currentlyFiring);\r\n\t\tif (!eventNamesAntiRecursion.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_concatUnique(this.$.currentlyFiring, eventNamesAntiRecursion)\r\n\t\t// Initialize evteters for \"return\"\r\n\t\tfor (var i = 0; i < (this.$.listeners || []).length; i ++) {\r\n\t\t\tif (e.propagationStopped) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar listener = this.$.listeners[i];\r\n\t\t\tvar listenerParams = listener.params || {};\r\n\t\t\tvar listenerEventNames = _arrFrom(listener.eventNames).map(str => str.replace(/\\`/g, ''));\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-1 filtering...\r\n\t\t\t// Match listenerEventNames to firingEventNames\r\n\t\t\t// --------------------------\r\n\t\t\tvar matches;\r\n\t\t\tif (listenerEventNames.length) {\r\n\t\t\t\tmatches = listenerEventNames.filter(listenerEventName => {\r\n\t\t\t\t\tvar firingEventNames = e.bubbling && listenerEventName.indexOf('.') > -1 ? e.bubbling\r\n\t\t\t\t\t\t: (!e.bubbling || listenerParams.allowBubbling ? eventNamesAntiRecursion : []);\r\n\t\t\t\t\treturn firingEventNames.filter(firingEventName => (listenerEventName + '.').startsWith(firingEventName + '.')).length;\r\n\t\t\t\t}).length;\r\n\t\t\t} else {\r\n\t\t\t\tmatches = !e.bubbling || listenerParams.allowBubbling;\r\n\t\t\t}\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-2 filtering...\r\n\t\t\t// --------------------------\r\n\t\t\tif (matches && this._shouldFire(listener, eventNames, e)) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar dispostn = this._doFire(listener, eventNames, e), proms;\r\n\t\t\t\tif ((dispostn === false) || (dispostn instanceof Event && dispostn.propagationStopped)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t} else if ((dispostn === false) || (dispostn instanceof Event && dispostn.defaultPrevented)) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t} else if ((dispostn instanceof Promise && (proms = dispostn))\r\n\t\t\t\t|| (dispostn instanceof Event && (proms = dispostn.promises))) {\r\n\t\t\t\t\te.promise(proms);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t_exclude(this.$.currentlyFiring, ...eventNamesAntiRecursion)\r\n\t\t// -----------------------------\r\n\t\t// The overall return value\r\n\t\t// -----------------------------\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Fires the listener at entry \"i\".\r\n\t * Returns listener's disposition.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\t_doFire(listener, eventNames, e) {\r\n\t\tvar context = e.context || {};\r\n\t\tvar _context = e._context || {};\r\n\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t// Call listener...\r\n\t\t\tvar data = [];\r\n\t\t\tvar _data = [];\r\n\t\t\tvar result = _arrFrom(listener.eventNames).forEach(eventName => {\r\n\t\t\t\teventName = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\t\tdata.push(_get(context, eventName));\r\n\t\t\t\t_data.push(_get(_context, eventName));\r\n\t\t\t});\r\n\t\t\treturn _isArray(listener.eventNames) \r\n\t\t\t\t? listener.callback(data, _data, e)\r\n\t\t\t\t: listener.callback(data[0], _data[0], e);\r\n\t\t}\r\n\t\tvar data = {};\r\n\t\tvar _data = {};\r\n\t\teventNames.forEach(eventName => {\r\n\t\t\tvar path = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\tdata[eventName] = _get(context, path);\r\n\t\t\t_data[eventName] = _get(_context, path);\r\n\t\t});\r\n\t\t// Call listener...\r\n\t\treturn listener.callback(data, _data, e);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default EventController;","\r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nexport default function(val) {\r\n\treturn typeof val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from '@onephrase/commons/js/isNull.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumber from '@onephrase/commons/js/isNumber.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isObservable from '@onephrase/commons/js/isObservable.js';\r\nimport _getProxyTarget from '@onephrase/commons/js/getProxyTarget.js';\r\nimport _isProxy from '@onephrase/commons/js/isProxy.js';\r\nimport _proxy from '@onephrase/commons/js/proxy.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport _inherit from '@onephrase/commons/obj/inherit.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport EventController from './EventController.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observable\r\n * ---------------------------\r\n */\r\n \r\nconst Observable = class extends EventController {\r\n\r\n\t/**\r\n\t * Handles initializations.\r\n\t *\r\n\t * @param object\t\t\tstate\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper();\r\n\t\t// @see ObservableCore.init()\r\n\t\tthis.$.params = _inherit({}, params, Observable.params);\r\n\t\tthis.$.bubblers = {};\r\n\t\tthis.$.state = state;\r\n\t\tthis.$._state = _isArray(state) ? state.slice() : _copy(1, state);\r\n\t\t_each(this.$.state, (prop, value) => {\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of addListener.\r\n\t *\r\n\t * @see addListener()\r\n\t */\r\n\tobserve(...args) {\r\n\t\treturn this.addListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of removeListener.\r\n\t *\r\n\t * @see removeListener()\r\n\t */\r\n\tunobserve(...args) {\r\n\t\treturn this.removeListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Pushes data into a given property, or list of properties.\r\n\t *\r\n\t * @param string\t\tprops\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tset(prop, value) {\r\n\t\tvar data = {};\r\n\t\tif (_isString(prop) || _isNumber(prop)) {\r\n\t\t\tdata[prop] = value;\r\n\t\t} else if (_isArray(prop)) {\r\n\t\t\tprop.forEach(p => {\r\n\t\t\t\tdata[p] = value;\r\n\t\t\t})\r\n\t\t} else if (_isObject(prop)) {\r\n\t\t\tdata = prop;\r\n\t\t}\r\n\t\tvar changedProps = Object.keys(data);\r\n\t\tif (_isArray(this.$.state)) {\r\n\t\t\tchangedProps = changedProps.map(key => parseInt(key));\r\n\t\t}\r\n\t\t// ------------------\r\n\t\tvar entries = [];\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t} else {\r\n\t\t\t\tentries.push(prop);\r\n\t\t\t}\r\n\t\t\t// Incoming...\r\n\t\t\t// ------------------\r\n\t\t\tvar value = data[prop];\r\n\t\t\t// When observables come as proxies,\r\n\t\t\t// we'll save them real\r\n\t\t\tif (_isProxy(value)) {\r\n\t\t\t\tvar _value = _getProxyTarget(value);\r\n\t\t\t\tif (_isObservable(_value)) {\r\n\t\t\t\t\tvalue = _value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t\t// Set now...\r\n\t\t\t// ------------------\r\n\t\t\tthis.$.state[prop] = value;\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(changedProps, {context: this.$.state, _context: this.$._state, entries: entries, exits: []});\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tthis.$._state[prop] = this.$.state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Unsets the property or list of properties from the object.\r\n\t *\r\n\t * @param string|array\t\tprop\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tdel(prop) {\r\n\t\tvar props = _arrFrom(prop);\r\n\t\tvar exits = [];\r\n\t\tprops.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\texits.push(prop);\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t}\r\n\t\t\tdelete this.$.state[prop];\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(props, {context: this.$.state, _context: this.$._state, entries: [], exits: exits});\r\n\t\tprops.forEach(prop => {\r\n\t\t\tdelete this.$._state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Evaluates a property name to see if it's a request for instance method\r\n\t * as against state property.\r\n\t *\r\n\t * @param string\t\t\tprop\r\n\t *\r\n\t * @return function|undefined\r\n\t */\r\n\tasOwnMethod(prop) {\r\n\t\tif (_isString(prop) && this.$.params.methodPrefix && prop.startsWith(this.$.params.methodPrefix)) {\r\n\t\t\tvar ownMethod = prop.substr(this.$.params.methodPrefix.length);\r\n\t\t\tif (ownMethod && _isFunction(ownMethod = this[ownMethod])) {\r\n\t\t\t\treturn ownMethod.bind(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns a field's value.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(prop) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(prop);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tvar value = this.$.state[prop];\r\n\t\tif (_isArray(this.$.state) && !_isNumeric(prop) && _isFunction(value)) {\r\n\t\t\treturn (...args) => {\r\n\t\t\t\tvar copy = this.$.state.slice();\r\n\t\t\t\tvar ret = value.apply(this.$.state, args);\r\n\t\t\t\tvar changedKeys = _unique(Object.keys(copy).concat(Object.keys(this.$.state))).filter(k => {\r\n\t\t\t\t\tk = parseInt(k);\r\n\t\t\t\t\tif (this.$.state[k] !== copy[k]) {\r\n\t\t\t\t\t\tif (!(k in this.$.state)) {\r\n\t\t\t\t\t\t\t// Outgoing...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._outgoing(k, copy[k]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Incoming...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._incoming(k, this.$.state[k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (changedKeys.length) {\r\n\t\t\t\t\tthis.fire(changedKeys, {context: this.$.state, _context: this.$._state});\r\n\t\t\t\t\tthis.$._state = this.$.state.slice();\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Tells if a a field exists.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\thas(prop) {\r\n\t\treturn (prop in this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Keys of current entries.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tkeys() {\r\n\t\treturn Object.keys(this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\tvar passes = 0, failures = 0;\r\n\t\t// One CACHE across listeners\r\n\t\t// IMPORTANT: This cache must\r\n\t\t// be destroyed before bubbling the (e) object\r\n\t\tif (!('CACHE' in e.$)) {\r\n\t\t\te.$.CACHE = {};\r\n\t\t\te.$._CACHE = {};\r\n\t\t}\r\n\t\tvar listenerParams = listener.params || {};\r\n\t\t(!_isNull(listener.eventNames) ? _arrFrom(listener.eventNames) : eventNames).forEach(prop => {\r\n\t\t\tif (!(prop in e.$.CACHE)) {\r\n\t\t\t\te.$.CACHE[prop] = {};\r\n\t\t\t\te.$._CACHE[prop] = {};\r\n\t\t\t\t// > ACCESS\r\n\t\t\t\tvar existsReciever = {};\r\n\t\t\t\tvar _existsReciever = {};\r\n\t\t\t\tvar path = _isString(prop) ? prop.split('.') : prop;\r\n\t\t\t\te.$.CACHE[prop].val = _get(e.context, path, existsReciever);\r\n\t\t\t\te.$._CACHE[prop].val = _get(e._context, path, _existsReciever);\r\n\t\t\t\te.$.CACHE[prop].existence = existsReciever.exists;\r\n\t\t\t\te.$._CACHE[prop].existence = _existsReciever.exists;\r\n\t\t\t\t// > DIFFING\r\n\t\t\t\tif (listenerParams.diff !== false && !('diffing' in e.$.CACHE[prop])) {\r\n\t\t\t\t\te.$.CACHE[prop].diffing = e.bubbling\r\n\t\t\t\t\t|| e.$.CACHE[prop].existence !== e.$._CACHE[prop].existence \r\n\t\t\t\t\t|| (_isObject(e.$.CACHE[prop].val) && _isObject(e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t? !_even(e.$.CACHE[prop].val, e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t: e.$.CACHE[prop].val !== e.$._CACHE[prop].val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Delta...\r\n\t\t\tif (_isNumeric(listenerParams.pulse) && e.context && e._context) {\r\n\t\t\t\tif (listenerParams.pulse === 0 && e.$.CACHE[prop].val && !e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t} else if (listenerParams.pulse === 1 && !e.$.CACHE[prop].val && e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Diff...\r\n\t\t\tif (listenerParams.diff === false || e.$.CACHE[prop].diffing) {\r\n\t\t\t\tpasses ++;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn !failures && passes && super._shouldFire(listener, eventNames, e);\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures outgoing objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_outgoing(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tif (prop in this.$.bubblers) {\r\n\t\t\t\tvalue.unobserve(this.$.bubblers[prop], {allowBubbling:true});\r\n\t\t\t}\r\n\t\t\tif (_isFunction(value.getOffsetParent) && value.getOffsetParent() === this) {\r\n\t\t\t\tvalue.setOffsetParent(null);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures incoming objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_incoming(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tvalue.observe(this._getBubbler(prop), {allowBubbling:true});\r\n\t\t\tif (_isFunction(value.getOffsetParent) && !value.getOffsetParent()) {\r\n\t\t\t\tvalue.setOffsetParent(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @param object|null\t\toffsetParent\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tsetOffsetParent(offsetParent) {\r\n\t\tthis.$.offsetParent = offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @return object|null\r\n\t */\r\n\tgetOffsetParent() {\r\n\t\treturn this.$.offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a function that observes changes in child observables and bubble them up here.\r\n\t *\r\n\t * @param string\t\tname\r\n\t *\r\n\t * @return function\r\n\t */\r\n\t_getBubbler(prop) {\r\n\t\tthis.$.bubblers = this.$.bubblers || {};\r\n\t\tthis.$.bubblers[prop] = (changes, _changes, e) => {\r\n\t\t\tvar _e = {};\r\n\t\t\t_e.context = this.$.state;\r\n\t\t\t_e._context = this.$._state;\r\n\t\t\t_e.entries = (e.entries || []).slice();\r\n\t\t\t_e.exits = (e.exits || []).slice();\r\n\t\t\t_e.bubbling = (e.bubbling ? _arrFrom(e.bubbling) : Object.keys(changes))\r\n\t\t\t\t.map(subFieldName => prop + '.' + subFieldName);\r\n\t\t\treturn this.fire(prop, _e);\r\n\t\t};\r\n\t\treturn this.$.bubblers[prop];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Warning handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\twarn(msg) {\r\n\t\tconsole.error(msg);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Error handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\terror(msg) {\r\n\t\tif (this.$.params.strictDebug) {\r\n\t\t\tthrow new Error(msg);\r\n\t\t} else {\r\n\t\t\tconsole.error(msg);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Constructs a proxy wrapper for the target.\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tproxy() {\r\n\t\treturn _proxy(this, {\r\n\t\t\t// -----------------------\r\n\t\t\t// The 4 cardinal points...\r\n\t\t\t// -----------------------\r\n\t\t\tget: function(target, prop) {\r\n\t\t\t\tvar value = target.get(prop);\r\n\t\t\t\tif (_isObject(value) && _isFunction(value.proxy)) {\r\n\t\t\t\t\tvalue = value.proxy();\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\t\t\tset: function(target, prop, val) {\r\n\t\t\t\ttarget.set(prop, val);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\thas: function(target, prop) {\r\n\t\t\t\treturn target.has(prop);\r\n\t\t\t},\r\n\t\t\tdeleteProperty: function(target, prop) {\r\n\t\t\t\treturn target.del(prop);\r\n\t\t\t},\r\n\t\t\t// -----------------------\r\n\t\t\t// Unimportant additions...\r\n\t\t\t// -----------------------\r\n\t\t\townKeys: function(target) {\r\n\t\t\t\t//TODO:return Reflect.ownKeys(target.$.state);\r\n\t\t\t\treturn Object.keys(target.$.state);\r\n\t\t\t},\r\n\t\t\tdefineProperty: function(target, prop, descriptor) {\r\n\t\t\t\tObject.defineProperty(target.$.state, prop, descriptor);\r\n\t\t\t\ttarget.set(prop, target.$.state[prop]);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyDescriptor: function(target, prop) {\r\n\t\t\t\treturn Object.getOwnPropertyDescriptor(target.$.state, prop);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertySymbols: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertySymbols(target.$.state);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyNames: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertyNames(target.$.state);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nObservable.params = {\r\n\tmethodPrefix: '$',\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport _merge from '../obj/merge.js';\r\n\r\n/**\r\n * Creats a proxy and keeps special reference to it.\r\n *\r\n * @param object\t target\r\n * @param object\t trap\r\n *\r\n * @return Proxy\r\n */\r\nexport default function(target, trap) {\r\n\tvar trapByCommons = {\r\n\t\tget: (target, prop) => {\r\n\t\t\tif (prop === '__proxyTargetByCommons') {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t\tif (prop === '__proxyTrapByCommons') {\r\n\t\t\t\treturn trap;\r\n\t\t\t}\r\n\t\t\treturn trap.get ? trap.get(target, prop) : target[prop];\r\n\t\t},\r\n\t};\r\n\treturn new Proxy(target, _merge({}, trap, trapByCommons));\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Observable from './Observable.js';\r\nimport EventController from './EventController.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tEventController,\r\n\tEvent\r\n};\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport _isProxy from './isProxy.js';\r\n\r\n/**\r\n * Returns the proxy's target object as earlier saved.\r\n *\r\n * @param mixed\t\tproxy\r\n *\r\n * @return mixed\r\n */\r\nexport default function(instance) {\r\n\treturn _isProxy(instance) ? instance.__proxyTargetByCommons : undefined;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _remove from './remove.js';\r\n\r\n/**\r\n * Removes all instances of each item.\r\n *\r\n * @param array \tarr\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...itms) {\r\n\titms.forEach(itm => _remove(arr, itm));\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies only properties of an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tonly\r\n * @param array\t\t \texcept\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\treturn _mergeCallback([{}, obj], (key, obj1, obj2) => {\r\n\t\tif (!_isFunction(obj2[key])) {\r\n\t\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t\t}\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the difference of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) === -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n","\r\n/**\r\n * Converts a string to title case.\r\n *\r\n * @param string \tstr\r\n * @param bool \t\tstrict\r\n *\r\n * @return string\r\n */\r\nexport default function(str, strict) {\r\n\tif (typeof str !== 'string') {\r\n\t\treturn str;\r\n\t}\r\n\treturn str.replace(/\\w\\S*/g,  function(txt) { return txt.charAt(0).toUpperCase() + ((typeof strict !== undefined && strict) ? txt.substr(1).toLowerCase() : txt.substr(1)); })\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _toTitle from './toTitle.js';\r\n\r\n/**\r\n * Makes a string camel-cased.\r\n *\r\n * @param string \tstr\r\n * @param bool\t \tfromStart\r\n *\r\n * @return string\r\n */\r\nexport default function(str, fromStart) {\r\n\t// Make disting words\r\n\tstr = _toTitle(str.replace(/-/g, ' ')).replace(/ /g, '');\r\n\treturn fromStart ? str : str[0].toLowerCase() + str.substr(1);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Binds callbacks to requestAnimationFrame()\r\n * to create a central \"read/write\" phases for DOM access.\r\n * ---------------------------\r\n */\r\n\t\t\t\r\nconst Reflow = {\r\n\t\r\n\t/**\r\n\t * Holds all callbacks bound to the \"read\" phase.\r\n\t *\r\n\t * @var array\r\n\t */\r\n\treadCallbacks: [],\r\n\t\r\n\t/**\r\n\t * Holds all callbacks bound to the \"write\" phase.\r\n\t *\r\n\t * @var array\r\n\t */\r\n\twriteCallbacks: [],\r\n\r\n\t/**\r\n\t * Starts the loop.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\t_run: function() {\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tReflow.readCallbacks.forEach((callback, i) => {\r\n\t\t\t\tif (callback && !callback()) {\r\n\t\t\t\t\tReflow.readCallbacks[i] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tReflow.writeCallbacks.forEach((callback, i) => {\r\n\t\t\t\tif (callback && !callback()) {\r\n\t\t\t\t\tReflow.writeCallbacks[i] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tReflow._run();\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Binds a callback to the \"read\" phase.\r\n\t *\r\n\t * @param function \tcallback\r\n\t * @param bool\t\twithPromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tonread: function(callback, withPromise = false) {\r\n\t\tif (withPromise) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tReflow.readCallbacks.push(() => {\r\n\t\t\t\t\tcallback(resolve, reject);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tReflow.readCallbacks.push(callback);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Binds a callback to the \"write\" phase.\r\n\t *\r\n\t * @param function \tcallback\r\n\t * @param bool\t\twithPromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tonwrite: function(callback, withPromise = false) {\r\n\t\tif (withPromise) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tReflow.writeCallbacks.push(() => {\r\n\t\t\t\t\tcallback(resolve, reject);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tReflow.writeCallbacks.push(callback);\r\n\t},\r\n\t\r\n\t/**\r\n\t * A special construct for DOM manipulations that span\r\n\t * one or more read/write cycles.\r\n\t *\r\n\t * @param function \tread\r\n\t * @param function \twrite\r\n\t * @param mixed\t\tprevTransaction\r\n\t *\r\n\t * @return void|mixed\r\n\t */\r\n\tcycle: function(read, write, prevTransaction) {\r\n\t\tReflow.onread(() => {\r\n\t\t\t// Record initial values\r\n\t\t\tvar readReturn = read(prevTransaction);\r\n\t\t\tif (readReturn) {\r\n\t\t\t\t// Call erite, the transation\r\n\t\t\t\tvar callWrite = (readReturn) => {\r\n\t\t\t\t\tReflow.onwrite(() => {\r\n\t\t\t\t\t\tvar writeReturn = write(readReturn, prevTransaction);\r\n\t\t\t\t\t\tif (writeReturn) {\r\n\t\t\t\t\t\t\t// Repeat transaction\r\n\t\t\t\t\t\t\tvar repeatTransaction = (writeReturn) => {\r\n\t\t\t\t\t\t\t\tReflow.cycle(read, write, writeReturn);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t// ---------------------------------------\r\n\t\t\t\t\t\t\t// If \"write\" returns a promise, we wait until it is resolved\r\n\t\t\t\t\t\t\t// ---------------------------------------\r\n\t\t\t\t\t\t\tif (writeReturn instanceof window.Promise) {\r\n\t\t\t\t\t\t\t\twriteReturn.then(repeatTransaction);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trepeatTransaction();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\t// ---------------------------------------\r\n\t\t\t\t// If \"read\" returns a promise, we wait until it is resolved\r\n\t\t\t\t// ---------------------------------------\r\n\t\t\t\tif (readReturn instanceof window.Promise) {\r\n\t\t\t\t\treadReturn.then(callWrite);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallWrite();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n};\r\nReflow._run();\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reflow;","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isBoolean from '@onephrase/commons/js/isBoolean.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _toCamel from '@onephrase/commons/str/toCamel.js';\r\nimport Reflow from './Reflow.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Element manipulation utilites.\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Creates a DOM element\r\n * from any of markup, selector, HTMLElement.\r\n *\r\n * @param mixed \t\t\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst from = function(input) {\r\n\tif (_isString(input)) {\r\n\t\tvar el;\r\n\t\tif (input.trim().startsWith('<')) {\r\n\t\t\t// Create a node from markup\r\n\t\t\tvar temp = document.createElement('div');\r\n\t\t\ttemp.innerHtml = input;\r\n\t\t\tel = temp.firstChild;\r\n\t\t} else {\r\n\t\t\tel = find(input);\r\n\t\t}\r\n\t\treturn el;\r\n\t}\r\n\treturn input;\r\n};\r\n\r\n/**\r\n * Queries a DOM context for the first element matching\r\n * the given selector.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n *\r\n * @return HTMLElement\r\n */\r\nconst find = function(selector, context = document) {\r\n\treturn _find(selector, context, false/*all*/);\r\n};\r\n\r\n/**\r\n * Queries a DOM context for all elements matching\r\n * the given selector.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n *\r\n * @return DOMNodeList\r\n */\r\nconst findAll = function(selector, context = document) {\r\n\treturn _find(selector, context);\r\n};\r\n\r\n/**\r\n * DOM query.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n * @param bool\t\t \t\t\tall\r\n *\r\n * @return DOMNodeList|HTMLElement\r\n */\r\nconst _find = function(selector, context = document, all = true) {\r\n\tvar matchedItems, method = all ? 'querySelectorAll' : 'querySelector';\r\n\ttry {\r\n\t\tmatchedItems = context[method](selector);\r\n\t} catch(e) {\r\n\t\ttry {\r\n\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':matches('));\r\n\t\t} catch(e) {\r\n\t\t\ttry {\r\n\t\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':-webkit-any('));\r\n\t\t\t} catch(e) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':-moz-any('));\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn matchedItems;\r\n};\r\n\r\n/**\r\n * @polyfills\r\n */\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = \r\n\tElement.prototype.matchesSelector || \r\n\tElement.prototype.mozMatchesSelector ||\r\n\tElement.prototype.msMatchesSelector || \r\n\tElement.prototype.oMatchesSelector || \r\n\tElement.prototype.webkitMatchesSelector ||\r\n\tfunction(s) {\r\n\t\tvar matches = (this.document || this.ownerDocument).querySelectorAll(s),\r\n\t\t\ti = matches.length;\r\n\t\twhile (--i >= 0 && matches.item(i) !== this) {}\r\n\t\treturn i > -1;            \r\n\t};\r\n}\r\n\r\n/**\r\n * Gets or sets custom data.\r\n *\r\n * @param DOMElement\t\t\tel \r\n * @param string|array|object\trequestOrPayload\r\n * @param mixed|void\t\t\tval\r\n *\r\n * @return mixed\r\n */\r\nconst domData = function(el, requestOrPayload, val = null) {\r\n\tif (!el.dataset.__customDatasetKey) {\r\n\t\tel.dataset.__customDatasetKey = customDatasets.length;\r\n\t\tcustomDatasets[el.dataset.__customDatasetKey] = {};\r\n\t}\r\n\tvar customDataset = customDatasets[el.dataset.__customDatasetKey];\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(requestOrPayload)) {\r\n\t\t\treturn customDataset[_toCamel(requestOrPayload)];\r\n\t\t}\r\n\t\tif (_isArray(requestOrPayload)) {\r\n\t\t\tvar vals = {};\r\n\t\t\trequestOrPayload.forEach(key => {\r\n\t\t\t\tvals[key] = customDataset[_toCamel(key)];\r\n\t\t\t});\r\n\t\t\treturn vals;\r\n\t\t}\r\n\t}\r\n\tvar payload = requestOrPayload;\r\n\tif (!_isObject(requestOrPayload)) {\r\n\t\tpayload = _objFrom(requestOrPayload, val);\r\n\t}\r\n\t_each(payload, (key, val) => {\r\n\t\tcustomDataset[_toCamel(key)] = val;\r\n\t});\r\n};\r\nconst customDatasets = [];\r\n \r\n/**\r\n * ---------------------\r\n * MANIPULATION METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * Gets an attribute or a list of attributes,\r\n * or sets an attribute or a list of attributes.\r\n *\r\n * @param DOMElement\t\t\tel \r\n * @param string|array|object\trequestOrPayload\r\n * @param string|bool|void\t\tvalOrMutation\r\n * @param bool|void\t\t\t\tsubValMutation\r\n *\r\n * @return mixed\r\n */\r\nconst domAttr = function(el, requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(requestOrPayload)) {\r\n\t\t\treturn el.getAttribute(requestOrPayload);\r\n\t\t}\r\n\t\tif (_isArray(requestOrPayload)) {\r\n\t\t\tvar vals = {};\r\n\t\t\trequestOrPayload.forEach(request => {\r\n\t\t\t\tvals[request] = el.getAttribute(request);\r\n\t\t\t});\r\n\t\t\treturn vals;\r\n\t\t}\r\n\t}\r\n\tvar payload = requestOrPayload;\r\n\tif (!_isObject(payload)) {\r\n\t\tpayload = _objFrom(requestOrPayload, valOrMutation);\r\n\t} else {\r\n\t\tsubValMutation = valOrMutation;\r\n\t}\r\n\t_each(payload, (name, valOrMutation) => {\r\n\t\tif (arguments.length > 3 || (_isObject(payload) && arguments.length > 2)) {\r\n\t\t\tvar substr = _isString(valOrMutation) ? valOrMutation.trim() : valOrMutation;\r\n\t\t\tvar currentVal = el.getAttribute(name);\r\n\t\t\tvar currentValArray = currentVal ? currentVal.split(' ').map(val => val.trim()) : [];\r\n\t\t\tif (!subValMutation && currentValArray.includes(substr)) {\r\n\t\t\t\t// Add...\r\n\t\t\t\tel.setAttribute(name, _remove(currentValArray, substr).join(' '));\r\n\t\t\t} else if (subValMutation && !currentValArray.includes(substr)) {\r\n\t\t\t\t// Remove...\r\n\t\t\t\tel.setAttribute(name, currentValArray.concat(substr).join(' '));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (valOrMutation === false) {\r\n\t\t\t\tel.removeAttribute(name);\r\n\t\t\t} else {\r\n\t\t\t\tel.setAttribute(name, valOrMutation === true ? 'true' : valOrMutation);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn el;\r\n};\r\n\r\n/**\r\n * Sets or gets HTML content.\r\n *\r\n * @param string|HTMLElement\tcontent\r\n *\r\n * @return void|string\r\n */\r\nconst domHtml = function(el, content = null) {\r\n\tif (arguments.length > 1) {\r\n\t\tif (_isString(content)) {\r\n\t\t\tel.innerHTML = content;\r\n\t\t} else {\r\n\t\t\tel.innerHTML = '';\r\n\t\t\tif (!_isUndefined(content)) {\r\n\t\t\t\tel.append(content);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn el;\r\n\t}\r\n\treturn el.innerHTML;  \r\n};\r\n\r\n/**\r\n * Sets or gets text content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return void|string\r\n */\r\nconst domText = function(el, content = null) {\r\n\tif (arguments.length > 1) {\r\n\t\tel.innerText = _isUndefined(content) ? '' : content;\r\n\t\treturn el;\r\n\t}\r\n\treturn el.innerText;  \r\n};\r\n\r\n/**\r\n * Appends new content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return HTMLElement\r\n */\r\nconst domAppend = function(el, content) {\r\n\tel.append(_isUndefined(content) ? '' : content); \r\n\treturn el; \r\n};\r\n\r\n/**\r\n * Prepends new content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return HTMLElement\r\n */\r\nconst domPrepend = function(el, content) {\r\n\tel.prepend(_isUndefined(content) ? '' : content);  \r\n\treturn el; \r\n};\r\n \r\n/**\r\n * ---------------------\r\n * ASYNC METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * The async type of domAttr().\r\n *\r\n * @see domAttr()\r\n *\r\n * @return Promise\r\n */\r\nconst domAttrAsync = function(el, requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\tif (arguments.length === 2) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domAttr(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domAttr(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domHtml().\r\n *\r\n * @see domHtml()\r\n *\r\n * @return Promise\r\n */\r\nconst domHtmlAsync = function(el, write = null) {\r\n\tif (arguments.length > 1) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domHtml(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domHtml(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domText().\r\n *\r\n * @see domText()\r\n *\r\n * @return Promise\r\n */\r\nconst domTextAsync = function(el, write = null) {\r\n\tif (arguments.length > 1) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domText(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domText(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domAppend().\r\n *\r\n * @see domAppend()\r\n *\r\n * @return Promise\r\n */\r\nconst domAppendAsync = function(el, write) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domAppend(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domPrepend().\r\n *\r\n * @see domPrepend()\r\n *\r\n * @return Promise\r\n */\r\nconst domPrependAsync = function(el, write) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domPrepend(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n \r\n/**\r\n * ---------------------\r\n * OTHER METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * Returns all, only text nodes.\r\n *\r\n * @param DOMElement \t\t\tel\r\n *\r\n * @return array\r\n */\r\nconst domTextNodes = function(el) {\r\n\t// Filter\r\n\tvar rejectScriptTextFilter = {\r\n\t\tacceptNode: function(node) {\r\n\t\t\tif (node.parentNode.nodeName !== 'SCRIPT') {\r\n\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t// Walker\r\n\tvar walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, rejectScriptTextFilter, false);\r\n\tvar node;\r\n\tvar textNodes = [];\r\n\twhile(node = walker.nextNode()) {\r\n\t\ttextNodes.push(node.nodeValue);\r\n\t}\r\n\treturn textNodes;\r\n};\r\n\r\n/**\r\n * Observes when the given elements or selectors are added or removed\r\n * from the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param int\t\t\t\t\t\ttest\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domMutationCallback = function(els, callback, test = null, context = null, observeContext = true) {\r\n\tvar search = (el, nodeListArray) => {\r\n\t\tif (_isString(el)) {\r\n\t\t\t// Is directly mutated...\r\n\t\t\tvar matches = nodeListArray.filter(node => node.matches(el));\r\n\t\t\tif (matches.length) {\r\n\t\t\t\treturn matches;\r\n\t\t\t}\r\n\t\t\t// Is contextly mutated...\r\n\t\t\tif (observeContext) {\r\n\t\t\t\tmatches = nodeListArray\r\n\t\t\t\t\t.reduce((collection, node) => collection.concat(_arrFrom(node.querySelectorAll(el))), []);\r\n\t\t\t\tif (matches.length) {\r\n\t\t\t\t\treturn matches;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Is directly mutated...\r\n\t\t\tif (nodeListArray.includes(el)) {\r\n\t\t\t\treturn el;\r\n\t\t\t}\r\n\t\t\t// Is contextly mutated...\r\n\t\t\tif (observeContext && nodeListArray.length) {\r\n\t\t\t\tvar parentNode = el;\r\n\t\t\t\twhile(!success && (parentNode = parentNode.parentNode)) {\r\n\t\t\t\t\tif (nodeListArray.includes(parentNode)) {\r\n\t\t\t\t\t\treturn el;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar mo = new MutationObserver(mutations => {\r\n\t\tif (test !== 0) {\r\n\t\t\tvar matchedAddedNodes = [];\r\n\t\t\t_arrFrom(els).forEach(el => {\r\n\t\t\t\tif (_isString(el)) {\r\n\t\t\t\t\tmatchedAddedNodes = mutations\r\n\t\t\t\t\t\t.reduce((matches, mut) => matches.concat(search(el, _arrFrom(mut.addedNodes)), matchedAddedNodes));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar matchedAsAddedNode = mutations\r\n\t\t\t\t\t\t.reduce((match, mut) => match || search(el, _arrFrom(mut.addedNodes)), null);\r\n\t\t\t\t\tif (matchedAsAddedNode) {\r\n\t\t\t\t\t\tmatchedAddedNodes.push(matchedAsAddedNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (matchedAddedNodes.length) {\r\n\t\t\t\tcallback(1, ...matchedAddedNodes);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (test !== 1) {\r\n\t\t\tvar matchedRemovedNodes = [];\r\n\t\t\t_arrFrom(els).forEach(el => {\r\n\t\t\t\tif (_isString(el)) {\r\n\t\t\t\t\tmatchedRemovedNodes = mutations\r\n\t\t\t\t\t\t.reduce((matches, mut) => matches.concat(search(el, _arrFrom(mut.removedNodes)), matchedRemovedNodes));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar matchedAsRemovedNode = mutations\r\n\t\t\t\t\t\t.reduce((match, mut) => match || search(el, _arrFrom(mut.removedNodes)), null);\r\n\t\t\t\t\tif (matchedAsRemovedNode) {\r\n\t\t\t\t\t\tmatchedRemovedNodes.push(matchedAsRemovedNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (matchedRemovedNodes.length) {\r\n\t\t\t\tcallback(0, ...matchedRemovedNodes);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tmo.observe(context || document.body, {childList:true, subtree:true});\r\n\treturn mo;\r\n};\r\n\r\n/**\r\n * Shortcut function to connectedCallback().\r\n *\r\n * Observes when the given elements or selectors are added\r\n * to the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domConnectedCallback = function(els, callback, context = null, observeContext = true) {\r\n\treturn connectedCallback(els, (test, ...els) => {\r\n\t\tcallback(...els);\r\n\t}, 1/*test*/, context, observeContext);\r\n};\r\n\r\n/**\r\n * Shortcut function to connectedCallback().\r\n *\r\n * Observes when the given elements or selectors are removed\r\n * from the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domDisconnectedCallback = function(els, callback, context = null, observeContext = true) {\r\n\treturn connectedCallback(els, (test, ...els) => {\r\n\t\tcallback(...els);\r\n\t}, 0/*test*/, context, observeContext);\r\n};\r\n\r\n/**\r\n * Observes changes in attributes of the given element.\r\n *\r\n * @param HTMLElement\t\t\t\tel\r\n * @param function\t\t\t\t\tcallback\r\n * @param array\t\t\t\t\t\tfilter\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domAttrChangeCallback = function(el, callback, filter = []) {\r\n\tvar observer = new MutationObserver(mutations => {\r\n\t\tmutations.forEach(m => {\r\n\t\t\tcallback(m);\r\n\t\t});\r\n\t});\r\n\tvar params = {attributes:true, attributeOldValue:true};\r\n\tif (filter) {\r\n\t\tparams.attributeFilter = filter;\r\n\t}\r\n\tobserver.observe(el, params);\r\n\treturn observer;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tfrom,\r\n\tfind,\r\n\tfindAll,\r\n\tdomData,\r\n\tdomAttr,\r\n\tdomHtml,\r\n\tdomText,\r\n\tdomAppend,\r\n\tdomPrepend,\r\n\tdomAttrAsync,\r\n\tdomHtmlAsync,\r\n\tdomTextAsync,\r\n\tdomAppendAsync,\r\n\tdomPrependAsync,\r\n\tdomTextNodes,\r\n\tdomMutationCallback,\r\n\tdomConnectedCallback,\r\n\tdomDisconnectedCallback,\r\n\tdomAttrChangeCallback,\r\n};","\r\n/**\r\n * ---------------------------\r\n * A collection of Vendor utilities.\r\n * ---------------------------\r\n */\r\n \t\r\n/**\r\n* The vendor prefix in different format.\r\n*\r\n* @param object\r\n*/\r\nconst vendorPrefix = (function() {\r\n\tvar styles = window.getComputedStyle(document.documentElement, '');\r\n\tvar prefix = (Array.prototype.slice.call(styles).join('').match(/-(moz|webkit|ms)-/) || styles.Olink === '' && ['', 'o'])[1];\r\n\tvar api = ('WebKit|Moz|Ms|O').match(new RegExp('(' + prefix + ')', 'i'))[1];\r\n\treturn {prefix:prefix, css:'-' + prefix + '-', api:api,};\r\n})();\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tvendorPrefix,\r\n}","\r\n/**\r\n * Splits a camel-cased string.\r\n *\r\n * @param string \tstr\r\n * @param string \tdelimiter\r\n *\r\n * @return string\r\n */\r\nexport default function(str, delimiter) {\r\n\treturn str === undefined ? '' : str.split(/(?=[A-Z])/).join(delimiter ? delimiter : ' '); // positive lookahead to keep the capital letters\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\n\r\n/**\r\n * ----------------------------------------\r\n * Establishes an operatiom that can be rolledback\r\n * without altering similar operation by other code.\r\n * ----------------------------------------\r\n */\r\n \r\nconst Transaction = class {\r\n\r\n\t/**\r\n\t * Creates a new transaction instance.\r\n\t *\r\n\t * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel \r\n\t * @param string|array|object\tparams\r\n\t * @param function\t \t\t\treadCallback\r\n\t * @param function\t \t\t\twriteCallback\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params, readCallback, writeCallback) {\r\n\t\tthis.el = el;\r\n\t\tthis.params = _arrFrom(params);\r\n\t\tthis.readCallback = readCallback;\r\n\t\tthis.writeCallback = writeCallback;\r\n\t\tthis.$savepoints = [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a savepoint that can be later rolled back to.\r\n\t *\r\n\t * @return Promise|mixed\r\n\t */\r\n\tsave() {\r\n\t\tvar readerDisposition = this.readCallback(this.el, this.params);\r\n\t\tif (readerDisposition instanceof Promise) {\r\n\t\t\treturn readerDisposition.then(data => this.$savepoints.push(data));\r\n\t\t} else if (_isObject(readerDisposition)) {\r\n\t\t\treturn this.$savepoints.push(readerDisposition);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Marks recods a commited.\r\n\t *\r\n\t * @param int\tsavepoint\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tcommit(savepoint = 0) {\r\n\t\tfor (var i = 0; i <= savepoint && savepoint < this.$savepoints.length; i ++) {\r\n\t\t\tthis.$savepoints[i] = null;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Rolls the transaction back to a savepoint.\r\n\t *\r\n\t * @param int\tsavepoint\r\n\t *\r\n\t * @return void}Promise\r\n\t */\r\n\trollback(savepoint = 0) {\r\n\t\tif (!_isNumeric(savepoint)) {\r\n\t\t\tthrow new Error('A valid transaction ID transaction must be provided!');\r\n\t\t}\r\n\t\t// -----------------------\r\n\t\tvar getRollbackData = currentRead => {\r\n\t\t\tvar savepoints = this.$savepoints.splice(savepoint);\r\n\t\t\t// ToSavepoint is our target point\r\n\t\t\tvar toSavepoint = savepoints.shift();\r\n\t\t\tif (!toSavepoint) {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t\t// FromSavepoint is our last point before current,\r\n\t\t\t// which we need to validate with current\r\n\t\t\tvar fromSavepoint = savepoints.pop();\r\n\t\t\tvar data = {};\r\n\t\t\t// Restore only what's applicable.\r\n\t\t\tthis.params.forEach(param => {\r\n\t\t\t\t// We'll restore only values that have\r\n\t\t\t\t// NOT changed from what we earlier COMMITTED...\r\n\t\t\t\tif (fromSavepoint && currentRead[param] !== fromSavepoint[param]) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// We'll restore only values that\r\n\t\t\t\t// HAVE changed from what we earlier RECORDED...\r\n\t\t\t\tif (currentRead[param] !== toSavepoint[param]) {\r\n\t\t\t\t\tdata[param] = toSavepoint[param];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn data;\r\n\t\t};\r\n\t\t// -----------------------\r\n\t\tvar currentRead = this.readCallback(this.el, this.params);\r\n\t\tif (currentRead instanceof Promise) {\r\n\t\t\treturn currentRead.then(currentRead => this.writeCallback(this.el, getRollbackData(currentRead)));\r\n\t\t}\r\n\t\treturn this.writeCallback(this.el, getRollbackData(currentRead));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns the number of pushes.\r\n\t *\r\n\t * @return int\r\n\t */\r\n\tdepth() {\r\n\t\treturn this.$savepoints.length;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Transaction;","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\n\r\n/**\r\n * ------------------------------\r\n * The little transform utility class\r\n * and stringifyer classes.\r\n * ------------------------------\r\n */\r\nconst TransformRule = class {\r\n\t\r\n\t/**\r\n\t * Creates a new TransformRule instance\r\n\t * and each rule's appropriate class.\r\n\t *\r\n\t * @param object\t\t transformRules\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(transformRules) {\r\n\t\t_each(transformRules, (rule, value) => {\r\n\t\t\tif (['rotate', 'scale', 'skew', 'translate'].includes(rule)) {\r\n\t\t\t\tthis[rule] = _isArray(value)\r\n\t\t\t\t\t? new TransformRule[rule](...value)\r\n\t\t\t\t\t: new TransformRule[rule](value);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Stringifies the transformRules in a CSS-compatible format.\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\treturn ['rotate', 'scale', 'skew', 'translate'].reduce(\r\n\t\t\t(str, rule) => str + (this[rule] && this[rule].length ? ' ' + this[rule] : ''), ''\r\n\t\t).trim();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Unmatrix: parse the values of the matrix\r\n\t *\r\n\t * Algorithm from:\r\n\t *\r\n\t * https://github.com/matthewmueller/unmatrix/blob/master/index.js\r\n\t * @see http://hg.mozilla.org/mozilla-central/file/7cb3e9795d04/layout/style/nsStyleAnimation.cpp\r\n\t *\r\n\t * @param string \t str\r\n\t *\r\n\t * @return {Object}\r\n\t */\r\n\tstatic parse(str) {\r\n\t\t// String to matrix\r\n\t\tvar stom = function(transformStr) {\r\n\t\t\tvar m = [];\r\n\t\t\tif (window.WebKitCSSMatrix) {\r\n\t\t\t\tm = new window.WebKitCSSMatrix(transformStr);\r\n\t\t\t\treturn [m.a, m.b, m.c, m.d, m.e, m.f];\r\n\t\t\t}\r\n\t\t\tvar rdigit = /[\\d\\.\\-]+/g;\r\n\t\t\tvar n;\r\n\t\t\twhile(n = rdigit.exec(transformStr)) {\r\n\t\t\t\tm.push(+n);\r\n\t\t\t}\r\n\t\t\treturn m;\r\n\t\t};\r\n\t\t// Round to the nearest hundredth\r\n\t\tvar round = function(n) {\r\n\t\t\treturn Math.round(n * 100) / 100;\r\n\t\t};\r\n\t\t// Radians to degrees\r\n\t\tvar r2d = function(radians) {\r\n\t\t\tvar deg = radians * 180 / Math.PI;\r\n\t\t\treturn round(deg);\r\n\t\t};\r\n\t\t// ---------------------------------\r\n\t\tvar m = stom(str);\r\n\t\tvar A = m[0];\r\n\t\tvar B = m[1];\r\n\t\tvar C = m[2];\r\n\t\tvar D = m[3];\r\n\t\tif (A * D == B * C) throw new Error('Dramatic.parseTransform: matrix is singular');\r\n\t\t// step (3)\r\n\t\tvar scaleX = Math.sqrt(A * A + B * B);\r\n\t\tA /= scaleX;\r\n\t\tB /= scaleX;\r\n\t\t// step (4)\r\n\t\tvar skew = A * C + B * D;\r\n\t\tC -= A * skew;\r\n\t\tD -= B * skew;\r\n\t\t// step (5)\r\n\t\tvar scaleY = Math.sqrt(C * C + D * D);\r\n\t\tC /= scaleY;\r\n\t\tD /= scaleY;\r\n\t\tskew /= scaleY;\r\n\t\t// step (6)\r\n\t\tif ( A * D < B * C ) {\r\n\t\t\tA = -A;\r\n\t\t\tB = -B;\r\n\t\t\tskew = -skew;\r\n\t\t\tscaleX = -scaleX;\r\n\t\t}\r\n\t\treturn new TransformRule({\r\n\t\t\ttranslate: [/*x*/m[4], /*y*/m[5],],\r\n\t\t\tscale: [/*x*/round(scaleX), /*y*/round(scaleY),],\r\n\t\t\trotate: r2d(Math.atan2(B, A)),\r\n\t\t\tskew: r2d(Math.atan(skew)),\r\n\t\t});\r\n\t};\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"rotate\" value class\r\n * -------------\r\n */\r\nTransformRule.rotate = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"rotate\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'deg' : val);\r\n\t\treturn 'rotate(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"scale\" array class\r\n * -------------\r\n */\r\nTransformRule.scale = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"scale\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\treturn 'scale(' + this.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"skew\" array class\r\n * -------------\r\n */\r\nTransformRule.skew = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"skew\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'deg' : val);\r\n\t\treturn 'skew(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"translate\" array class\r\n * -------------\r\n */\r\nTransformRule.translate = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"translate\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'px' : val);\r\n\t\treturn 'translate(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default TransformRule;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tvendorPrefix\r\n} from '../../App/Client.js';\r\nimport _fromCamel from '@onephrase/commons/str/fromCamel.js';\r\nimport _toCamel from '@onephrase/commons/str/toCamel.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _replace from '@onephrase/commons/arr/replace.js';\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\nimport _copyPlain from '@onephrase/commons/obj/copyPlain.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport Transaction from '../Transaction.js';\r\nimport Reflow from '../Reflow.js';\r\nimport TransformRule from './TransformRule.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Returns computed CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|array\t\tprops\r\n * @param string\t\t\tpsuedo\r\n *\r\n * @return object|string\r\n */\r\nconst cssRead = function(el, props, psuedo = null) {\r\n\tvar style = window.getComputedStyle(el, psuedo), rect;\r\n\treturn ruleCallback(props, (prop, rawProp) => {\r\n\t\tvar val = style.getPropertyValue(vendorize(prop) || prop);\r\n\t\tif ((prop === 'width' || prop === 'height') && val === '') {\r\n\t\t\tval = '0px';\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// We return an object for the \"transform\" property\r\n\t\t// -----------------------------\r\n\t\tif (prop === 'transform') {\r\n\t\t\tval = TransformRule.parse(val);\r\n\t\t}\r\n\t\treturn val;\r\n\t}, false/*withVendorVersion*/);\r\n};\r\n\r\n/**\r\n * Sets new CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tnameOrProps\r\n * @param string|number\t\tval\r\n *\r\n * @return HTMLElement\r\n */\r\nconst cssWrite = function(el, nameOrProps, val = null) {\r\n\tnameOrProps = typeof nameOrProps === 'string' \r\n\t\t? _objFrom(nameOrProps, val)\r\n\t\t: nameOrProps;\r\n\tvar destructables = {\r\n\t\tinset: ['top', 'right', 'bottom', 'left'],\r\n\t\tmargin: ['top', 'right', 'bottom', 'left'],\r\n\t\tpadding: ['top', 'right', 'bottom', 'left'],\r\n\t};\r\n\truleCallback(Object.keys(nameOrProps), (prop, rawProp) => {\r\n\t\tvar val = nameOrProps[rawProp];\r\n\t\t// -----------------------------\r\n\t\t// We can destucture things like \"inset\"(\"left\", \"top\", \"right\", \"bottom\"), etc\r\n\t\t// -----------------------------\r\n\t\t_each(destructables, (destructableProp, meaning) => {\r\n\t\t\tif (prop === destructableProp) {\r\n\t\t\t\tif (_isObject(val)) {\r\n\t\t\t\t\tval = meaning.map(key => val[key]).filter(val => !_isUndefined(val));\r\n\t\t\t\t}\r\n\t\t\t\tif (_isArray(val)) {\r\n\t\t\t\t\tval = val.join(' ');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t// -----------------------------\r\n\t\t// We accept an object for the \"transform\" property\r\n\t\t// -----------------------------\r\n\t\tif (prop === 'transform' && _isObject(val) && !(val instanceof TransformRule)) {\r\n\t\t\tval = (new TransformRule(val)).toString();\r\n\t\t}\r\n\t\tel.style[prop] = autopx.includes(prop) && _isNumeric(val)\r\n\t\t\t? val + 'px'\r\n\t\t\t: val;\r\n\t}, 'auto'/*withVendorVersion*/);\r\n\treturn el;\r\n};\r\n \r\n/**\r\n * The cssRead() and cssWrite() function in one signature.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param array\t\t\t\t...args\r\n *\r\n * @return mixed\r\n */\r\nconst css = function(el, ...args) {\r\n\tif ((args.length > 1 && _isString(args[0])) || _isObject(args[0])) {\r\n\t\treturn cssWrite(el, ...args);\r\n\t}\r\n\treturn cssRead(el, ...args);\r\n};\r\n \r\n/**\r\n * ---------------------\r\n * ASYNC METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * The async type of cssRead().\r\n *\r\n * @see cssRead()\r\n *\r\n * @return Promise\r\n */\r\nconst cssReadAsync = function(el, props, psuedo = null) {\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(_isFunction(props) ? props(el) : cssRead(el, props, psuedo));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of cssWrite().\r\n *\r\n * @see cssWrite()\r\n *\r\n * @return Promise\r\n */\r\nconst cssWriteAsync = function(el, nameOrProps, val = null) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(cssWrite(el, nameOrProps, val));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n \r\n/**\r\n * The async type of css().\r\n *\r\n * @see css()\r\n *\r\n * @return Promise\r\n */\r\nconst cssAsync = function(el, ...args) {\r\n\tif ((args.length > 1 && _isString(args[0])) || _isObject(args[0])) {\r\n\t\treturn cssWriteAsync(el, ...args);\r\n\t}\r\n\treturn cssReadAsync(el, ...args);\r\n};\r\n\r\n/**\r\n * Applies some CSS within a transaction, gets computed values for use before rolling back.\r\n * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n *\r\n * @param HTMLElement\t\tel \r\n * @param string|object\t\tnameOrProps\r\n * @param string|number\t\tval\r\n * @param function\t\t\treadCallback\r\n *\r\n * @return Promise\r\n */\r\nconst cssComputeAsync = function(el, nameOrProps, val = null, readCallback = null) {\r\n\tvar propsToRead = _isObject(nameOrProps) ? Object.keys(nameOrProps) : nameOrProps;\r\n\treadCallback = _isObject(nameOrProps) ? val : readCallback;\r\n\t// -------------\r\n\tvar inlineSavepoint = cssReadInline(el, propsToRead);\r\n\treturn cssWriteAsync(el, nameOrProps, val).then(() => {\r\n\t\treturn cssReadAsync(el, readCallback || propsToRead).then(computedValues => {\r\n\t\t\t// We return the computedValues in a promise\r\n\t\t\treturn cssWriteAsync(el, inlineSavepoint).then(() => {\r\n\t\t\t\treturn computedValues;\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n};\r\n\r\n/**\r\n * Establishes a CSS operatiom that can be rolledback without altering similar operation by other code.\r\n * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n *\r\n * @param HTMLElement\t\t\tel \r\n * @param string|array\t\t\tprops\r\n *\r\n * @return Transaction\r\n */\r\nconst cssTransaction = function(el, props) {\r\n\treturn new Transaction(el, props, (el, props) => {\r\n\t\treturn cssReadInline(el, props);\r\n\t}, (el, data) => {\r\n\t\treturn cssWriteAsync(el, data);\r\n\t});\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Stylesheet functions.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Returns inline-only CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tprop\r\n * @param bool|string\t\twithVendorVersions\r\n *\r\n * @return mixed\r\n */\r\nconst cssReadInline = function(el, props, withVendorVersion = 'auto') {\r\n\tvar style = el.getAttribute('style');\r\n\tif (props === 'all') {\r\n\t\tprops = style.split(';').map(str => str.split(':')[0]);\r\n\t}\r\n\treturn ruleCallback(props, prop => {\r\n\t\tvar regex = new RegExp(';[ ]*?' + prop + ':([^;]+);?', 'g');\r\n\t\treturn (regex.exec(';' + style) || ['', ''])[1].trim();\r\n\t}, withVendorVersion);\r\n};\r\n\r\n/**\r\n * Returns inline-only CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tprop\r\n * @param bool\t\t\t\tnoCache\r\n * @param bool\t\t\t\twithVendorVersions\r\n *\r\n * @return jQuery|object|string\r\n */\r\nconst cssReadStylesheet = function(el, props, noCache, withVendorVersion = 'auto') {\r\n\t// Ask cache first...\r\n\tvar cacheKey = _isArray(props) ? props.join('|') : props;\r\n\tif (!noCache && stylesheetCache[cacheKey] && stylesheetCache[cacheKey].el === el) {\r\n\t\treturn stylesheetCache[cacheKey]._remove(el);\r\n\t}\r\n\t// Find rules\r\n\tvar allRules = [];\r\n\tstylesheetRuleCallback(ruleDefinition => {\r\n\t\tif (ruleDefinition.type === window.CSSRule.STYLE_RULE && el.matches(ruleDefinition.selectorText)) {\r\n\t\t\tvar propsList = props;\r\n\t\t\tif (!props/*original*/) {\r\n\t\t\t\tpropsList = [];\r\n\t\t\t\tfor (var i = 0; i < ruleDefinition.style.length; i ++) {\r\n\t\t\t\t\tpropsList.push(ruleDefinition.style[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tallRules.push(ruleCallback(propsList, prop => {\r\n\t\t\t\treturn ruleDefinition.style[prop];\r\n\t\t\t}, withVendorVersion));\r\n\t\t}\r\n\t});\r\n\t// Handle priority\r\n\tallRules.forEach(rules => {});\r\n\t// Save\r\n\tif (!stylesheetCache) {\r\n\t\tstylesheetCache = {};\r\n\t}\r\n\tstylesheetCache[cacheKey] = allRules.slice();\r\n\tstylesheetCache[cacheKey].el = el;\r\n\treturn allRules;\r\n};\r\n\t\t\r\n/**\r\n * FInds the keyframes of the given animation name(s) across all stylesheets.\r\n *\r\n * @param string|array\t\tname\r\n * @param bool\t\t\t\tnoCache\r\n * @param bool\t\t\t\tnormalize\r\n *\r\n * @return NULL|bool\r\n */\r\nconst cssReadKeyframes = function(name, noCache, normalize = true) {\r\n\t// Ask cache first...\r\n\tvar cacheKey = _isArray(name) ? name.join('|') : name;\r\n\tif (!noCache && stylesheetKeyframesCache[cacheKey]) {\r\n\t\treturn stylesheetKeyframesCache[cacheKey];\r\n\t}\r\n\t// Parse keyframes rule\r\n\tvar parseKeyframes = function(ruleDefinition) {\r\n\t\tvar keyframes = [];\r\n\t\tfor (var i = 0; i < ruleDefinition.cssRules.length; i ++) {\r\n\t\t\tvar keyframeRule = ruleDefinition.cssRules[i];\r\n\t\t\tvar keyframe = parseRules(keyframeRule.cssText\r\n\t\t\t\t.replace(keyframeRule.keyText, '').replace('{', '').replace('}', '').trim()\r\n\t\t\t);\r\n\t\t\tvar offsets = (keyframeRule.keyText || ' ').split(',').map(key => key === 'from' ? 0 : (key === 'to' ? 1 : (parseInt(key) / 100)));\r\n\t\t\tif (normalize) {\r\n\t\t\t\tnormalizeToWAAPI(keyframe, ['animation-', 'transition-']);\r\n\t\t\t\twhile(offsets.length) {\r\n\t\t\t\t\tvar _keyframe = _copyPlain(keyframe);\r\n\t\t\t\t\t_keyframe.offset = offsets.shift();\r\n\t\t\t\t\tkeyframes.push(_keyframe);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tkeyframe.offset = offsets.length > 1 ? offsets : offsets[0];\r\n\t\t\t\tkeyframes.push(keyframe);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn keyframes.sort((a, b) => a.offset === b.offset ? 0 : a.offset > b.offset ? 1 : -1);\r\n\t};\r\n\t// Find keyframes\r\n\tvar allKeyframes = [];\r\n\tstylesheetRuleCallback(ruleDefinition => {\r\n\t\tif ((ruleDefinition.type === window.CSSRule.KEYFRAMES_RULE || ruleDefinition.type === window.CSSRule[vendorPrefix.api.toUpperCase() + '_KEYFRAMES_RULE'])\r\n\t\t&& (_isArray(name) ? name : [name]).indexOf(ruleDefinition.name) > -1) {\r\n\t\t\tallKeyframes = allKeyframes.concat(allKeyframes, parseKeyframes(ruleDefinition));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}, true/*reversed*/);\r\n\t// Save\r\n\tstylesheetKeyframesCache[cacheKey] = allKeyframes;\r\n\treturn allKeyframes;\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Other utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Tells if the element's width is defined as auto.\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return bool\r\n */\r\nconst isAutoWidth = function(el) {\r\n};\r\n\r\n/**\r\n * Tells if the element's height is defined as auto.\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return bool\r\n */\r\nconst isAutoHeight = function(el) {\r\n};\r\n\r\n/**\r\n * Parses/decodes the element's transform rule\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return object\r\n */\r\nconst transformRule = function(el) {\r\n};\r\n\t\t\r\n/**\r\n * Returns preset easing functions from CSS variables.\r\n *\r\n * @param string \tname\r\n *\r\n * @return string|NULL\r\n */\r\nconst cssVarRead = function(name) {\r\n\t var name = !name.indexOf('-') ? _fromCamel(name, '-') : name;\r\n\treturn window.getComputedStyle(document.body).getPropertyValue('--' + name);\r\n};\r\n\r\n// -----------------------------------------\r\n// -----------------------------------------\r\n\r\n/**\r\n * Normalizes CSS animation properties to WAAPI compatible properties\r\n *\r\n * @param object\t\t\tanimationProps\r\n * @param string|arrau\t\tprefix\r\n * @param string|arrau\t\toffset\r\n *\r\n * @return null\r\n */\r\nconst normalizeToWAAPI = function(animationProps, offset, prefix = '') {\r\n\tif (_isArray(prefix)) {\r\n\t\tprefix.forEach(pref => {normalizeToWAAPI(animationProps, pref)});\r\n\t\treturn;\r\n\t}\r\n\tif (animationProps[prefix + 'timing-function']) {\r\n\t\tanimationProps.easing = animationProps[prefix + 'timing-function'];\r\n\t\tdelete animationProps[prefix + 'timing-function'];\r\n\t}\r\n\tif (animationProps[prefix + 'fill-mode']) {\r\n\t\tanimationProps.fill = animationProps[prefix + 'fill-mode'];\r\n\t\tdelete animationProps[prefix + 'fill-mode'];\r\n\t}\r\n\tif (animationProps[prefix + 'iteration-count']) {\r\n\t\tanimationProps.iterations = animationProps[prefix + 'iteration-count'];\r\n\t\tdelete animationProps[prefix + 'iteration-count'];\r\n\t\tif (animationProps.iterations === 'infinite') {\r\n\t\t\tanimationProps.iterations = Infinity;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Loops thru all keys in props calls callback to obtain their value.\r\n *\r\n * @param string|array\t\tprops\r\n * @param function\t\t\tcallback\r\n * @param bool\t\t\t\twithVendorVersion\r\n *\r\n * @return NULL|bool\r\n */\r\nconst ruleCallback = function(props, callback, withVendorVersion) {\r\n\tvar valsList = {};\r\n\tvar propsList = _arrFrom(props);\r\n\tvar callCallback = (i, prop) => {\r\n\t\t// We use the key as given, but we obtain value with\r\n\t\t// We support camel cases, but return their normalized versions\r\n\t\tvar normalProp = _fromCamel(prop, '-').toLowerCase();\r\n\t\t// With vendor verison?\r\n\t\t// We set the vendor version first if support for this property\r\n\t\tif (withVendorVersion === 'auto') {\r\n\t\t\tvalsList[normalProp] = callback(vendorize(normalProp) || normalProp, propsList[i]);\r\n\t\t} else {\r\n\t\t\tif (withVendorVersion) {\r\n\t\t\t\tvar vendorizedProp = vendorize(normalProp);\r\n\t\t\t\tif (vendorizedProp) {\r\n\t\t\t\t\tvalsList[vendorizedProp] = callback(vendorizedProp, propsList[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalsList[normalProp] = callback(normalProp, propsList[i]);\r\n\t\t}\r\n\t};\r\n\t_each(propsList, (i, prop) => {\r\n\t\tcallCallback(i, prop);\r\n\t});\r\n\treturn _isArray(props) || withVendorVersion || props === 'size' || props === 'offsets' \r\n\t\t? valsList \r\n\t\t: valsList[props];\r\n};\r\n\r\n/**\r\n * Loops thru all rules in all stylesheets (in reverse order possible).\r\n *\r\n * @param function\t\t\tcallback\r\n * @param bool\t\t\t\treversed\r\n *\r\n * @return NULL|bool\r\n */\r\nconst stylesheetRuleCallback = function(callback, reversed) {\r\n\tvar stylesheets = document.styleSheets;\r\n\tvar stylesheetCallback = function(stylesheet) {\r\n\t\ttry {\r\n\t\t\tfor (var k = 0; k < stylesheet.cssRules.length; k ++) {\r\n\t\t\t\tvar ruleDefinition = stylesheet.cssRules[k];\r\n\t\t\t\tif (callback(ruleDefinition) === true) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {}\r\n\t}\r\n\tif (reversed) {\r\n\t\tfor (var i = stylesheets.length - 1; i >= 0; i --) {\r\n\t\t\tif (stylesheetCallback(stylesheets[i]) === true) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var i = 0; i < stylesheets.length; i ++) {\r\n\t\t\tif (stylesheetCallback(stylesheets[i]) === true) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Parses/decodes transform rule\r\n *\r\n * @param string str\r\n *\r\n * @return object\r\n */\r\nconst stylesheetTransformRuleParse = function(str) {\r\n\tvar transform = {};\r\n\tvar regex = /(\\w+)\\((.+?)\\)/g;\r\n\tvar match = null;\r\n\twhile(match = regex.exec(str)) {\r\n\t\ttransform[match[1]] = (match[2].indexOf(',') > -1 ? match[2].replace(' ', '').split(',') : match[2]);\r\n\t}\r\n\treturn transform;\r\n};\r\n\t\t\r\n/**\r\n * Helper method: parses a CSS string into an associative array.\r\n *\r\n * @param string\t \tcss\r\n *\r\n * @return object\r\n */\r\nconst parseRules = function(css) {\r\n\tvar split = {};\r\n\t_each(css.split(';'), (i, rule) => {\r\n\t\trule = rule.split(':');\r\n\t\tsplit[rule[0].trim()] = rule[1].trim();\r\n\t});\r\n\treturn split;\r\n};\r\n\r\n/**\r\n * Helper method: stringifies an associative array into a CSS string.\r\n *\r\n * @param object\t \tcss\r\n *\r\n * @return string\r\n */\r\nconst stringifyRules = function(css) {\r\n\tvar str = [];\r\n\t_each(css, (propName, value) => {\r\n\t\tstr.push(propName + ': ' + value);\r\n\t});\r\n\treturn str.join('; ');\r\n};\r\n\t\t\r\n/**\r\n * Gets an accurate width of the device scrollbar by running a test.\r\n * (Adapted from bootstrap.js)\r\n *\r\n * @return int\r\n */\r\nconst standardScrollbarWidth = function() {\r\n\tvar style = 'position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll';\r\n\tvar d = $('<div style=\"' + style + '\"></div>');\r\n\tdocument.body.appendChild(d);\r\n\t// Answer 2\r\n\tc = d[0].offsetWidth - d[0].clientWidth;\r\n\tdocument.body.removeChild(d);\r\n\treturn c;\r\n};\r\n\r\n/**\r\n * Returns the vendor-specific css property if supported. NULL if not.\r\n *\r\n * @param string \tprop\r\n *\r\n * @return string|NULL\r\n */\r\nconst vendorize = function(prop) {\r\n\tvar camelCasedProp = _toCamel(prop, true);\r\n\tif (vendorPrefix.api + camelCasedProp in document.body.style) {\r\n\t\treturn vendorPrefix.css + _fromCamel(prop, '-');\r\n\t}\r\n};\r\n\r\n/**\r\n * CSS properties that must have a default pixel unit.\r\n *\r\n * @var array\r\n */\r\nconst autopx = ['width', 'height', 'top', 'left', 'right', 'bottom',\r\n\t'padding', 'padding-top', 'padding-left', 'padding-right', 'padding-bottom',\r\n\t'margin', 'margin-top', 'margin-left', 'margin-right', 'margin-bottom',\r\n\t'border-width', 'border-top-width', 'border-left-width', 'border-right-width', 'border-bottom-width',\r\n\t'outline-width', 'outline-top-width', 'outline-left-width', 'outline-right-width', 'outline-bottom-width',\r\n];\r\n\t\r\n/**\r\n * @var object\r\n */\r\nconst stylesheetCache = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nconst stylesheetKeyframesCache = {};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tcssRead,\r\n\tcssWrite,\r\n\tcss,\r\n\tcssReadAsync,\r\n\tcssWriteAsync,\r\n\tcssAsync,\r\n\tcssReadInline,\r\n\tcssComputeAsync,\r\n\tcssTransaction,\r\n\tcssReadStylesheet,\r\n\tcssReadKeyframes,\r\n\tisAutoWidth,\r\n\tisAutoHeight,\r\n\ttransformRule,\r\n\tcssVarRead,\r\n\tstandardScrollbarWidth,\r\n\tvendorize,\r\n\tautopx,\r\n};\r\nexport default css;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Finds a value in an array/object and returns the key (or path when found deep).\r\n *\r\n * @param array}object \tobj\r\n * @param function\t\tcallback\r\n * @param bool\t\t\tdeep\r\n *\r\n * @return number|string|array\r\n */\r\nconst _find = function(obj, callback, deep = false) {\r\n\tvar keys = null;\r\n\tvar values = obj;\r\n\tif (!_isArray(obj)) {\r\n\t\tkeys = Object.keys(obj);\r\n\t\tvalues = Object.values(obj);\r\n\t}\r\n\tvar subKey = undefined;\r\n\tvar value = values.reduce((prev, curr) => {\r\n\t\tif (subKey === undefined) {\r\n\t\t\tif (callback(curr, prev)) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t\tif (deep && (_isTypeObject(curr) || _isFunction(curr)) && (subKey = _find(curr, callback, deep)) !== undefined) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn prev;\r\n\t}, undefined);\r\n\tif (value !== undefined) {\r\n\t\tvar key = keys ? keys[values.indexOf(value)] : values.indexOf(value);\r\n\t\treturn subKey !== undefined ? [key].concat(_arrFrom(subKey)) : key;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _find;","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Custom events\r\n * ---------------------------\r\n *\r\n * @var object\r\n */\t\t\t\t\r\nconst CustomEvents = {};\r\n\r\n/**\r\n * Multitap events\r\n */\r\nconst Multitap = {\r\n\t\r\n\t/**\r\n\t * Binds all multitap events.\r\n\t */\r\n\tsetup(fireCallback, el, hammertime, eventName) {\r\n\t\tvar allSetup = true;\r\n\t\tvar recognizers = Multitap.events.map((tapType, i) => {\r\n\t\t\tvar recognizer = hammertime.get(tapType);\r\n\t\t\tif (!recognizer) {\r\n\t\t\t\tallSetup = false;\r\n\t\t\t\trecognizer = new Hammer.Tap({\r\n\t\t\t\t\tevent: tapType,\r\n\t\t\t\t\ttaps: Multitap.events.length - i,\r\n\t\t\t\t});\r\n\t\t\t\thammertime.add(recognizer);\r\n\t\t\t}\r\n\t\t\treturn recognizer;\r\n\t\t});\r\n\t\tif (!allSetup) {\r\n\t\t\t// From left to right, recognizeWith all others ahead\r\n\t\t\tvar recgzr, recgzrs = recognizers.slice();\r\n\t\t\twhile((recgzr = recgzrs.shift()) && recgzrs.length) {\r\n\t\t\t\trecgzr.recognizeWith(recgzrs);\r\n\t\t\t}\r\n\t\t\t// From right to left, recognizeWith all others behind\r\n\t\t\tvar recgzr2, recgzrs2 = recognizers.slice();\r\n\t\t\twhile((recgzr2 = recgzrs2.pop()) && recgzrs2.length) {\r\n\t\t\t\trecgzr2.requireFailure(recgzrs2);\r\n\t\t\t}\r\n\t\t}\r\n\t\thammertime.on(eventName, e => fireCallback(e.type, {\r\n\t\t\tcontext:_objFrom(e.type, e)\r\n\t\t}));\r\n\t},\r\n\t\r\n\t/**\r\n\t * Unbinds all multitap events.\r\n\t */\r\n\tteardown(el, hammertime, eventName) {\r\n\t\thammertime.off(eventName);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Now additional taps is achieved by\r\n\t * simply prepending to this array.\r\n\t */\r\n\tevents: ['tripletap', 'doubletap', 'singletap'],\r\n};\r\n// Add all to CustomEvents\r\nMultitap.events.forEach(event => {\r\n\tCustomEvents[event] = Multitap;\r\n});\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tMultitap\r\n};\r\nexport default CustomEvents;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tdomData\r\n} from '../Dom.js';\r\nimport {\r\n\tEventController as _EventController,\r\n\tEvent\r\n} from '@onephrase/observable';\r\nimport _toTitle from '@onephrase/commons/str/toTitle.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _objFrom from '@onephrase/commons/obj/from.js';\r\nimport _find from '@onephrase/commons/obj/find.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport CustomEvents from './CustomEvents.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Router class\r\n * ---------------------------\r\n *\r\n * This class provides additional functionality over native events.\r\n * \r\n * The EventController.fire() method has support for a listener's \"return false\"\r\n * and the consolidated Promise of \"sync\" listeners.\r\n *\r\n * EventController.addListener() can also be used to observe other \"events\" that the native addEventListener() does not support:\r\n * customEvents, @ownMutationEvents, @attributeMutationEvents, #childTreeMutationEvents, :states, ~gestures.\r\n *\r\n * EventController.unobserve() goes with a decision to use EventController.observe().\r\n */\t\t\t\t\r\nconst EventController = class extends _EventController {\r\n\r\n\t/**\r\n\t * Constructs a new observable and returns a proxy wrapper.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.el = el;\r\n\t\tthis.$.params = params;\r\n\t\tthis.$.activeHooks = {};\r\n\t\tthis.$.hammertime = new Hammer.Manager(this.el);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up an event type when its first listener is added.\r\n\t *\r\n\t * @param string NAME \r\n\t * @param object params \r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_setup(NAME, params) {\r\n\t\t// We register an event only once.\r\n\t\tif (this.$.activeHooks[NAME]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (CustomEvents[NAME]) {\r\n\t\t\tif (_isString(CustomEvents[NAME])) {\r\n\t\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_objFrom(NAME, e)});\r\n\t\t\t\t// Setup: we'll observe CustomEvents[NAME] to process and push the CUSTOM event/state.\r\n\t\t\t\tthis.addListener(CustomEvents[NAME], this.$.activeHooks[NAME]);\r\n\t\t\t} else if (_isFunction(CustomEvents[NAME].setup)) {\r\n\t\t\t\tthis.$.activeHooks[NAME] = true;\r\n\t\t\t\t// Custom setup. We supply the this.observe, this.trigger methods incase they'll be needed.\r\n\t\t\t\tCustomEvents[NAME].setup((firedEvents, firedEventsDetails) => {\r\n\t\t\t\t\tif (!_isFunction(CustomEvents[NAME].validate) \r\n\t\t\t\t\t|| CustomEvents[NAME].validate(firedEvents, firedEventsDetails, NAME, params)) {\r\n\t\t\t\t\t\tthis.fire(firedEvents, firedEventsDetails)\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this.el, this.$.hammertime, NAME);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('The \"' + NAME + '\" event hook must have a \"setup\" function!');\r\n\t\t\t}\r\n\t\t} else if (recognizeGesture(NAME.split('+')[0])) {\r\n\t\t\t// Lets work as if if always a list\r\n\t\t\tvar recognizers = NAME.split('+').map(gestureName => {\r\n\t\t\t\tvar mainGestureName = recognizeGesture(gestureName);\r\n\t\t\t\tvar recognizer = this.$.hammertime.get(mainGestureName);\r\n\t\t\t\tif (!recognizer) {\r\n\t\t\t\t\trecognizer = new Hammer[_toTitle(mainGestureName)];\r\n\t\t\t\t\tthis.$.hammertime.add(recognizer);\r\n\t\t\t\t}\r\n\t\t\t\treturn recognizer;\r\n\t\t\t});\r\n\t\t\t// From right to left, recognizeWith all others ahead\r\n\t\t\trecognizers.forEach((recognizer, i) => {\r\n\t\t\t\trecognizer.recognizeWith(recognizers.slice(i + 1));\r\n\t\t\t});\r\n\t\t\t// Listen now...\r\n\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_objFrom(NAME, e)});\r\n\t\t\tthis.$.hammertime.on(NAME.split('+').join(' '), this.$.activeHooks[NAME]);\r\n\t\t} else {\r\n\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_objFrom(NAME, e)});\r\n\t\t\t// Setup: we'll observe a native event to process and push ours.\r\n\t\t\tthis.el.addEventListener(NAME, this.$.activeHooks[NAME]);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * Tears down an event type when its last listener is removed.\r\n\t *\r\n\t * @param string NAME \r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_teardown(NAME) {\r\n\t\t// We register an event only once.\r\n\t\tif (!this.$.activeHooks[NAME]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (CustomEvents[NAME]) {\r\n\t\t\tif (_isString(CustomEvents[NAME])) {\r\n\t\t\t\t// Level1 custom event\r\n\t\t\t\tthis.removeListener(CustomEvents[NAME], this.$.activeHooks[NAME]);\r\n\t\t\t} else if (_isFunction(CustomEvents[NAME].teardown)) {\r\n\t\t\t\t// Level2 custom event. We supply the this.unobserve method incase it'll be needed.\r\n\t\t\t\tCustomEvents[NAME].teardown(this.el, this.$.hammertime, NAME);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('The \"' + NAME + '\" event hook must have a \"teardown\" function!');\r\n\t\t\t}\r\n\t\t} else if (recognizeGesture(NAME.split('+')[0])) {\r\n\t\t\tthis.$.hammertime.off(NAME.split('+').join(' '), this.$.activeHooks[NAME]);\r\n\t\t} else {\r\n\t\t\t// Native event\r\n\t\t\tthis.el.removeEventListener(NAME, this.$.activeHooks[NAME]);\r\n\t\t}\r\n\t\tdelete this.$.activeHooks[NAME];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see super.observe()\r\n\t *\r\n\t * Captures the params being observed and sets up their hooks\r\n\t * when their first listener just gets added.\r\n\t */\r\n\taddListener(...args) {\r\n\t\tvar listener = super.addListener(...args);\r\n\t\t_arrFrom(listener.eventNames).forEach(NAME => {\r\n\t\t\tthis._setup(NAME, listener.params);\r\n\t\t});\r\n\t\tlistener.removeCallback = () => {\r\n\t\t\t_arrFrom(listener.eventNames).forEach(NAME => {\r\n\t\t\t\tthis._teardown(NAME);\r\n\t\t\t});\r\n\t\t};\r\n\t\treturn listener;\r\n\t}\r\n};\r\n\r\n/**\r\n * Gesture reference.\r\n */\r\nconst gestureIndex = {\r\n\tpress: \t['press', 'pressup',], \r\n\trotate:\t['rotate', 'rotatestart', 'rotatemove', 'rotateend', 'rotatecancel',],\r\n\tpinch: \t['pinch', 'pinchstart', 'pinchmove', 'pinchend', 'pinchcancel', 'pinchin', 'pinchout',], \r\n\tpan: \t['pan', 'panstart', 'panmove', 'panend', 'pancancel', 'panleft', 'panright', 'panup', 'pandown',],\r\n\tswipe: \t['swipe', 'swipeleft', 'swiperight', 'swipeup', 'swipedown',],\r\n\ttap: \t['tap',],\r\n};\r\n\r\n/**\r\n * Finds the recognizer for a gestureName.\r\n *\r\n * @param string\tgestureName\r\n *\r\n * @return string\r\n */\r\nconst recognizeGesture = function(gestureName) {\r\n\treturn _find(gestureIndex, list => list.includes(gestureName), false/*deep*/);\r\n};\r\n\r\n/**\r\n * Binds listeners to an element's event controller.\r\n *\r\n * @param DOMElement \t\t\tel\r\n * @param array\t\t \t\t\t...args\r\n *\r\n * @return object\r\n */\r\nconst addListener = function(el, ...args) {\r\n\tif (!domData(el, 'eventController')) {\r\n\t\tdomData(el, 'eventController', new EventController(el));\r\n\t}\r\n\treturn domData(el, 'eventController').addListener(...args);\r\n};\r\n\r\n/**\r\n * Unbinds listeners from an element's event controller.\r\n *\r\n * @param DOMElement \t\t\tel\r\n * @param array\t\t \t\t\t...args\r\n *\r\n * @return bool\r\n */\r\nconst removeListener = function(el, ...args) {\r\n\tif (domData(el, 'eventController')) {\r\n\t\treturn domData(el, 'eventController').removeListener(...args);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\taddListener,\r\n\tremoveListener,\r\n};\r\nexport default EventController;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tcssRead,\r\n\tcssWrite,\r\n\tcssComputeAsync,\r\n\tcssReadKeyframes,\r\n\tcssVarRead,\r\n\tautopx as cssAutopx\r\n} from '../Css/Css.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _exclude from '@onephrase/commons/arr/exclude.js';\r\nimport _pushUnique from '@onephrase/commons/arr/pushUnique.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumber from '@onephrase/commons/js/isNumber.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport TransformRule from '../Css/TransformRule.js';\r\nimport Reflow from '../Reflow.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\t\t\t\r\nconst Anim = class {\r\n\t\r\n\t/**\r\n\t * Creates an amiation from\r\n\t * any of keyframes, CSS keyframe name, or CSS object.\r\n\t *\r\n\t * @param DOMNode\t\t\t\tel\r\n\t * @param array|object|string\teffect\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el, effect, params = {}) {\r\n\t\t// Private properties\r\n\t\tthis.el = el;\r\n\t\tthis.$ = {\r\n\t\t\treadyCallbacks: [],\r\n\t\t\tfinishCallbacks: [],\r\n\t\t\tcancelCallbacks: [],\r\n\t\t\tparams: params,\r\n\t\t};\r\n\t\t// -----------------------------\r\n\t\t// Normalize params...\r\n\t\t// -----------------------------\r\n\t\tparams.fill = params.fill || 'both';\r\n\t\tif (!('duration' in params)) {\r\n\t\t\tparams.duration = 400;\r\n\t\t}\r\n\t\t// Convert certain easing strings to beizier curves\r\n\t\tif (params.easing && ['ease-in', 'ease-out', 'ease-in-out'].indexOf(params.easing) === -1 && params.easing.indexOf('(') === -1) {\r\n\t\t\t// Native easings, custom cubic-beziers, or Dramatic's cubic-beziers\r\n\t\t\tparams.easing = cssVarRead(params.easing) || params.easing;\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Normalize keyframes...\r\n\t\t// -----------------------------\r\n\t\tvar destructables = {\r\n\t\t\tinset: ['top', 'right', 'bottom', 'left'],\r\n\t\t\tmargin: ['top', 'right', 'bottom', 'left'],\r\n\t\t\tpadding: ['top', 'right', 'bottom', 'left'],\r\n\t\t};\r\n\t\tconst init = keyframes => {\r\n\t\t\tkeyframes = keyframes.slice();\r\n\t\t\t// Mine out end-state properties\r\n\t\t\tvar firstFrame = {};\r\n\t\t\tvar lastFrame = {};\r\n\t\t\t_each(keyframes, (i, keyframe) => {\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t// We can destucture things like \"inset\"(\"left\", \"top\", \"right\", \"bottom\"), etc\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t_each(destructables, (destructableProp, meaning) => {\r\n\t\t\t\t\tif (keyframe[destructableProp]) {\r\n\t\t\t\t\t\tif (_isObject(keyframe[destructableProp])) {\r\n\t\t\t\t\t\t\tkeyframe[destructableProp] = meaning.map(key => keyframe[destructableProp][key]).filter(val => !_isUndefined(val));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (_isArray(keyframe[destructableProp])) {\r\n\t\t\t\t\t\t\tkeyframe[destructableProp] = keyframe[destructableProp].join(' ');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t// We accept an object for the \"transform\" property\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\tif (keyframe.transform && _isObject(keyframe.transform) && !(keyframe.transform instanceof TransformRule)) {\r\n\t\t\t\t\tkeyframe.transform = (new TransformRule(keyframe.transform)).toString();\r\n\t\t\t\t}\r\n\t\t\t\t// Marshal out its properties\r\n\t\t\t\t_exclude(Object.keys(keyframe), 'offset', 'easing').forEach(prop => {\r\n\t\t\t\t\t// Auto-px\r\n\t\t\t\t\tif (cssAutopx.includes(prop) && _isNumeric(keyframe[prop])) {\r\n\t\t\t\t\t\tkeyframe[prop] += 'px';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Save last seen value of this property\r\n\t\t\t\t\t// across all keyframes...\r\n\t\t\t\t\tfirstFrame[prop] = typeof firstFrame[prop] === 'undefined' ? keyframe[prop] : firstFrame[prop];\r\n\t\t\t\t\tlastFrame[prop] = keyframe[prop];\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t// -----------------------------\r\n\t\t\t// The animation...\r\n\t\t\t// -----------------------------\r\n\t\t\ttry {\r\n\t\t\t\tvar anim = this.el.animate(keyframes, params);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tthis.$.error = e;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Reverse\r\n\t\t\tif (params.reverse) {\r\n\t\t\t\tanim.reverse();\r\n\t\t\t}\r\n\t\t\t// A little polifyll\r\n\t\t\tif (!anim.effect) {\r\n\t\t\t\tanim.effect = {};\r\n\t\t\t}\r\n\t\t\tif (!anim.effect.duration) {\r\n\t\t\t\tanim.effect.duration = params.duration;\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\t// \"onfinish\" and \"oncancel\" listener\r\n\t\t\t// -----------------------------\r\n\t\t\tanim.onfinish = () => {\r\n\t\t\t\t// As getter, as it were\r\n\t\t\t\tif (params.cancelForCss) {\r\n\t\t\t\t\tanim.cancel();\r\n\t\t\t\t\tif (params.fill === 'forwards' || params.fill === 'both') {\r\n\t\t\t\t\t\tcssWrite(this.el, lastFrame);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.finishCallbacks.forEach(callback => {\r\n\t\t\t\t\tcallback(this.el);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// oncancel listener\r\n\t\t\tanim.oncancel = () => {\r\n\t\t\t\t// As getter, as it were\r\n\t\t\t\tthis.$.cancelCallbacks.forEach(callback => {\r\n\t\t\t\t\tcallback(this.el);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// -------------------\r\n\t\t\tthis.$.anim = anim;\r\n\t\t\tthis.$.firstFrame = firstFrame;\r\n\t\t\tthis.$.lastFrame = lastFrame;\r\n\t\t\tif (this.$.readyCallbacks.length) {\r\n\t\t\t\tthis.$.readyCallbacks.forEach(callback => callback(anim, params, firstFrame, lastFrame));\r\n\t\t\t}\r\n\t\t\t// -------------------\r\n\t\t};\r\n\t\tif (_isFunction(effect)) {\r\n\t\t\teffect(el, init);\r\n\t\t} else {\r\n\t\t\tAnim.createCallback(el, effect, init, error => {\r\n\t\t\t\t// -------------------\r\n\t\t\t\tthis.$.error = error;\r\n\t\t\t\t// -------------------\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Animation-ready callback.\r\n\t *\r\n\t * @param function\t\tsucces\r\n\t * @param function\t\terror\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tready(succes, error) {\r\n\t\tif (this.$.error) {\r\n\t\t\tif (error) {\r\n\t\t\t\terror(this.$.error);\r\n\t\t\t}\r\n\t\t} else if (this.$.anim) {\r\n\t\t\tsucces(this.$.anim, this.$.params, this.$.firstFrame, this.$.lastFrame);\r\n\t\t} else {\r\n\t\t\tthis.$.readyCallbacks.push(succes);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a function to the \"onfinish\" event.\r\n\t *\r\n\t * @param function callback\r\n\t *\r\n\t * @return this\r\n\t *\r\n\t */\r\n\tonfinish(callback) {\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error(\"Onfinish() accepts only a function.\");\r\n\t\t}\r\n\t\tthis.$.finishCallbacks.push(callback);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a function to the \"oncancel\" event.\r\n\t *\r\n\t * @param function callback\r\n\t *\r\n\t * @return this\r\n\t *\r\n\t */\r\n\toncancel(callback) {\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error(\"Oncancel() accepts only a function.\");\r\n\t\t}\r\n\t\tthis.$.cancelCallbacks.push(callback);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Seeks the animation to a time.\r\n\t *\r\n\t * @param number to\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tseek(to) {\r\n\t\tif (!_isNumber(to)) {\r\n\t\t\tthrow new Error(\"Seek() accepts only a numeric value.\");\r\n\t\t}\r\n\t\tthis.ready((anim, effect) => {\r\n\t\t\tanim.currentTime = Math.min(to * effect.duration, effect.duration);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns the animation's progress.\r\n\t *\r\n\t * @return number\r\n\t */\r\n\tprogress() {\r\n\t\tif (this.$.anim) {\r\n\t\t\treturn this.$.anim.currentTime / this.$.anim.effect.duration;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Reverses the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\treverse() {\r\n\t\tthis.ready(anim => anim.reverse());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Plays the animation.\r\n\t * Returns an \"onfinish\" promise.\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tplay() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.ready(anim => {\r\n\t\t\t\tanim.play();\r\n\t\t\t\tthis.onfinish(() => resolve(this));\r\n\t\t\t\tthis.oncancel(() => reject(this));\r\n\t\t\t}, reject);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pauses the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tpause() {\r\n\t\tthis.ready(anim => anim.pause());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finishes the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tfinish() {\r\n\t\tthis.ready(anim => anim.finish());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cancels the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tcancel() {\r\n\t\tthis.ready(anim => anim.cancel());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves the given effect into valid keyframes.\r\n\t *\r\n\t * Effect can be CSS animation name,\r\n\t * or an object of CSS properties that represent the end keyframe.\r\n\t *\r\n\t * @param DOMNode\t\t\t\tel\r\n\t * @param array|object|string\teffect\r\n\t * @param function\t\t\t\tready\r\n\t * @param function\t\t\t\terror\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic createCallback(el, effect, ready, error) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve firstFrame from current state?\r\n\t\t// -----------------------------\r\n\t\tif (_isObject(effect)) {\r\n\t\t\t// Get first keyframe from current state\r\n\t\t\tReflow.onread(() => {\r\n\t\t\t\tAnim.createCallback(el, [cssRead(el, Object.keys(effect)), effect], ready, error);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Create keyframes from CSS animation name...\r\n\t\t// -----------------------------\r\n\t\tif (_isString(effect)) {\r\n\t\t\t// Retrieve keyframes of the given animation name from css\r\n\t\t\tvar animationName = effect;\r\n\t\t\teffect = cssReadKeyframes(el, animationName);\r\n\t\t\tif (!effect.length && error) {\r\n\t\t\t\terror('Animation name \"' + animationName + '\" not found in any stylesheet!');\r\n\t\t\t}\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Resolve auto pixels...\r\n\t\t// -----------------------------\r\n\t\tif (_isArray(effect)) {\r\n\t\t\tvar keyframesWithAutoSizes = [];\r\n\t\t\t_each(effect, (i, keyframe) => {\r\n\t\t\t\t// We can animate to auto width and height\r\n\t\t\t\tif (keyframe.height === 'auto') {\r\n\t\t\t\t\t_pushUnique(keyframesWithAutoSizes, i);\r\n\t\t\t\t}\r\n\t\t\t\tif (keyframe.width === 'auto') {\r\n\t\t\t\t\t_pushUnique(keyframesWithAutoSizes, i);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (keyframesWithAutoSizes.length) {\r\n\t\t\t\t// apply() will be called when ready\r\n\t\t\t\t// We return cssComputeAsync(), which in itself returns the return of apply()\r\n\t\t\t\tcssComputeAsync(el, {width:'auto', height:'auto'}, el => el.getBoundingClientRect()).then(result => {\r\n\t\t\t\t\tkeyframesWithAutoSizes.forEach(i => {\r\n\t\t\t\t\t\tif (effect[i].width === 'auto') {\r\n\t\t\t\t\t\t\teffect[i].width = result.width + 'px';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (effect[i].height === 'auto') {\r\n\t\t\t\t\t\t\teffect[i].height = result.height + 'px';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tready(effect);\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Return result...\r\n\t\t// -----------------------------\r\n\t\t// We return the return of success()\r\n\t\tready(effect);\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Anim;","\r\n/**\r\n * Tells if ANY items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest || callback(itm), false);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _any from '@onephrase/commons/arr/any.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _merge from '@onephrase/commons/obj/merge.js';\r\nimport _with from '@onephrase/commons/obj/with.js';\r\nimport {\r\n\tcssRead\r\n} from '../Css/Css.js';\r\nimport TransformRule from '../Css/TransformRule.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\t\t\t\r\n/**\r\n * Gets the element's width/height values or left/top offsets or both.\r\n *\r\n * A context can be specified from which to resolve left/top distances.\r\n * document origins are used by default.\r\n *\r\n * This function can calculate the rect of 3 different types of object:\r\n * - DOM element: offsets are calculated from el.getBoundingClientRect() and resolved relative to the specified offsetOrigin.\r\n *\t\twidth and height are calculated from el.getBoundingClientRect().\r\n * - Event object: offsets are calculated as the event's (client|offset|page) x/y, depending on the specified offsetOrigin.\r\n *\t\twidth and height are always 0, 0.\r\n * - Window object: offsets are calculated as the current left/top scroll, as determined by the value of offsetOrigin.\r\n *\t\twidth and height are always the window's inner width/height values.\r\n *\r\n * @param DOMElement|Event|window \tel\r\n * @param bool\t \t\t\t\t\tsize\r\n * @param DOMElement|window\t \t\toffsetOrigin\r\n *\r\n * @return object\r\n */\r\nconst rect = function(el, size = true, offsetOrigin = null) {\r\n\tvar rectProps = ['width', 'height', 'top', 'right', 'bottom', 'left'];\r\n\tvar eventProps = ['clientX', 'clientY', 'offsetX', 'offsetY', 'pageX', 'pageY', 'screenX', 'screenY'];\r\n\tvar _isElement = obj => obj instanceof HTMLElement || obj instanceof HTMLDocument;\r\n\tvar _rect = {};\r\n\tif (_isObject(el) && _any(eventProps, prop => prop in el)) {\r\n\t\t_rect = size !== false ? {width:0, height:0,} : {};\r\n\t\tif (offsetOrigin === window || _isElement(offsetOrigin)) {\r\n\t\t\t_rect.left = el.clientX;\r\n\t\t\t_rect.top = el.clientY;\r\n\t\t} else if (offsetOrigin === true) {\r\n\t\t\t_rect.left = el.offsetX;\r\n\t\t\t_rect.top = el.offsetY;\r\n\t\t} else if (offsetOrigin !== false) {\r\n\t\t\t_rect.left = el.pageX;\r\n\t\t\t_rect.top = el.pageY;\r\n\t\t}\r\n\t} else if (el === window) {\r\n\t\t_rect = size !== false ? {width:window.innerWidth, height:window.innerHeight,} : {};\r\n\t\tif (offsetOrigin === window || offsetOrigin === true || _isElement(offsetOrigin)) {\r\n\t\t\t_rect.left = 0;\r\n\t\t\t_rect.top = 0;\r\n\t\t} else if (offsetOrigin !== false) {\r\n\t\t\t_rect.left = window.pageXOffset || document.documentElement.scrollLeft;\r\n\t\t\t_rect.top = window.pageYOffset || document.documentElement.scrollTop;\r\n\t\t}\r\n\t} else if (_isElement(el)) {\r\n\t\t_rect = el.getBoundingClientRect().toJSON();\r\n\t\tdelete _rect.x;\r\n\t\tdelete _rect.y;\r\n\t\tdelete _rect.right;\r\n\t\tdelete _rect.bottom;\r\n\t\tif (size === false) {\r\n\t\t\tdelete _rect.width;\r\n\t\t\tdelete _rect.height;\r\n\t\t}\r\n\t\tif (offsetOrigin === true) {\r\n\t\t\toffsetOrigin = el.offsetParent;\r\n\t\t} else if (offsetOrigin === false) {\r\n\t\t\tdelete _rect.left;\r\n\t\t\tdelete _rect.top;\r\n\t\t} else if (offsetOrigin !== window && !_isElement(offsetOrigin)) {\r\n\t\t\t_rect.left += (window.pageXOffset || document.documentElement.scrollLeft);\r\n\t\t\t_rect.top += (window.pageYOffset || document.documentElement.scrollTop);\r\n\t\t}\r\n\t} else if (_isObject(el) && _any(rectProps, prop => prop in el)) {\r\n\t\t_rect = _copy(el, rectProps);\r\n\t} else {\r\n\t\tthrow new Error('Unknown object type!');\r\n\t}\r\n\tif (_isElement(offsetOrigin)) {\r\n\t\tvar contextOffset = rect(offsetOrigin, false, window);\r\n\t\t_rect.left -= contextOffset.left;\r\n\t\t_rect.top -= contextOffset.top;\r\n\t}\r\n\treturn _rect;\r\n};\r\n\r\n/**\r\n * Returns an object containing the element's width or height or both.\r\n *\r\n * @param DOMElement\t\tel \r\n * @param object\t\t\taxis \r\n *\r\n * @return object\r\n */\r\nconst size = function(el, axis) {\r\n\tvar _size = rect(el, true, false);\r\n\tvar axes = axis ? _arrFrom(axis) : ['x', 'y'];\r\n\tif (!axes.includes('x')) {\r\n\t\tdelete _size.width;\r\n\t}\r\n\tif (!axes.includes('y')) {\r\n\t\tdelete _size.height;\r\n\t}\r\n\treturn _size;\r\n};\r\n\r\n/**\r\n * Returns an object containing the element's left/top.\r\n *\r\n * @param DOMElement\t\tel \r\n * @param object\t\t\taxis \r\n * @param string|bool\t\toffsetOrigin \r\n *\r\n * @return object\r\n */\r\nconst offsets = function(el, axis, origin = null) {\r\n\tvar _offsets = rect(el, false, origin);\r\n\tvar axes = axis ? _arrFrom(axis) : ['x', 'y'];\r\n\tif (!axes.includes('x')) {\r\n\t\tdelete _offsets.left;\r\n\t}\r\n\tif (!axes.includes('y')) {\r\n\t\tdelete _offsets.top;\r\n\t}\r\n\treturn _offsets;\r\n};\r\n\r\n/**\r\n * Simulates, does not actually effect, a DOMElement to a some CSS position and\r\n * uses rect() to calculate its rects at that virtual position.\r\n *\r\n * @param DOMElement\t\t\t\tel \r\n * @param object \t\t\t\t\toffsets\r\n *\r\n * @return object\r\n */\r\nconst rectAtOffsets = function(el, offsets) {\r\n\tvar _rect = rect(el);\r\n\tvar positionType = cssRead(el, 'position');\r\n\tif (positionType !== 'static') {\r\n\t\tif (positionType === 'absolute') {\r\n\t\t\tvar offsetParentRect = rect(el.offsetParent);\r\n\t\t\t_rect.top = offsetParentRect.top;\r\n\t\t\t_rect.left = offsetParentRect.left;\r\n\t\t} else if (positionType === 'fixed') {\r\n\t\t\tvar offsetParentRect = rect(window);\r\n\t\t\t_rect.top = 0;\r\n\t\t\t_rect.left = 0;\r\n\t\t}\r\n\t\t_rect.top = _isNumeric(offsets.top) ? _rect.top + parseFloat(offsets.top) \r\n\t\t\t: (_isNumeric(offsets.bottom) ? (offsetParentRect \r\n\t\t\t\t? (offsetParentRect.top + offsetParentRect.height) - (_rect.height + offsets.bottom)\r\n\t\t\t\t: _rect.top - offsets.bottom\r\n\t\t\t) : 0);\r\n\t\t_rect.left = _isNumeric(offsets.left) ? _rect.left + parseFloat(offsets.left) \r\n\t\t\t: (_isNumeric(offsets.right) ? (offsetParentRect \r\n\t\t\t\t? (offsetParentRect.left + offsetParentRect.width) - (_rect.width + offsets.right)\r\n\t\t\t\t: _rect.left - offsets.right\r\n\t\t\t) : 0);\r\n\t}\r\n\treturn _rect;\r\n};\r\n\r\n/**\r\n * Calculates the length on an axis of an intersection.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param object\t\t \t\t\t_rect\r\n * @param object\t\t \t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst coordsAtRect = function(el, _rect, options = {}) {\r\n\tvar _intersection = intersection(rect(options.using || el), _rect);\r\n\tvar length = {x:'width', y:'height'};\r\n\tvar start = {x:'left', y:'top'};\r\n\tvar end = {x:'right', y:'bottom'};\r\n\tvar coords = {};\r\n\tvar _alignment = {};\r\n\t['x', 'y'].forEach(axis => {\r\n\t\tif (options[axis] === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rect1Length = _intersection.rect1[length[axis]/*height*/];\r\n\t\t// Distinguish and predicate\r\n\t\t_alignment[axis] = parsePlacement(options[axis] || '');\r\n\t\tswitch(_alignment[axis].keyword) {\r\n\t\t\tcase 'before':\r\n\t\t\t\t// Pull beyond start\r\n\t\t\t\tcoords[axis] = - (_intersection[start[axis]/*top*/] + rect1Length);\r\n\t\t\tbreak;\r\n\t\t\tcase 'after':\r\n\t\t\t\t// Push beyond end\r\n\t\t\t\tcoords[axis] = _intersection[end[axis]/*bottom*/] + rect1Length;\r\n\t\t\tbreak;\r\n\t\t\tcase 'start':\r\n\t\t\t\t// Pull to start\r\n\t\t\t\tcoords[axis] = - _intersection[start[axis]/*top*/];\r\n\t\t\tbreak;\r\n\t\t\tcase 'end':\r\n\t\t\t\t// Push to end\r\n\t\t\t\tcoords[axis] = _intersection[end[axis]/*bottom*/];\r\n\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\t// Align to center\r\n\t\t\t\tcoords[axis] = _intersection.delta[axis];\r\n\t\t}\r\n\t\t// Apply predicates\r\n\t\tif (_alignment[axis].predicates) {\r\n\t\t\tcoords[axis] += evalPredicates(_alignment[axis].predicates, rect1Length);\r\n\t\t}\r\n\t});\r\n\tcoords.alignment = _alignment;\r\n\tcoords.intersection = _intersection;\r\n\treturn coords;\r\n};\r\n\r\n/**\r\n * Manipulates an element's translate.translate to place it with another element.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst translateTo = function(el, el2, options = {}) {\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar _coordsFormatted = {\r\n\t\tfrom: new TransformRule({translate: [],}),\r\n\t\tto: new TransformRule({translate: [],}),\r\n\t\tcurrent: {\r\n\t\t\tfrom: new TransformRule({translate: [],}),\r\n\t\t\tto: new TransformRule({translate: [],}),\r\n\t\t\tprogress: {},\r\n\t\t},\r\n\t};\r\n\t// -----------\r\n\tvar activeTransform = cssRead(el, 'transform');\r\n\t['x', 'y'].forEach((axis, i) => {\r\n\t\tif (axis in _coords) {\r\n\t\t\t_coordsFormatted.from.translate[i] = 0;\r\n\t\t\t_coordsFormatted.to.translate[i] = _coords[axis] + activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.current.to.translate[i] = _coords[axis];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = Math.abs(activeTransform.translate[i] / (_coords[axis] + activeTransform.translate[i]));\r\n\t\t} else {\r\n\t\t\t_coordsFormatted.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.to.translate[i] = activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.current.to.translate[i] = activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = 0;\r\n\t\t}\r\n\t});\r\n\treturn _coordsFormatted;\r\n};\r\n\r\n/**\r\n * Calculates an element's offset where it to be at the given rect.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst offsetTo = function(el, el2, options = {}) {\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar start = {x:'left', y:'top'};\r\n\tvar end = {x:'right', y:'bottom'};\r\n\tvar _offsets = _intersect(['x', 'y'], Object.keys(_coords)).reduce((obj, axis) => {\r\n\t\tswitch(_coords.alignment[axis].keyword) {\r\n\t\t\tcase 'before':\r\n\t\t\t\treturn options.alternateAnchors ? _with(obj, start[axis], _coords[axis]) : _with(obj, end[axis], - _coords[axis]);\r\n\t\t\tcase 'after':\r\n\t\t\t\treturn options.alternateAnchors ? _with(obj, end[axis], - _coords[axis]) : _with(obj, start[axis], _coords[axis]);\r\n\t\t\tcase 'end':\r\n\t\t\t\treturn _with(obj, end[axis], - _coords[axis]);\r\n\t\t\tdefault: // center,start\r\n\t\t\t\treturn _with(obj, start[axis], _coords[axis]);\r\n\t\t}\r\n\t}, {});\r\n\t// -----------\r\n\tvar _offsetsFormatted = {from: {}, to: {}, current: {\r\n\t\t\tfrom: {}, to: {}, progress: {},\r\n\t\t},\r\n\t};\r\n\t// -----------\r\n\tvar currentOffsets = positioningOffsets(el, Object.keys(_offsets));\r\n\t['left', 'right', 'top', 'bottom'].forEach(name => {\r\n\t\tif (name in _offsets) {\r\n\t\t\t_offsetsFormatted.from[name] = 0;\r\n\t\t\t_offsetsFormatted.to[name] = _offsets[name] + currentOffsets[name];\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.from[name] = currentOffsets[name];\r\n\t\t\t_offsetsFormatted.current.to[name] = _offsets[name];\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.progress[name] = Math.abs(currentOffsets[name] / (_offsets[name] + currentOffsets[name]));\r\n\t\t} else {\r\n\t\t\t_offsetsFormatted.from[name] = 'auto';\r\n\t\t\t_offsetsFormatted.to[name] = 'auto';\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.from[name] = 'auto';\r\n\t\t\t_offsetsFormatted.current.to[name] = 'auto';\r\n\t\t}\r\n\t});\r\n\treturn _offsetsFormatted;\r\n};\r\n\r\n/**\r\n * Scrolls an element to the position of another element\r\n * within its scrollable parent.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst scrollTo = function(el, el2, options = {}) {\r\n\tvar viewport = options.scrollAnchor || scrollParent(el);\r\n\tviewport = viewport === document.body ? window : viewport;\r\n\tif (!scrolls(viewport)) {\r\n\t\treturn;\r\n\t}\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar _offsetsFormatted = {from: {}, to: {}, current: {\r\n\t\t\tfrom: {}, to: {}, progress: {},\r\n\t\t},\r\n\t\tviewport: viewport,\r\n\t};\r\n\t// -----------\r\n\tvar currentScroll = {\r\n\t\tscrollLeft: viewport[viewport === window ? 'pageXOffset' : 'scrollLeft'],\r\n\t\tscrollTop: viewport[viewport === window ? 'pageYOffset' : 'scrollTop'],\r\n\t};\r\n\t['x', 'y'].forEach((axis, i) => {\r\n\t\tvar axisProp = axis === 'x' ? 'scrollLeft' : 'scrollTop';\r\n\t\tif (axis in _coords) {\r\n\t\t\t_coordsFormatted.from[axisProp] = 0;\r\n\t\t\t_coordsFormatted.to[axisProp] = _coords[axis] + currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.current.to[axisProp] = _coords[axis];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = Math.abs(currentScroll[axisProp] / (_coords[axis] + currentScroll[axisProp]));\r\n\t\t} else {\r\n\t\t\t_coordsFormatted.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.to[axisProp] = currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.current.to[axisProp] = currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = 0;\r\n\t\t}\r\n\t});\r\n\treturn _coordsFormatted;\r\n};\r\n\r\n/**\r\n * Observes when any of the given elements\r\n * changes in size.\r\n *\r\n * @param [HTMLElement]\t\t\t \tels\r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return ResizeObserver\r\n */\r\nconst resizeCallback = function(els, callback) {\r\n\tvar sizings = Object.keys(els);\r\n\tvar ro = new ResizeObserver(entries => {\r\n\t\tfor (let entry of entries) {\r\n\t\t\tsizings[els.indexOf(entry.target)] = {\r\n\t\t\t\twidth: entry.contentRect.left + entry.contentRect.right, \r\n\t\t\t\theight: entry.contentRect.top + entry.contentRect.bottom,\r\n\t\t\t};\r\n\t\t}\r\n\t\tsizings = sizings.map((sizing, i) => !_isObject(sizing) ? _copyPlain(rect(els[i]), ['width', 'height',]) : sizing);\r\n\t\tcallback.call(...sizings);\r\n\t});\r\n\tels.forEach(el => {\r\n\t\tro.observe(el);\r\n\t});\r\n\treturn ro;\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * A set of utilities for processing rects.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Computes the percentage proximity between two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n * @param string|array\taxis\r\n * @param object\t\tpreviousProximity\r\n *\r\n * @return object\r\n */\r\nconst proximity = function(rect1, rect2, axis, previousProximity) {\r\n\tvar _proximity = {intersection: intersection(rect1, rect2)};\t\t\t\t\r\n\t_proximity.x = _proximity.x || {};\r\n\t_proximity.y = _proximity.y || {};\r\n\tpreviousProximity = _copy(previousProximity);\r\n\t// X,Y processing...\r\n\t(axis ? _arrFrom(axis) : ['x', 'y']).forEach(axis => {\r\n\t\t// In the context of the given axis...\r\n\t\tvar distanceBefore = axis === 'x' ? 'left' : 'top';\r\n\t\tvar distanceAfter = axis === 'x' ? 'right' : 'bottom';\r\n\t\tvar rect1Length = rect1[axis === 'x' ? 'width' : 'height'];\r\n\t\tvar rect2Length = rect2[axis === 'x' ? 'width' : 'height'];\r\n\t\t// ----- In which direction are we moving\r\n\t\t_proximity[axis].moving = 'positive';\r\n\t\tif (previousProximity.intersection) {\r\n\t\t\t_proximity[axis].moving = previousProximity.intersection[distanceBefore] > _proximity.intersection[distanceBefore] \r\n\t\t\t\t? 'negative' : (previousProximity.intersection[distanceBefore] < _proximity.intersection[distanceBefore] \r\n\t\t\t\t\t? 'positive' : previousProximity[axis].moving);\r\n\t\t}\r\n\t\t// ----- Cross-in percentage\r\n\t\tvar percentageIn = 0;\r\n\t\t// Element topline touches or passes Anchor bottom line\r\n\t\tif (_proximity.intersection[distanceBefore] <= rect2Length\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor bottom line\r\n\t\t&& _proximity.intersection[distanceAfter] <= 0) {\r\n\t\t\tpercentageIn = (rect1Length - Math.abs(_proximity.intersection[distanceAfter])) / rect1Length;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > 0) {\r\n\t\t\tpercentageIn = 1;\r\n\t\t}\r\n\t\t// ----- Cross-out percentage\r\n\t\tvar percentageOut = 0;\r\n\t\t// Element topline touches or passes Anchor top line\r\n\t\tif (_proximity.intersection[distanceBefore] <= 0\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor top line\r\n\t\t&& _proximity.intersection[distanceAfter] <= rect2Length) {\r\n\t\t\tpercentageOut = Math.abs(_proximity.intersection[distanceBefore]) / rect1Length;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > rect2Length) {\r\n\t\t\tpercentageOut = 1;\r\n\t\t}\r\n\t\t// ----- Cross-pass percentage\r\n\t\tvar percentagePass = 0;\r\n\t\t// Element topline touches or passes Anchor bottom line\r\n\t\tif (_proximity.intersection[distanceBefore] <= rect2Length\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor top line\r\n\t\t&& _proximity.intersection[distanceAfter] <= rect2Length) {\r\n\t\t\tvar totalDistance = rect2Length + rect1Length;\r\n\t\t\tvar currentPass = proximity.intersection[distanceBefore] + rect1Length;\r\n\t\t\tpercentagePass = (totalDistance - currentPass) / totalDistance;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > rect2Length) {\r\n\t\t\tpercentagePass = 1;\r\n\t\t}\r\n\t\t// ----- Cross-overflow percentage\r\n\t\tvar percentageContained = 0;\r\n\t\tif (rect1Length > rect2Length) {\r\n\t\t\t// Element is larger than, and covering Anchor top/bottom lines\r\n\t\t\tif (_proximity.intersection[distanceBefore] <= 0\r\n\t\t\t&& _proximity.intersection[distanceAfter] <= 0) {\r\n\t\t\t\tvar lengthDifference = rect1Length - rect2Length;\r\n\t\t\t\tpercentageContained = Math.abs(_proximity.intersection[distanceBefore]) / lengthDifference;\r\n\t\t\t} else if (_proximity.intersection[distanceAfter] > 0) {\r\n\t\t\t\tpercentageContained = 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Element is smaller than, and within Anchor top/bottom lines\r\n\t\t\tif (_proximity.intersection[distanceBefore] >= 0\r\n\t\t\t&& _proximity.intersection[distanceAfter] >= 0) {\r\n\t\t\t\tvar lengthDifference = rect2Length - rect1Length;\r\n\t\t\t\tpercentageContained = _proximity.intersection[distanceAfter] / lengthDifference;\r\n\t\t\t} else if (_proximity.intersection[distanceBefore] < 0) {\r\n\t\t\t\tpercentageContained = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ------ Bind the values to the instance object\r\n\t\tif (_proximity[axis].moving === 'negative') {\r\n\t\t\t_proximity[axis].percentageIn = percentageIn;\r\n\t\t\t_proximity[axis].percentageOut = percentageOut;\r\n\t\t\t_proximity[axis].percentagePass = percentagePass;\r\n\t\t\t_proximity[axis].percentageContained = percentageContained;\r\n\t\t} else {\r\n\t\t\t_proximity[axis].percentageIn = 1 - percentageOut;\r\n\t\t\t_proximity[axis].percentageOut = 1 - percentageIn;\r\n\t\t\t_proximity[axis].percentagePass = 1 - percentagePass;\r\n\t\t\t_proximity[axis].percentageContained = 1 - percentageContained;\r\n\t\t}\r\n\t\tif (rect1Length > rect2Length) {\r\n\t\t\t_proximity[axis].percentageContained *= -1;\r\n\t\t}\r\n\t});\r\n\treturn _proximity;\r\n};\r\n\r\n/**\r\n * Returns coordinates of the intersection between two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n *\r\n * @return object\r\n */\r\nconst intersection = function(rect1, rect2) {\r\n\tvar _intersection = {\r\n\t\tleft: rect1.left - rect2.left,\r\n\t\ttop: rect1.top - rect2.top,\r\n\t\tright: (rect2.left + rect2.width) - (rect1.left + rect1.width),\r\n\t\tbottom: (rect2.top + rect2.height) - (rect1.top + rect1.height),\r\n\t};\r\n\t// More offsets\r\n\tvar leftline = Math.max(rect1.left, rect2.left);\r\n\tvar rightline = Math.min(rect1.left + rect1.width, rect2.left + rect2.width);\r\n\tvar topline = Math.max(rect1.top, rect2.top);\r\n\tvar bottomline = Math.min(rect1.top + rect1.height, rect2.top + rect2.height);\r\n\t_intersection.width = rightline > leftline ? rightline - leftline : 0;\r\n\t_intersection.height = bottomline > topline ? bottomline - topline : 0;\r\n\t// The raw values\r\n\t_intersection.rect1 = rect1;\r\n\t_intersection.rect2 = rect2;\r\n\t_intersection.delta = delta(rect1, rect2);\r\n\treturn _intersection;\r\n};\r\n\r\n/**\r\n * Returns coordinates of two rects as one.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n *\r\n * @return object\r\n */\r\nconst union = function(rect1, rect2) {\r\n\tvar _union = {\r\n\t\tleft: Math.min(rect1.left, rect2.left),\r\n\t\ttop: Math.min(rect1.top, rect2.top),\r\n\t\tright: Math.max((rect1.left + rect1.width), (rect2.left + rect2.width)),\r\n\t\tbottom: Math.max((rect1.top + rect1.height), (rect2.top + rect2.height)),\r\n\t};\r\n\t// More offsets\r\n\t_union.width = _union.right - _union.left;\r\n\t_union.height = _union.bottom - _union.top;\r\n\t// The raw values\r\n\t_union.rect1 = rect1;\r\n\t_union.rect2 = rect2;\r\n\t_union.delta = delta(rect1, rect2);\r\n\treturn _union;\r\n};\r\n\r\n/**\r\n * Returns distances in x, y, and z between the centers of two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n * @param bool\t\t\twithAngle\r\n *\r\n * @return object\r\n */\r\nconst delta = function(rect1, rect2, withAngle = false) {\r\n\tvar _delta = {};\r\n\t_delta.x = (rect2.left + (rect2.width / 2)) - (rect1.left + (rect1.width / 2));\r\n\t_delta.y = (rect2.top + (rect2.height / 2)) - (rect1.top + (rect1.height / 2));\r\n\t_delta.z = Math.sqrt(Math.pow(_delta.x, 2) + Math.pow(_delta.y, 2));\r\n\tif (withAngle) {\r\n\t\t_delta = _merge(_delta, deltaAngle(_delta));\r\n\t}\r\n\treturn _delta;\r\n};\r\n\r\n/**\r\n * Returns distances in x, y, and z between the centers of two rects.\r\n *\r\n * @param object\t\tdelta\r\n *\r\n * @return object\r\n */\r\nconst deltaAngle = function(delta) {\r\n\tif (_isNumeric(delta.y) && _isNumeric(delta.x)) {\r\n\t\tvar angleOfElevation = Math.atan(delta.y/delta.x);\r\n\t} else if (_isNumeric(delta.x) && _isNumeric(delta.z)) {\r\n\t\tvar angleOfElevation = Math.acos(delta.x/delta.z);\r\n\t} else if (_isNumeric(delta.y) && _isNumeric(delta.z)) {\r\n\t\tvar angleOfElevation = Math.asin(delta.y/delta.z);\r\n\t}\r\n\tvar angleOfDepression = 180 - 90 - angleOfElevation;\r\n\treturn {\r\n\t\tangle:angleOfElevation, \r\n\t\tangle2:angleOfDepression, \r\n\t\tisHorizontal:angleOfElevation < 45, \r\n\t\tisVertical:angleOfDepression < 45,\r\n\t};\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Other Utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Gets the element's left,top,bottom,right values\r\n * with \"auto\"s resolved.\r\n *\r\n * @param HTMLElement\t\t\tel \r\n * @param array\t\t\t\t\tanchors \r\n *\r\n * @return object\r\n */\r\nconst positioningOffsets = function(el, anchors = ['left', 'top', 'right', 'bottom']) {\r\n\tvar inverses = {right:'left', left:'right', bottom:'top', top:'bottom'};\r\n\tvar currentOffsets = cssRead(el, anchors.concat('position'));\r\n\tvar intersectionWithAnchor = null;\r\n\tanchors.forEach(name => {\r\n\t\tif (currentOffsets[name] === 'auto') {\r\n\t\t\t// Get what anchor value would be...\r\n\t\t\t// on current position type\r\n\t\t\tif (currentOffsets.position === 'relative') {\r\n\t\t\t\tcurrentOffsets[name] = - parseFloat(currentOffsets[inverses[name]]);\r\n\t\t\t} else if (currentOffsets.position === 'fixed') {\r\n\t\t\t\tintersectionWithAnchor = intersectionWithAnchor || intersection(rect(el), rect(window));\r\n\t\t\t\tcurrentOffsets[name] = intersectionWithAnchor[name];\r\n\t\t\t} else if (currentOffsets.position === 'absolute') {\r\n\t\t\t\tintersectionWithAnchor = intersectionWithAnchor || intersection(rect(el), rect(el.offsetParent));\r\n\t\t\t\tcurrentOffsets[name] = intersectionWithAnchor[name];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurrentOffsets[name] = parseFloat(currentOffsets[name]);\r\n\t\t}\r\n\t});\r\n\tdelete currentOffsets.position;\r\n\treturn currentOffsets;\r\n};\r\n\r\n/**\r\n * Returns the heighest z-index attained by any of its descendants,\r\n * starting from its stacking context.\r\n *\r\n * @param DOMElement\t\tel \r\n *\r\n * @return int\r\n */\r\nconst zHeight = function(el) {\r\n\tvar zIndex = 0;\r\n\t_arrFrom(el.children).forEach((el, i) => {\r\n\t\tzIndex = Math.max(zIndex, parseInt(cssRead(el, 'z-index')) || 0);\r\n\t});\r\n\treturn zIndex;\r\n};\r\n\r\n/**\r\n * Parses the total width of the element's vertical borders.\r\n *\r\n * @param DOMElement \t\tel\r\n *\r\n * @return int\r\n */\r\nconst yBorders = function(el) {\r\n\tvar borderWidth = 0;\r\n\tborderWidth += parseInt(cssRead(el, 'border-left-width'));\r\n\tborderWidth += parseInt(cssRead(el, 'border-right-width'));\r\n\treturn borderWidth;\r\n};\r\n\r\n/**\r\n * Parses the total height of the element's horizontal borders.\r\n *\r\n * @param DOMElement \t\tel\r\n *\r\n * @return int\r\n */\r\nconst xBorders = function(el) {\r\n\tvar borderHeight = 0;\r\n\tborderHeight += parseInt(cssRead(el, 'border-top-width'));\r\n\tborderHeight += parseInt(cssRead(el, 'border-bottom-width'));\r\n\treturn borderHeight;\r\n};\r\n\r\n/**\r\n * Gets an element's nearest scrollable parent.\r\n *\r\n * @param DOMNode\t\tel\r\n *\r\n * @return jQuery\r\n */\r\nconst scrollParent = function(el) {\r\n\tvar style = window.getComputedStyle(el);\r\n\tvar excludeStaticParent = style.position === 'absolute';\r\n\tvar overflowRegex = false/*includeHidden*/ ? /(auto|scroll|hidden)/ : /(auto|scroll)/;\r\n\tif (style.position !== 'fixed') {\r\n\t\tfor (var parent = el; (parent = parent.parentElement);) {\r\n\t\t\tstyle = window.getComputedStyle(parent);\r\n\t\t\tif (excludeStaticParent && style.position === 'static') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) {\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn document.body;\r\n};\r\n\r\n/**\r\n * Tells if an element is scrollable due to overflowing content.\r\n *\r\n * @param DOMNode\t\tel\r\n *\r\n * @return bool\r\n */\r\nconst scrolls = function(el) {\r\n\treturn el === window \r\n\t\t? (el.pageYOffset || el.pageYOffset) \r\n\t\t: (el.scrollHeight > el.clientHeight);\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Still other Utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Parses a directive to obtain a placement keyword and modifiers.\r\n *\r\n * @param string\t\t\t \texpr\r\n *\r\n * @return object\r\n */\r\nconst parsePlacement = function(expr) {\r\n\tvar regPlacement = new RegExp('(before|after|start|end|center)', 'g');\r\n\tvar regModifiers = new RegExp('[\\-\\+][0-9]+(%)?', 'g');\r\n\treturn {\r\n\t\tkeyword: (expr.match(regPlacement) || [])[0],\r\n\t\tpredicates: expr.match(regModifiers),\r\n\t};\r\n};\r\n\r\n/**\r\n * Sums a list of Mathematical expressions.\r\n *\r\n * @param array\t\t\t\t \tmodifiers\r\n * @param number \t\t\t\tpercentageContext\r\n *\r\n * @return number\r\n */\r\nconst evalPredicates = function(modifiers, percentageContext) {\r\n\treturn modifiers.reduce((total, modifier) => total + (modifier.endsWith('%') \r\n\t\t? parseFloat(modifier) / 100 * percentageContext\r\n\t\t: parseFloat(modifier)\r\n\t), 0);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\trect,\r\n\tsize,\r\n\toffsets,\r\n\trectAtOffsets,\r\n\tcoordsAtRect,\r\n\ttranslateTo,\r\n\toffsetTo,\r\n\tscrollTo,\r\n\tresizeCallback,\r\n\tproximity,\r\n\tunion,\r\n\tintersection,\r\n\tdelta,\r\n\tdeltaAngle,\r\n\tzHeight,\r\n\tyBorders,\r\n\txBorders,\r\n\tscrollParent,\r\n\tscrolls,\r\n};\r\nexport default rect;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tfrom as domFrom,\r\n\tfind as domFind,\r\n\tdomData,\r\n\tdomAttr,\r\n\tdomHtml,\r\n\tdomText,\r\n\tdomAppend,\r\n\tdomPrepend,\r\n\tdomAttrAsync,\r\n\tdomHtmlAsync,\r\n\tdomTextAsync,\r\n\tdomAppendAsync,\r\n\tdomPrependAsync,\r\n} from './Dom.js';\r\nimport {\r\n\tcss,\r\n\tcssAsync,\r\n\tcssComputeAsync,\r\n\tcssTransaction,\r\n} from './Css/Css.js';\r\nimport {\r\n\taddListener,\r\n\tremoveListener,\r\n} from './Event/EventController.js';\r\nimport Anim from './Anim/Anim.js';\r\nimport Reflow from './Reflow.js';\r\nimport {\r\n\ttranslateTo,\r\n\toffsetTo,\r\n\tscrollTo,\r\n} from './Geometry/Rect.js';\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Element manipulation library.\r\n * ---------------------------\r\n */\r\nconst Element = class {\r\n\t\r\n\t/**\r\n\t * General element creator.\r\n\t * Accepts any of markup, selector, HTMLElement.\r\n\t *\r\n\t * @param string \t\t\t\tinput\r\n\t *\r\n\t * @return Element\r\n\t */\r\n\tstatic from(input) {\r\n\t\treturn new Element(domFrom(input));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Creates an instance over an element.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el) {\r\n\t\tthis.el = el;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Strategically returns a HTMLElement.\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\t_el() {\r\n\t\treturn this.el || document.createElement('div');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Automatically returns the current instance in place\r\n\t * of the element.\r\n\t *\r\n\t * @param mixed\t\t\t\t\tret\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_ret(ret) {\r\n\t\treturn this.el && ret === this.el ? this : ret;\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Queries the current element.\r\n\t *\r\n\t * @param string \t\t\t\tselector\r\n\t *\r\n\t * @return DOMNodeList\r\n\t */\r\n\tfind(selector) {\r\n\t\treturn new Element(this.el ? domFind(selector, this.el) : undefined);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see domData\r\n\t *\r\n\t * @return mixed|this\r\n\t */\r\n\tdata(requestOrPayload, val = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domData function is sensitive to argument count\r\n\t\treturn this._ret(domData(this._el(), ...arguments));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see css\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcss(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// css function is sensitive to argument count\r\n\t\treturn this._ret(css(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAttr\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tattr(requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domAttr function is sensitive to argument count\r\n\t\treturn this._ret(domAttr(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domHtml\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\thtml(content = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domHtml function is sensitive to argument count\r\n\t\treturn this._ret(domHtml(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domText\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\ttext(content = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domText function is sensitive to argument count\r\n\t\treturn this._ret(domText(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAppend\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tappend(content) {\r\n\t\treturn this._ret(domAppend(this._el(), content));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domPrepend\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tprepend(content) {\r\n\t\treturn this._ret(domPrepend(this._el(), content));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see cssAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcssAsync(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// cssAsync function is sensitive to argument count\r\n\t\treturn cssAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAttrAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tattrAsync(requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domAttrAsync function is sensitive to argument count\r\n\t\treturn domAttrAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domHtmlAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\thtmlAsync(content) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domHtmlAsync function is sensitive to argument count\r\n\t\treturn domHtmlAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domTextAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\ttextAsync(content) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domTextAsync function is sensitive to argument count\r\n\t\treturn domTextAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAppendAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tappendAsync(content) {\r\n\t\treturn domAppendAsync(this._el(), ...arguments).then(() => {\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domPrependAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tprependAsync(content) {\r\n\t\treturn domPrependAsync(this._el(), ...arguments).then(() => {\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see cssComputeAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcssComputeAsync(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// cssComputeAsync function is sensitive to argument count\r\n\t\treturn cssComputeAsync(this._el(), ...arguments);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Establishes a CSS operatiom that can be rolledback without altering similar operation by other code.\r\n\t * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n\t *\r\n\t * @param string|array\t\t\tprops\r\n\t *\r\n\t * @return Transaction\r\n\t */\r\n\tcssTransaction(props) {\r\n\t\treturn cssTransaction(this._el(), props);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see addListener\r\n\t */\r\n\tobserve(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// addListener function is sensitive to argument count\r\n\t\treturn addListener(this._el(), ...arguments);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see removeListener\r\n\t */\r\n\tunobserve(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// removeListener function is sensitive to argument count\r\n\t\treturn removeListener(this._el(), ...arguments);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Creates and plays an amiation.\r\n\t * @see Animation\r\n\t *\r\n\t * @param array|object|string\teffect\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tplay(effect, params = {}) {\r\n\t\tif (!('cancelForCss' in params)) {\r\n\t\t\tparams.cancelForCss = true;\r\n\t\t}\r\n\t\treturn (new Anim(this._el(), effect, params)).play();\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Translates an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\ttranslateTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = translateTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tresolve(this.play([\r\n\t\t\t\t\t{transform: trans.current.from},\r\n\t\t\t\t\t{transform: trans.to},\r\n\t\t\t\t], options.play));\r\n\t\t\t} else {\r\n\t\t\t\tresolve(this.css({transform: trans.to}));\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Offsets an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\toffsetTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = offsetTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tresolve(this.play([trans.current.from, trans.to], options.play));\r\n\t\t\t} else {\r\n\t\t\t\tresolve(this.css(trans.to));\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Scrolls an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tscrollTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = scrollTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tconsole.log('scrollTo() does not currently support animation.');\r\n\t\t\t}\r\n\t\t\tresolve(trans.viewport.scrollTo(trans.to.scrollLeft, trans.to.scrollTop));\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Element;","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"class\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) && /^class\\s/.test(Function.prototype.toString.call(val));\r\n};\r\n","\r\n/**\r\n * Return the part of a string before a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   beforeLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, beforeLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = beforeLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn subject;\r\n\t}\r\n\treturn subject.substr(0, pos);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _pushUnique from '@onephrase/commons/arr/pushUnique.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The HTML Context Model Schema.\r\n\t// @see https://html.spec.whatwg.org/multipage\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * @object\r\n */\r\nconst Schema = {\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\tstd: {\r\n\t\t/**\r\n\t\t * @uncategorized\r\n\t\t */\r\n\t\thtml: {\r\n\t\t\ttype: ['#sectioning-root'],\r\n\t\t\tmodel: ['head', 'body'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcaption: {\r\n\t\t\tmodel: ['#flow', '!table'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcol: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tcolgroup: {\r\n\t\t\tmodel: [{'colgroup[span]': ['#nothing']}, {':not(colgroup[span])': ['col', 'template']}],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tdd: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'definition',\r\n\t\t},\r\n\t\tdt: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tfigcaption: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thead: {\r\n\t\t\tmodel: ['#metadata'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlegend: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tli: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'listitem',\r\n\t\t},\r\n\t\toptgroup: {\r\n\t\t\tmodel: ['option', '#script-supporting'],\r\n\t\t\timplicitRole: 'group',\r\n\t\t},\r\n\t\toption: {\r\n\t\t\tmodel: [{'option[label][value]': ['#nothing']}, {'option[label]:not(option[value])': ['#text']}, {':not(option[label])': ['#text']}],\r\n\t\t},\r\n\t\tparam: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\trp: {\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\trt: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsource: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#phrasing', '#heading'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttrack: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttbody: {\r\n\t\t\tmodel: ['#script-supporting', 'tr'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t},\r\n\t\ttfoot: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tthead: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttr: {\r\n\t\t\tmodel: ['#script-supporting', 'td', 'th'],\r\n\t\t},\r\n\t\t/**\r\n\t\t * @categorized\r\n\t\t */\r\n\t\ta: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'a[href]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#interactive', '!a'],\r\n\t\t},\r\n\t\tabbr: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing',],\r\n\t\t},\r\n\t\taddress: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer', '!address',],\r\n\t\t},\r\n\t\t// If a child of <map>\r\n\t\tarea: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tarticle: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'article',\r\n\t\t\tacceptableRoles: ['application', 'article', 'document', 'main',],\r\n\t\t},\r\n\t\taside: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'complementary',\r\n\t\t\tacceptableRoles: ['complementary', 'note', 'search',],\r\n\t\t},\r\n\t\taudio: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'audio[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(audio[src])': ['source']}],\r\n\t\t},\r\n\t\tb: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbase: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbdi: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbdo: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tblockquote: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\tbody: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow', '@banner', '@contentinfo', '@complementary', '@main'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tbutton: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#phrasing', '!#interactive'],\r\n\t\t},\r\n\t\tcanvas: {\r\n\t\t\ttype: ['#embedded', '#flow', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#transparent', '!#interactive', 'a', 'img[usemap]', 'button', 'input[type=\"button\"]', 'input[type=\"radio\"]', 'input[type=\"checkbox\"]', 'select[multiple]', 'select[size>=1]', /*has tabindex but not #interactive*/'[tabindex]!#interactive'],\r\n\t\t},\r\n\t\tcite: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tcode: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdatalist: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '#script-supporting', 'option'],\r\n\t\t},\r\n\t\tdel: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tdetails: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow', 'summary'],\r\n\t\t},\r\n\t\tdfn: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '!dfn'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tdialog: {\r\n\t\t\ttype: ['#flow', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'dialog',\r\n\t\t},\r\n\t\tdiv: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [{'dl > div': ['dt', 'dd']}, {':not(dl > div)': ['#flow']}],\r\n\t\t},\r\n\t\tdl: {\r\n\t\t\t/*complicated*/\r\n\t\t\ttype: ['#flow', /*{:contains(> * name-value group): ['#palpable']}*/],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#script-supporting', 'dl', 'dt', 'div'],\r\n\t\t},\r\n\t\tem: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tembed: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tfieldset: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['legend', '#flow'],\r\n\t\t},\r\n\t\tfigure: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['#flow', 'figcaption'],\r\n\t\t\timplicitRole: 'figure',\r\n\t\t},\r\n\t\tfooter: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['contentinfo',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tform: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!form'],\r\n\t\t},\r\n\t\th1: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th2: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th3: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th4: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th5: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th6: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\theader: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['banner',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thgroup: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '#script-supporting'],\r\n\t\t},\r\n\t\thr: {\r\n\t\t\ttype: ['#flow'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\timplicitRole: 'separator',\r\n\t\t},\r\n\t\ti: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tiframe: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\timg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'img[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tinput: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'input:not([type!=\"hidden\"])': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tins: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tkbd: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!label'],\r\n\t\t},\r\n\t\tlink: {\r\n\t\t\ttype: ['#metadata', {'body link': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tmain: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'main',\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tmap: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmark: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmath: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\tmenu: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tmeta: {\r\n\t\t\ttype: ['#metadata', {'meta[itemprop]': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tnames: ['application-name', 'author', 'description', 'generator', 'keywords', 'referrer', 'theme-color'],\r\n\t\t},\r\n\t\tmeter: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tnav: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'navigation',\r\n\t\t\tacceptableRoles: ['navigation',],\r\n\t\t},\r\n\t\tnoscript: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing'], \r\n\t\t\tmodel: [{'head link': ['style', 'meta', 'link']}, {':not(head link)': ['#transparent', '!noscript']}],\r\n\t\t},\r\n\t\tobject: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'object[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', 'param'],\r\n\t\t},\r\n\t\tol: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\toutput: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tp: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tpicture: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing'], \r\n\t\t\tmodel: ['source', 'img', '#acript-supporting'],\r\n\t\t},\r\n\t\tpre: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tprogress: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!progress'],\r\n\t\t},\r\n\t\tq: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\truby: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'],\r\n\t\t\t/*complicated*/ \r\n\t\t\tmodel: ['rp', 'rt'],\r\n\t\t},\r\n\t\ts: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsamp: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tscript: {\r\n\t\t\ttype: ['#flow', '#metadata', '#phrasing', '#acript-supporting'], \r\n\t\t\tmodel: [{'script[src]': []}],\r\n\t\t},\r\n\t\tsection: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'region',\r\n\t\t\tacceptableRoles: ['alert', 'alertdialog', 'application', 'contentinfo', 'dialog', 'document', 'log', 'main', 'marquee', 'region', 'search', 'status',],\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['option', 'optgroup', '#acript-supporting'],\r\n\t\t},\r\n\t\tslot: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tsmall: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tspan: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstrong: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstyle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\tsub: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsup: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsvg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\ttable: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['caption', 'colgroup', 'thead', 'tbody', 'tr', 'tfoot', '#script-supporting'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\ttemplate: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing', '#script-supporting'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\ttime: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: [{'time[datetime]': ['#phrasing']}, {':not(time[datetime])': ['#text']}],\r\n\t\t},\r\n\t\ttitle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tu: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tul: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tvar: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tvideo: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'video[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(video[src])': ['source']}],\r\n\t\t},\r\n\t\twbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\taria: {\r\n\t\tbanner: {\r\n\t\t\ttype: ['@banner'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcontentinfo: {\r\n\t\t\ttype: ['@contentinfo'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcomplementary: {\r\n\t\t\ttype: ['@complementary'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tnavigation: {\r\n\t\t\ttype: ['@navigation'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlist: {\r\n\t\t\ttype: ['@list'], \r\n\t\t},\r\n\t\tlistitem: {\r\n\t\t\ttype: ['@listitem'], \r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic content model for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetContentModelFor(el) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\treturn Schema.std[elTagName] ? Schema.expandRules(el, Schema.std[elTagName].model || []) : [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic categories for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param bool\t\t\t\t\t\troleInclusive\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCategoriesFor(el, roleInclusive = true) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\tvar elSchema = Schema.std[elTagName] || Schema.aria[elTagName] || {};\r\n\t\tvar currentElCategories = [];\r\n\t\tif (roleInclusive && !el.nodeName.startsWith('#') \r\n\t\t&& (el.hasAttribute('role') || elSchema.implicitRole)) {\r\n\t\t\t// Current el's impliable/acceptable roles\r\n\t\t\t// (These take precedence over native semantics)\r\n\t\t\tif (el.hasAttribute('role')) {\r\n\t\t\t\tvar definedRoles = el.getAttribute('role').split(' ');\r\n\t\t\t\tel.getAttribute('role').split(' ').forEach(role => {\r\n\t\t\t\t\tif (elSchema && elSchema.acceptableRoles && !elSchema.acceptableRoles.includes(role)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trole = role.trim();\r\n\t\t\t\t\tcurrentElCategories.push('@' + role);\r\n\t\t\t\t\tif (Schema.aria[role] && Schema.aria[role].type) {\r\n\t\t\t\t\t\tcurrentElCategories = currentElCategories.concat(Schema.expandRules(el, Schema.aria[role].type || []));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (elSchema.implicitRole) {\r\n\t\t\t\t_pushUnique(currentElCategories, '@' + elSchema.implicitRole, elTagName);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Current node's categories/tagname\r\n\t\t\tvar currentElCategories = _pushUnique(Schema.expandRules(el, elSchema.type || []), elTagName);\r\n\t\t}\r\n\t\treturn currentElCategories;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node belongs in the context's content model\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tcontext\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInContentModel(context, node) {\r\n\t\tvar contextModel = context instanceof HTMLElement \r\n\t\t\t? Schema.getContentModelFor(context)\r\n\t\t\t: context;\r\n\t\tvar nodeCategories = node instanceof HTMLElement \r\n\t\t\t? Schema.getCategoriesFor(node)\r\n\t\t\t: node;\r\n\t\tif (_intersect(contextModel, ['#nothing', '#text']).length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar valid;\r\n\t\t// So current content model has to list either this node's categories,\r\n\t\t// tagname, or impliable/acceptable roles\r\n\t\tcontextModel.forEach(allowedNode => {\r\n\t\t\tif (allowedNode.startsWith('!')) {\r\n\t\t\t\tvar disallowedNode = allowedNode.substr(1);\r\n\t\t\t\tif (nodeCategories.includes(disallowedNode)) {\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t}\r\n\t\t\t} else if (valid !== false) {\r\n\t\t\t\tif (nodeCategories.includes(allowedNode)) {\r\n\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn valid && true;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node is associated to the context directly\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tscope\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t * @param object\t\t\t\t\tnodeSchema\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInScopeAs(scope, node, nodeSchema = null) {\r\n\t\tvar contextCategories = Schema.getCategoriesFor(scope);\r\n\t\tvar closest, current = node, nodeModel;\r\n\t\twhile (!closest && (current = current.parentNode)) {\r\n\t\t\tif (_intersect(contextCategories, Schema.getCategoriesFor(current)).length\r\n\t\t\t\t&& Schema.assertNodeBelongsInContentModel(current, nodeSchema ? (nodeSchema.type || node) : node)\r\n\t\t\t) {\r\n\t\t\t\tclosest = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn closest === scope;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Flattens the schema rules for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param array\t\t\t\t\t\trules\r\n\t *\r\n\t * @return array\r\n\t */\r\n\texpandRules(el, rules) {\r\n\t\tvar rles = rules.reduce((categories, rule) => {\r\n\t\t\tif (_isObject(rule)) {\r\n\t\t\t\tif (el.matches(Object.keys(rule)[0])) {\r\n\t\t\t\t\tcategories = categories.concat(Object.values(rule)[0]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcategories.push(rule);\r\n\t\t\t}\r\n\t\t\treturn categories;\r\n\t\t}, []);\r\n\t\tif (rles.includes('#sectioning-root')) {\r\n\t\t\trles.push('#sectioning-content');\r\n\t\t}\r\n\t\treturn rles;\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Schema;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Matrix loader\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Matrix = class {\r\n\t\r\n\t/**\r\n\t * Creates a new Matrix instance.\r\n\t *\r\n\t * @param array \t\t\tsources\r\n\t * @param string|array \t\tnamespace\r\n\t * @param function \t\t\tgetter\r\n\t * @param MatrixInterface\tcarry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(sources, namespace, getter, carry = null) {\r\n\t\tthis.sources = _arrFrom(sources);\r\n\t\tthis.namespace = _arrFrom(namespace);\r\n\t\tthis.getter = getter;\r\n\t\tthis.carry = carry;\r\n\t\tthis.collections = {};\r\n\t\tthis.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Enters into a sub collection if exists.\r\n\t *\r\n\t * @param string \t\t\tname\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tenter(name) {\r\n\t\tif (!(name in this.collections)) {\r\n\t\t\tthis.collections[name] = new Matrix(\r\n\t\t\t\tthis.sources, \r\n\t\t\t\tthis.namespace.concat(name),\r\n\t\t\t\tthis.getter,\r\n\t\t\t\tthis \r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this.collections[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Leaves the current current collection into the super collection if exists.\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tleave() {\r\n\t\treturn this.carry;\r\n\t}\r\n\r\n\t/**\r\n\t * Lazy-loads a property from sources.\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget() {\r\n\t\tif (!this.value) {\r\n\t\t\tvar namespace = this.namespace.slice();\r\n\t\t\tvar value = this.carry ? this.carry.get() : null;\r\n\t\t\tthis.sources.forEach((source, i) => {\r\n\t\t\t\tif (value = this.getter.call(null, source, namespace, value, i)) {\r\n\t\t\t\t\tthis.value = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the most-specific module for the given namespace from sources.\r\n\t *\r\n\t * @param sting\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tfind(namespace) {\r\n\t\tvar nsArray = namespace.split('/');\r\n\t\tvar subMatrix, nsKey, nsDrill = this;\r\n\t\twhile((nsKey = nsArray.shift()) && (nsDrill = nsDrill.enter(nsKey))) {\r\n\t\t\tsubMatrix = nsDrill; \r\n\t\t}\r\n\t\t// Clone now...\r\n\t\tvar el = subMatrix.get();\r\n\t\tif (el) {\r\n\t\t\treturn el.cloneNode(true);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Matrix;\r\n","\r\n/**\r\n * Instanceof that supports our multi-inheritance implementstion.\r\n *\r\n * @param object\t \tobj1\r\n * @param object\t \tclassB\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, classB) {\r\n\tif (!obj) {\r\n\t\treturn false;\r\n\t}\r\n\tif (obj instanceof classB) {\r\n\t\treturn true;\r\n\t}\r\n\tvar mixinTest = classA => {\r\n\t\twhile (classA && classA !== Function.prototype) {\r\n\t\t\tif (classA === classB || (classA.prototypes && classA.prototypes.reduce((prevAns, prototype) => prevAns || (prototype === classB) || mixinTest(prototype), false))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tclassA = Object.getPrototypeOf(classA);\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\treturn mixinTest(obj.constructor);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ExprInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Compares the current instance with another object.\r\n\t *\r\n\t * @param object Expr\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\teven(Expr) {\r\n\t\tif (_isObject(Expr) && Expr.jsenType === this.jsenType) {\r\n\t\t\treturn _even(Expr, this);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Inherits properties from a super Expr.\r\n\t *\r\n\t * @param ExprInterface Super\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinherit(Super) {\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds comments to the instance.\r\n\t *\r\n\t * @param string\t comments\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithComments(comments) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.comments = comments;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds variables to the instance.\r\n\t *\r\n\t * @param array\t\t vars\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithVars(vars) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.vars = vars;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evaluates the expression instance for a result,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t//eval(context = null, callback = null)\r\n\t\r\n\t/**\r\n\t * Serializes the expression instance back to a string,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return string\r\n\t */\r\n\t//toString(context = null)\r\n\t\r\n\t/**\r\n\t * SAttempts to parse a string into the class instance.\r\n\t *\r\n\t * @param string expr\r\n\t * @param object params\r\n\t *\r\n\t * @return ExprInterface\r\n\t */\r\n\t//static parse(expr, params = {})\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssignmentInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssignmentExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReferenceInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Reference'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * DeletionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'DeleteExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CallInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'CallExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _instanceof from '@onephrase/commons/js/instanceof.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Jsen (base) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Jsen = class {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, Parsers, params = {}, Static = Jsen) {\r\n\t\tif (!params.meta) {\r\n\t\t\tparams.meta = {vars: []};\r\n\t\t}\r\n\t\tif (expr.length) {\r\n\t\t\tvar parsers = Object.values(Parsers || Static.grammars);\r\n\t\t\tfor (var i = 0; i < parsers.length; i ++) {\r\n\t\t\t\t// From this point forward, all vars is within current scope\r\n\t\t\t\tvar varsScope = params.meta && _isArray(params.meta.vars) ? params.meta.vars.length : 0;\r\n\t\t\t\tvar parsed = parsers[i].parse(expr, (_expr, _Parsers) => Jsen.parse(_expr, _Parsers, params, Static));\r\n\t\t\t\t// Add/remove vars to scope\r\n\t\t\t\tif (parsed && params.meta) {\r\n\t\t\t\t\tif (!parsed.meta) {\r\n\t\t\t\t\t\tparsed.meta = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Reap vars into scope expr\r\n\t\t\t\t\tparsed.meta.vars = params.meta.vars.slice(varsScope);\r\n\t\t\t\t\t// Add vars to scope\r\n\t\t\t\t\tif (_instanceof(parsed, ReferenceInterface) || _instanceof(parsed, CallInterface)) {\r\n\t\t\t\t\t\t_remove(parsed.meta.vars, parsed.context);\r\n\t\t\t\t\t\t_remove(params.meta.vars, parsed.context);\r\n\t\t\t\t\t\tparams.meta.vars.push(parsed);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed && params.explain) {\r\n\t\t\t\t\tconsole.log(expr, ' >>------------->> ', parsed.jsenType);\r\n\t\t\t\t}\r\n\t\t\t\tif ((parsed instanceof AssignmentInterface || parsed instanceof DeletionInterface) \r\n\t\t\t\t&& (!params || !params.mutates)) {\r\n\t\t\t\t\tthrow new Error('[Permission error:] ' + expr);\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed) {\r\n\t\t\t\t\treturn parsed;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (params.assert === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthrow new Error('[Syntax error:] ' + expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _first from './first.js';\r\n\r\n/**\r\n * Returns THE LAST ENTRY OR A NUMBER OF ENTRIES counting forward to the end.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, amount = 1) {\r\n\treturn arguments.length > 1\r\n\t\t? _first(arr.slice().reverse(), amount).reverse()\r\n\t\t: _first(arr.slice().reverse());\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _merge from '@onephrase/commons/obj/merge.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _copyPlain from '@onephrase/commons/obj/copyPlain.js';\r\n\r\n/**\r\n * --------------------------\r\n * TOKENIZER\r\n * --------------------------\r\n */\r\n\r\nconst Lexer = class {\r\n\r\n\t/**\r\n\t * Factory method.\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic lex(str, delims, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Argument1 must be a string!');\r\n\t\t}\r\n\t\t// CREATE NEW -----------------------------\r\n\t\tvar instance = new Lexer(str, options);\r\n\t\t// GIVE CACHE -----------------------------\r\n\t\tLexer.$cache[str] = Lexer.$cache[str] || [];\r\n\t\tLexer.$cache[str].push(instance);\r\n\t\t// RETURN NEW -----------------------------\r\n\t\treturn instance.lex(delims);\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .split().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic split(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).tokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .match().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic match(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).matches;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a lexer instance on a string with the given options.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t * @param string \t\tblocks\t\t\t\tThe strings that begin and end a nested structure\r\n\t * @param number \t\tlimit\t\t\t\tMax results to return\r\n\t * @param string \t\tbackreference\t\tA character like (\\) that prefixes non-delim characters\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tconstructor(str, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Lexer requires the first argument to be a string.');\r\n\t\t}\r\n\t\tthis.$str = str;\r\n\t\tthis.$options = options || {};\r\n\t\tif (!this.$options.blocks) {\r\n\t\t\tthis.$options.blocks = Lexer.$blocks;\r\n\t\t}\r\n\t\tif (!this.$options.quotes) {\r\n\t\t\tthis.$options.quotes = Lexer.$quotes;\r\n\t\t}\r\n\t\tif (!this.$options.comments) {\r\n\t\t\tthis.$options.comments = Lexer.$comments;\r\n\t\t}\r\n\t\tthis.$cache = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the instance string on the given delimeters.\r\n\t *\r\n\t * This method supports static calling,\r\n\t * in which case a string is required as the first argument.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tlex(delims, options) {\r\n\t\tvar runtime = {\r\n\t\t\tdelims: _arrFrom(delims),\r\n\t\t\toptions: _merge(true, {}, this.$options, options || {}),\r\n\t\t\tnesting: [],\r\n\t\t\tmaxDepth: 0,\r\n\t\t\tcomments: [],\r\n\t\t\ttokens: [],\r\n\t\t\tmatches: [],\r\n\t\t\tmatchesi: {},\r\n\t\t};\r\n\t\t// ASK INSTANCE CACHE ---------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tfor (var i = 0; i < this.$cache.length; i ++) {\r\n\t\t\t\tif (_even(this.$cache[i].delims, runtime.delims) && _even(this.$cache[i].options, runtime.options)) {\r\n\t\t\t\t\treturn _copyPlain(this.$cache[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// EVALUATE NEW --------------------------------\r\n\t\t// Iterate over each character, keep track of current row and column (of the returned array)\r\n\t\tthis._evalCharsAt(runtime, 0);\r\n\t\tif (runtime.nesting.length) {\r\n\t\t\tthrow new Error('Error parsing the string: ' + this.$str + '. Unterminated blocks: ' + _flatten(runtime.nesting).join(', ') + '');\r\n\t\t}\r\n\t\t// GIVE CACHE ----------------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tthis.$cache.push(runtime);\r\n\t\t}\r\n\t\t// RETURN NEW ----------------------------------\r\n\t\treturn runtime;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: evaluates and handles the character on the current cursor.\r\n\t * Advances the cursor.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_evalCharsAt(runtime, i) {\r\n\t\tif (i >= this.$str.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar charWidth = 1;\r\n\t\tvar commentTest = {}, quoteTest = {}, nestingTest = {};\r\n\t\t// Quotes inside comments must be ignored\r\n\t\tif (!runtime.openComment) {\r\n\t\t\tquoteTest = this._testQuotes(runtime, i);\r\n\t\t}\r\n\t\t// Comments inside quotes must be ignored\r\n\t\tif (!runtime.openQuote) {\r\n\t\t\tcommentTest = this._testComments(runtime, i);\r\n\t\t}\r\n\t\t// Save comments\r\n\t\tif (runtime.openComment || commentTest.ending) {\r\n\t\t\t// Save only outer comments\r\n\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\tvar chars = commentTest.starting || commentTest.ending || this.$str[i];\r\n\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\tthis._push(runtime, chars, 'comments');\r\n\t\t\t\tif (runtime.options.preserveComments) {\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t}\r\n\t\t} else if (runtime.openQuote || quoteTest.ending) {\r\n\t\t\t// Yes add quotes\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t} else if (runtime.options.limit && runtime.matches.length === runtime.options.limit) {\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\treturn this._evalCharsAt(runtime, i + 1);\r\n\t\t} else {\r\n\t\t\t// Nesting tags inside comments and quotes have been ignored\r\n\t\t\tnestingTest = this._testNesting(runtime, i);\r\n\t\t\t// ---------------------\r\n\t\t\t// STOP ON THIS CHARACTER...?\r\n\t\t\t// ---------------------\r\n\t\t\tvar nestingTest = this._testNesting(runtime, i);\r\n\t\t\t// STOP CHAR(S)? at top level?\r\n\t\t\tvar stopChar = this._testChars(runtime.options.stopChars || [], runtime, i);\r\n\t\t\tif (!runtime.nesting.length && stopChar !== false) {\r\n\t\t\t\truntime.options.stopChar = stopChar;\r\n\t\t\t\truntime.options.stopCharForward = this.$str.substr(i);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// ---------------------\r\n\t\t\t// Match and split now...\r\n\t\t\t// ---------------------\r\n\t\t\tif (!runtime.delims.length) {\r\n\t\t\t\t// BLOCK-BASED SPLITTING...\r\n\t\t\t\tif (runtime.nesting.length === 2 && nestingTest.starting) {\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t\tthis._push(runtime, nestingTest.starting);\r\n\t\t\t\t\tcharWidth = nestingTest.starting.length;\r\n\t\t\t\t} else if (!runtime.nesting.length && nestingTest.ending) {\r\n\t\t\t\t\tthis._push(runtime, nestingTest.ending);\r\n\t\t\t\t\tcharWidth = nestingTest.ending.length;\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t} else/*no-nesting flag*/ {\r\n\t\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// ---------------------\r\n\t\t\t\t// DELIMS-BASED SPLITTING\r\n\t\t\t\t// ---------------------\r\n\t\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\t\t// In case the chars at index 0 is a delim,\r\n\t\t\t\t\t// the resulting split should first have an empty string, instead of undefined\r\n\t\t\t\t\tthis._push(runtime, '');\r\n\t\t\t\t\tvar matchedDelim = this._testChars(runtime.delims, runtime, i);\r\n\t\t\t\t\tif (matchedDelim !== false) {\r\n\t\t\t\t\t\truntime.matches.push(matchedDelim);\r\n\t\t\t\t\t\truntime.matchesi[i] = matchedDelim;\r\n\t\t\t\t\t\tcharWidth = matchedDelim.length || 1;\r\n\t\t\t\t\t\tif (!runtime.options.preserveDelims) {\r\n\t\t\t\t\t\t\t// The current character is a delimiter...\r\n\t\t\t\t\t\t\t// and should not get to appending to the split series down the line\r\n\t\t\t\t\t\t\treturn this._evalCharsAt(runtime, i + (matchedDelim.length || 1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._push(runtime, matchedDelim || this.$str[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar chars = nestingTest.starting || nestingTest.ending || this.$str[i];\r\n\t\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._evalCharsAt(runtime, i + charWidth);\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a quote start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testQuotes(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.quotes || []).forEach(quote => {\r\n\t\t\tif (this.$str.substr(i, 1) === quote) {\r\n\t\t\t\tif (!runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = quote;\r\n\t\t\t\t\tresult.starting = quote;\r\n\t\t\t\t} else if (quote === runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = false;\r\n\t\t\t\t\tresult.ending = quote;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a comment start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testComments(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.comments || []).forEach(block => {\r\n\t\t\tif (!runtime.openComment) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = block;\r\n\t\t\t\t\tresult.starting = m[0];\r\n\t\t\t\t}\r\n\t\t\t} else if (_last(block) === _last(runtime.openComment)) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = false;\r\n\t\t\t\t\tresult.ending = m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a nesting start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testNesting(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.blocks || []).forEach(block => {\r\n\t\t\tvar starting = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\tif (starting) {\r\n\t\t\t\truntime.nesting = runtime.nesting.concat([block]);\r\n\t\t\t\tresult.starting = starting[0];\r\n\t\t\t} else if (runtime.nesting.length && _last(block) === _last(_last(runtime.nesting))) {\r\n\t\t\t\tvar ending = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (ending) {\r\n\t\t\t\t\truntime.nesting = runtime.nesting.slice(0, -1);\r\n\t\t\t\t\tresult.ending = ending[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\truntime.maxDepth = Math.max(runtime.maxDepth, runtime.nesting.length);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a delimiter or stop character on the current cursor.\r\n\t *\r\n\t * @param array\t\ttestList\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_testChars(testList, runtime, i) {\r\n\t\tfor (var k = 0; k < testList.length; k ++) {\r\n\t\t\tvar test = testList[k];\r\n\t\t\tif (runtime.options.useRegex) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + test, runtime.options.useRegex !== true ? runtime.options.useRegex : ''));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\treturn m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((!runtime.options.ci && this.$str.substr(i, test.length) === test)\r\n\t\t\t|| (runtime.options.ci && this.$str.substr(i, test.length).toLowerCase() === test.toLowerCase())) {\r\n\t\t\t\treturn test;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Expr helper: pushes a character or set of characters into the current split series.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param string\tchars\r\n\t * @param string\ttarget\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_push(runtime, chars, target = 'tokens') {\r\n\t\tvar splitSeries = runtime.matches.length;\r\n\t\tif (_isUndefined(runtime[target][splitSeries])) {\r\n\t\t\truntime[target][splitSeries] = '';\r\n\t\t}\r\n\t\truntime[target][splitSeries] += chars;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tsplit(str, delims, options) {\r\n\t\treturn this.lex(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tmatch(str, delims, options) {\r\n\t\treturn this.lex(delims, options).matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses the instance string on the given delimeters using regex.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tregParse(delims, options) {\r\n\t\treturn this.lex(delims, _merge({useRegex: true}, options || {}));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters using regex; returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregSplit(delims, options) {\r\n\t\treturn this.regParse(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Matches the instance string on the given delimeters using regex; returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregMatch(delims, options) {\r\n\t\treturn this.regParse(delims, options).matches;\r\n\t}\r\n};\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$blocks = [['\\\\(', '\\\\)'], ['\\\\[', '\\\\]'], ['\\\\{', '\\\\}'],];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$quotes = ['\"', \"'\", '`',];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$comments = [['\\\\/\\\\*', '\\\\*\\\\/'], ['\\\\/\\\\/', '(\\\\r)?\\\\n'],];\r\n\r\n/**\r\n * @var object\r\n */\r\nLexer.$cache = {};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Lexer;\r\n\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nclass Contexts extends Array {\r\n\t\r\n\t/**\r\n\t * Returns the first found \"undefined\" value of a reference from \r\n\t * from contexts.\r\n\t *\r\n\t * @param string|number varName\r\n\t * @param bool\t\t\tbindThis\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(varName, bindThis = true) {\r\n\t\tfor(var i = 0; i < this.length; i ++) {\r\n\t\t\tvar val = _get(this[i], varName);\r\n\t\t\tif (_isFunction(val) && bindThis) {\r\n\t\t\t\treturn val.bind(this[i]);\r\n\t\t\t}\r\n\t\t\tif (!_isUndefined(val)) {\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Factory method for making a Contexts instance.\r\n\t *\r\n\t * @param array|object \tcntxt\r\n\t *\r\n\t * @return Contexts\r\n\t */\r\n\tstatic create(cntxt) {\r\n\t\treturn cntxt instanceof Contexts ? cntxt \r\n\t\t\t: (cntxt ? new Contexts(cntxt) : new Contexts());\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Contexts;","\r\n/**\r\n * Tells if the string is warapped with the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return bool\r\n */\r\nexport default function(subject, openingTag, closingTag) {\r\n\treturn subject.startsWith(openingTag) && subject.endsWith(closingTag);\r\n};\r\n","\r\n/**\r\n * Return the remainder of a string after a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   afterLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, afterLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = afterLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn '';\r\n\t}\r\n\treturn subject.substr(pos + search.length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _before from './before.js';\r\n\r\n/**\r\n * Return the part of a string before last occurence of a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search) {\r\n\treturn _before(subject, search, true);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _after from './after.js';\r\nimport _beforeLast from './beforeLast.js';\r\n\r\n/**\r\n * Returns the string without the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, openingTag, closingTag) {\r\n\treturn _beforeLast(_after(subject, openingTag), closingTag);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AbstractionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Abstraction'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport AbstractionInterface from './AbstractionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Abstraction class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Abstraction = class extends AbstractionInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.expr.toString(context) + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Abstraction) {\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_unwrap(expr, '(', ')'))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Abstraction;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ArrayType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport ArrInterface from './ArrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Array utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arr = class extends ArrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs || [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ArrInterface) {\r\n\t\t\tvar newExprs = Super.exprs.filter(exprA => {\r\n\t\t\t\treturn this.exprs.reduce((uniqueSoFar, exprB) => uniqueSoFar && !exprA.even(exprB), true);\r\n\t\t\t});\r\n\t\t\tthis.exprs = newExprs.concat(this.exprs);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.map(expr => expr.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '[' + this.exprs.map(expr => expr.toString(context)).join(', ') + ']';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arr) {\r\n\t\tif (_wrapped(expr, '[', ']') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(_unwrap(expr, '[', ']'), [','])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n).map(expr => parseCallback(expr));\r\n\t\t\treturn new Static(splits);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Arr;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArgumentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Arguments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport ArgumentsInterface from './ArgumentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Arguments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arguments = class extends ArgumentsInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(list = []) {\r\n\t\tsuper();\r\n\t\tthis.list = list;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.list.map(arg => arg.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.list.map(arg => arg.toString(context)).join(', ') + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arguments) {\r\n\t\tvar args; expr = expr.trim();\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tLexer.split(_unwrap(expr, '(', ')'), [',']).map(arg => parseCallback(arg.trim()))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Arguments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssertionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssertionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport AssertionInterface from './AssertionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assertion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assertion = class extends AssertionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs, logic) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs;\r\n\t\tthis.logic = logic;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t eval(context = null, callback = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn !_first(this.exprs).eval(context, callback);\r\n\t\t}\r\n\t\tvar operators = _flatten(Assertion.operators);\r\n\t\tvar logic = (this.logic || '').trim().toUpperCase();\r\n\t\tvar isOr = logic === (Assertion.operators.or || '').trim().toUpperCase();\r\n\t\tvar isNor = logic === (Assertion.operators.nor || '').trim().toUpperCase();\r\n\t\tvar isAnd = logic === (Assertion.operators.and || '').trim().toUpperCase();\r\n\t\tvar isNand = logic === (Assertion.operators.nand || '').trim().toUpperCase();\r\n\t\tvar lastResult = true, trues = 0;\r\n\t\tfor(var i = 0; i < this.exprs.length; i ++) {\r\n\t\t\tif (isAnd && !lastResult) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (isNand && !lastResult) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlastResult = this.exprs[i].eval(context, callback);\r\n\t\t\tif (isOr && lastResult) {\r\n\t\t\t\treturn lastResult;\r\n\t\t\t}\r\n\t\t\ttrues += lastResult ? 1 : 0;\r\n\t\t}\r\n\t\tif (isOr) {\r\n\t\t\t// Which is falsey,\r\n\t\t\t// by virtue of getting here\r\n\t\t\treturn lastResult;\r\n\t\t}\r\n\t\tif (isAnd || isNand) {\r\n\t\t\t// For AND and NAND, all entries must be true,\r\n\t\t\t// by virtue of getting here.\r\n\t\t\t// For AND, this means true; for NAND, false\r\n\t\t\treturn isAnd;\r\n\t\t}\r\n\t\t// For NOR, all entries need to be false\r\n\t\treturn isNor && trues === 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t toString(context = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn '!' + _first(this.exprs).toString(context);\r\n\t\t}\r\n\t\treturn this.exprs.map(expr => expr.toString(context)).join(' ' + this.logic + ' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assertion) {\r\n\t\tif (expr.startsWith('!')) {\r\n\t\t\treturn new Static(\r\n\t\t\t\t[parseCallback(expr.substr(1))],\r\n\t\t\t\t'!'\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tvar logic = _unique(parse.matches);\r\n\t\t\tif (logic.length > 1) {\r\n\t\t\t\tthrow new Error('\"AND\" and \"OR\" logic cannot be asserted in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr.trim())),\r\n\t\t\t\t_first(logic)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nAssertion.operators = {\r\n\tand: '&&',\r\n\tor: '||',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assertion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport AssignmentInterface from './AssignmentInterface.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assignment class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assignment = class extends AssignmentInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, val, operator = '=') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.val = val;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar val = this.val.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, val);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tcntxt[reference.name] = val;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.reference.toString(context), this.operator, this.val.toString(context)].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assignment) {\r\n\t\tvar parse = Lexer.lex(expr, Static.operators);\r\n\t\tif (parse.tokens.length === 2) {\r\n\t\t\tvar reference, val;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.shift().trim())) instanceof ReferenceInterface) \r\n\t\t\t|| !(val = parseCallback(parse.tokens.shift().trim()))) {\r\n\t\t\t\tthrow new Error('Invalid assignment directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, val, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nAssignment.operators = [' = '];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assignment;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * BoolInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'BooleanType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport BoolInterface from './BoolInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Bool (boolean) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Bool = class extends BoolInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(state) {\r\n\t\tsuper();\r\n\t\tthis.state = state;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.state.toLowerCase().trim() === 'true';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.state;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Bool) {\r\n\t\tvar expr = expr.toLowerCase().trim();\r\n\t\tif (expr === 'true' || expr === 'false') {\r\n\t\t\treturn new Static(expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Bool;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport CallInterface from './CallInterface.js';\r\nimport Arguments from './Arguments.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Call = class extends CallInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, args) {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.args = args;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar args = this.args.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, args);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar _contexts = Contexts.create(reference.context).slice();\r\n\t\t\tvar func = _contexts.get(reference.name, true/*bindThis*/);\r\n\t\t\tif (_isFunction(func)) {\r\n\t\t\t\treturn func(...args);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar handler, _cntxts = _contexts.slice();\r\n\t\t\twhile(_cntxts.length && !handler) {\r\n\t\t\t\tvar cntxt = _cntxts.shift();\r\n\t\t\t\tvar utils = Call.utils || {};\r\n\t\t\t\tvar handler = _isNumeric(cntxt) && utils.Num ? utils.Num\r\n\t\t\t\t\t: (_isString(cntxt) && utils.Str ? utils.Str\r\n\t\t\t\t\t\t: (_isArray(cntxt) && utils.Arr ? utils.Arr\r\n\t\t\t\t\t\t\t: (_isObject(cntxt) && utils.Obj ? utils.Obj : null)));\r\n\t\t\t\tif (handler && _isFunction(handler[reference.name])) {\r\n\t\t\t\t\targs.unshift(cntxt);\r\n\t\t\t\t\treturn handler[reference.name](...args);\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error('\"' + this + '\" is not a function. (Called on ' + _contexts.map(c => typeof c).join(', ') + ')');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.reference.toString(context) + this.args.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Call) {\r\n\t\tif (!expr.startsWith('(') && expr.endsWith(')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar tokens = Lexer.split(expr, []);\r\n\t\t\tvar reference, args = tokens.pop();\r\n\t\t\tif (!((reference = parseCallback(tokens.join(''))) instanceof ReferenceInterface) \r\n\t\t\t|| !(args = parseCallback(args, [Arguments]))) {\r\n\t\t\t\tthrow new Error('Invalid call directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, args);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Call;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CommentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Comments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _after from '@onephrase/commons/str/after.js';\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport CommentsInterface from './CommentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comments = class extends CommentsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(comments, type) {\r\n\t\tsuper();\r\n\t\tthis.comments = comments;\r\n\t\tthis.type = type;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comments) {\r\n\t\tvar _comments = null;\r\n\t\tvar _expr = null;\r\n\t\tvar type = 0;\r\n\t\tvar commentPlacement = 'before';\r\n\t\t// Oneliner comments\r\n\t\tif (expr.startsWith('//')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '//'), [\"\\r\\n\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 1;\r\n\t\t} else if (expr.startsWith('/*')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '/*'), [\"*/\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 2;\r\n\t\t} else if (expr.endsWith('*/')) {\r\n\t\t\tvar splits = Lexer.split(_beforeLast(expr, '*/'), [\"/*\"]);\r\n\t\t\t_comments = splits.pop().trim();\r\n\t\t\t_expr = splits.pop().trim();\r\n\t\t\ttype = 2;\r\n\t\t\tvar commentPlacement = 'after';\r\n\t\t}\r\n\t\tif (type) {\r\n\t\t\tif (type === 2) {\r\n\t\t\t\t_comments = Lexer.split(_comments.trim(), [\"\\r\\n\"])\r\n\t\t\t\t\t.map(line => line.replace(/^[\\*]+/, ''))\r\n\t\t\t\t\t.filter(line => line.trim());\r\n\t\t\t}\r\n\t\t\tconsole.log(_comments, commentPlacement, expr);\r\n\t\t\t_comments = new Static(_comments, type);\r\n\t\t}\r\n\t\tif (_expr) {\r\n\t\t\t_expr = parseCallback(_expr);\r\n\t\t\t_expr.meta.commenta = _comments;\r\n\t\t\treturn _expr;\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ComparisonInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ComparisonExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _difference from '@onephrase/commons/arr/difference.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport ComparisonInterface from './ComparisonInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comparison class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comparison = class extends ComparisonInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(operand1, operand2, operator) {\r\n\t\tsuper();\r\n\t\tthis.operand1 = operand1;\r\n\t\tthis.operand2 = operand2;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn Comparison.compare(\r\n\t\t\tthis.operand1.eval(context, callback), \r\n\t\t\tthis.operand2.eval(context, callback), \r\n\t\t\tthis.operator\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.operand1.toString(context), \r\n\t\t\tthis.operator, \r\n\t\t\tthis.operand2.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comparison) {\r\n\t\tvar operators = _flatten(Static.operators).map(oper => ' ' + oper + ' ');\r\n\t\tvar parse = Lexer.lex(expr, operators);\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tif (parse.tokens.length > 2) {\r\n\t\t\t\tthrow new Error('Malformed \"Comparison\" expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_first(parse.tokens).trim()),\r\n\t\t\t\tparseCallback(_last(parse.tokens).trim()),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * Use the operator type to compare the two operands\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param string \toperator\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic compare(operand1, operand2, operator = '==') {\r\n\t\tif (_flatten(Comparison.operators).indexOf(operator) === -1) {\r\n\t\t\tthrow new Error('The operator \"' + operator + '\" is not recognized.');\r\n\t\t}\r\n\t\tif (_isArray(operand1) && _isArray(operand2) && operator !== '===') {\r\n\t\t\tif (operand1.length !== operand2.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allItemsMatch = true;\r\n\t\t\toperand1.sort();\r\n\t\t\toperand2.sort();\r\n\t\t\tfor (var i = 0; i < operand1.length; i ++) {\r\n\t\t\t\tallItemsMatch = allItemsMatch && Comparison.compare(operand1[i], operand2[i], operator);\r\n\t\t\t}\r\n\t\t\treturn allItemsMatch;\r\n\t\t} else if (_isObject(operand1) && _isObject(operand2) && operator !== '===') {\r\n\t\t\tvar entry1Keys = Object.keys(operand1);\r\n\t\t\tvar entry2Keys = Object.keys(operand2);\r\n\t\t\tif (entry1Keys.length !== entry2Keys.length || _difference(entry1Keys, entry2Keys).length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allEntriesMatch = true;\r\n\t\t\t_each(entry1Keys, (i, key) => {\r\n\t\t\t\tallEntriesMatch = allEntriesMatch && Comparison.compare(operand1[key], operand2[key], operator);\r\n\t\t\t});\r\n\t\t\treturn allEntriesMatch;\r\n\t\t}\r\n\t\tswitch(operator) {\r\n\t\t\tcase '===':\r\n\t\t\t\treturn operand1 === operand2;\r\n\t\t\tcase '==':\r\n\t\t\tcase '=':\r\n\t\t\t\treturn operand1 == operand2;\r\n\t\t\tcase '>':\r\n\t\t\t\treturn operand1 > operand2;\r\n\t\t\tcase '<':\r\n\t\t\t\treturn operand1 < operand2;\r\n\t\t\tcase '>=':\r\n\t\t\t\treturn operand1 >= operand2;\r\n\t\t\tcase '<=':\r\n\t\t\t\treturn operand1 <= operand2;\r\n\t\t\tcase '!=':\r\n\t\t\t\treturn operand1 != operand2;\r\n\t\t\tcase '!==':\r\n\t\t\t\treturn operand1 !== operand2;\r\n\t\t\tcase '^=':\r\n\t\t\t\treturn _isString(operand1) && operand1.startsWith(operand2);\r\n\t\t\tcase '$=':\r\n\t\t\t\treturn _isString(operand1) && operand1.endsWith(operand2);\r\n\t\t\tcase '*=':\r\n\t\t\t\t// Contains\r\n\t\t\t\treturn _isArray(operand2) || _isString(operand2) ? operand1.indexOf(operand2) > -1 : false;\r\n\t\t\tcase '~=':\r\n\t\t\t\t// Contains word\r\n\t\t\t\treturn _isString(operand1) && _isString(operand2) && (' ' + operand1 + ' ').indexOf(' ' + operand2 + ' ') > -1;\r\n\t\t\tcase '>=<': // Between\r\n\t\t\t\t if (!(_isArray(operand2) && operand2.length === 2)) {\r\n\t\t\t\t\t throw new Error('A \\'Between\\' comparison requires argument 2 to be an array of exactly 2 values.');\r\n\t\t\t\t }\r\n\t\t\t\t return operand1 >= operand2[0] && operand1 <= operand2[1];\r\n\t\r\n\t\t\tcase '/**/': // Regex\r\n\t\t\t\treturn operand2.match(new RegExp(operand1));\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * Compares two operands for differences\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param bool\t \tstrict\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic diff(operand1, operand2, strict) {\r\n\t\treturn !Comparison.compare(operand1, operand2, strict ? '===' : '==');\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nComparison.operators = {\r\n\texact: {\r\n\t\tis: '===',\r\n\t\tisNull: '===',\r\n\t\tequalsTo: '==',\r\n\t\tnotEqualsTo: '!=',\r\n\t},\r\n\trelative: {\r\n\t\tlesserThan: '<',\r\n\t\tgreaterThan: '>',\r\n\t\tlesserThanOrEqualsTo: '<=',\r\n\t\tgreaterThanOrEqualsTo: '>=',\r\n\t\tbetween: '>=<',\r\n\t},\r\n\tpartial: {\r\n\t\tstartsWith: '^=',\r\n\t\tendsWith: '$=',\r\n\t\tcontains: '*=',\r\n\t\tany: '~=',\r\n\t\tin: '~=',\r\n\t\tmatches: '/**/',\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comparison;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ConditionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ConditionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ConditionInterface from './ConditionInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Condition class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Condition = class extends ConditionInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(assertion, onTrue, onFalse) {\r\n\t\tsuper();\r\n\t\tthis.assertion = assertion;\r\n\t\tthis.onTrue = onTrue;\r\n\t\tthis.onFalse = onFalse;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.assertion.eval(context, callback) \r\n\t\t\t? this.onTrue.eval(context, callback) \r\n\t\t\t: this.onFalse.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.assertion.toString(context), \r\n\t\t\tCondition.operators[0], \r\n\t\t\tthis.onTrue.toString(context),\r\n\t\t\tCondition.operators[1], \r\n\t\t\tthis.onFalse.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Condition) {\r\n\t\tvar splits = Lexer.split(expr, Static.operators);\r\n\t\tif (splits.length > 1) {\r\n\t\t\tif (splits.length === 2) {\r\n\t\t\t\tthrow new Error('Malformed ternary expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(splits[0].trim()),\r\n\t\t\t\tparseCallback(splits[1].trim()),\r\n\t\t\t\tparseCallback(splits[2].trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nCondition.operators = ['?', ':'];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Condition;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport DeletionInterface from './DeletionInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Deletion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Deletion = class extends DeletionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, operator = 'delete') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tdelete cntxt[reference.name];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.operator + ' ' + this.reference.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Deletion) {\r\n\t\tvar parse = Lexer.lex(expr, Object.values(Static.operators));\r\n\t\tif (parse.matches.length === 1 && expr.startsWith(parse.matches[0] + ' ')) {\r\n\t\t\tvar reference;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.pop().trim())) instanceof ReferenceInterface)) {\r\n\t\t\t\tthrow new Error('Invalid delete directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nDeletion.operators = {\r\n\tred: 'reduce', \r\n\tdel: 'delete',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Deletion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * FuncInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'FunctionType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport FuncInterface from './FuncInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Func class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Func = class extends FuncInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(paramters, statements, arrowFunctionFormatting = {}) {\r\n\t\tsuper();\r\n\t\tthis.paramters = paramters || {};\r\n\t\tthis.statements = statements;\r\n\t\tthis.arrowFunctionFormatting = arrowFunctionFormatting;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof FuncInterface) {\r\n\t\t\tvar parentParams = Object.keys(Super.paramters);\r\n\t\t\tvar ownParams = Object.keys(this.paramters);\r\n\t\t\tfor (var i = 0; i < Math.max(ownParams.length, parentParams.length); i ++) {\r\n\t\t\t\tvar nameInParent = parentParams[i];\r\n\t\t\t\tvar nameInSelf = ownParams[i];\r\n\t\t\t\tif (!nameInSelf && nameInParent) {\r\n\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInParent + ') in parent function must be implemented.');\r\n\t\t\t\t}\r\n\t\t\t\tif (nameInSelf && nameInParent) {\r\n\t\t\t\t\tvar defaultValInParent = Super.paramters[nameInParent];\r\n\t\t\t\t\tvar defaultValInSelf = this.paramters[nameInSelf];\r\n\t\t\t\t\tif (defaultValInSelf && !defaultValInParent) {\r\n\t\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInSelf + ') must not have a default value as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (defaultValInSelf && defaultValInParent && defaultValInSelf.jsenType !== defaultValInParent.jsenType) {\r\n\t\t\t\t\t\tthrow new Error('Default value for parameter #' + i + ' (' + nameInSelf + ') must be of type ' + defaultValInParent.jsenType + ' as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.sup = Super;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn (...args) => {\r\n\t\t\tvar localContext = {};\r\n\t\t\t_each(Object.keys(this.paramters), (i, name) => {\r\n\t\t\t\tvar defaultVal = this.paramters[name];\r\n\t\t\t\tif (args.length - 1 < i && !defaultVal) {\r\n\t\t\t\t\tthrow new Error('The parameter \"' + name + '\" is required.');\r\n\t\t\t\t}\r\n\t\t\t\tlocalContext[name] = args.length > i \r\n\t\t\t\t\t? args[i] \r\n\t\t\t\t\t: (this.paramters[name] \r\n\t\t\t\t\t\t? this.paramters[name].eval(context, callback) \r\n\t\t\t\t\t\t: null);\r\n\t\t\t});\r\n\t\t\t// But this newer context should come first\r\n\t\t\tvar multipleContexts = Contexts.create(localContext).concat(Contexts.create(context));\r\n\t\t\treturn this.statements.eval(multipleContexts, callback);\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar paramters = [];\r\n\t\t_each(this.paramters, (name, value) => {\r\n\t\t\tparamters.push(name + (value ? '=' + value.toString(context) : ''));\r\n\t\t});\r\n\t\tif (this.arrowFunctionFormatting) {\r\n\t\t\tvar headNoWrap = this.arrowFunctionFormatting.head === false || (paramters.length === 1 && paramters[0].indexOf('=') === -1);\r\n\t\t\tvar bodyNoWrap = this.arrowFunctionFormatting.body === false\r\n\t\t\treturn (headNoWrap ? paramters[0] : '(' + paramters.join(', ') + ')')\r\n\t\t\t+ ' => ' + (bodyNoWrap ? this.statements.toString(context) : '{' + this.statements.toString(context) + '}');\r\n\t\t}\r\n\t\treturn 'function (' + paramters.join(', ') + ') {' + this.statements.toString(context) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Func) {\r\n\t\texpr = expr.trim();\r\n\t\tvar splits;\r\n\t\tif (expr.startsWith('function') \r\n\t\t&& (splits = Lexer.split(expr, []).slice(1).filter(b => b.trim())) && splits.length === 2) {\r\n\t\t\tvar arrowFunctionFormatting = false;\r\n\t\t\tvar funcHead = _unwrap(splits.shift().trim(), '(', ')');\r\n\t\t\tvar funcBody = _unwrap(splits.shift().trim(), '{', '}');\r\n\t\t} else if (!expr.startsWith('function') \r\n\t\t&& (splits = Lexer.split(expr, ['=>'])) && splits.length === 2) {\r\n\t\t\tvar funcHead = splits.shift().trim();\r\n\t\t\tvar funcBody = splits.shift().trim();\r\n\t\t\tvar arrowFunctionFormatting = {};\r\n\t\t\tif (_wrapped(funcHead, '(', ')')) {\r\n\t\t\t\tfuncHead = _unwrap(funcHead, '(', ')');\r\n\t\t\t} else {\r\n\t\t\t\tarrowFunctionFormatting.head = false;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(funcBody, '{', '}')) {\r\n\t\t\t\tfuncBody = _unwrap(funcBody, '{', '}');\r\n\t\t\t} else {\r\n\t\t\t\tarrowFunctionFormatting.body = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar paramters = {};\r\n\t\tLexer.split(funcHead, [',']).forEach(param => {\r\n\t\t\tvar paramSplit = param.split('=');\r\n\t\t\tif (paramSplit[1]) {\r\n\t\t\t\tparamters[paramSplit[0].trim()] = parseCallback(paramSplit[1].trim());\r\n\t\t\t} else {\r\n\t\t\t\tparamters[param.trim()] = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar statements = parseCallback(funcBody);\r\n\t\treturn new Static(paramters, statements, arrowFunctionFormatting);\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nFunc.operators = ['=>',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Func;","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * MathInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'MathExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport MathInterface from './MathInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Math class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Math = class extends MathInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(val, exprs) {\r\n\t\tsuper();\r\n\t\tthis.val = val;\r\n\t\tthis.exprs = exprs;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.reduce((currentTotal, expr) => {\r\n\t\t\tvar val = expr.val.eval(context, callback);\r\n\t\t\tvar operator = expr.operator.trim();\r\n\t\t\tif ((!_isNumeric(currentTotal) || !_isNumeric(val)) && operator !== '+') {\r\n\t\t\t\tthrow new Error('Invalid Math expression: ' + this.toString() + '!');\r\n\t\t\t}\r\n\t\t\tswitch(operator) {\r\n\t\t\t\tcase '+':\r\n\t\t\t\t\treturn currentTotal + val;\r\n\t\t\t\tcase '-':\r\n\t\t\t\t\treturn currentTotal - val;\r\n\t\t\t\tcase '*':\r\n\t\t\t\t\treturn currentTotal * val;\r\n\t\t\t\tcase '/':\r\n\t\t\t\t\treturn currentTotal / val;\r\n\t\t\t}\r\n\t\t}, this.val.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.val.toString(context)].concat(\r\n\t\t\tthis.exprs.map(expr => expr.operator + ' ' + expr.val.toString(context))\r\n\t\t).join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Math) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1 && parse.matches.length === parse.tokens.length - 1) {\r\n\t\t\tvar operators = _unique(parse.matches);\r\n\t\t\tif (_intersect(operators, Math.operators.sup).length && _intersect(operators, Math.operators.sub).length) {\r\n\t\t\t\tthrow new Error('\"Addition/subtraction\" and \"multiplication/division\" operators cannot be used in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(parse.tokens.shift().trim()),\r\n\t\t\t\tparse.tokens.map((expr, i) => {return {\r\n\t\t\t\t\toperator: parse.matches[i],\r\n\t\t\t\t\tval: parseCallback(expr.trim())\r\n\t\t\t\t};})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nMath.operators = {\r\n\tsup: ['*', '/'],\r\n\tsub: [' + ', ' - '],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Math;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * NumInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'NumberType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport NumInterface from './NumInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Num (number) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Num = class extends NumInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(int, dec = 0) {\r\n\t\tsuper();\r\n\t\tthis.int = int;\r\n\t\tthis.dec = dec;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn parseFloat(this.int + (this.dec ? '.' + this.dec : null));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.int + (this.dec ? '.' + this.dec : null);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Num) {\r\n\t\tif (_isNumeric(expr)) {\r\n\t\t\tvar expr = expr.split('.');\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseInt(expr.shift()),\r\n\t\t\t\tparseInt(expr.shift())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Num;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ObjInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ObjectType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport ObjInterface from './ObjInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Object utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Obj = class extends ObjInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries) {\r\n\t\tsuper();\r\n\t\tthis.entries = entries || {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ObjInterface) {\r\n\t\t\t_each(Super.entries, (name, val) => {\r\n\t\t\t\tif (!(name in this.entries)) {\r\n\t\t\t\t\tthis.entries[name] = val;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar items = {};\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\titems[key] = expr.eval(context, callback);\r\n\t\t});\r\n\t\treturn items;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar str = [];\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\tstr.push(key + Obj.operators.sub + expr.toString(context));\r\n\t\t});\r\n\t\treturn '{' + str.join(Obj.operators.sup) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Obj) {\r\n\t\tif (_wrapped(expr, '{', '}') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar entries = {};\r\n\t\t\tvar _entriesSplit = Lexer.split(_unwrap(expr, '{', '}'), [Obj.operators.sup])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n);\r\n\t\t\t_each(_entriesSplit, (key, expr) => {\r\n\t\t\t\tvar entry = Lexer.split(expr, [Obj.operators.sub], {limit:1}/*IMPORTANT*/);\r\n\t\t\t\tentries[_first(entry).trim()] = parseCallback(_last(entry).trim());\r\n\t\t\t});\r\n\t\t\treturn new Static(entries);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nObj.operators = {\r\n\tsup: ',',\r\n\tsub: ':',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Obj;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport ExprInterface from '../ExprInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Reference class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Reference = class extends ReferenceInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(context, name, backticks = false) {\r\n\t\tsuper();\r\n\t\tthis.context = context;\r\n\t\tthis.name = name;\r\n\t\tthis.backticks = backticks;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tgetEval(context = null, callback = null) {\r\n\t\tvar sourceContext = context, name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = name.eval(context, callback);\r\n\t\t\t}\r\n\t\t\tsourceContext = this.context.eval(context, callback);\r\n\t\t}\r\n\t\treturn {context:sourceContext, name:name,};\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar parts = this.getEval(context, callback);\r\n\t\tif (!_isUndefined(parts.context) && !_isUndefined(parts.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, parts.context, parts.name);\r\n\t\t\t}\r\n\t\t\treturn Contexts.create(parts.context).get(parts.name);\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tvar subjectContext = this.context.toString(context);\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = '[' + name.toString(context) + ']';\r\n\t\t\t} else if (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar subjectContext = context;\r\n\t\t\tif (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (subjectContext || '') + (subjectContext && !name.startsWith('[') ? Reference.separator : '') + name;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Reference) {\r\n\t\tif (!Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(expr, []);\r\n\t\t\t// ------------------------\r\n\t\t\t// name, first\r\n\t\t\t// ------------------------\r\n\t\t\tvar context, name = splits.pop(), backticks;\r\n\t\t\tvar nameSplit = Lexer.split(name.trim(), [Static.separator], {preserveDelims:true});\r\n\t\t\tif (nameSplit.length > 1) {\r\n\t\t\t\tname = nameSplit.pop().substr(1);\r\n\t\t\t\tsplits = splits.concat(nameSplit);\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '`', '`')) {\r\n\t\t\t\tname = _unwrap(name, '`', '`');\r\n\t\t\t\tbackticks = true;\r\n\t\t\t}\r\n\t\t\t// ------------------------\r\n\t\t\t// context, second\r\n\t\t\t// ------------------------\r\n\t\t\tif (splits.length) {\r\n\t\t\t\tcontext = parseCallback(splits.join(''));\r\n\t\t\t\tcontext.isContext = true;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '[', ']')) {\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Invalid reference: ' + expr + '!');\r\n\t\t\t\t}\r\n\t\t\t\tname = parseCallback(_unwrap(name, '[', ']'));\r\n\t\t\t}\r\n\t\t\treturn new Static(context, name, backticks);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop string\r\n */\r\nReference.separator = '.';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reference;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReturnInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ReturnDirective'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Ret (return) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Return = class extends ReturnInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr ? this.expr.eval(context, callback) : undefined;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.expr ? 'return ' + this.expr.toString(context) : 'return';\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Return) {\r\n\t\tvar exprLc = expr.toLowerCase();\r\n\t\tif (exprLc.startsWith('return ') || exprLc === 'return') {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(expr.substr(6).trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Return;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StatementsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Statements'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport StatementsInterface from './StatementsInterface.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Statements class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Statements = class extends StatementsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(stmts, delim) {\r\n\t\tsuper();\r\n\t\tthis.stmts = exprs;\r\n\t\tthis.delim = delim;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar exprs = [];\r\n\t\tfor (var i = 0; i < this.stmts.length; i ++) {\r\n\t\t\tif (this.stmts[i] instanceof ReturnInterface) {\r\n\t\t\t\treturn this.stmts[i].eval(context, callback);\r\n\t\t\t} else {\r\n\t\t\t\texprs[i] = this.stmts[i].eval(context, callback);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn exprs;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.stmts.map(expr => expr.toString(context)).join(this.delim);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Statements) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr)),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop array\r\n */\r\nStatements.operators = [\r\n\t';',\r\n\t\"\\r\\n\",\r\n];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Statements;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'StringType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport StrInterface from './StrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\nimport Bool from './Bool.js';\r\n\r\n/**\r\n * ---------------------------\r\n * String utils\r\n * ---------------------------\r\n */\r\n\r\nconst Str = class extends StrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr, quote) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t\tthis.quote = quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.expr;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.quote + this.expr + this.quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Str) {\r\n\t\texpr = expr.trim();\r\n\t\tif ((_wrapped(expr, '\"', '\"') || _wrapped(expr, \"'\", \"'\")) \r\n\t\t&& !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar quote = _wrapped(expr, '\"', '\"') ? '\"' : \"'\";\r\n\t\t\treturn new Static(\r\n\t\t\t\t_unwrap(expr, quote, quote),\r\n\t\t\t\tquote\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Str;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen from './Jsen.js';\r\nimport ExprInterface from './ExprInterface.js';\r\nimport Lexer from './Lexer.js';\r\nimport Contexts from './Contexts.js';\r\nimport Abstraction from './Expr/Abstraction.js';\r\nimport AbstractionInterface from './Expr/AbstractionInterface.js';\r\nimport Arr from './Expr/Arr.js';\r\nimport ArrInterface from './Expr/ArrInterface.js';\r\nimport Arguments from './Expr/Arguments.js';\r\nimport ArgumentsInterface from './Expr/ArgumentsInterface.js';\r\nimport Assertion from './Expr/Assertion.js';\r\nimport AssertionInterface from './Expr/AssertionInterface.js';\r\nimport Assignment from './Expr/Assignment.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport Bool from './Expr/Bool.js';\r\nimport BoolInterface from './Expr/BoolInterface.js';\r\nimport Call from './Expr/Call.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\nimport Comments from './Expr/Comments.js';\r\nimport CommentsInterface from './Expr/CommentsInterface.js';\r\nimport Comparison from './Expr/Comparison.js';\r\nimport ComparisonInterface from './Expr/ComparisonInterface.js';\r\nimport Condition from './Expr/Condition.js';\r\nimport ConditionInterface from './Expr/ConditionInterface.js';\r\nimport Deletion from './Expr/Deletion.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport Func from './Expr/Func.js';\r\nimport FuncInterface from './Expr/FuncInterface.js';\r\nimport Math from './Expr/Math.js';\r\nimport MathInterface from './Expr/MathInterface.js';\r\nimport Num from './Expr/Num.js';\r\nimport NumInterface from './Expr/NumInterface.js';\r\nimport Obj from './Expr/Obj.js';\r\nimport ObjInterface from './Expr/ObjInterface.js';\r\nimport Reference from './Expr/Reference.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport Return from './Expr/Return.js';\r\nimport ReturnInterface from './Expr/ReturnInterface.js';\r\nimport Statements from './Expr/Statements.js';\r\nimport StatementsInterface from './Expr/StatementsInterface.js';\r\nimport Str from './Expr/Str.js';\r\nimport StrInterface from './Expr/StrInterface.js';\r\n\r\n/**\r\n * @var object\r\n */\r\nJsen.grammars = {\r\n\tComments: Comments,\t\t\t// // single-line | /* double-line */\r\n\tReturn: Return,\t\t\t\t// return field1\r\n\tStatements: Statements,\t\t// field1 = 3; field2 = val2\r\n\tDeletion: Deletion,\t\t\t// delete field1\r\n\tAssignment: Assignment,\t\t// field1[key1].key2 = k\r\n\tFunc: Func,\t\t\t\t\t// (field1, field2) => {}\r\n\tAbstraction: Abstraction,\t// (field1)\r\n\tCondition: Condition,\t\t// field1 > field2 ? val1 : val2\r\n\tAssertion: Assertion,\t\t// !field1 && field2\r\n\tComparison: Comparison,\t\t// field1 > field2\r\n\tMath: Math,\t\t\t\t\t// field1 + field2\r\n\tArr: Arr,\t\t\t\t\t// [field1, field2]\r\n\tObj: Obj,\t\t\t\t\t// {field1:val1, field2:val2}\r\n\tNum: Num,\t\t\t\t\t// [0-9]\r\n\tStr: Str,\t\t\t\t\t// \"\"\r\n\tBool: Bool,\t\t\t\t\t// true\r\n\tCall: Call,\t\t\t\t\t// field1()\r\n\tReference: Reference,\t\t\t\t// field1\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tExprInterface,\r\n\tLexer,\r\n\tContexts\r\n};\r\nexport {\r\n\tAbstraction,\r\n\tArr,\r\n\tArguments,\r\n\tAssertion,\r\n\tAssignment,\r\n\tBool,\r\n\tCall,\r\n\tComments,\r\n\tComparison,\r\n\tCondition,\r\n\tDeletion,\r\n\tFunc,\r\n\tMath,\r\n\tNum,\r\n\tObj,\r\n\tReference,\r\n\tReturn,\r\n\tStr,\r\n\tStatements\r\n};\r\nexport {\r\n\tAbstractionInterface,\r\n\tArrInterface,\r\n\tArgumentsInterface,\r\n\tAssertionInterface,\r\n\tAssignmentInterface,\r\n\tBoolInterface,\r\n\tCallInterface,\r\n\tCommentsInterface,\r\n\tComparisonInterface,\r\n\tConditionInterface,\r\n\tDeletionInterface,\r\n\tFuncInterface,\r\n\tMathInterface,\r\n\tNumInterface,\r\n\tObjInterface,\r\n\tReferenceInterface,\r\n\tReturnInterface,\r\n\tStrInterface,\r\n\tStatementsInterface\r\n};\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Def = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(key, value, flag = null) {\r\n\t\tthis.key = key;\r\n\t\tthis.value = value;\r\n\t\tthis.flag = flag;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.key + ': ' + this.value + (this.flag ? ' ' + this.flag : '');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return Def\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tif (expr) {\r\n\t\t\tvar _opts = _copy(opts);\r\n\t\t\t_opts.limit = 1;\r\n\t\t\tvar defSplit = Lexer.split(expr, [':'], _opts);\r\n\t\t\tif (defSplit.length < 2) {\r\n\t\t\t\tthrow new Error('Malformed def: ' + expr);\r\n\t\t\t}\r\n\t\t\tvar key = defSplit.shift().trim();\r\n\t\t\tvar value, flag, vf = Lexer.split(defSplit.shift().trim(), [' '], opts);\r\n\t\t\tif (vf.length > 1) {\r\n\t\t\t\tif (Def.flags.includes(_last(vf).trim().toLowerCase())) {\r\n\t\t\t\t\tflag = vf.pop().trim().toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalue = vf.join(' ');\r\n\t\t\treturn new Def(key, value, flag);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nDef.flags = ['!replace', '!incase',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Def;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport Def from './Def.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefBlock = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries = []) {\r\n\t\t// We must add them through the door\r\n\t\tthis.entries = [];\r\n\t\tentries.forEach(entry => this.add(entry));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns valid entries.\r\n\t *\r\n\t * @param bool\t\twithDuplicates\r\n\t * @param bool\t\twithOverRidden\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfilter(withDuplicate = false, withOverRidden = false) {\r\n\t\treturn this.entries.filter(entry => (!entry.isDuplicate || withDuplicate) && (!entry.overridden || withOverRidden));\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\treturn this.filter(withDuplicate, withOverRidden).map(def => def.toString(context)).join('; ') + ';';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds an entry to the list with overRiding resolved.\r\n\t *\r\n\t * @param object\t\tentry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tadd(newDef) {\r\n\t\tif (!newDef.key || !newDef.value) {\r\n\t\t\tthrow new Error('Def must contain a valid key and value!');\r\n\t\t}\r\n\t\tif (!(newDef instanceof Def)) {\r\n\t\t\tnewDef = new Def(newDef.key, newDef.value, newDef.flag);\r\n\t\t}\r\n\t\tthis.entries.forEach(existingDef => {\r\n\t\t\tif (existingDef.isDuplicate || existingDef.overridden) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar key_a = existingDef.key.toString();\r\n\t\t\tvar value_a = existingDef.value.toString();\r\n\t\t\tvar value_aUnwrapped = _wrapped(value_a, '(', ')') ? _unwrap(value_a, '(', ')') : value_a;\r\n\t\t\tvar key_b = newDef.key.toString();\r\n\t\t\tvar value_b = newDef.value.toString();\r\n\t\t\tvar value_bUnwrapped = _wrapped(value_b, '(', ')') ? _unwrap(value_b, '(', ')') : value_b;\r\n\t\t\tvar incase_a = (existingDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_a = (existingDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tvar incase_b = (newDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_b = (newDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tif (key_a === key_b) {\r\n\t\t\t\tif ((value_a === value_b || value_aUnwrapped === value_bUnwrapped) \r\n\t\t\t\t&& (important_a === important_b || incase_a === incase_b)) {\r\n\t\t\t\t\tnewDef.isDuplicate = true;\r\n\t\t\t\t} else if (important_b || incase_a) {\r\n\t\t\t\t\texistingDef.overridden = true;\r\n\t\t\t\t} else if ((important_a || incase_b)) {\r\n\t\t\t\t\tnewDef.overridden = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.entries.push(newDef);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return DefBlock\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\treturn new DefBlock(\r\n\t\t\tLexer.split(expr, [';'], opts).filter(def => def.trim()).map(def => Def.parse(def.trim()))\r\n\t\t);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefBlock;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport DefBlock from './DefBlock.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefSheet = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(block = {}) {\r\n\t\tthis.block = {};\r\n\t\tthis.apply(block);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\tvar str = [];\r\n\t\t_each(this.block, (type, defBlock) => {\r\n\t\t\tstr.push('@' + type);\r\n\t\t\tstr.push('{' + defBlock.toString(context, withDuplicate, withOverRidden) + '}');\r\n\t\t});\r\n\t\treturn str.join(' ');\r\n\t}\r\n\t \r\n\t/**\r\n\t * Merges a DefSheet instance or a block of entries into the current instance.\r\n\t *\r\n\t * @param array|DefSheet\tdefSheet\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapply(defSheet) {\r\n\t\tvar block = defSheet;\r\n\t\tif (defSheet instanceof DefSheet) {\r\n\t\t\tblock = defSheet.block;\r\n\t\t} else if (!_isObject(defSheet)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an object or an instance of ./DefSheet!');\r\n\t\t}\r\n\t\t_each(block, (section, defBlock) => {\r\n\t\t\tthis.applyTo(section, defBlock);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * Adds entries to the list of entries for the given type.\r\n\t *\r\n\t * @param string\t\t\tsection\r\n\t * @param array|DefBlock\tdefBlock\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapplyTo(section, defBlock) {\r\n\t\tvar entries = defBlock;\r\n\t\tif (defBlock instanceof DefBlock) {\r\n\t\t\tentries = defBlock.entries;\r\n\t\t} else if (!_isArray(defBlock)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an array or an instance of ./DefBlock!');\r\n\t\t}\r\n\t\tif (!this.block[section]) {\r\n\t\t\tthis.block[section] = new DefBlock;\r\n\t\t}\r\n\t\tentries.forEach(entry => this.block[section].add(_copy(entry)));\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tvar splits = Lexer.split(expr, [], opts);\r\n\t\tvar type, expr, defBlock, block = {};\r\n\t\twhile ((type = splits.shift()) && (defBlock = splits.shift())) {\r\n\t\t\tblock[type.trim().toLowerCase().substr(1)] = DefBlock.parse(_unwrap(defBlock.trim(), '{', '}'), opts);\r\n\t\t}\r\n\t\treturn new DefSheet(block);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefSheet;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen, {\r\n\tArgumentsInterface,\r\n\tCallInterface,\r\n\tReferenceInterface,\r\n\tArguments,\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _getProxyTarget from '@onephrase/commons/js/getProxyTarget.js';\r\nimport _isProxy from '@onephrase/commons/js/isProxy.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport _after from '@onephrase/commons/str/after.js';\r\nimport Observable from '@onephrase/observable';\r\nimport Matrix from './Def/Matrix.js';\r\nimport DefSheet from './Def/DefSheet.js';\r\nimport DefBlock from './Def/DefBlock.js';\r\nimport Schema from './Schema.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst ChtmlCore = class extends Observable {\r\n\r\n\t/**\r\n\t * Initializes the new Chtml instance.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper({}, params);\r\n\t\t// -----------------------------\r\n\t\t// ROOT RESOLUTION:\r\n\t\t// -----------------------------\r\n\t\tthis.root = this.el = el;\r\n\t\tif (el.nodeName === '#document') {\r\n\t\t\tthis.el = el.querySelector('html');\r\n\t\t} else if (!(el instanceof HTMLElement)) {\r\n\t\t\tthrow new Error('Argument #1 must be instanceof of HTMLElement or the document object!');\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// BINDINGS/DIRECTIVES\r\n\t\t// -----------------------------\r\n\t\t// The parsed namespace ($ns)\r\n\t\tthis.$.ns = ChtmlCore.parseNamespace(this.el);\r\n\t\t// The parsed Cascaded Definition Sheet ($defs)\r\n\t\tthis.$.defs = ChtmlCore.parseCascadedDefSheet(this.el);\r\n\t\t// Initialize...\r\n\t\tthis.init();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Executes one-off initialization directives.\r\n\t *\r\n\t * Then executes reactive bindings and keeps them bound.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinit() {\r\n\t\t// -----------------------\r\n\t\t// Free the instance first...\r\n\t\tthis.free(false);\r\n\t\t// -----------------------\r\n\t\t// One-off init\r\n\t\tthis.getCpsBlock('init', true/*asDirectives*/).forEach(directive => directive.eval(this));\r\n\t\t// -----------------------\r\n\t\t// Reactive bindings\r\n\t\tthis.$.bindingsListeners = [];\r\n\t\t// Apply bindings...\r\n\t\tvar stringifyEach = list => _unique(list.map(expr => _before(_before(expr.toString(), '['), '(')));\r\n\t\tthis.getCpsBlock('directives', true/*asDirectives*/).forEach(binding => {\r\n\t\t\tif (!this.$.params.observeOnly) {\r\n\t\t\t\tbinding.eval(this);\r\n\t\t\t}\r\n\t\t\t// We'll execute binding on the appriopriate changes\r\n\t\t\tvar listenerObj = this.observe(stringifyEach(binding.meta.vars), (newState, oldState, params) => {\r\n\t\t\t\t// Next eval() should be triggered by only the changes in the vars that participated in this eval()\r\n\t\t\t\tvar evalReturn = binding.eval(this);\r\n\t\t\t\t// If the result of this evaluation is false,\r\n\t\t\t\t// e.stopPropagation will be called and subsequent expressions\r\n\t\t\t\t// will not be evaluated. So we must not allow false to be returned.\r\n\t\t\t\t// All expressions are meant to be evaluated in parallel, independent of each other.\r\n\t\t\t\tif (evalReturn !== false) {\r\n\t\t\t\t\treturn evalReturn;\r\n\t\t\t\t}\r\n\t\t\t}, {diff: this.$.params.diff});\r\n\t\t\tthis.$.bindingsListeners.push(listenerObj);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Frees the instance of either observed bindings\r\n\t * or entire available listeners.\r\n\t *\r\n\t * @param bool\t\t\t\t\tall\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tfree(all = true) {\r\n\t\tif (all) {\r\n\t\t\t// Remove all available listeners\r\n\t\t\tsuper.removeListener();\r\n\t\t} else if (this.$.bindingsListeners) {\r\n\t\t\t// Remove all observed bindings\r\n\t\t\tthis.$.bindingsListeners.forEach(listener => listener.remove());\r\n\t\t\tthis.$.bindingsListeners.splice();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Clones the instance using a serialize/deserialize strategy.\r\n\t *\r\n\t * @param bool\t \t\tcleanCopy\r\n\t *\r\n\t * @return ChtmlInterface\r\n\t */\r\n\tclone(cleanCopy = true) {\r\n\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t}\r\n\t\tvar el = this.el.cloneNode(true);\r\n\t\t// -------------------------------\r\n\t\t// We'll remove all aprsable components of the element\r\n\t\t// as we already have the most accurate available\r\n\t\t// -------------------------------\r\n\t\tvar attrCache = {};\r\n\t\tChtmlCore.paramsAttrs.map(attr => ChtmlCore.attributeMap[attr]).forEach(type => {\r\n\t\t\tvar attrValue;\r\n\t\t\tif (attrValue = el.getAttribute(type)) {\r\n\t\t\t\tattrCache.type = attrValue;\r\n\t\t\t\tel.removeAttribute(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar dataBlockScript;\r\n\t\tif (dataBlockScript = _arrFrom(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0]) {\r\n\t\t\tdataBlockScript.remove();\r\n\t\t}\r\n\t\t// -------------------------------\r\n\t\t// Instantiate now...\r\n\t\t// -------------------------------\r\n\t\tvar instance = this.$.params.componentCallback(el, this.$.params, false/*resolveInheritance*/);\r\n\t\tvar _instance = _isProxy(instance) ? _getProxyTarget(instance) : instance;\r\n\t\t// Serialize/deserialize definitions\r\n\t\t_instance.$defs = DefSheet.parse(this.$.defs.toString(null/*context*/, !cleanCopy/*withDuplicate*/, true/*withOverRidden*/));\r\n\t\t// -------------------------------\r\n\t\t// Restore parsable components of the element just for the records\r\n\t\t// -------------------------------\r\n\t\t_each(attrCache, (type, attrValue) => {\r\n\t\t\tel.setAttribute(type, attrValue);\r\n\t\t});\r\n\t\tif (dataBlockScript) {\r\n\t\t\tel.prepend(dataBlockScript);\r\n\t\t}\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evalutes the bindings for the component;\r\n\t * caches the result for subsequent calls.\r\n\t *\r\n\t * @param string\t\tkey\r\n\t * @param bool\t\t\tasDirectives\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCpsBlock(key, asDirectives = false) {\r\n\t\tvar cpsBlockDefs = this.$.defs.block[key] ? this.$.defs.block[key].filter() : [];\r\n\t\tif (asDirectives) {\r\n\t\t\tvar directives = [];\r\n\t\t\tcpsBlockDefs.forEach(def => {\r\n\t\t\t\tvar argsExpr = (this.$.params.chainableDirectives === false || !def.value.trim().startsWith('(') ? [def.value] : Lexer.split(def.value, ['.']))\r\n\t\t\t\t\t.map(expr => Jsen.parse(expr, [Arguments], {assert:false}) || Jsen.parse(expr));\r\n\t\t\t\tif (argsExpr.length !== argsExpr.filter(a => a).length) {\r\n\t\t\t\t\tthis.error('Malformed argument in the CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar directive, _directive = def.key + (argsExpr.length > 1 || argsExpr[0] instanceof ArgumentsInterface ? argsExpr.join('.') : '(' + argsExpr[0].toString() + ')');\r\n\t\t\t\tif (!(directive = Jsen.parse(_directive, null, {explain: this.$.params.explainJsen}))) {\r\n\t\t\t\t\tthis.error('Malformed CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdirectives.push(directive);\r\n\t\t\t});\r\n\t\t\treturn directives;\r\n\t\t}\r\n\t\treturn cpsBlockDefs;\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to resolve a node as related node.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|ChtmlInterface\r\n\t */\r\n\tgetRelatedNode(requestNodeName) {\r\n\t\tvar computeQuery, node;\r\n\t\tif (!this.computedRelated) {\r\n\t\t\tthis.computedRelated = {};\r\n\t\t\tthis.getCpsBlock('related', false/*asDirectives*/).forEach(entry => {\r\n\t\t\t\tthis.computedRelated[entry.key] = Jsen.parse(entry.value);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif ((computeQuery = this.computedRelated[requestNodeName]) \r\n\t\t&& (node = computeQuery.eval(this))) {\r\n\t\t\tif (_isFunction(node)) {\r\n\t\t\t\tnode = node(this.el, requestNodeName);\r\n\t\t\t\tif (!_isString(node) && !(node instanceof HTMLElement)) {\r\n\t\t\t\t\tthrow new Error('The callback for node \"' + requestNodeName + '\" returned an invalid type.');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (_isString(node)) {\r\n\t\t\t\t// Markup or plain selector string....\r\n\t\t\t\tnode = ChtmlCore.toElement(node);\r\n\t\t\t}\r\n\t\t\tif (!(node instanceof HTMLElement)) {\r\n\t\t\t\tthrow new Error('\"' + requestNodeName + '\" could not be resolved to a valid node instance.');\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from explicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tgetExplicitNode(requestNodeName) {\r\n\t\t// If given a rolecase, we can perform a query if we understand the semantics.\r\n\t\tif ((this.$.roles && this.$.roles.length)\r\n\t\t|| (this.$.roles = (this.el.getAttribute(ChtmlCore.attributeMap.superrole) || '').replace('  ', ' ').split(' ')).length) {\r\n\t\t\tvar roles = this.$.params.rolecase ? [this.$.params.rolecase] : this.$.roles;\r\n\t\t\t// Find matches...\r\n\t\t\treturn roles.reduce((matchedNode, role) => {\r\n\t\t\t\tif (!matchedNode) {\r\n\t\t\t\t\tvar closestSuperSelector = '[' + CSS.escape(ChtmlCore.attributeMap.superrole) + '~=\"' + role + '\"]';\r\n\t\t\t\t\tvar nodeSelector = '[' + CSS.escape(ChtmlCore.attributeMap.subrole) + '~=\"' + role + '-' + requestNodeName + '\"]';\r\n\t\t\t\t\tvar closestSuper, _matchedNode;\r\n\t\t\t\t\tif ((_matchedNode = (this.el.shadowRoot || this.el).querySelector(nodeSelector))\r\n\t\t\t\t\t// If this.el has a shadowRoot, we don't expect _matchedNode to be able to find is superRole element.\r\n\t\t\t\t\t// If it finds one, then its not for the curren superRole element.\r\n\t\t\t\t\t&& ((this.el.shadowRoot && !(_matchedNode.parentNode.closest && _matchedNode.parentNode.closest(closestSuperSelector)))\r\n\t\t\t\t\t// _matchedNode must find this.el as its superRole element to qualify.\r\n\t\t\t\t\t\t|| (!this.el.shadowRoot && _matchedNode.parentNode && (closestSuper = _matchedNode.parentNode.closest(closestSuperSelector)) && closestSuper.isSameNode(this.el))\r\n\t\t\t\t\t)) {\r\n\t\t\t\t\t\tmatchedNode = _matchedNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn matchedNode;\r\n\t\t\t}, null);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from implicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|array\r\n\t */\r\n\tgetImplicitNode(requestNodeName) {\r\n\t\tif (requestNodeName.match(/[^a-zA-Z0-9\\-]/)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Use schema...\r\n\t\tvar nodeSchema, nodeSelector = [];\r\n\t\tvar tries = [];\r\n\t\tif (ChtmlCore.schema.aria[requestNodeName]) {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: ['[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.std[requestNodeName] || ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: [requestNodeName, '[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t}\r\n\t\t_each(ChtmlCore.schema.std, (tagname, schema) => {\r\n\t\t\tif (schema.implicitRole === requestNodeName) {\r\n\t\t\t\ttries.push({\r\n\t\t\t\t\tschema: schema,\r\n\t\t\t\t\tselector: [tagname],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar matches = null;\r\n\t\ttries.forEach(trie => {\r\n\t\t\t(this.el.shadowRoot || this.el).querySelectorAll(trie.selector.join(',')).forEach(node => {\r\n\t\t\t\tif (ChtmlCore.schema.assertNodeBelongsInScopeAs(this.el, node, trie.schema)) {\r\n\t\t\t\t\tif (trie.schema && trie.schema.singleton) {\r\n\t\t\t\t\t\tmatches = node;\r\n\t\t\t\t\t} else if (!matches || _isArray(matches)) {\r\n\t\t\t\t\t\tmatches = matches || [];\r\n\t\t\t\t\t\tmatches.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Makes a node object following the nodeCallback rules\r\n\t * for the instance.\r\n\t *\r\n\t * @param string|int\t nodeName\r\n\t * @param mixed\t\t\t node\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tcreateNode(nodeName, node) {\r\n\t\tvar _node = node;\r\n\t\tif (this.$.params.drilldown) {\r\n\t\t\tif (node === this.root || node === this.el) {\r\n\t\t\t\tnode = this;\r\n\t\t\t} else if (node) {\r\n\t\t\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t\t\t}\r\n\t\t\t\tvar params = _copy(this.$.params);\r\n\t\t\t\tparams.alias = nodeName;\r\n\t\t\t\tnode = _isArray(node) \r\n\t\t\t\t\t? node.map(node => this.$.params.componentCallback(node, params, true/*resolveInheritance*/)) \r\n\t\t\t\t\t: this.$.params.componentCallback(node, params, true/*resolveInheritance*/);\r\n\t\t\t}\r\n\t\t} else if (_isFunction(this.$.params.nodeCallback)) {\r\n\t\t\tnode = _isArray(node) \r\n\t\t\t\t? node.map(node => this.$.params.nodeCallback(node)) \r\n\t\t\t\t: this.$.params.nodeCallback(node);\r\n\t\t}\r\n\t\tthis.set(nodeName, node);\r\n\t\tif (_node && _node !== this.root && _node !== this.el && !_isArray(_node)) {\r\n\t\t\tChtmlCore.disconnectedCallback(_node, () => {\r\n\t\t\t\tthis.del(nodeName);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn node;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds a node by name; caches result.\r\n\t *\r\n\t * @param string \t\tnodeName\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(nodeName) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(nodeName);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tvar node;\r\n\t\tif (nodeName === '_') {\r\n\t\t\treturn this.getOffsetParent();\r\n\t\t}\r\n\t\tif ((nodeName === 'root' && (node = this.root)) \r\n\t\t|| (nodeName === 'el' && (node = this.el))) {\r\n\t\t\treturn _isFunction(this.$.params.nodeCallback) \r\n\t\t\t\t? this.$.params.nodeCallback(node) \r\n\t\t\t\t: node;\r\n\t\t}\r\n\t\tif (!(nodeName in this.$.state)) {\r\n\t\t\tif ((node = this.getRelatedNode(nodeName))\r\n\t\t\t|| (!this.$.params.implicitOnly && (node = this.getExplicitNode(nodeName)))\r\n\t\t\t|| (!this.$.params.explicitOnly && (node = this.getImplicitNode(nodeName)))) {\r\n\t\t\t\tthis.createNode(nodeName, node);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.$.state[nodeName];\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * UTILITY METHODS\r\n\t * -------------------\r\n\t */\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML namespace.\r\n\t * This explains how an element's namespace is used in CHTML.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseNamespace(el) {\r\n\t\tvar namespaceParse = {roadmap: el.getAttribute(ChtmlCore.attributeMap.ns)};\r\n\t\tif (namespaceParse.roadmap) {\r\n\t\t\tnamespaceParse.namespace = _before(namespaceParse.roadmap, '//');\r\n\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.roadmap, '//');\r\n\t\t\t// In case this is the /// spot...\r\n\t\t\tif (namespaceParse.subnamespace.startsWith('/')) {\r\n\t\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.subnamespace, '/');\r\n\t\t\t}\r\n\t\t\tif (namespaceParse.subnamespace.endsWith('//') && namespaceParse.subnamespace.indexOf('///') === -1) {\r\n\t\t\t\tnamespaceParse.subnamespace = namespaceParse.subnamespace + namespaceParse.namespace + '//';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn namespaceParse;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML definitions (related, bindings)\r\n\t * both from attributes and from an embedded script data block.\r\n\t *\r\n\t * Where both attributes and data block are set, definitions in attributes inherit from those in data block.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return DefSheet\r\n\t */\r\n\tstatic parseCascadedDefSheet(el) {\r\n\t\tvar dataBlockScript, defsheet;\r\n\t\tif (!(dataBlockScript = _arrFrom(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0])\r\n\t\t|| !(defsheet = DefSheet.parse((dataBlockScript.textContent || '').trim()))) {\r\n\t\t\tdefsheet = new DefSheet;\r\n\t\t}\r\n\t\tvar attr, defBlock;\r\n\t\tChtmlCore.paramsAttrs.forEach(type => {\r\n\t\t\tif ((attr = el.getAttribute(ChtmlCore.attributeMap[type])) && (defBlock = DefBlock.parse(attr))) {\r\n\t\t\t\tdefsheet.applyTo(type, defBlock);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn defsheet;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Composes a component from a super component.\r\n\t *\r\n\t * All definitions (related, directives) will be inherited.\r\n\t * If the idea is to import, the super component's element will be returned,\r\n\t * (On import, nodes in component (as defined, if) will be uploaded into slots in the super component.)\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recompose(elTo, elFrom) {\r\n\t\tif (elTo.matches(ChtmlCore.elementMap.import)) {\r\n\t\t\telFrom = elFrom.cloneNode(true);\r\n\t\t\tvar elToNs = elTo.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromNs = elFrom.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromRoles = (elFrom.getAttribute(ChtmlCore.attributeMap.superrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t// -------------------------\r\n\t\t\t// So we concat() the role attribute\r\n\t\t\t// -------------------------\r\n\t\t\telFrom.setAttribute(ChtmlCore.attributeMap.ns, elToNs);\r\n\t\t\t// We will prepend defs from the elTo into elFrom\r\n\t\t\tChtmlCore.recomposeDefs(elFrom, elTo, 'append');\r\n\t\t\t// -------------------------\r\n\t\t\t// Upload nodes into elFrom just the way slots work in Web Compoonents\r\n\t\t\t// -------------------------\r\n\t\t\t_arrFrom((elTo.shadowRoot || elTo).children).forEach((replacementNode, i) => {\r\n\t\t\t\tif (replacementNode.matches(ChtmlCore.elementMap.defsheet)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treplacementNode = replacementNode.cloneNode(true);\r\n\t\t\t\tvar applicableContextRoles = [], applicableReplacementNodeRoles = [];\r\n\t\t\t\tvar replacementNodeRoles = (replacementNode.getAttribute(ChtmlCore.attributeMap.subrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t\treplacementNodeRoles.forEach(replacementNodeRole => {\r\n\t\t\t\t\tvar _applicableContextRoles = elFromRoles.filter(contextRole => replacementNodeRole.startsWith(contextRole + '-'));\r\n\t\t\t\t\tif (_applicableContextRoles.length) {\r\n\t\t\t\t\t\tapplicableContextRoles.push(_applicableContextRoles[0]);\r\n\t\t\t\t\t\tapplicableReplacementNodeRoles.push(replacementNodeRole);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (applicableContextRoles.length) {\r\n\t\t\t\t\tvar slotNodes;\r\n\t\t\t\t\tvar contextSelector = applicableContextRoles.map(contextRole => '[' + CSS.escape(ChtmlCore.attributeMap.superrole) + '~=\"' + contextRole + '\"]');\r\n\t\t\t\t\tvar slotNodeSelector = applicableReplacementNodeRoles.map(replacementNodeRole => '[' + CSS.escape(ChtmlCore.attributeMap.subrole) + '~=\"' + replacementNodeRole + '\"]');\r\n\t\t\t\t\tif ((elFrom.shadowRoot && (slotNodes = elFrom.shadowRoot.querySelectorAll(slotNodeSelector)))\r\n\t\t\t\t\t|| ((slotNodes = elFrom.querySelectorAll(slotNodeSelector)).length === 1 && slotNodes[0].closest(contextSelector) === elFrom)) {\r\n\t\t\t\t\t\t// We will prepend defs from the slot node into replacement node\r\n\t\t\t\t\t\tChtmlCore.recomposeDefs(replacementNode, slotNodes[0], 'prepend');\r\n\t\t\t\t\t\t// Port to target...\r\n\t\t\t\t\t\tslotNodes[0].replaceWith(replacementNode);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error('Composition Error: Node #' + i + ' (at ' + elToNs + ') must match exactly one targetNode in ' + elFromNs + '! (' + slotNodes.length + ' matched)');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\telFrom.append(replacementNode);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn elFrom;\r\n\t\t}\r\n\t\t// We will append defs from the elFrom into elTo\r\n\t\tChtmlCore.recomposeDefs(elTo, elFrom, 'prepend');\r\n\t\treturn elTo;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Composes definitions (related, directives) from elFrom into elTo.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t * @param string\t\t\t\t\tappendOrPrepend\r\n\t * @param array\t\t\t\t\t\tnorecompose\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recomposeDefs(elTo, elFrom, appendOrPrepend, norecompose = []) {\r\n\t\tnorecompose = norecompose.concat([ChtmlCore.attributeMap.ns, ...ChtmlCore.attributeMap.nocompose]);\r\n\t\tif (elTo.hasAttribute('norecompose')) {\r\n\t\t\tnorecompose = norecompose.concat((elTo.getAttribute('norecompose') || '*').split(' ').map(val => val.trim()));\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Custom Composition...\r\n\t\t// ----------------------------\r\n\t\tif (_isFunction(ChtmlCore.recomposeCallback)) {\r\n\t\t\tvar disposition = ChtmlCore.recomposeCallback(elTo, elFrom, appendOrPrepend, norecompose);\r\n\t\t\tif (disposition === false) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (_isString(disposition) || _isArray(disposition)) {\r\n\t\t\t\tnorecompose = norecompose.concat(disposition);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Merge list attributes...\r\n\t\t// ----------------------------\r\n\t\t_unique([ChtmlCore.attributeMap.superrole, ChtmlCore.attributeMap.subrole, 'role', 'class']).forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointList = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointList = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, _unique(jointList.join(' ').split(' ').map(r => r.trim())).join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Merge definition attributes...\r\n\t\t// ----------------------------\r\n\t\tChtmlCore.paramsAttrs.map(attr => ChtmlCore.attributeMap[attr]).concat('style').forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointDefs = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t\tif (!jointDefs[0].trim().endsWith(';')) {\r\n\t\t\t\t\t\tjointDefs[0] = jointDefs[0] + ';';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointDefs = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, jointDefs.join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Port all other attributes...\r\n\t\t// ----------------------------\r\n\t\tfor (var i = 0; i < elFrom.attributes.length; i ++) {\r\n\t\t\tvar attr = elFrom.attributes[i];\r\n\t\t\tif (!norecompose.includes(attr.name) && !norecompose.includes('*') && !elTo.hasAttribute(attr.name)) {\r\n\t\t\t\telTo.setAttribute(attr.name, attr.value);\r\n\t\t\t\tnorecompose.push(attr.name);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// For data blocks...\r\n\t\t// ----------------------------\r\n\t\tif (!norecompose.includes('@cps') && !norecompose.includes('*')) {\r\n\t\t\tvar elToDefs = _arrFrom((elTo.shadowRoot || elTo).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tvar elFromDefs = _arrFrom((elFrom.shadowRoot || elFrom).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tif (elFromDefs.length) {\r\n\t\t\t\tif (elToDefs.length) {\r\n\t\t\t\t\telToDefs[0][appendOrPrepend](elFromDefs[0].textContent);\r\n\t\t\t\t} else {\r\n\t\t\t\t\telTo.prepend(elFromDefs[0].cloneNode(true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic toElement(input) {\r\n\t\tif (ChtmlCore.ctxt.document) {\r\n\t\t\tvar el;\r\n\t\t\tif (input.trim().startsWith('<')) {\r\n\t\t\t\t// Create a node from markup\r\n\t\t\t\tvar temp = ChtmlCore.ctxt.document.createElement('div');\r\n\t\t\t\ttemp.innerHtml = input;\r\n\t\t\t\tel = temp.firstChild;\r\n\t\t\t} else {\r\n\t\t\t\tel = ChtmlCore.ctxt.document.querySelector(input);\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t * @param function\t\t\t\t\tcallback\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic disconnectedCallback(el, callback) {\r\n\t\tif (el.parentNode) {\r\n\t\t\tvar called = false;\r\n\t\t\tvar observer = new MutationObserver(mutations => {\r\n\t\t\t\tmutations.forEach(m => {\r\n\t\t\t\t\tif (!called && _arrFrom(m.removedNodes).includes(el)) {\r\n\t\t\t\t\t\tcalled = true;\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tobserver.observe(el.parentNode, {childList:true});\r\n\t\t\tChtmlCore.disconnectedCallback(el.parentNode, () => {\r\n\t\t\t\tif (!called) {\r\n\t\t\t\t\tcalled = true;\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.ctxt = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.schema = Schema;\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.elementMap = {\r\n\tdefsheet: 'script[type=\"text/jsen-p\"]',\r\n\tbundle: 'chtml-bundle',\r\n\timport: 'chtml-import',\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.attributeMap = {\r\n\t// paramsAttrs\r\n\trelated: 'chtml-related',\r\n\tdirectives: 'chtml-directives',\r\n\t// structuralAttrs\r\n\tns: 'chtml-ns',\r\n\tsuperrole: 'chtml-role',\r\n\tsubrole: 'chtml-role',\r\n\t// other\r\n\tnocompose: ['nocompose', 'shadow',],\r\n};\r\n\r\n/**\r\n * @var array\r\n */\r\nChtmlCore.paramsAttrs = [\r\n\t'related', \r\n\t'directives',\r\n];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default ChtmlCore;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mixin from '@onephrase/commons/js/mixin.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isNumber from '@onephrase/commons/js/isNumber.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isObservable from '@onephrase/commons/js/isObservable.js';\r\nimport _getProxyTarget from '@onephrase/commons/js/getProxyTarget.js';\r\nimport _isProxy from '@onephrase/commons/js/isProxy.js';\r\nimport _all from '@onephrase/commons/arr/all.js';\r\nimport _following from '@onephrase/commons/arr/following.js';\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport _beforeLast from '@onephrase/commons/str/beforeLast.js';\r\nimport _closest from '@onephrase/commons/num/closest.js';\r\nimport _inherit from '@onephrase/commons/obj/inherit.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Chtml = class extends ChtmlCore {\r\n\r\n\t/**\r\n\t * Constructs a new Chtml and optionally returns a proxy wrapper.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper(el, _inherit({}, params, Chtml.params));\r\n\t\t// -----------------------------\r\n\t\t// OBSERVABILITY\r\n\t\t// -----------------------------\r\n\t\t// Bind populable context\r\n\t\tthis.observe(this.$.params.dataKey, (context, _context) => {\r\n\t\t\tif (this.$.ns.subnamespace && !_isString(context) && !_isNumber(context) && !_isUndefined(context)) {\r\n\t\t\t\t// Initial Sync...\r\n\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback);\r\n\t\t\t\t// Reactive Sync?\r\n\t\t\t\tif (_isObservable(context)) {\r\n\t\t\t\t\tcontext.observe(changes => {\r\n\t\t\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback, Object.keys(changes));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) context object or logical object to the instance.\r\n\t *\r\n\t * @param object \t\tcontext\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tbind(context) {\r\n\t\tthis.set(this.$.params.dataKey, context);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) list context to the instance.\r\n\t * Childnodes will be automatically created/removed per key.\r\n\t *\r\n\t * @param array \t\tlistContext\r\n\t * @param string \t\tsubnamespace\r\n\t * @param function \t\titemCallback\r\n\t * @param array \t\tonlyKeys\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tpopulate(listContext, subnamespace, itemCallback = null, onlyKeys = []) {\r\n\t\tif (_isObservable(listContext) && !_isProxy(listContext)) {\r\n\t\t\tlistContext = listContext.proxy();\r\n\t\t}\r\n\t\t(arguments.length > 3 ? onlyKeys : Object.keys(listContext)).forEach(k => {\r\n\t\t\tk = _isNumeric(k) ? parseInt(k) : k;\r\n\t\t\tvar item = this.has(k) ? this.get(k) : null;\r\n\t\t\tif (!_isUndefined(listContext[k])) {\r\n\t\t\t\tvar isNewItem = false;\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\tvar itemNamespaceArray = subnamespace.split('//');\r\n\t\t\t\t\t// Create a namespace hash...\r\n\t\t\t\t\titemNamespaceArray[0] += '/' + k;\r\n\t\t\t\t\tvar itemEl = Chtml.import(itemNamespaceArray.join('//'));\r\n\t\t\t\t\tif (itemEl) {\r\n\t\t\t\t\t\tvar following = _following(Object.keys(listContext), k + ''/*numeric k needs this*/, true/*length*/)\r\n\t\t\t\t\t\t\t.reduce((closest, _k) => closest || (this.has(_k) ? this.get(_k) : null), null);\r\n\t\t\t\t\t\tif (following) {\r\n\t\t\t\t\t\t\tfollowing.el.before(itemEl);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.el.append(itemEl);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem = this.createNode(k, itemEl);\r\n\t\t\t\t\t\tisNewItem = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (item) {\r\n\t\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\t\titemCallback(item, listContext[k], k, isNewItem);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.bind(listContext[k]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (item) {\r\n\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\tvar unbindReturn = itemCallback(item, false, k);\r\n\t\t\t\t\tif (('Promise' in ChtmlCore.ctxt) && unbindReturn instanceof ChtmlCore.ctxt.Promise) {\r\n\t\t\t\t\t\tunbindReturn.then(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.free();\r\n\t\t\t\t\titem.el.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * INSTANCE-RELATED METHODS\r\n\t * -------------------\r\n\t */\r\n\r\n\t/**\r\n\t * Creates a Chtml over a root resolved from definition or markup string.\r\n\t *\r\n\t * @param string|document|HTMLElement\tinput\r\n\t * @param object\t\t\t\t\t\tparams\r\n\t * @param bool\t\t\t\t\t\t\tresolveInheritance\r\n\t * @param object\t\t\t\t\t\tStatic\r\n\t *\r\n\t * @return Chtml\r\n\t */\r\n\tstatic from(input, params = {}, resolveInheritance = true, Static = Chtml) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve element from input\r\n\t\t// -----------------------------\r\n\t\tvar el = input;\r\n\t\tif (_isString(input) && !input.trim().startsWith('<') && input.indexOf('/') !== -1) {\r\n\t\t\tif (!ChtmlCore.bundles || !(el = Chtml.import(_before(input, '//')))) {\r\n\t\t\t\tthrow new Error('No element found on the namespace \"' + input + '\"!');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (_isString(input)) {\r\n\t\t\t\tif (!(el = ChtmlCore.toElement(input))) {\r\n\t\t\t\t\tthrow new Error('Could not resolve the string \"' +input + '\" to an element!');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (resolveInheritance && ChtmlCore.bundles) {\r\n\t\t\t\tvar ns, superNs, superEl, isImport = el.matches(ChtmlCore.elementMap.import);\r\n\t\t\t\tif ((ns = _before(el.getAttribute(ChtmlCore.attributeMap.ns) || '', '//'))\r\n\t\t\t\t// The entire namespace is used for elements of type import.\r\n\t\t\t\t// The supernamespace is used for normal elements\r\n\t\t\t\t&& ((isImport && (superNs = ns)) || (superNs = _beforeLast(ns, '/')) && superNs.indexOf('/') > -1)\r\n\t\t\t\t&& (superEl = Chtml.import(superNs))) {\r\n\t\t\t\t\tvar _el = el;\r\n\t\t\t\t\tel = ChtmlCore.recompose(el, superEl);\r\n\t\t\t\t\tif (isImport) {\r\n\t\t\t\t\t\t_el.replaceWith(el);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (ns) {\r\n\t\t\t\t\tconsole.warn('Namespace resolution failed: ' + ns);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn new Static(el, params);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Imports a module from bundles.\r\n\t *\r\n\t * @param string\t\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic import(namespace) {\r\n\t\treturn ChtmlCore.bundles.find(namespace);\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtml.params = {\r\n\tdiff: true,\r\n\tdataKey: '$',\r\n\tdrilldown: false,\r\n\tnodeCallback: null,\r\n\tcomponentCallback: Chtml.from,\r\n\tobserveOnly: false,\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Chtml;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '../js/isUndefined.js';\r\n\r\n/**\r\n * 1. Returns the ENTRY following (either the FIRST or the LAST instance of) the reference.\r\n * 2. Returns A NUMBER OF ENTRIES counting forwards from (either the FIRST or the LAST instance of) the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, reference, length = false, rotate = false, lastReference = false) {\r\n\tif (arr.indexOf(reference) === -1) {\r\n\t\treturn length ? [] : undefined;\r\n\t}\r\n\tvar amount = length === true ? arr.length - 1 : (length === false ? 1 : length);\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1;\r\n\tvar after = !_isUndefined(reference) ? arr.slice(from, from + amount) : [];\r\n\tif (rotate && after.length < amount && after.length < arr.length) {\r\n\t\tafter = after.concat(arr.slice(0, amount - after.length));\r\n\t};\r\n\treturn length ? after : after[0];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport Schema from './Schema.js';\r\nimport Matrix from './Def/Matrix.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\nimport Chtml from './Chtml.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Configure CHTM with\r\n * a global document.\r\n */\r\nChtmlCore.ctxt = window;\r\n\r\n/**\r\n * Create a \"ready\" construct that\r\n * init-related functionality can leverage.\r\n */\r\nvar contentLoadedPromise = new Promise(resolve => {\r\n\tif (document.readyState === 'complete') {\r\n\t\tresolve(); return;\r\n\t}\r\n\tdocument.addEventListener('DOMContentLoaded', resolve, false);\r\n\twindow.addEventListener('load', resolve, false);\r\n});\r\n// ------------------------------------\r\nChtmlCore.ready = (callback, waitForBundles = true) => {\r\n\tcontentLoadedPromise.then(() => {\r\n\t\tif (!waitForBundles) {\r\n\t\t\tcallback(); return;\r\n\t\t}\r\n\t\tChtmlCore.initObj.loadingBundlesPromise.then(callback);\r\n\t});\r\n};\r\n\r\n/**\r\n * Create an initialization object that all\r\n * init-related functionality can build on.\r\n */\r\ncontentLoadedPromise.then(() => {\r\n\t// ------------------------------------\r\n\tChtmlCore.initObj = (() => {\r\n\t\tvar bundles = _arrFrom(document.querySelectorAll('template[is=\"' + ChtmlCore.elementMap.bundle + '\"]')).reverse();\r\n\t\tvar remoteBundles = bundles.filter(b => b.hasAttribute('src') && !b.content.children.length);\r\n\t\tvar loadingBundles = remoteBundles.map(b => new Promise(resolve => {\r\n\t\t\tb.addEventListener('bundleloadsuccess', resolve);\r\n\t\t\tb.addEventListener('bundleloaderror', resolve);\r\n\t\t}));\r\n\t\tvar loadingBundlesPromise = Promise.all(loadingBundles).then(() => {\r\n\t\t\tloadingBundles.splice(0);\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tcontentLoadedPromise,\r\n\t\t\tloadingBundlesPromise,\r\n\t\t\tbundles,\r\n\t\t\tremoteBundles,\r\n\t\t\tloadingBundles\r\n\t\t};\r\n\t})();\r\n\t// ------------------------------------\r\n\t// Configure CHTM with bundle sources.\r\n\t// ------------------------------------\r\n\tvar warnedEarlyBundleAccess;\r\n\tvar anticyclicBundlesQuery = [];\r\n\tChtmlCore.bundles = new Matrix(ChtmlCore.initObj.bundles/*sources*/, []/*namespace*/, (bundle, namespace, superEl, bundleIndex) => {\r\n\t\tif (ChtmlCore.initObj.loadingBundles.length && !warnedEarlyBundleAccess) {\r\n\t\t\twarnedEarlyBundleAccess = true;\r\n\t\t\tconsole.warn('Remote bundles are still loading at this time! You should probabbly wrap bundle-dependent code within Chtml.ready(callback[, true/*waitForBundles*/]).');\r\n\t\t}\r\n\t\tvar _namespace = namespace.join('/');\r\n\t\tif (anticyclicBundlesQuery.includes(_namespace)) {\r\n\t\t\treturn ChtmlCore.bundles.find(namespace.slice(0, -1).join('/'));\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.push(_namespace);\r\n\t\tvar el = bundle.content.querySelector('[' + CSS.escape(ChtmlCore.attributeMap.ns) + '=\"' + _namespace + '\"]');\r\n\t\tif (el && superEl) {\r\n\t\t\ttry {\r\n\t\t\t\tvar norecompose = [];\r\n\t\t\t\tif (bundle.hasAttribute('norecompose')) {\r\n\t\t\t\t\tnorecompose = (bundle.getAttribute('norecompose') || '*').split(' ').map(val => val.trim());\r\n\t\t\t\t}\r\n\t\t\t\tel = ChtmlCore.recompose(el, superEl, 'prepend', norecompose);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error('[Inheritance error at source #' + bundleIndex + ']: ' + e.message);\r\n\t\t\t}\r\n\t\t\tanticyclicBundlesQuery.pop();\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.pop();\r\n\t\treturn el ? el.cloneNode(true) \r\n\t\t\t: (superEl ? superEl.cloneNode(true) : null);\r\n\t}/*getter*/);\r\n});\r\n\t\t\t\r\n/**\r\n * Define the customized built-in template element\r\n * that supports remote content.\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.bundle, class extends HTMLTemplateElement {\r\n\r\n\t/**\r\n\t * This handles both triggers remote loading\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (newValue) {\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt to load remote content if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tload() {\r\n\t\tvar src = this.getAttribute('src');\r\n\t\tif (src && this.content.children.length) {\r\n\t\t\tconsole.warn('A CHTML bundle must define only either a remote content or local content! Bundle ignored.');\r\n\t\t} else if (src) {\r\n\t\t\tfetch(src).then(response => {\r\n\t\t\t\treturn response.ok ? response.text() : Promise.reject(response.statusText);\r\n\t\t\t}).then(content => {\r\n\t\t\t\tthis.innerHTML = content;\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloadsuccess'));\r\n\t\t\t}).catch(error => {\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tconsole.warn('Error fetching the bundle at ' + src + '. (' + error + ')');\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloaderror'));\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['src'];\r\n\t}\r\n}, {extends: 'template'});\r\n\t\t\t\r\n/**\r\n * Define the custom import element\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.import, class extends HTMLElement {\r\n\r\n\t/**\r\n\t * Tests if conditions are right to resolve the import.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tshouldResolve() {\r\n\t\treturn !this.hasAttribute('ondemand')\r\n\t\t\t&& !this.closest('template')\r\n\t\t\t&& !this.closest(ChtmlCore.elementMap.import + '[ondemand]');\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconnectedCallback() {\r\n\t\tthis.processed = false;\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt self-replacement if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tresolve() {\r\n\t\tChtml.ready(() => {\r\n\t\t\tif (!this.parentNode) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar replacement, namespace, namespaceAttr = ChtmlCore.attributeMap.ns;\r\n\t\t\tif ((namespace = _before(this.getAttribute(namespaceAttr) || '', '//'))\r\n\t\t\t&& (namespace !== this.__namespace)) {\r\n\t\t\t\tthis.__namespace = namespace;\r\n\t\t\t\tif (!(replacement = Chtml.import(namespace))) {\r\n\t\t\t\t\tthis.innnerText = 'No element found on the namespace \"' + namespace + '\"!';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar resolved = ChtmlCore.recompose(this, replacement);\r\n\t\t\t\t\tif (this.hasAttribute('shadow')) {\r\n\t\t\t\t\t\tif (!this.parentNode.shadowRoot) {\r\n\t\t\t\t\t\t\tthis.parentNode.attachShadow({mode: 'open'});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.parentNode.shadowRoot.append(resolved);\r\n\t\t\t\t\t\tthis.remove();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.replaceWith(resolved);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['ondemand', ChtmlCore.attributeMap.ns];\r\n\t}\r\n});\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tChtmlCore,\r\n\tSchema,\r\n\tMatrix\r\n};\r\nexport default Chtml;","\r\n/**\r\n * @imports\r\n */\r\nimport _inherit from '@onephrase/commons/obj/inherit.js';\r\nimport _Chtml from '@onephrase/chtml';\r\nimport Element from './Element/Element.js';\r\nimport Component from './Component.js';\r\n\r\n/**\r\n * ---------------------------\r\n * A reactive Element library.\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Tells if an object is a DOM element.\r\n *\r\n * @param mixed \t\t\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst Chtml = class extends _Chtml {\r\n\t\r\n\t/**\r\n\t * Overrides the Static paramter in super.from() with self.\r\n\t *\r\n\t * @see super.from()\r\n\t */\r\n\tstatic from(input, params = {}, resolveInheritance = true, Static = Chtml) {\r\n\t\treturn super.from(input, params, resolveInheritance, Static);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper(el, _inherit({}, params, Chtml.params));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds a component to the instance;\r\n\t * saves it at an automatically-derived name.\r\n\t *\r\n\t * @param string \t\tname\t\r\n\t * @param array \t\t...args\t\r\n\t *\r\n\t * @inheritdoc\r\n\t */\r\n\tuse(name, ...args) {\r\n\t\treturn this.useAs(name, '$' + name, ...args);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds a component to the instance;\r\n\t * saves it at the given key.\r\n\t *\r\n\t * @param string \t\tname\t\r\n\t * @param string \t\tkey\t\r\n\t * @param array \t\t...args\t\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tuseAs(name, key, ...args) {\r\n\t\tvar componentInstance = Component.use(name, ...args);\r\n\t\tthis.set(key, componentInstance);\r\n\t\treturn componentInstance;\r\n\t}\r\n};\r\n\r\n/**\r\n * Deep override the default factory method.\r\n */\r\nChtml.params.drilldown = true;\r\nChtml.params.observeOnly = false;\r\nChtml.params.nodeCallback = el => new Element(el);\r\nChtml.params.componentCallback = Chtml.from;\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Chtml;","\r\n/**\r\n * @imports\r\n */\r\nimport _sort from '@onephrase/commons/arr/sort.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _with from '@onephrase/commons/obj/with.js';\r\nimport Component from '../Component.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Router class\r\n * ---------------------------\r\n *\r\n * This class provides additional functionality over\r\n * the native document.history object and the \"onpopstate\" event.\r\n */\r\n\t\t\t\r\nconst Router = class extends Component {\r\n\r\n\t/**\r\n\t * Constructs a new Router instance. Typically,\r\n\t * only one instance would be needed app-wide. So an should\r\n\t * be used as a singleton.\r\n\t *\r\n\t * @param object\t\t\t\tstate\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper(state, params);\r\n\t\t// -----------------------\r\n\t\t// This event is triggered by\r\n\t\t// either the browser back button,\r\n\t\t// the window.history.back(),\r\n\t\t// the window.history.forward(),\r\n\t\t// or the window.history.go() action.\r\n\t\tvar getProps = (urlObj, state = null) => {\r\n\t\t\turlObj = _copy(urlObj, urlProperties);\r\n\t\t\turlObj.path = Router.parsePath(urlObj.pathname);\r\n\t\t\turlObj.query = Router.parseQuery(urlObj.search);\r\n\t\t\treturn state ? _with(urlObj, 'state', state) : urlObj;\r\n\t\t};\r\n\t\twindow.addEventListener('popstate', e => {\r\n\t\t\t// Needed to alow document.location\r\n\t\t\t// to update to window.location\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.set(getProps(document.location, window.history.state));\r\n\t\t\t}, 0);\r\n\t\t});\r\n\t\tif (!this.get('href')) {\r\n\t\t\t// Startup route\r\n\t\t\tthis.set(getProps(document.location));\r\n\t\t}\r\n\t\tif (!this.get('state') && window.history) {\r\n\t\t\t// Startup state\r\n\t\t\tthis.set('state', window.history.state);\r\n\t\t}\r\n\t\t// -----------------------\r\n\t\t// Capture all link-clicks\r\n\t\t// and fire to this router.\r\n\t\twindow.addEventListener('click', e => {\r\n\t\t\t// TODO: remove without issues\r\n\t\t\te.preventDefault();\r\n\t\t\tvar anchor, href, target;\r\n\t\t\tif ((anchor = e.target.closest('a')) \r\n\t\t\t&& (href = anchor.getAttribute('href'))) {\r\n\t\t\t\tvar e2 = this.route(href, null, anchor.getAttribute('target'));\r\n\t\t\t\tif (e2.defaultPrevented) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets new URL and state data and fires the change.\r\n\t *\r\n\t * For the benefit of calling observers and accessing listeners' disposition,\r\n\t * this function should be used instead of window.history.pushState() and window.history.replaceState().\r\n\t *\r\n\t * @param string \thref\r\n\t * @param object \tstate\r\n\t * @param string \ttarget\r\n\t *\r\n\t * @return void|false|Promise\r\n\t */\r\n\troute(href, state = null, target = null) {\r\n\t\tvar urlObj = Router.parseUrl(href);\r\n\t\tif (!_isObject(state)) {\r\n\t\t\tstate = window.history.state;\r\n\t\t}\r\n\t\t// -----------------\r\n\t\tvar listenersDisposition = this.set(_with(_with(urlObj, 'state', state), 'target', target));\r\n\t\tif (urlObj.href === document.location.href) {\r\n\t\t\twindow.history.replaceState(state, '', href);\r\n\t\t} else {\r\n\t\t\twindow.history.pushState(state, '', href);\r\n\t\t}\r\n\t\tif (listenersDisposition instanceof Promise) {\r\n\t\t\tlistenersDisposition.catch(() => {\r\n\t\t\t\tthis.back();\r\n\t\t\t});\r\n\t\t}\r\n\t\t// -----------------\r\n\t\treturn listenersDisposition;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Updates the current url with new state data.\r\n\t *\r\n\t * For the benefit of calling observers and accessing listeners' disposition,\r\n\t * this function should be used instead of window.history.replaceState().\r\n\t *\r\n\t * @param object \tstate\r\n\t *\r\n\t * @return void|false|Promise\r\n\t */\r\n\tupdate(state) {\r\n\t\twindow.history.replaceState(state, '', document.location);\r\n\t\treturn this.set('data', state);\r\n\t}\r\n\r\n\t/**\r\n\t * Forwards to a visited route using window.history.forward()\r\n\t *\r\n\t * This function eventually calls observers via \"popstate\" event bound in the constructor.\r\n\t * But this won't return a Promise as Router.route() would.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tforward() {\r\n\t\twindow.history.forward();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns to a previous route using window.history.back()\r\n\t *\r\n\t * This function eventually calls observers via \"popstate\" event bound in the constructor.\r\n\t * But this won't return a Promise as Router.route() would.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tback() {\r\n\t\twindow.history.back();\r\n\t}\r\n\r\n\t/**\r\n\t * Goes to a specific history entry using window.history.go()\r\n\t *\r\n\t * This function eventually calls observers via \"popstate\" event bound in the constructor.\r\n\t * But this won't return a Promise as Router.route() would.\r\n\t *\r\n\t * @param int key\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tgo(key) {\r\n\t\twindow.history.go(key);\r\n\t}\r\n\r\n\t/**\r\n\t * Tells if the given URL matches the router's current URL\r\n\t *\r\n\t * @param string\t\t\thref\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tmatches(href) {\r\n\t\tvar urlObj = Router.parseUrl(href);\r\n\t\treturn (this.get('href') + '/').startsWith(!urlObj.href.endsWith('/') ? urlObj.href + '/' : urlObj.href);\r\n\t}\r\n\r\n\t/**\r\n\t * Parses an URL and returns its properties\r\n\t *\r\n\t * @param string\t\t\thref\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseUrl(href) {\r\n\t\tvar a = document.createElement('a');\r\n\t\ta.href = href;\r\n\t\tvar urlObj = urlProperties.reduce((obj, prop) => _with(obj, prop, a[prop]), {});\r\n\t\turlObj.path = Router.parsePath(urlObj.pathname);\r\n\t\turlObj.query = Router.parseQuery(urlObj.search);\r\n\t\treturn urlObj;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the input path and returns its parts named\r\n\t *\r\n\t * @param string\t\t\tpath\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parsePath(path) {\r\n\t\tvar pathArr = path.split('/').filter(k => k);\r\n\t\tvar pathStr = path === '/' ? path : '/' + pathArr.join('/') + '/';\r\n\t\tvar pathnaming = _sort(Object.keys(Router.pathnaming), 'desc').reduce((_pathnames, _path) => {\r\n\t\t\treturn _pathnames || (pathStr.startsWith(_path === '/' ? _path : '/' + _path.split('/').filter(k => k).join('/') + '/') ? Router.pathnaming[_path] : null);\r\n\t\t}, null);\r\n\t\tvar pathObj = pathArr.reduce((obj, pathItem, i) => pathnaming[i] ? _with(obj, pathnaming[i], pathItem) : obj, {});\r\n\t\treturn {\r\n\t\t\tstr:pathStr,\r\n\t\t\tarr:pathArr,\r\n\t\t\tobj:pathObj,\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the input query string and returns its parts named\r\n\t *\r\n\t * @param string\t\t\tquery\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseQuery(query) {\r\n\t\tvar queryArr = (query.startsWith('?') ? query.substr(1) : query)\r\n\t\t\t.split('&').map(q => q.split('=').map(str => str.trim()));\r\n\t\treturn queryArr.reduce((obj, q) => _with(obj, q[0], q[1]), {});\r\n\t}\r\n};\r\n\r\n/**\r\n * These are standard\r\n * and shouldnt'/can't be modified\r\n *\r\n * @array\r\n */\r\nconst urlProperties = [\r\n\t'hash',\r\n\t'host',\r\n\t'hostname',\r\n\t'href',\r\n\t'origin',\r\n\t'pathname',\r\n\t'port',\r\n\t'protocol',\r\n\t'search',\r\n];\r\n\r\n/**\r\n * @array\r\n */\r\nRouter.pathnaming = {\r\n\t'/': ['controller', 'resourceType', 'resourceId', 'action',],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Router;","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '../js/isString.js';\r\n\r\n/**\r\n * Sorts a list performantly.\r\n *\r\n * @param array\t \t\t\t\t\tarr\r\n * @param string\t \t\t\t\torder\t\t\tASC|DESC \r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, order, callback = null) {\r\n\tvar _arr = [];\r\n\t// Make a shallow copy\r\n\tvar length = arr.length;\r\n\tfor (var i = 0; i < length; i ++) {\r\n\t\t_arr.push({index: i, value: callback ? callback(arr[i]) : arr[i]});\r\n\t};\r\n\t_arr.sort(function(a, b) {\r\n\t\t// Using localeCompare if possible\r\n\t\tif (_isString(a.value) && \"\".localeCompare) {\r\n\t\t\treturn a.value.localeCompare(b.value);\r\n\t\t};\r\n\t\treturn a.value === b.value ? 0 : a.value > b.value ? 1 : -1;\r\n\t});\r\n\tif ((order || '').trim().toLowerCase() === 'desc') {\r\n\t\t_arr = _arr.reverse();\r\n\t};\r\n\t// Fill the order with actual values\r\n\treturn _arr.map(itm => arr[itm.index]);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isClass from '@onephrase/commons/js/isClass.js';\r\nimport Component from '../Component.js';\r\nimport Frame from './Frame.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Frameset class\r\n * ---------------------------\r\n *\r\n * This class manages multiple Frame instances.\r\n */\r\n\t\t\t\r\nconst Frameset = class extends Component {\r\n\r\n\t/**\r\n\t * Matches and activates frames;\r\n\t * deactivates unmacthed frames.\r\n\t *\r\n\t * @param string\t\t\t\tkeyExpr\r\n\t *\r\n\t * @return int\r\n\t */\r\n\tselect(selectExpr) {\r\n\t\treturn this.filterCallback(\r\n\t\t\t(name, frame) => (new RegExp(name)).test(selectExpr),\r\n\t\t\t(name, frame) => frame.active(true),\r\n\t\t\t(name, frame) => frame.active(false),\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Passes each item through a filter into\r\n\t * success and failure callbacks.\r\n\t *\r\n\t * @param function\t\t\t\tfilterCallback\r\n\t * @param function\t\t\t\tsuccessCallback\r\n\t * @param function\t\t\t\tfailureCallback\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfilterCallback(filterCallback, successCallback, failureCallback) {\r\n\t\tvar passes = {}, failures = {};\r\n\t\t_each(this.getFrames(), (name, frame) => {\r\n\t\t\tif (filterCallback(name, frame)) {\r\n\t\t\t\tpasses[name] = frame;\r\n\t\t\t} else {\r\n\t\t\t\tfailures[name] = frame;\r\n\t\t\t}\r\n\t\t});\r\n\t\t_each(passes, successCallback);\r\n\t\t_each(failures, failureCallback);\r\n\t\treturn passes;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns items.\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tgetFrames() {\r\n\t\tvar frames = {};\r\n\t\tthis.keys().forEach(name => {\r\n\t\t\tif (this.get(name) instanceof Frame) {\r\n\t\t\t\tframes[name] = this.get(name);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates Frames from declarations.\r\n\t *\r\n\t * @param array\t\t\tframesList\r\n\t *\r\n\t * @return Frameset\r\n\t */\r\n\tstatic create(framesList) {\r\n\t\tvar frames = {};\r\n\t\t_each(framesList, (name, frameConstructor) => {\r\n\t\t\tframes[name] = frameConstructor instanceof Frame ? frameConstructor\r\n\t\t\t\t: (_isClass(frameConstructor) ? new frameConstructor \r\n\t\t\t\t\t: (_isFunction(frameConstructor) ? frameConstructor(match) \r\n\t\t\t\t\t\t: new Frame(frameConstructor || {})));\r\n\t\t});\r\n\t\treturn new Frameset(frames);\r\n\t}\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Frameset;","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _objFirst from '@onephrase/commons/obj/first.js';\r\nimport Component from '../Component.js';\r\nimport Frameset from './Frameset.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Frame class\r\n * ---------------------------\r\n *\r\n * This class represents a given route and manages\r\n * its sub-route.\r\n */\r\n\t\t\t\r\nconst Frame = class extends Component {\r\n\r\n\t/**\r\n\t * Constructs a new Frame instance.\r\n\t * Sub-views may also be listed.\r\n\t *\r\n\t * Its content could either be static or remote.\r\n\t *\r\n\t * @param object\t\t\t\tstate\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tif (state.children && !(state.children instanceof Frameset)) {\r\n\t\t\tstate = _copy(0, state);\r\n\t\t\tstate.children = Frameset.create(state.children);\r\n\t\t}\r\n\t\tsuper(state, params);\r\n\t\t// -----------------------\r\n\t\t// Observe the Frame's route-slot\r\n\t\tvar routerInstance = Component.use('router');\r\n\t\tvar routePathSlot = this.get('routePathSlot') || 0;\r\n\t\tconst select = (children, path) => {\r\n\t\t\tif (children && path) {\r\n\t\t\t\tvar routePathSlotVal = _isNumeric(routePathSlot) ? path.arr[routePathSlot] : path.obj[routePathSlot];\r\n\t\t\t\tvar activeChild = _objFirst(children.select(routePathSlotVal));\r\n\t\t\t\treturn this.set({\r\n\t\t\t\t\tactiveChild: activeChild,\r\n\t\t\t\t\thasActiveChild: activeChild ? true : false,\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn this.set({\r\n\t\t\t\t\tactiveChild: undefined,\r\n\t\t\t\t\thasActiveChild: false,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\t// -----------------------\r\n\t\trouterInstance.observe('path', path => {\r\n\t\t\treturn select(this.get('children'), path);\r\n\t\t}, {diff:true});\r\n\t\t// -----------------------\r\n\t\tthis.observe('children', (children, _children, e) => {\r\n\t\t\t// Immediate children that are entering and leaving...\r\n\t\t\tif ((!e.bubbling || !e.bubbling.filter(path => path.split('.').length > 2).length)\r\n\t\t\t&& (e.entries.length || e.exits.length)) {\r\n\t\t\t\treturn select(children, routerInstance.get('path'));\r\n\t\t\t}\r\n\t\t}, {allowBubbling:true, diff:true});\r\n\t\t// -----------------------\r\n\t\tthis.observe(['activeChild', 'active'], states => {\r\n\t\t\tif (states[0]) {\r\n\t\t\t\treturn states[0].active(state[1]);\r\n\t\t\t}\r\n\t\t}, {diff:true});\r\n\t}\r\n\r\n\t/**\r\n\t * Controls the Frame's active state.\r\n\t *\r\n\t * @param bool\t\t\t\tstate\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tactive(state = true) {\r\n\t\treturn this.set('active', state);\r\n\t}\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Frame;","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _arrFirst from '../arr/first.js';\r\n\r\n/**\r\n * Returns the FIRST ENTRY.\r\n *\r\n * @param array|object \tobj\r\n *\r\n * @return mixed\r\n */\r\nexport default function(obj) {\r\n\treturn _isArray(obj) ? _arrFirst(obj) : obj[Object.keys(obj)[0]];\r\n};\r\n","\r\n    import Observable from '@onephrase/observable';\r\n    import Chtml from '../src/Chtml.js';\r\n    import Router from '../src/App/Router.js';\r\n    import Frame from '../src/App/Frame.js';\r\n    import Comp from '../src/Component.js';\r\n    \r\n    Comp.register('router', Router, true);\r\n    const router = Comp.use('router');\r\n\r\n    var Main = new Frame({\r\n        active: true,\r\n        content: {\r\n            title:'This is Home page!',\r\n        },\r\n\t\troutePathSlot: 2,\r\n        children: {\r\n            documentation: {\r\n                content: {\r\n                    title:'This is documentation page!',\r\n                },\r\n\t\t\t\troutePathSlot: 3,\r\n\t\t\t\tchildren: {\r\n\t\t\t\t\tintro: {\r\n\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\ttitle:'Welcome to Rosewell!',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n            },\r\n            download: {\r\n                content: {\r\n                    title:'This is download page!',\r\n                },\r\n            },\r\n\t\t}\r\n    });\r\n\t\r\n\tChtml.ready(() => {\r\n\t\tChtml.from('#app').bind(Main);\r\n\t});\r\n\t"],"sourceRoot":""}