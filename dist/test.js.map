{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/src/Js.js","webpack:///../commons/src/Arr.js","webpack:///../commons/src/Obj.js","webpack:///../commons/src/Str.js","webpack:///../jsen/src/ExprInterface.js","webpack:///../jsen/src/Expr/AssignmentInterface.js","webpack:///../jsen/src/Expr/ReferenceInterface.js","webpack:///../jsen/src/Expr/DeletionInterface.js","webpack:///../jsen/src/Expr/CallInterface.js","webpack:///../jsen/src/Jsen.js","webpack:///../jsen/src/Lexer.js","webpack:///../jsen/src/Contexts.js","webpack:///../jsen/src/Expr/AbstractionInterface.js","webpack:///../jsen/src/Expr/Abstraction.js","webpack:///../jsen/src/Expr/ArrInterface.js","webpack:///../jsen/src/Expr/Arr.js","webpack:///../jsen/src/Expr/ArgumentsInterface.js","webpack:///../jsen/src/Expr/Arguments.js","webpack:///../jsen/src/Expr/AssertionInterface.js","webpack:///../jsen/src/Expr/Assertion.js","webpack:///../jsen/src/Expr/Assignment.js","webpack:///../jsen/src/Expr/BoolInterface.js","webpack:///../jsen/src/Expr/Bool.js","webpack:///../jsen/src/Expr/Call.js","webpack:///../jsen/src/Expr/CommentsInterface.js","webpack:///../jsen/src/Expr/Comments.js","webpack:///../jsen/src/Expr/ComparisonInterface.js","webpack:///../jsen/src/Expr/Comparison.js","webpack:///../jsen/src/Expr/ConditionInterface.js","webpack:///../jsen/src/Expr/Condition.js","webpack:///../jsen/src/Expr/Deletion.js","webpack:///../jsen/src/Expr/FuncInterface.js","webpack:///../jsen/src/Expr/Func.js","webpack:///../jsen/src/Expr/MathInterface.js","webpack:///../jsen/src/Expr/Math.js","webpack:///../jsen/src/Expr/NumInterface.js","webpack:///../jsen/src/Expr/Num.js","webpack:///../jsen/src/Expr/ObjInterface.js","webpack:///../jsen/src/Expr/Obj.js","webpack:///../jsen/src/Expr/Reference.js","webpack:///../jsen/src/Expr/ReturnInterface.js","webpack:///../jsen/src/Expr/Return.js","webpack:///../jsen/src/Expr/StatementsInterface.js","webpack:///../jsen/src/Expr/Statements.js","webpack:///../jsen/src/Expr/StrInterface.js","webpack:///../jsen/src/Expr/Str.js","webpack:///../commons/src/index.js","webpack:///../jsen/src/index.js","webpack:///./src/Component.js","webpack:///../observable/src/Event.js","webpack:///../observable/src/EventController.js","webpack:///../observable/src/Observable.js","webpack:///../observable/src/index.js","webpack:///../commons/src/Num.js","webpack:///./src/Element/Reflow.js","webpack:///./src/Element/Dom.js","webpack:///./src/App/Client.js","webpack:///./src/Element/Transaction.js","webpack:///./src/Element/Css/TransformRule.js","webpack:///./src/Element/Css/Css.js","webpack:///./src/Element/Event/CustomEvents.js","webpack:///./src/Element/Event/EventController.js","webpack:///./src/Element/Anim/Anim.js","webpack:///./src/Element/Geometry/Rect.js","webpack:///./src/Element/Element.js","webpack:///./src/App/Router.js","webpack:///../chtml/src/Schema.js","webpack:///../chtml/src/Def/Matrix.js","webpack:///../chtml/src/Def/Def.js","webpack:///../chtml/src/Def/DefBlock.js","webpack:///../chtml/src/Def/DefSheet.js","webpack:///../chtml/src/ChtmlCore.js","webpack:///../chtml/src/Chtml.js","webpack:///../chtml/src/index.js","webpack:///./src/Chtml.js","webpack:///./src/App/Frameset.js","webpack:///./src/App/Frame.js","webpack:///./tests/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_isString","val","_isNumber","_isNumeric","isNaN","_isArray","Array","isArray","_isTypeArray","_isUndefined","length","_isObject","_isTypeObject","_isFunction","_isTypeFunction","toString","_isClass","test","Function","arguments","undefined","_isBoolean","_isNull","_isEmpty","keys","_getType","_isObservable","input","method","_proxy","target","trap","trapByCommons","prop","Proxy","_isProxy","__proxyTargetByCommons","_getProxyTarget","instance","_getProxyTrap","__proxyTrapByCommons","_mixin","classes","Traps","Base","supersMap","Mixin","args","super","prototypes","forEach","_class","obj1","obj2","indexOf","push","supers","this","supersReturnValues","supr","_instanceof","obj","classB","mixinTest","classA","reduce","prevAns","getPrototypeOf","constructor","_from","slice","values","_first","arr","amount","count","itm","firsts","_last","reverse","_avg","_sum","_max","v1","v2","Math","max","shift","_min","min","_rand","result","rand","floor","random","total","v","_slice","offset","lengthOrOffset2","_preceding","reference","rotate","lastReference","from","lastIndexOf","before","concat","_following","after","_precedingLast","_followingLast","_between","reference2","rtl","to","_intersect","arr2","callback","filter","val1","val2","_difference","_filter","_divide","passes","failures","_flatten","depth","withObjects","acc","_sort","order","_arr","index","sort","a","b","localeCompare","trim","toLowerCase","map","_unique","self","_pushUnique","items","_concatUnique","arrs","_remove","limit","splice","_exclude","itms","_replace","replacements","k","_concatBefore","secondHalf","_concatAfter","_concatBeforeLast","_concatAfterLast","_all","prevTest","_any","_inSequence","timing","sync","delay","delayAlways","Promise","resolve","reject","advance","setTimeout","ret","then","catch","_with","entriesOrKey","_merge","_each","returnValue","parseFloat","_get","ctxt","path","reciever","detectObservables","_ctxt","_key","isObsvble","has","exists","_set","buildTree","_unset","reduceTree","success","lastKey","pop","_obj","_isset","_sample","_copy","_find","deep","subKey","prev","curr","_getAllPropertyNames","until","keysAll","_getPrototypeChain","getOwnPropertyNames","prototypalChain","_copyPlain","_mergeCallback","objs","_inherit","replaceIntoEmptyObj","_even","assertion","_compareCallback","_match","netMatch","_diff","netDiff","_percentageMatch","_percentageDiff","deepProps","isReplace","withSymbols","Error","valAtObj1","valAtObj2","getOwnPropertyDescriptor","netComparison","contrast","returnOnFirstFalse","contn","testPass","_wrapped","subject","openingTag","closingTag","startsWith","endsWith","_unwrap","_beforeLast","_after","_before","search","beforeLast","pos","substr","afterLast","_afterLast","_toTitle","str","strict","replace","txt","charAt","toUpperCase","_toCamel","fromStart","_fromCamel","delimiter","split","join","_matches","lllll","Expr","jsenType","Super","comments","meta","vars","Interface","ExprInterface","Jsen","expr","Parsers","params","Static","parsers","grammars","varsScope","parsed","parse","_expr","_Parsers","ReferenceInterface","CallInterface","context","explain","console","log","AssignmentInterface","DeletionInterface","mutates","assert","Lexer","delims","options","$cache","lex","tokens","matches","$str","$options","blocks","$blocks","quotes","$quotes","$comments","runtime","nesting","maxDepth","matchesi","cache","_evalCharsAt","charWidth","commentTest","quoteTest","nestingTest","openComment","_testQuotes","openQuote","_testComments","ending","_push","chars","starting","preserveComments","_testNesting","stopChar","_testChars","stopChars","stopCharForward","matchedDelim","preserveDelims","quote","block","match","RegExp","testList","useRegex","ci","splitSeries","regParse","Abstraction","AbstractionInterface","eval","parseCallback","ArrInterface","exprs","newExprs","exprA","uniqueSoFar","exprB","even","Arguments","ArgumentsInterface","list","arg","Assertion","AssertionInterface","logic","operators","isOr","or","isNor","nor","isAnd","and","isNand","nand","lastResult","trues","Assignment","operator","getEval","Contexts","Bool","BoolInterface","state","Call","_contexts","__contexts","cntxt","utils","handler","Num","Str","Arr","Obj","unshift","Comments","CommentsInterface","type","_comments","commentPlacement","splits","line","commenta","Comparison","ComparisonInterface","operand1","operand2","compare","oper","allItemsMatch","entry1Keys","entry2Keys","allEntriesMatch","exact","is","isNull","equalsTo","notEqualsTo","relative","lesserThan","greaterThan","lesserThanOrEqualsTo","greaterThanOrEqualsTo","between","partial","contains","any","in","Condition","ConditionInterface","onTrue","onFalse","Deletion","red","del","Func","FuncInterface","paramters","statements","wrappings","parentParams","ownParams","nameInParent","nameInSelf","defaultValInParent","defaultValInSelf","sup","localContext","defaultVal","multipleContexts","headNoWrap","head","bodyNoWrap","body","funcHead","funcBody","param","paramSplit","MathInterface","currentTotal","sub","NumInterface","int","dec","parseInt","ObjInterface","entries","_entriesSplit","entry","Reference","backticks","sourceContext","parts","subjectContext","separator","nameSplit","isContext","Return","ReturnInterface","exprLc","Statements","StatementsInterface","stmts","delim","StrInterface","standardize","prefix","funcName","rename","Component","construtor","registry","singletonInstance","component","singleton","$","isPropagationStopped","isDefaultPrevented","promises","promise","all","listeners","eventNames","tag","listener","remove","removeCallback","eventsAll","details","e","currentlyFiring","eventNamesAntiRecursion","listenerParams","listenerEventNames","listenerEventName","bubbling","allowBubbling","firingEventName","_shouldFire","proms","dispostn","_doFire","stopPropagation","preventDefault","_context","data","_data","eventName","Observable","bubblers","_state","_incoming","offsetParent","addListener","removeListener","changedProps","_outgoing","_value","observersDisposition","fire","exits","props","methodPrefix","ownMethod","asOwnMethod","getOffsetParent","parent","copy","apply","changedKeys","exprObj","jsenGetter","caller","error","CACHE","_CACHE","existsReciever","_existsReciever","existence","diff","diffing","pulse","unobserve","setOffsetParent","observe","_getBubbler","changes","_changes","_e","subFieldName","msg","strictDebug","proxy","set","deleteProperty","ownKeys","descriptor","getOwnPropertySymbols","_closest","num","byKey","closest","abs","_fromWords","text","strtr","zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty","thirty","forty","fourty","fifty","sixty","seventy","eighty","ninety","hundred","thousand","million","billion","tmp","sum","last","part","Reflow","readCallbacks","writeCallbacks","_run","requestAnimationFrame","onread","withPromise","onwrite","cycle","read","write","prevTransaction","readReturn","callWrite","writeReturn","repeatTransaction","window","find","selector","document","matchedItems","Element","matchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector","webkitMatchesSelector","ownerDocument","querySelectorAll","item","domData","el","requestOrPayload","dataset","__customDatasetKey","customDatasets","customDataset","vals","payload","domAttr","valOrMutation","subValMutation","getAttribute","request","currentVal","currentValArray","includes","setAttribute","removeAttribute","domHtml","content","innerHTML","append","domText","innerText","domAppend","domPrepend","prepend","vendorPrefix","styles","getComputedStyle","documentElement","Olink","css","api","readCallback","writeCallback","$savepoints","readerDisposition","savepoint","getRollbackData","currentRead","savepoints","toSavepoint","fromSavepoint","TransformRule","transformRules","rule","round","r2d","radians","deg","PI","transformStr","WebKitCSSMatrix","f","rdigit","exec","stom","A","B","C","D","scaleX","sqrt","skew","scaleY","translate","scale","atan2","atan","cssRead","psuedo","style","ruleCallback","rawProp","getPropertyValue","vendorize","cssWrite","nameOrProps","destructables","inset","margin","padding","destructableProp","meaning","autopx","cssReadAsync","cssWriteAsync","cssComputeAsync","propsToRead","inlineSavepoint","cssReadInline","computedValues","withVendorVersion","cssReadKeyframes","noCache","normalize","cacheKey","stylesheetKeyframesCache","allKeyframes","stylesheetRuleCallback","ruleDefinition","CSSRule","KEYFRAMES_RULE","keyframes","cssRules","keyframeRule","keyframe","parseRules","cssText","keyText","offsets","normalizeToWAAPI","_keyframe","parseKeyframes","animationProps","pref","easing","fill","iterations","Infinity","valsList","propsList","normalProp","vendorizedProp","callCallback","reversed","stylesheets","styleSheets","stylesheetCallback","stylesheet","camelCasedProp","CustomEvents","Multitap","fireCallback","hammertime","allSetup","recognizers","events","tapType","recognizer","Hammer","Tap","event","taps","add","recgzr","recgzrs","recognizeWith","recgzr2","recgzrs2","requireFailure","on","off","EventController","activeHooks","Manager","NAME","setup","firedEvents","firedEventsDetails","validate","recognizeGesture","gestureName","mainGestureName","addEventListener","teardown","removeEventListener","_setup","_teardown","gestureIndex","press","pinch","pan","swipe","tap","Anim","effect","readyCallbacks","finishCallbacks","cancelCallbacks","duration","cssVarRead","init","firstFrame","lastFrame","transform","anim","animate","onfinish","cancelForCss","cancel","oncancel","createCallback","succes","ready","currentTime","play","pause","finish","animationName","keyframesWithAutoSizes","height","width","getBoundingClientRect","size","offsetOrigin","rectProps","_isElement","HTMLElement","HTMLDocument","_rect","left","clientX","top","clientY","offsetX","offsetY","pageX","pageY","innerWidth","innerHeight","pageXOffset","scrollLeft","pageYOffset","scrollTop","toJSON","x","y","right","bottom","contextOffset","coordsAtRect","_intersection","intersection","using","start","end","coords","_alignment","axis","rect1Length","rect1","parsePlacement","keyword","delta","predicates","evalPredicates","alignment","rect2","leftline","rightline","topline","bottomline","withAngle","_delta","z","pow","deltaAngle","angleOfElevation","acos","asin","angleOfDepression","angle","angle2","isHorizontal","isVertical","positioningOffsets","anchors","inverses","currentOffsets","intersectionWithAnchor","position","scrollParent","excludeStaticParent","overflowRegex","parentElement","overflow","overflowY","overflowX","scrolls","scrollHeight","clientHeight","regPlacement","regModifiers","modifiers","percentageContext","modifier","temp","createElement","innerHtml","firstChild","_ret","_el","cssAsync","domAttrAsync","domHtmlAsync","domTextAsync","domAppendAsync","domPrependAsync","cssTransaction","refPoint","trans","el2","_coords","_coordsFormatted","current","progress","activeTransform","translateTo","_offsets","alternateAnchors","_offsetsFormatted","offsetTo","viewport","scrollAnchor","currentScroll","axisProp","scrollTo","Router","getProps","urlObj","urlProperties","parsePath","pathname","query","parseQuery","location","history","anchor","href","route","parseUrl","listenersDisposition","replaceState","pushState","back","forward","go","pathArr","pathStr","pathnaming","_pathnames","_path","pathObj","pathItem","q","Schema","std","html","model","caption","col","colgroup","dd","implicitRole","dt","figcaption","legend","li","optgroup","option","rp","rt","source","summary","track","tbody","td","tfoot","thead","tr","abbr","address","area","article","acceptableRoles","aside","audio","base","bdi","bdo","blockquote","br","button","canvas","cite","code","datalist","dfn","dialog","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","img","ins","kbd","label","link","main","mark","math","menu","names","meter","nav","noscript","ol","output","picture","pre","ruby","samp","script","section","select","slot","small","span","strong","svg","table","template","textarea","time","title","u","ul","var","video","wbr","aria","banner","contentinfo","complementary","navigation","listitem","elTagName","nodeName","expandRules","roleInclusive","elSchema","currentElCategories","hasAttribute","role","node","valid","contextModel","getContentModelFor","nodeCategories","getCategoriesFor","allowedNode","disallowedNode","scope","nodeSchema","contextCategories","parentNode","assertNodeBelongsInContentModel","rules","rles","categories","Matrix","sources","namespace","carry","collections","subMatrix","nsKey","nsArray","nsDrill","enter","cloneNode","Def","flag","opts","_opts","defSplit","vf","flags","DefBlock","withDuplicate","withOverRidden","isDuplicate","overridden","def","newDef","existingDef","key_a","value_a","value_aUnwrapped","key_b","value_b","value_bUnwrapped","incase_a","important_a","incase_b","important_b","DefSheet","defBlock","defSheet","applyTo","ChtmlCore","root","querySelector","parseNamespace","defs","parseCascadedDefSheet","free","getCpsBlock","directive","bindingsListeners","binding","observeOnly","listenerObj","newState","oldState","evalReturn","cleanCopy","componentCallback","dataBlockScript","attrCache","attributeMap","related","bindings","attrValue","children","elementMap","defsheet","$defs","asDirectives","cpsBlockDefs","directives","argsExpr","chainableDirectives","_directive","explainJsen","requestNodeName","computeQuery","computedRelated","toElement","roles","superrole","rolecase","matchedNode","closestSuper","_matchedNode","closestSuperSelector","nodeSelector","subrole","shadowRoot","isSameNode","tries","schema","tagname","trie","assertNodeBelongsInScopeAs","_node","drilldown","alias","nodeCallback","disconnectedCallback","getRelatedNode","implicitOnly","getExplicitNode","explicitOnly","getImplicitNode","createNode","namespaceParse","roadmap","subnamespace","attr","textContent","elTo","elFrom","import","elToNs","elFromNs","elFromRoles","recomposeDefs","replacementNode","applicableContextRoles","applicableReplacementNodeRoles","replacementNodeRole","_applicableContextRoles","contextRole","slotNodes","contextSelector","slotNodeSelector","replaceWith","appendOrPrepend","norecompose","nocompose","recomposeCallback","disposition","b_attr","a_attr","jointList","jointDefs","attributes","elToDefs","elFromDefs","called","MutationObserver","mutations","removedNodes","childList","bundle","Chtml","dataKey","populate","itemCallback","listContext","onlyKeys","unbindReturn","isNewItem","itemNamespaceArray","itemEl","following","_k","resolveInheritance","bundles","superNs","superEl","isImport","recompose","warn","contentLoadedPromise","readyState","waitForBundles","initObj","loadingBundlesPromise","remoteBundles","loadingBundles","warnedEarlyBundleAccess","anticyclicBundlesQuery","bundleIndex","_namespace","message","customElements","define","HTMLTemplateElement","oldValue","newValue","load","src","fetch","response","ok","statusText","dispatchEvent","Event","extends","processed","shouldResolve","replacement","namespaceAttr","__namespace","resolved","attachShadow","innnerText","useAs","componentInstance","use","Frameset","selectExpr","filterCallback","frame","active","successCallback","failureCallback","getFrames","frames","framesList","frameConstructor","Frame","routerInstance","routePathSlot","routePathSlotVal","activeChild","hasActiveChild","_children","states","register","Main","documentation","intro","download"],"mappings":"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","file":"test.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 14);\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_all,\r\n\t_last,\r\n\t_slice\r\n} from './Arr.js';\r\nimport {\r\n\t_each,\r\n\t_merge,\r\n\t_mergeCallback\r\n} from './Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Typechecks and other utils\r\n * ---------------------------\r\n */\r\n \r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isString = function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isNumber = function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isNumeric = function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isArray = function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isTypeArray = function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isObject = function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isTypeObject = function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nconst _isFunction = function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isTypeFunction = function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"class\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nconst _isClass = function(val) {\r\n\treturn _isTypeFunction(val) && /^class\\s/.test(Function.prototype.toString.call(val));\r\n};\r\n \r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isUndefined = function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n \r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isBoolean = function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n \r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isNull = function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n \r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isEmpty = function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n \r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nconst _getType = function(val) {\r\n\treturn typeof val;\r\n};\r\n\r\n/**\r\n * Tells if a given object has observability methods.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst _isObservable = function(input) {\r\n\treturn _isObject(input) && _all([\r\n\t\t'observe',\r\n\t\t'unobserve',\r\n\t\t'setOffsetParent',\r\n\t\t'getOffsetParent',\r\n\t], method => _isFunction(input[method]));\r\n};\r\n\r\n/**\r\n * Creats a proxy and keeps special reference to it.\r\n *\r\n * @param object\t target\r\n * @param object\t trap\r\n *\r\n * @return Proxy\r\n */\r\nconst _proxy = function(target, trap) {\r\n\tvar trapByCommons = {\r\n\t\tget: (target, prop) => {\r\n\t\t\tif (prop === '__proxyTargetByCommons') {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t\tif (prop === '__proxyTrapByCommons') {\r\n\t\t\t\treturn trap;\r\n\t\t\t}\r\n\t\t\treturn trap.get ? trap.get(target, prop) : target[prop];\r\n\t\t},\r\n\t};\r\n\treturn new Proxy(target, _merge({}, trap, trapByCommons));\r\n};\r\n\r\n/**\r\n * Tells if a given object instance has been proxied.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst _isProxy = function(input) {\r\n\treturn (_isObject(input) && input.__proxyTargetByCommons) || false;\r\n};\r\n\r\n/**\r\n * Returns the proxy's target object as earlier saved.\r\n *\r\n * @param mixed\t\tproxy\r\n *\r\n * @return mixed\r\n */\r\nconst _getProxyTarget = function(instance) {\r\n\treturn _isProxy(instance) ? instance.__proxyTargetByCommons : undefined;\r\n};\r\n\r\n/**\r\n * Returns the proxy's trap object as earlier saved.\r\n *\r\n * @param mixed\t\tproxy\r\n *\r\n * @return mixed\r\n */\r\nconst _getProxyTrap = function(instance) {\r\n\treturn _isProxy(instance) ? instance.__proxyTrapByCommons : undefined;\r\n};\r\n\r\n/**\r\n * A multi-inheritance implementstion.\r\n *\r\n * @param array\t \t...classes\r\n *\r\n * @return object\r\n */\r\nconst _mixin = function(...classes) {\r\n\tvar Traps = {};\r\n\tvar RetrnDirective = 'last';\r\n\tif (_isArray(arguments[0])) {\r\n\t\tclasses = arguments[0];\r\n\t\tTraps = arguments[1];\r\n\t\tif (arguments[2]) {\r\n\t\t\tRetrnDirective = arguments[2];\r\n\t\t}\r\n\t}\r\n\tvar Base = _last(classes);\r\n\tvar supersMap = {};\r\n\tvar Mixin = class extends Base {\r\n\t\tconstructor(...args) {\r\n\t\t\tsuper(...args);\r\n\t\t}\r\n\t};\r\n\t// A trap for _instanceof()\r\n\tMixin.prototypes = classes;\r\n\t// ---------------------\r\n\t// Extend (merge) properties but keep methods\r\n\tclasses.forEach(_class => {\r\n\t\t// Copy const members\r\n\t\t_mergeCallback([Mixin, _class], (key, obj1, obj2) => ['name', 'prototype', 'prototypes', 'length'].indexOf(key) === -1);\r\n\t\t_mergeCallback([Mixin.prototype, _class.prototype], (key, obj1, obj2) => {\r\n\t\t\tif (['prototype', 'prototypes'].indexOf(key) === -1) {\r\n\t\t\t\tif (_isFunction(obj2[key])) {\r\n\t\t\t\t\tif (_isArray(supersMap[key])) {\r\n\t\t\t\t\t\tsupersMap[key].push(obj2[key]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsupersMap[key] = [obj2[key]];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, true/*deepProps*/);\r\n\t});\r\n\t// Extend (proxy) methods\r\n\t_each(supersMap, (name, supers) => {\r\n\t\tif (name === 'constructor') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// NOTE: this must not be defined as an arrow function\r\n\t\t// for the benefit of the \"this\".\r\n\t\tMixin.prototype[name] = function(...args) {\r\n\t\t\tif (Object.hasOwnProperty(Traps, name) && _isFunction(Traps[name])) {\r\n\t\t\t\t// Wrap a call to the trap...\r\n\t\t\t\t// So mixin supers are passed to traps\r\n\t\t\t\treturn Traps[name].call(this, supers, ...args);\r\n\t\t\t} else {\r\n\t\t\t\t// Call each super and return\r\n\t\t\t\t// the last one's return value\r\n\t\t\t\tvar supersReturnValues = [];\r\n\t\t\t\tsupers.forEach(supr => {\r\n\t\t\t\t\tsupersReturnValues.push(supr.call(this, ...args));\r\n\t\t\t\t})\r\n\t\t\t\treturn _last(supersReturnValues);\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n\treturn Mixin;\r\n};\r\n\r\n/**\r\n * Instanceof that supports our multi-inheritance implementstion.\r\n *\r\n * @param object\t \tobj1\r\n * @param object\t \tclassB\r\n *\r\n * @return bool\r\n */\r\nconst _instanceof = function(obj, classB) {\r\n\tif (!obj) {\r\n\t\treturn false;\r\n\t}\r\n\tif (obj instanceof classB) {\r\n\t\treturn true;\r\n\t}\r\n\tvar mixinTest = classA => {\r\n\t\twhile (classA && classA !== Function.prototype) {\r\n\t\t\tif (classA === classB || (classA.prototypes && classA.prototypes.reduce((prevAns, prototype) => prevAns || (prototype === classB) || mixinTest(prototype), false))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tclassA = Object.getPrototypeOf(classA);\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\treturn mixinTest(obj.constructor);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_isString,\r\n\t_isNumber,\r\n\t_isNumeric,\r\n\t_isArray,\r\n\t_isTypeArray,\r\n\t_isObject,\r\n\t_isTypeObject,\r\n\t_isFunction,\r\n\t_isTypeFunction,\r\n\t_isClass,\r\n\t_isUndefined,\r\n\t_isBoolean,\r\n\t_isNull,\r\n\t_isEmpty,\r\n\t_getType,\r\n\t_isObservable,\r\n\t_isProxy,\r\n\t_getProxyTarget,\r\n\t_getProxyTrap,\r\n\t_proxy,\r\n\t_mixin,\r\n\t_instanceof\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isBoolean,\r\n\t_isEmpty,\r\n\t_isNumber,\r\n\t_isNumeric,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isTypeArray,\r\n\t_isUndefined\r\n} from './Js.js';\r\nimport {\r\n\t_each\r\n} from './Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Array utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n *\r\n * @return array\r\n */\r\nconst _from = function(val) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n\r\n/**\r\n * Returns THE FIRST ENTRY OR A NUMBER OF ENTRIES counting forward from the begining.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nconst _first = function(arr, amount = 1) {\r\n\tvar count = 0;\r\n\tarr.forEach(itm => {\r\n\t\tcount ++;\r\n\t});\r\n\tvar firsts = arr.slice(arr.length - count, amount);\r\n\treturn arguments.length > 1 ? firsts : firsts[0];\r\n};\r\n\r\n/**\r\n * Returns THE LAST ENTRY OR A NUMBER OF ENTRIES counting forward to the end.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nconst _last = function(arr, amount = 1) {\r\n\treturn arguments.length > 1\r\n\t\t? _first(arr.slice().reverse(), amount).reverse()\r\n\t\t: _first(arr.slice().reverse());\r\n};\r\n\r\n/**\r\n * Gets the average of an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _avg = function(arr) {\r\n\treturn arr.length ? _sum(arr) / arr.length : 0;\r\n};\r\n\r\n/**\r\n * Gets the maximum of an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _max = function(arr) {\r\n\tarr = arr.slice();\r\n\treturn arr.reduce((v1, v2) => Math.max(v1, v2), arr.shift());\r\n};\r\n\r\n/**\r\n * Gets the minimum of an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _min = function(arr) {\r\n\tarr = arr.slice();\r\n\treturn arr.reduce((v1, v2) => Math.min(v1, v2), arr.shift());\r\n};\r\n\r\n/**\r\n * Gets one or more random values from an array.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nconst _rand = function(arr, amount = 1) {\r\n\tvar result = [];\r\n\tvar rand = null;\r\n\twhile (result.length < amount && (rand = arr[Math.floor(Math.random() * arr.length)]) && result.indexOf(rand) === -1) {\r\n\t\tresult.push(rand);\r\n\t};\r\n\treturn arguments.length > 1 ? result : result[0];\r\n};\r\n\r\n/**\r\n * Sums an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _sum = function(arr) {\r\n\tarr = arr.slice();\r\n\treturn arr.reduce((total, v) => total + v, arr.shift());\r\n};\r\n\r\n/**\r\n * Array slicing with support for negative offsets.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n * @param array\t \t\t\t\toffset\r\n * @param array\t \t\t\t\tlengthOrOffset2\r\n *\t *\r\n * @return array\r\n */\r\nconst _slice = function(arr, offset = 0, lengthOrOffset2 = null) {\r\n\tif (arguments.length > 1) {\r\n\t\toffset = offset < 0 ? (arr.length + offset)/*subtraction eventually*/ : offset;\r\n\t\tif (arguments.length > 2) {\r\n\t\t\tlengthOrOffset2 = lengthOrOffset2 < 0 ? (arr.length + lengthOrOffset2)/*subtraction eventually*/ - offset : lengthOrOffset2;\r\n\t\t};\r\n\t};\r\n\treturn arr.slice(offset, lengthOrOffset2);\r\n};\r\n\r\n/**\r\n * 1. Returns the ENTRY preceding (either the FIRST or the LAST instance of) the reference.\r\n * 2. Returns A NUMBER OF ENTRIES counting backwards from (either the FIRST or the LAST instance of) the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return mixed|array\r\n */\r\nconst _preceding = function(arr, reference, length = false, rotate = false, lastReference = false) {\r\n\tif (arr.indexOf(reference) === -1) {\r\n\t\treturn length ? [] : undefined;\r\n\t}\r\n\tvar amount = length === true ? arr.length - 1 : (length === false ? 1 : length);\r\n\tvar arr = arr.slice().reverse();\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1;\r\n\tvar before = !_isUndefined(reference) ? arr.slice(from, from + amount) : [];\r\n\tif (rotate && before.length < amount && before.length < arr.length) {\r\n\t\tbefore = before.concat(arr.slice(0, amount - before.length));\r\n\t};\r\n\treturn length ? before : before[0];\r\n};\r\n\t\r\n/**\r\n * 1. Returns the ENTRY following (either the FIRST or the LAST instance of) the reference.\r\n * 2. Returns A NUMBER OF ENTRIES counting forwards from (either the FIRST or the LAST instance of) the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return mixed|array\r\n */\r\nconst _following = function(arr, reference, length = false, rotate = false, lastReference = false) {\r\n\tif (arr.indexOf(reference) === -1) {\r\n\t\treturn length ? [] : undefined;\r\n\t}\r\n\tvar amount = length === true ? arr.length - 1 : (length === false ? 1 : length);\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1;\r\n\tvar after = !_isUndefined(reference) ? arr.slice(from, from + amount) : [];\r\n\tif (rotate && after.length < amount && after.length < arr.length) {\r\n\t\tafter = after.concat(arr.slice(0, amount - after.length));\r\n\t};\r\n\treturn length ? after : after[0];\r\n};\r\n\r\n/**\r\n * Alias of _preceding() but uses last instance of reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n *\r\n * @return mixed|array\r\n */\r\nconst _precedingLast = function(arr, reference, length = false, rotate = false) {\r\n\treturn _preceding(arr, reference, length, rotate, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Alias of _following() but uses last instance of reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n *\r\n * @return mixed|array\r\n */\r\nconst _followingLast = function(arr, reference, length = false, rotate = false) {\r\n\treturn _following(arr, reference, length, rotate, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Returns ALL THE ENTRIES from (either the FIRST or the LAST instance of) the given reference UNTIL reference2,\r\n * in ltr/rtl direction.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param mixed\t \treference2\r\n * @param bool\t \trtl\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return array\r\n */\r\nconst _between = function(arr, reference, reference2, rtl = false, rotate = false, lastReference = false) {\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) : arr.indexOf(reference);\r\n\tvar to = lastReference ? arr.lastIndexOf(reference2) : arr.indexOf(reference2);\r\n\tif (rtl) {\r\n\t\tvar length = to > from \r\n\t\t\t? from/*the begining backward*/ + arr.length - to/*the other half*/\r\n\t\t\t: from - to;\r\n\t\treturn _preceding(arr, reference, length, rotate, lastReference);\r\n\t};\r\n\tvar length = to < from \r\n\t\t? arr.length - from - 1/*the remainder forward*/ + to + 1/*the other half*/\r\n\t\t: to - from;\r\n\treturn _following(arr, reference, length, rotate, lastReference);\r\n};\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nconst _intersect = function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n\r\n/**\r\n * Returns the difference of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nconst _difference = function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) === -1\r\n\t);\r\n};\r\n\r\n/**\r\n * Returns a list of items that pass a callback test.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n * @param function\t\t\t\tcallback\r\n *\t *\r\n * @return array\r\n */\r\nconst _filter = function(arr, callback) {\r\n\treturn _divide(arr, callback)[0];\r\n};\r\n\r\n/**\r\n * Makes a separation between items that pass a callback test and those that fail.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n * @param function\t\t\t\tcallback\r\n *\t *\r\n * @return array\r\n */\r\nconst _divide = function(arr, callback) {\r\n\tvar passes = [];\r\n\tvar failures = [];\r\n\tvar length = arr.length;\r\n\tfor (i = 0; i < length; i++) {\r\n\t\tif (callback(arr[i])) {\r\n\t\t\tpasses.push(arr[i]);\r\n\t\t} else {\r\n\t\t\tfailures.push(arr[i]);\r\n\t\t};\r\n\t};\r\n\treturn [passes, failures];\r\n};\r\n\r\n/**\r\n * Flattens a nested array to the given depth.\r\n *\r\n * @param array \tarr\r\n * @param int \t \tdepth\r\n * @param bool \t \twithObjects\r\n *\r\n * @return array\r\n */\r\nconst _flatten = function(arr, depth = 1, withObjects = true) {\r\n\tif (!_isNumeric(depth) || depth <= 0) {\r\n\t\treturn arr;\r\n\t};\r\n\tif (!_isArray(arr) && _isObject(arr) && withObjects) {\r\n\t\tarr = Object.values(arr);\r\n\t};\r\n\tif (!_isArray(arr)) {\r\n\t\treturn arr;\r\n\t};\r\n\treturn arr.reduce((acc, val) => _isArray(val) || (_isObject(val) && withObjects) \r\n\t\t? acc.concat(_flatten(!_isArray(val) ? Object.values(val) : val, depth - 1, withObjects)) \r\n\t\t: acc.concat(val), []);\r\n};\r\n\r\n/**\r\n * Sorts a list performantly.\r\n *\r\n * @param array\t \t\t\t\t\tarr\r\n * @param string\t \t\t\t\torder\t\t\tASC|DESC \r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return array\r\n */\r\nconst _sort = function(arr, order, callback = null) {\r\n\tvar _arr = [];\r\n\t// Make a shallow copy\r\n\tvar length = arr.length;\r\n\tfor (var i = 0; i < length; i ++) {\r\n\t\t_arr.push({index: i, value: callback ? callback(arr[i]) : arr[i]});\r\n\t};\r\n\t_arr.sort(function(a, b) {\r\n\t\t// Using localeCompare if possible\r\n\t\tif (_isString(a.value) && \"\".localeCompare) {\r\n\t\t\treturn a.value.localeCompare(b.value);\r\n\t\t};\r\n\t\treturn a.value === b.value ? 0 : a.value > b.value ? 1 : -1;\r\n\t});\r\n\tif ((order || '').trim().toLowerCase() === 'desc') {\r\n\t\t_arr = _arr.reverse();\r\n\t};\r\n\t// Fill the order with actual values\r\n\treturn _arr.map(itm => arr[itm.index]);\r\n};\r\n\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nconst _unique = function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nconst _pushUnique = function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds items that do not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...arrs\r\n *\r\n * @return array\r\n */\r\nconst _concatUnique = function(arr, ...arrs) {\r\n\tarrs.forEach(_arr => {\r\n\t\t_arr.forEach(itm => _pushUnique(arr, ..._from(_arr)));\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Removes instances of reference up to <limit> times.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \titm\r\n * @param int|bool \tlimit\r\n *\r\n * @return array\r\n */\r\nconst _remove = function(arr, itm, limit = false) {\r\n\tvar i = arr.indexOf(itm);\r\n\twhile (i > -1 && (limit || limit === false)) {\r\n\t\tarr.splice(i, 1);\r\n\t\tif (limit > 0) {\r\n\t\t\tlimit --;\r\n\t\t};\r\n\t\ti = arr.indexOf(itm);\r\n\t};\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Removes all instances of each item.\r\n *\r\n * @param array \tarr\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nconst _exclude = function(arr, ...itms) {\r\n\titms.forEach(itm => _remove(arr, itm));\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Removes an item.\r\n *\r\n * @param array \tarr\r\n * @param array\t \titms\r\n * @param array\t \treplacements\r\n *\r\n * @return array\r\n */\r\nconst _replace = function(arr, itms, replacements = []) {\r\n\tif (arguments.length === 2) {\r\n\t\titms.forEach((itm, i) => {arr[i] = itm;});\r\n\t\treturn arr;\r\n\t};\r\n\t_each(itms, (k, reference) => {\r\n\t\tvar i = arr.indexOf(reference);\r\n\t\tif (i !== -1) {\r\n\t\t\tarr[i] = replacements[k];\r\n\t\t};\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS before the FIRST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n * @param bool\t \tlastReference\r\n *\r\n * @return array\r\n */\r\nconst _concatBefore = function(arr, reference, itms, lastReference = false) {\r\n\tvar secondHalf = arr.splice(lastReference ? arr.lastIndexOf(reference) : arr.indexOf(reference));\r\n\titms.concat(secondHalf).forEach(function(itm) {\r\n\t\tarr.push(itm);\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS after the FIRST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n * @param bool\t \tlastReference\r\n *\r\n * @return array\r\n */\r\nconst _concatAfter = function(arr, reference, itms, lastReference = false) {\r\n\tvar secondHalf = arr.splice(lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1);\r\n\titms.concat(secondHalf).forEach(function(itm) {\r\n\t\tarr.push(itm);\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS before the LAST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nconst _concatBeforeLast = function(arr, reference, itms) {\r\n\treturn _concatBefore(arr, reference, itms, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS after the LAST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nconst _concatAfterLast = function(arr, reference, itms) {\r\n\treturn _concatAfter(arr, itms, reference, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nconst _all = function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n\r\n/**\r\n * Tells if ANY items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nconst _any = function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest || callback(itm), false);\r\n};\r\n\r\n/**\r\n * Calls callback with each item in the list and waits inbetween for each callback's promise to resolve.\r\n * The delay parameter may be used solely as the wait or as an addition to the promise-based wait.\r\n *\r\n * @param int|string|object \tinterval\r\n *\r\n * @return new Promise\r\n */\r\nconst _inSequence = function(arr, callback, timing) {\r\n\tif (!_isArray(arr)) {\r\n\t\treturn;\r\n\t};\r\n\tif (_isObject(timing)) {\r\n\t\tvar sync = timing.sync || false;\r\n\t\tvar delay = timing.delay || 0;\r\n\t\tvar delayAlways = timing.delayAlways || false;\r\n\t} else {\r\n\t\tvar sync = _isBoolean(timing) || timing === 'last' ? timing : false;\r\n\t\tvar delay = _isNumber(timing) ? timing : 0;\r\n\t\tvar delayAlways = false;\r\n\t};\r\n\tvar items = arr;\r\n\tvar promise = new Promise(function(resolve, reject) {\r\n\t\tif (items.length) {\r\n\t\t\tvar call = function(i) {\r\n\t\t\t\tvar advance = () => {\r\n\t\t\t\t\t// Delay first before asking items.length\r\n\t\t\t\t\t// Good for progressivly adding new items\r\n\t\t\t\t\t// -----------------------\r\n\t\t\t\t\tif (delayAlways) {\r\n\t\t\t\t\t\tif (delay) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tif (items.length > i + 1) {\r\n\t\t\t\t\t\t\t\t\tcall(i + 1);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}, delay);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (items.length > i + 1) {\r\n\t\t\t\t\t\t\t\tcall(i + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t// Ask items.length first before delay\r\n\t\t\t\t\t// Good for when delay should only be BETWEEN items\r\n\t\t\t\t\t// -----------------------\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (items.length > i + 1) {\r\n\t\t\t\t\t\t\tif (delay) {\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {call(i + 1);}, delay);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcall(i + 1);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t\tvar ret = callback(items[i]);\r\n\t\t\t\tif (ret instanceof Promise && (sync === true || (sync === 'last' && i === items.length - 1))) {\r\n\t\t\t\t\t// On any of the outcomes...\r\n\t\t\t\t\tret.then(advance);\r\n\t\t\t\t\tret.catch(advance);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tadvance();\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tcall(0);\r\n\t\t} else {\r\n\t\t\tresolve();\r\n\t\t};\r\n\t});\r\n\treturn promise;\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport {\r\n\t_from,\r\n\t_first,\r\n\t_last,\r\n\t_avg,\r\n\t_max,\r\n\t_min,\r\n\t_rand,\r\n\t_sum,\r\n\t_slice, \r\n\t_preceding,\r\n\t_following,\r\n\t_precedingLast,\r\n\t_followingLast,\r\n\t_between,\r\n\t_intersect,\r\n\t_difference,\r\n\t_filter,\r\n\t_divide,\r\n\t_flatten,\r\n\t_sort,\r\n\t_unique,\r\n\t_pushUnique,\r\n\t_concatUnique,\r\n\t_remove,\r\n\t_exclude,\r\n\t_replace,\r\n\t_concatBefore,\r\n\t_concatAfter,\r\n\t_concatBeforeLast,\r\n\t_concatAfterLast, \r\n\t_all,\r\n\t_any,\r\n\t_inSequence\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isBoolean,\r\n\t_isFunction,\r\n\t_isNumeric,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isNull,\r\n\t_isTypeObject,\r\n\t_isObservable,\r\n\t_isUndefined,\r\n} from './Js.js';\r\nimport {\r\n\t_from as _arr_from,\r\n\t_first as _arr_first,\r\n\t_last as _arr_last,\r\n\t_pushUnique,\r\n\t_rand,\r\n} from './Arr.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Object utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n \r\n/**\r\n * Return an object for the given pair(s) of input.\r\n *\r\n * @param string|array \t\t\tkey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nconst _from = function(key, val = null) {\r\n\tvar obj = {};\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(key)) {\r\n\t\t\tobj[key] = val;\r\n\t\t} else if (_isArray(key) && _isArray(val)) {\r\n\t\t\tkey.forEach((k, i) => obj[k] = val[i]);\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n \r\n/**\r\n * Return the input object with additional entries.\r\n *\r\n * @param object\t \t\t\tobj\r\n * @param string|array \t\t\tentriesOrKey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nconst _with = function(obj, entriesOrKey, val = null) {\r\n\treturn _merge(obj, _isObject(entriesOrKey) ? entriesOrKey : _from(entriesOrKey, val));\r\n};\r\n \r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nconst _each = function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach(k => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k]);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n\t\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\treciever\r\n * @param object \t\t\t\tdetectObservables\r\n *\r\n * @return mixed\r\n */\r\nconst _get = function(ctxt, path, reciever = {}, detectObservables = true) {\r\n\tpath = _arr_from(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tvar isObsvble = detectObservables && _isObservable(_ctxt);\r\n\t\tif (!(isObsvble ? _ctxt.has(_key) : (_key in _ctxt))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = isObsvble ? _ctxt.get(_key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n\t\r\n/**\r\n * Sets a value to the given path.\r\n *\r\n * @param object \t\t\t\tobj\r\n * @param array \t\t\t\tpath\r\n * @param mixed \t\t\t\tval\r\n * @param object|function \t\tbuildTree\r\n *\r\n * @return bool\r\n */\r\nconst _set = function(obj, path, val, buildTree = {}) {\r\n\tpath = _arr_from(path);\r\n\tvar target = obj;\r\n\tfor(var i = 0; i < path.length; i ++) {\r\n\t\tif (i < path.length - 1) {\r\n\t\t\tif (!_isTypeObject(target) && !_isFunction(target)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (!_isTypeObject(target[path[i]])) {\r\n\t\t\t\tif (!buildTree) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\ttarget[path[i]] = _isFunction(buildTree) ? buildTree(i) : buildTree;\r\n\t\t\t}\r\n\t\t\ttarget = target[path[i]];\r\n\t\t} else {\r\n\t\t\ttarget[path[i]] = val;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n};\r\n\t\r\n/**\r\n * Unsets a value from the given path.\r\n *\r\n * @param object \t\t\t\tobj\r\n * @param array \t\t\t\tpath\r\n * @param bool|function \t\treduceTree\r\n *\r\n * @return bool\r\n */\r\nconst _unset = function(obj, path, reduceTree = false) {\r\n\tpath = _arr_from(path);\r\n\tvar success = false;\r\n\tdo {\r\n\t\tvar lastKey = path.pop();\r\n\t\tvar lastKey = lastKey === ''/*null*/ ? 0 : lastKey;\r\n\t\tvar _obj = obj;\r\n\t\tif (path.length) {\r\n\t\t\t_obj = _get(obj, path);\r\n\t\t}\r\n\t\tif ((_isTypeObject(_obj) || _isFunction(_obj)) && lastKey in _obj) {\r\n\t\t\tdelete _obj[lastKey];\r\n\t\t\tsuccess = true;\r\n\t\t}\r\n\t} while (success && reduceTree && path.length && (_isTypeObject(_obj) || _isFunction(_obj)) && !Object.keys(_obj).length);\r\n\treturn success;\r\n};\r\n\t\r\n/**\r\n * Tells if the given path exists.\r\n *\r\n * @param object \t\t\t\tobj\r\n * @param array \t\t\t\tpath\r\n *\r\n * @return bool\r\n */\r\nconst _isset = function(obj, path) {\r\n\tvar reciever = {};\r\n\t_get(obj, path, reciever);\r\n\treturn reciever.exists;\r\n};\r\n\r\n/**\r\n * Returns the FIRST ENTRY.\r\n *\r\n * @param array|object \tobj\r\n *\r\n * @return mixed\r\n */\r\nconst _first = function(obj) {\r\n\treturn _isArray(obj) ? _arr_first(obj) : obj[Object.keys(obj)[0]];\r\n};\r\n\r\n/**\r\n * Returns the LAST ENTRY.\r\n *\r\n * @param array|object \tobj\r\n *\r\n * @return mixed\r\n */\r\nconst _last = function(obj) {\r\n\treturn _isArray(obj) ? _arr_last(obj) : obj[_arr_last(Object.keys(obj))];\r\n};\r\n\r\n/**\r\n * Returns a random subset of object.\r\n *\r\n * @param array|object \tobj\r\n * @param int\t\t \tamount\r\n *\r\n * @return array|object\r\n */\r\nconst _sample = function(obj, amount = 1) {\r\n\treturn _isArray(obj) ? _rand(obj) : _copy(obj, _rand(Object.keys(obj), amount));\r\n};\r\n\r\n/**\r\n * Finds a value in an array/object and returns the key (or path when found deep).\r\n *\r\n * @param array}object \tobj\r\n * @param function\t\tcallback\r\n * @param bool\t\t\tdeep\r\n *\r\n * @return number|string|array\r\n */\r\nconst _find = function(obj, callback, deep = false) {\r\n\tvar keys = null;\r\n\tvar values = obj;\r\n\tif (!_isArray(obj)) {\r\n\t\tkeys = Object.keys(obj);\r\n\t\tvalues = Object.values(obj);\r\n\t}\r\n\tvar subKey = undefined;\r\n\tvar value = values.reduce((prev, curr) => {\r\n\t\tif (subKey === undefined) {\r\n\t\t\tif (callback(curr, prev)) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t\tif (deep && (_isTypeObject(curr) || _isFunction(curr)) && (subKey = _find(curr, callback, deep)) !== undefined) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn prev;\r\n\t}, undefined);\r\n\tif (value !== undefined) {\r\n\t\tvar key = keys ? keys[values.indexOf(value)] : values.indexOf(value);\r\n\t\treturn subKey !== undefined ? [key].concat(_arr_from(subKey)) : key;\r\n\t}\r\n};\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nconst _getAllPropertyNames = function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nconst _getPrototypeChain = function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n\r\n/**\r\n * Copies only properties of an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tonly\r\n * @param array\t\t \texcept\r\n *\r\n * @return object\r\n */\r\nconst _copyPlain = function(obj, filter = []) {\r\n\treturn _mergeCallback([{}, obj], (key, obj1, obj2) => {\r\n\t\tif (!_isFunction(obj2[key])) {\r\n\t\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t\t}\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nconst _copy = function(obj, filter = []) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _merge = function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t});\r\n};\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects into first array/object but only when not set;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _inherit = function(...objs) {\r\n\treturn _mergeCallback(objs, (key, obj1, obj2) => {\r\n\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\tif (obj1.indexOf(obj2[key]) === -1) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (!(key in obj1)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/**\r\n  * Replaces properties of first array/object with values from subsequent arrays/objects;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _replace = function(...objs) {\r\n\tvar replaceIntoEmptyObj = Object.keys(objs[0]).length === 0;\r\n\treturn _mergeCallback(objs, (key, obj1, obj2, i) => {\r\n\t\tif ((key in obj1) || (replaceIntoEmptyObj && i === 0)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}, false/*deepProps*/, true/*isReplace*/);\r\n};\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif ((_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length)\r\n\t|| (_isObject(obj1) && _isObject(obj2) && Object.keys(obj1).length !== Object.keys(obj2).length)) {\r\n\t\treturn false;\r\n\t}\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif (depth > 0 && ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2)))) {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\treturn _isArray(result) ? result.length === obj1.length\r\n\t\t: (_isObject(result) ? Object.keys(result).length === Object.keys(obj1).length : result);\r\n};\r\n\r\n/**\r\n * Gets the match(es) between (members of) two objects;\r\n * optionally with custom assertion.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetMatch\r\n *\r\n * @return object|undefined\r\n */\r\nconst _match = function(obj1, obj2, assertion = true, netMatch = true) {\r\n\treturn _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2))) {\r\n\t\t\treturn _match(v1, v2, assertion, netMatch);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, netMatch/*netComparison*/);\r\n};\r\n\r\n/**\r\n * Gets the difference(s) between (members of) two objects;\r\n * optionally with custom assertion.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetDiff\r\n *\r\n * @return object|undefined\r\n */\r\nconst _diff = function(obj1, obj2, assertion = true, netDiff = true) {\r\n\treturn _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2))) {\r\n\t\t\treturn _diff(v1, v2, assertion, netDiff);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, netDiff/*netComparison*/, true/*contrast*/);\r\n};\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n *\r\n * @return bool\r\n */\r\nconst _percentageMatch = function(obj1, obj2, assertion = true) {\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2))) {\r\n\t\t\treturn _percentageMatch(v1, v2, assertion);\r\n\t\t}\r\n\t\treturn (_isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion) ? 1 : 0;\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\tvar values = _isObject(result) ? Object.values(result) : result;\r\n\treturn values.reduce((a, b) => a + b, 0) / values.length;\r\n};\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n *\r\n * @return bool\r\n */\r\nconst _percentageDiff = function(obj1, obj2, assertion = false) {\r\n\treturn 1 - _percentageMatch(obj1, obj2, assertion);\r\n};\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _mergeCallback = function(objs, callback, deepProps = false, isReplace = false, withSymbols = false) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\t_mergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (withSymbols) {\r\n\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nconst _compareCallback = function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);;\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_from,\r\n\t_with,\r\n\t_each,\r\n\t_get,\r\n\t_set,\r\n\t_unset,\r\n\t_isset,\r\n\t_first,\r\n\t_last,\r\n\t_sample,\r\n\t_find,\r\n\t_getAllPropertyNames,\r\n\t_getPrototypeChain,\r\n\t_copyPlain,\r\n\t_copy,\r\n\t_merge,\r\n\t_inherit,\r\n\t_replace,\r\n\t_even,\r\n\t_match,\r\n\t_diff,\r\n\t_percentageMatch,\r\n\t_percentageDiff,\r\n\t_mergeCallback,\r\n\t_compareCallback,\r\n};","\r\n/**\r\n * ---------------------------\r\n * String utils\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Tells if the string is warapped with the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return bool\r\n */\r\nconst _wrapped = function(subject, openingTag, closingTag) {\r\n\treturn subject.startsWith(openingTag) && subject.endsWith(closingTag);\r\n};\r\n\r\n/**\r\n * Returns the string without the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return string\r\n */\r\nconst _unwrap = function(subject, openingTag, closingTag) {\r\n\treturn _beforeLast(_after(subject, openingTag), closingTag);\r\n};\r\n\r\n/**\r\n * Return the part of a string before a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   beforeLast\r\n *\r\n * @return string\r\n */\r\nconst _before = function(subject, search, beforeLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = beforeLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn subject;\r\n\t}\r\n\treturn subject.substr(0, pos);\r\n};\r\n\r\n/**\r\n * Return the part of a string before last occurence of a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n *\r\n * @return string\r\n */\r\nconst _beforeLast = function(subject, search) {\r\n\treturn _before(subject, search, true);\r\n};\r\n\r\n/**\r\n * Return the remainder of a string after a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   afterLast\r\n *\r\n * @return string\r\n */\r\nconst _after = function(subject, search, afterLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = afterLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn '';\r\n\t}\r\n\treturn subject.substr(pos + search.length);\r\n};\r\n\r\n/**\r\n * Return the remainder of a string after last occurence of a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n *\r\n * @return string\r\n */\r\nconst _afterLast = function(subject, search) {\r\n\treturn _after(subject, search, true);\r\n}\r\n \r\n/**\r\n * Converts a string to title case.\r\n *\r\n * @param string \tstr\r\n * @param bool \t\tstrict\r\n *\r\n * @return string\r\n */\r\nconst _toTitle = function(str, strict) {\r\n\tif (typeof str !== 'string') {\r\n\t\treturn str;\r\n\t}\r\n\treturn str.replace(/\\w\\S*/g,  function(txt) { return txt.charAt(0).toUpperCase() + ((typeof strict !== undefined && strict) ? txt.substr(1).toLowerCase() : txt.substr(1)); })\r\n};\r\n\r\n/**\r\n * Makes a string camel-cased.\r\n *\r\n * @param string \tstr\r\n * @param bool\t \tfromStart\r\n *\r\n * @return string\r\n */\r\nconst _toCamel = function(str, fromStart) {\r\n\t// Make disting words\r\n\tstr = _toTitle(str.replace(/-/g, ' ')).replace(/ /g, '');\r\n\treturn fromStart ? str : str[0].toLowerCase() + str.substr(1);\r\n};\r\n\r\n/**\r\n * Splits a camel-cased string.\r\n *\r\n * @param string \tstr\r\n * @param string \tdelimiter\r\n *\r\n * @return string\r\n */\r\nconst _fromCamel = function(str, delimiter) {\r\n\treturn str === undefined ? '' : str.split(/(?=[A-Z])/).join(delimiter ? delimiter : ' '); // positive lookahead to keep the capital letters\r\n};\r\n\r\n/**\r\n * ReMatches a string against another string.\r\n *\r\n * @param string \tstr\r\n * @param string \tdelimiter\r\n *\r\n * @return string\r\n */\r\nconst _matches = function(str, delimiter) {\r\n\treturn lllll;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_wrapped,\r\n\t_unwrap,\r\n\t_before,\r\n\t_beforeLast,\r\n\t_after,\r\n\t_afterLast,\r\n\t_toTitle,\r\n\t_toCamel,\r\n\t_fromCamel,\r\n\t_matches\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {_isObject} from '@onephrase/commons/src/Js.js';\r\nimport {_even} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ExprInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Compares the current instance with another object.\r\n\t *\r\n\t * @param object Expr\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\teven(Expr) {\r\n\t\tif (_isObject(Expr) && Expr.jsenType === this.jsenType) {\r\n\t\t\treturn _even(Expr, this);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Inherits properties from a super Expr.\r\n\t *\r\n\t * @param ExprInterface Super\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinherit(Super) {\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds comments to the instance.\r\n\t *\r\n\t * @param string\t comments\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithComments(comments) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.comments = comments;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds variables to the instance.\r\n\t *\r\n\t * @param array\t\t vars\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithVars(vars) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.vars = vars;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evaluates the expression instance for a result,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t//eval(context = null, callback = null)\r\n\t\r\n\t/**\r\n\t * Serializes the expression instance back to a string,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return string\r\n\t */\r\n\t//toString(context = null)\r\n\t\r\n\t/**\r\n\t * SAttempts to parse a string into the class instance.\r\n\t *\r\n\t * @param string expr\r\n\t * @param object params\r\n\t *\r\n\t * @return ExprInterface\r\n\t */\r\n\t//static parse(expr, params = {})\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssignmentInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssignmentExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReferenceInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Reference'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * DeletionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'DeleteExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CallInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'CallExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_remove\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isArray,\r\n\t_instanceof\r\n} from '@onephrase/commons/src/Js.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Jsen (base) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Jsen = class {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, Parsers, params = {}, Static = Jsen) {\r\n\t\tif (!params.meta) {\r\n\t\t\tparams.meta = {vars: []};\r\n\t\t}\r\n\t\tif (expr.length) {\r\n\t\t\tvar parsers = Object.values(Parsers || Static.grammars);\r\n\t\t\tfor (var i = 0; i < parsers.length; i ++) {\r\n\t\t\t\t// From this point forward, all vars is within current scope\r\n\t\t\t\tvar varsScope = params.meta && _isArray(params.meta.vars) ? params.meta.vars.length : 0;\r\n\t\t\t\tvar parsed = parsers[i].parse(expr, (_expr, _Parsers) => Jsen.parse(_expr, _Parsers, params, Static));\r\n\t\t\t\t// Add/remove vars to scope\r\n\t\t\t\tif (parsed && params.meta) {\r\n\t\t\t\t\tif (!parsed.meta) {\r\n\t\t\t\t\t\tparsed.meta = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Reap vars into scope expr\r\n\t\t\t\t\tparsed.meta.vars = params.meta.vars.slice(varsScope);\r\n\t\t\t\t\t// Add vars to scope\r\n\t\t\t\t\tif (_instanceof(parsed, ReferenceInterface) || _instanceof(parsed, CallInterface)) {\r\n\t\t\t\t\t\t_remove(parsed.meta.vars, parsed.context);\r\n\t\t\t\t\t\t_remove(params.meta.vars, parsed.context);\r\n\t\t\t\t\t\tparams.meta.vars.push(parsed);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed && params.explain) {\r\n\t\t\t\t\tconsole.log(expr, ' >>------------->> ', parsed.jsenType);\r\n\t\t\t\t}\r\n\t\t\t\tif ((parsed instanceof AssignmentInterface || parsed instanceof DeletionInterface) \r\n\t\t\t\t&& (!params || !params.mutates)) {\r\n\t\t\t\t\tthrow new Error('[Permission error:] ' + expr);\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed) {\r\n\t\t\t\t\treturn parsed;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (params.assert === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthrow new Error('[Syntax error:] ' + expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isString,\r\n\t_isUndefined\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_from,\r\n\t_flatten,\r\n\t_first,\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_merge,\r\n\t_even,\r\n\t_copyPlain\r\n} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * --------------------------\r\n * TOKENIZER\r\n * --------------------------\r\n */\r\n\r\nconst Lexer = class {\r\n\r\n\t/**\r\n\t * Factory method.\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic lex(str, delims, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Argument1 must be a string!');\r\n\t\t}\r\n\t\t// CREATE NEW -----------------------------\r\n\t\tvar instance = new Lexer(str, options);\r\n\t\t// GIVE CACHE -----------------------------\r\n\t\tLexer.$cache[str] = Lexer.$cache[str] || [];\r\n\t\tLexer.$cache[str].push(instance);\r\n\t\t// RETURN NEW -----------------------------\r\n\t\treturn instance.lex(delims);\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .split().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic split(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).tokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .match().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic match(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).matches;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a lexer instance on a string with the given options.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t * @param string \t\tblocks\t\t\t\tThe strings that begin and end a nested structure\r\n\t * @param number \t\tlimit\t\t\t\tMax results to return\r\n\t * @param string \t\tbackreference\t\tA character like (\\) that prefixes non-delim characters\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tconstructor(str, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Lexer requires the first argument to be a string.');\r\n\t\t}\r\n\t\tthis.$str = str;\r\n\t\tthis.$options = options || {};\r\n\t\tif (!this.$options.blocks) {\r\n\t\t\tthis.$options.blocks = Lexer.$blocks;\r\n\t\t}\r\n\t\tif (!this.$options.quotes) {\r\n\t\t\tthis.$options.quotes = Lexer.$quotes;\r\n\t\t}\r\n\t\tif (!this.$options.comments) {\r\n\t\t\tthis.$options.comments = Lexer.$comments;\r\n\t\t}\r\n\t\tthis.$cache = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the instance string on the given delimeters.\r\n\t *\r\n\t * This method supports static calling,\r\n\t * in which case a string is required as the first argument.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tlex(delims, options) {\r\n\t\tvar runtime = {\r\n\t\t\tdelims: _from(delims),\r\n\t\t\toptions: _merge(true, {}, this.$options, options || {}),\r\n\t\t\tnesting: [],\r\n\t\t\tmaxDepth: 0,\r\n\t\t\tcomments: [],\r\n\t\t\ttokens: [],\r\n\t\t\tmatches: [],\r\n\t\t\tmatchesi: {},\r\n\t\t};\r\n\t\t// ASK INSTANCE CACHE ---------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tfor (var i = 0; i < this.$cache.length; i ++) {\r\n\t\t\t\tif (_even(this.$cache[i].delims, runtime.delims) && _even(this.$cache[i].options, runtime.options)) {\r\n\t\t\t\t\treturn _copyPlain(this.$cache[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// EVALUATE NEW --------------------------------\r\n\t\t// Iterate over each character, keep track of current row and column (of the returned array)\r\n\t\tthis._evalCharsAt(runtime, 0);\r\n\t\tif (runtime.nesting.length) {\r\n\t\t\tthrow new Error('Error parsing the string: ' + this.$str + '. Unterminated blocks: ' + _flatten(runtime.nesting).join(', ') + '');\r\n\t\t}\r\n\t\t// GIVE CACHE ----------------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tthis.$cache.push(runtime);\r\n\t\t}\r\n\t\t// RETURN NEW ----------------------------------\r\n\t\treturn runtime;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: evaluates and handles the character on the current cursor.\r\n\t * Advances the cursor.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_evalCharsAt(runtime, i) {\r\n\t\tif (i >= this.$str.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar charWidth = 1;\r\n\t\tvar commentTest = {}, quoteTest = {}, nestingTest = {};\r\n\t\t// Quotes inside comments must be ignored\r\n\t\tif (!runtime.openComment) {\r\n\t\t\tquoteTest = this._testQuotes(runtime, i);\r\n\t\t}\r\n\t\t// Comments inside quotes must be ignored\r\n\t\tif (!runtime.openQuote) {\r\n\t\t\tcommentTest = this._testComments(runtime, i);\r\n\t\t}\r\n\t\t// Save comments\r\n\t\tif (runtime.openComment || commentTest.ending) {\r\n\t\t\t// Save only outer comments\r\n\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\tvar chars = commentTest.starting || commentTest.ending || this.$str[i];\r\n\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\tthis._push(runtime, chars, 'comments');\r\n\t\t\t\tif (runtime.options.preserveComments) {\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t}\r\n\t\t} else if (runtime.openQuote || quoteTest.ending) {\r\n\t\t\t// Yes add quotes\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t} else if (runtime.options.limit && runtime.matches.length === runtime.options.limit) {\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\treturn this._evalCharsAt(runtime, i + 1);\r\n\t\t} else {\r\n\t\t\t// Nesting tags inside comments and quotes have been ignored\r\n\t\t\tnestingTest = this._testNesting(runtime, i);\r\n\t\t\t// ---------------------\r\n\t\t\t// STOP ON THIS CHARACTER...?\r\n\t\t\t// ---------------------\r\n\t\t\tvar nestingTest = this._testNesting(runtime, i);\r\n\t\t\t// STOP CHAR(S)? at top level?\r\n\t\t\tvar stopChar = this._testChars(runtime.options.stopChars || [], runtime, i);\r\n\t\t\tif (!runtime.nesting.length && stopChar !== false) {\r\n\t\t\t\truntime.options.stopChar = stopChar;\r\n\t\t\t\truntime.options.stopCharForward = this.$str.substr(i);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// ---------------------\r\n\t\t\t// Match and split now...\r\n\t\t\t// ---------------------\r\n\t\t\tif (!runtime.delims.length) {\r\n\t\t\t\t// BLOCK-BASED SPLITTING...\r\n\t\t\t\tif (runtime.nesting.length === 2 && nestingTest.starting) {\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t\tthis._push(runtime, nestingTest.starting);\r\n\t\t\t\t\tcharWidth = nestingTest.starting.length;\r\n\t\t\t\t} else if (!runtime.nesting.length && nestingTest.ending) {\r\n\t\t\t\t\tthis._push(runtime, nestingTest.ending);\r\n\t\t\t\t\tcharWidth = nestingTest.ending.length;\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t} else/*no-nesting flag*/ {\r\n\t\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// ---------------------\r\n\t\t\t\t// DELIMS-BASED SPLITTING\r\n\t\t\t\t// ---------------------\r\n\t\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\t\t// In case the chars at index 0 is a delim,\r\n\t\t\t\t\t// the resulting split should first have an empty string, instead of undefined\r\n\t\t\t\t\tthis._push(runtime, '');\r\n\t\t\t\t\tvar matchedDelim = this._testChars(runtime.delims, runtime, i);\r\n\t\t\t\t\tif (matchedDelim !== false) {\r\n\t\t\t\t\t\truntime.matches.push(matchedDelim);\r\n\t\t\t\t\t\truntime.matchesi[i] = matchedDelim;\r\n\t\t\t\t\t\tcharWidth = matchedDelim.length || 1;\r\n\t\t\t\t\t\tif (!runtime.options.preserveDelims) {\r\n\t\t\t\t\t\t\t// The current character is a delimiter...\r\n\t\t\t\t\t\t\t// and should not get to appending to the split series down the line\r\n\t\t\t\t\t\t\treturn this._evalCharsAt(runtime, i + (matchedDelim.length || 1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._push(runtime, matchedDelim || this.$str[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar chars = nestingTest.starting || nestingTest.ending || this.$str[i];\r\n\t\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._evalCharsAt(runtime, i + charWidth);\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a quote start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testQuotes(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.quotes || []).forEach(quote => {\r\n\t\t\tif (this.$str.substr(i, 1) === quote) {\r\n\t\t\t\tif (!runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = quote;\r\n\t\t\t\t\tresult.starting = quote;\r\n\t\t\t\t} else if (quote === runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = false;\r\n\t\t\t\t\tresult.ending = quote;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a comment start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testComments(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.comments || []).forEach(block => {\r\n\t\t\tif (!runtime.openComment) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = block;\r\n\t\t\t\t\tresult.starting = m[0];\r\n\t\t\t\t}\r\n\t\t\t} else if (_last(block) === _last(runtime.openComment)) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = false;\r\n\t\t\t\t\tresult.ending = m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a nesting start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testNesting(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.blocks || []).forEach(block => {\r\n\t\t\tvar starting = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\tif (starting) {\r\n\t\t\t\truntime.nesting = runtime.nesting.concat([block]);\r\n\t\t\t\tresult.starting = starting[0];\r\n\t\t\t} else if (runtime.nesting.length && _last(block) === _last(_last(runtime.nesting))) {\r\n\t\t\t\tvar ending = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (ending) {\r\n\t\t\t\t\truntime.nesting = runtime.nesting.slice(0, -1);\r\n\t\t\t\t\tresult.ending = ending[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\truntime.maxDepth = Math.max(runtime.maxDepth, runtime.nesting.length);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a delimiter or stop character on the current cursor.\r\n\t *\r\n\t * @param array\t\ttestList\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_testChars(testList, runtime, i) {\r\n\t\tfor (var k = 0; k < testList.length; k ++) {\r\n\t\t\tvar test = testList[k];\r\n\t\t\tif (runtime.options.useRegex) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + test, runtime.options.useRegex !== true ? runtime.options.useRegex : ''));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\treturn m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((!runtime.options.ci && this.$str.substr(i, test.length) === test)\r\n\t\t\t|| (runtime.options.ci && this.$str.substr(i, test.length).toLowerCase() === test.toLowerCase())) {\r\n\t\t\t\treturn test;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Expr helper: pushes a character or set of characters into the current split series.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param string\tchars\r\n\t * @param string\ttarget\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_push(runtime, chars, target = 'tokens') {\r\n\t\tvar splitSeries = runtime.matches.length;\r\n\t\tif (_isUndefined(runtime[target][splitSeries])) {\r\n\t\t\truntime[target][splitSeries] = '';\r\n\t\t}\r\n\t\truntime[target][splitSeries] += chars;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tsplit(str, delims, options) {\r\n\t\treturn this.lex(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tmatch(str, delims, options) {\r\n\t\treturn this.lex(delims, options).matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses the instance string on the given delimeters using regex.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tregParse(delims, options) {\r\n\t\treturn this.lex(delims, _merge({useRegex: true}, options || {}));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters using regex; returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregSplit(delims, options) {\r\n\t\treturn this.regParse(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Matches the instance string on the given delimeters using regex; returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregMatch(delims, options) {\r\n\t\treturn this.regParse(delims, options).matches;\r\n\t}\r\n};\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$blocks = [['\\\\(', '\\\\)'], ['\\\\[', '\\\\]'], ['\\\\{', '\\\\}'],];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$quotes = ['\"', \"'\", '`',];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$comments = [['\\\\/\\\\*', '\\\\*\\\\/'], ['\\\\/\\\\/', '(\\\\r)?\\\\n'],];\r\n\r\n/**\r\n * @var object\r\n */\r\nLexer.$cache = {};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Lexer;\r\n\r\n","\r\n/**\r\n * @exports\r\n */\r\nexport default class extends Array {};","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AbstractionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Abstraction'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport AbstractionInterface from './AbstractionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Abstraction class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Abstraction = class extends AbstractionInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.expr.toString(context) + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Abstraction) {\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_unwrap(expr, '(', ')'))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Abstraction;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ArrayType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport ArrInterface from './ArrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Array utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arr = class extends ArrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs || [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ArrInterface) {\r\n\t\t\tvar newExprs = Super.exprs.filter(exprA => {\r\n\t\t\t\treturn this.exprs.reduce((uniqueSoFar, exprB) => uniqueSoFar && !exprA.even(exprB), true);\r\n\t\t\t});\r\n\t\t\tthis.exprs = newExprs.concat(this.exprs);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.map(expr => expr.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '[' + this.exprs.map(expr => expr.toString(context)).join(', ') + ']';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arr) {\r\n\t\tif (_wrapped(expr, '[', ']') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(_unwrap(expr, '[', ']'), [','])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n).map(expr => parseCallback(expr));\r\n\t\t\treturn new Static(splits);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Arr;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArgumentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Arguments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport ArgumentsInterface from './ArgumentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Arguments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arguments = class extends ArgumentsInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(list = []) {\r\n\t\tsuper();\r\n\t\tthis.list = list;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.list.map(arg => arg.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.list.map(arg => arg.toString(context)).join(', ') + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arguments) {\r\n\t\tvar args; expr = expr.trim();\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tLexer.split(_unwrap(expr, '(', ')'), [',']).map(arg => parseCallback(arg.trim()))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Arguments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssertionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssertionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_first,\r\n\t_flatten,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport AssertionInterface from './AssertionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assertion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assertion = class extends AssertionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs, logic) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs;\r\n\t\tthis.logic = logic;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t eval(context = null, callback = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn !_first(this.exprs).eval(context, callback);\r\n\t\t}\r\n\t\tvar operators = _flatten(Assertion.operators);\r\n\t\tvar logic = (this.logic || '').trim().toUpperCase();\r\n\t\tvar isOr = logic === (Assertion.operators.or || '').trim().toUpperCase();\r\n\t\tvar isNor = logic === (Assertion.operators.nor || '').trim().toUpperCase();\r\n\t\tvar isAnd = logic === (Assertion.operators.and || '').trim().toUpperCase();\r\n\t\tvar isNand = logic === (Assertion.operators.nand || '').trim().toUpperCase();\r\n\t\tvar lastResult = true, trues = 0;\r\n\t\tfor(var i = 0; i < this.exprs.length; i ++) {\r\n\t\t\tif (isAnd && !lastResult) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (isNand && !lastResult) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlastResult = this.exprs[i].eval(context, callback);\r\n\t\t\tif (isOr && lastResult) {\r\n\t\t\t\treturn lastResult;\r\n\t\t\t}\r\n\t\t\ttrues += lastResult ? 1 : 0;\r\n\t\t}\r\n\t\tif (isOr) {\r\n\t\t\t// Which is falsey,\r\n\t\t\t// by virtue of getting here\r\n\t\t\treturn lastResult;\r\n\t\t}\r\n\t\tif (isAnd || isNand) {\r\n\t\t\t// For AND and NAND, all entries must be true,\r\n\t\t\t// by virtue of getting here.\r\n\t\t\t// For AND, this means true; for NAND, false\r\n\t\t\treturn isAnd;\r\n\t\t}\r\n\t\t// For NOR, all entries need to be false\r\n\t\treturn isNor && trues === 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t toString(context = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn '!' + _first(this.exprs).toString(context);\r\n\t\t}\r\n\t\treturn this.exprs.map(expr => expr.toString(context)).join(' ' + this.logic + ' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assertion) {\r\n\t\tif (expr.startsWith('!')) {\r\n\t\t\treturn new Static(\r\n\t\t\t\t[parseCallback(expr.substr(1))],\r\n\t\t\t\t'!'\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tvar logic = _unique(parse.matches);\r\n\t\t\tif (logic.length > 1) {\r\n\t\t\t\tthrow new Error('\"AND\" and \"OR\" logic cannot be asserted in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr.trim())),\r\n\t\t\t\t_first(logic)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nAssertion.operators = {\r\n\tand: '&&',\r\n\tor: '||',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assertion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isUndefined,\r\n\t_isFunction\r\n} from '@onephrase/commons/src/Js.js';\r\nimport AssignmentInterface from './AssignmentInterface.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assignment class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assignment = class extends AssignmentInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, val, operator = '=') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.val = val;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar val = this.val.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, val);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tcntxt[reference.name] = val;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.reference.toString(context), this.operator, this.val.toString(context)].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assignment) {\r\n\t\tvar parse = Lexer.lex(expr, Static.operators);\r\n\t\tif (parse.tokens.length === 2) {\r\n\t\t\tvar reference, val;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.shift().trim())) instanceof ReferenceInterface) \r\n\t\t\t|| !(val = parseCallback(parse.tokens.shift().trim()))) {\r\n\t\t\t\tthrow new Error('Invalid assignment directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, val, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nAssignment.operators = [' = '];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assignment;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * BoolInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'BooleanType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport BoolInterface from './BoolInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Bool (boolean) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Bool = class extends BoolInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(state) {\r\n\t\tsuper();\r\n\t\tthis.state = state;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.state.toLowerCase().trim() === 'true';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.state;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Bool) {\r\n\t\tvar expr = expr.toLowerCase().trim();\r\n\t\tif (expr === 'true' || expr === 'false') {\r\n\t\t\treturn new Static(expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Bool;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isFunction,\r\n\t_isNumeric,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isUndefined\r\n} from '@onephrase/commons/src/Js.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport CallInterface from './CallInterface.js';\r\nimport Arguments from './Arguments.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Call = class extends CallInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, args) {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.args = args;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar args = this.args.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, args);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar _contexts = reference.context instanceof Contexts \r\n\t\t\t\t? reference.context.slice() \r\n\t\t\t\t: [reference.context];\r\n\t\t\tvar __contexts = _contexts.slice();\r\n\t\t\twhile(_contexts.length) {\r\n\t\t\t\tvar cntxt = _contexts.pop();\r\n\t\t\t\tif (cntxt && _isFunction(cntxt[reference.name])) {\r\n\t\t\t\t\treturn cntxt[reference.name](...args);\r\n\t\t\t\t}\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\tvar utils = Call.utils || {};\r\n\t\t\t\tvar handler = _isNumeric(cntxt) && utils.Num ? utils.Num\r\n\t\t\t\t\t: (_isString(cntxt) && utils.Str ? utils.Str\r\n\t\t\t\t\t\t: (_isArray(cntxt) && utils.Arr ? utils.Arr\r\n\t\t\t\t\t\t\t: (_isObject(cntxt) && utils.Obj ? utils.Obj : null)));\r\n\t\t\t\tif (handler && _isFunction(handler[reference.name])) {\r\n\t\t\t\t\targs.unshift(cntxt);\r\n\t\t\t\t\treturn handler[reference.name](...args);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthrow new Error('\"' + this + '\" is not a function. (Called on ' + __contexts.map(c => typeof c).join(', ') + ')');\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.reference.toString(context) + this.args.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Call) {\r\n\t\tif (!expr.startsWith('(') && expr.endsWith(')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar tokens = Lexer.split(expr, []);\r\n\t\t\tvar reference, args = tokens.pop();\r\n\t\t\tif (!((reference = parseCallback(tokens.join(''))) instanceof ReferenceInterface) \r\n\t\t\t|| !(args = parseCallback(args, [Arguments]))) {\r\n\t\t\t\tthrow new Error('Invalid call directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, args);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Call;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CommentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Comments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_after,\r\n\t_before\r\n} from '@onephrase/commons/src/Str.js';\r\nimport CommentsInterface from './CommentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comments = class extends CommentsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(comments, type) {\r\n\t\tsuper();\r\n\t\tthis.comments = comments;\r\n\t\tthis.type = type;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comments) {\r\n\t\tvar _comments = null;\r\n\t\tvar _expr = null;\r\n\t\tvar type = 0;\r\n\t\tvar commentPlacement = 'before';\r\n\t\t// Oneliner comments\r\n\t\tif (expr.startsWith('//')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '//'), [\"\\r\\n\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 1;\r\n\t\t} else if (expr.startsWith('/*')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '/*'), [\"*/\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 2;\r\n\t\t} else if (expr.endsWith('*/')) {\r\n\t\t\tvar splits = Lexer.split(_beforeLast(expr, '*/'), [\"/*\"]);\r\n\t\t\t_comments = splits.pop().trim();\r\n\t\t\t_expr = splits.pop().trim();\r\n\t\t\ttype = 2;\r\n\t\t\tvar commentPlacement = 'after';\r\n\t\t}\r\n\t\tif (type) {\r\n\t\t\tif (type === 2) {\r\n\t\t\t\t_comments = Lexer.split(_comments.trim(), [\"\\r\\n\"])\r\n\t\t\t\t\t.map(line => line.replace(/^[\\*]+/, ''))\r\n\t\t\t\t\t.filter(line => line.trim());\r\n\t\t\t}\r\n\t\t\tconsole.log(_comments, commentPlacement, expr);\r\n\t\t\t_comments = new Static(_comments, type);\r\n\t\t}\r\n\t\tif (_expr) {\r\n\t\t\t_expr = parseCallback(_expr);\r\n\t\t\t_expr.meta.commenta = _comments;\r\n\t\t\treturn _expr;\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ComparisonInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ComparisonExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_matches\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_flatten,\r\n\t_first,\r\n\t_last,\r\n\t_difference\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isArray,\r\n\t_isObject,\r\n\t_isString\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport ComparisonInterface from './ComparisonInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comparison class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comparison = class extends ComparisonInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(operand1, operand2, operator) {\r\n\t\tsuper();\r\n\t\tthis.operand1 = operand1;\r\n\t\tthis.operand2 = operand2;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn Comparison.compare(\r\n\t\t\tthis.operand1.eval(context, callback), \r\n\t\t\tthis.operand2.eval(context, callback), \r\n\t\t\tthis.operator\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.operand1.toString(context), \r\n\t\t\tthis.operator, \r\n\t\t\tthis.operand2.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comparison) {\r\n\t\tvar operators = _flatten(Static.operators).map(oper => ' ' + oper + ' ');\r\n\t\tvar parse = Lexer.lex(expr, operators);\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tif (parse.tokens.length > 2) {\r\n\t\t\t\tthrow new Error('Malformed \"Comparison\" expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_first(parse.tokens).trim()),\r\n\t\t\t\tparseCallback(_last(parse.tokens).trim()),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * Use the operator type to compare the two operands\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param string \toperator\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic compare(operand1, operand2, operator = '==') {\r\n\t\tif (_flatten(Comparison.operators).indexOf(operator) === -1) {\r\n\t\t\tthrow new Error('The operator \"' + operator + '\" is not recognized.');\r\n\t\t}\r\n\t\tif (_isArray(operand1) && _isArray(operand2) && operator !== '===') {\r\n\t\t\tif (operand1.length !== operand2.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allItemsMatch = true;\r\n\t\t\toperand1.sort();\r\n\t\t\toperand2.sort();\r\n\t\t\tfor (var i = 0; i < operand1.length; i ++) {\r\n\t\t\t\tallItemsMatch = allItemsMatch && Comparison.compare(operand1[i], operand2[i], operator);\r\n\t\t\t}\r\n\t\t\treturn allItemsMatch;\r\n\t\t} else if (_isObject(operand1) && _isObject(operand2) && operator !== '===') {\r\n\t\t\tvar entry1Keys = Object.keys(operand1);\r\n\t\t\tvar entry2Keys = Object.keys(operand2);\r\n\t\t\tif (entry1Keys.length !== entry2Keys.length || _difference(entry1Keys, entry2Keys).length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allEntriesMatch = true;\r\n\t\t\t_each(entry1Keys, (i, key) => {\r\n\t\t\t\tallEntriesMatch = allEntriesMatch && Comparison.compare(operand1[key], operand2[key], operator);\r\n\t\t\t});\r\n\t\t\treturn allEntriesMatch;\r\n\t\t}\r\n\t\tswitch(operator) {\r\n\t\t\tcase '===':\r\n\t\t\t\treturn operand1 === operand2;\r\n\t\t\tcase '==':\r\n\t\t\tcase '=':\r\n\t\t\t\treturn operand1 == operand2;\r\n\t\t\tcase '>':\r\n\t\t\t\treturn operand1 > operand2;\r\n\t\t\tcase '<':\r\n\t\t\t\treturn operand1 < operand2;\r\n\t\t\tcase '>=':\r\n\t\t\t\treturn operand1 >= operand2;\r\n\t\t\tcase '<=':\r\n\t\t\t\treturn operand1 <= operand2;\r\n\t\t\tcase '!=':\r\n\t\t\t\treturn operand1 != operand2;\r\n\t\t\tcase '!==':\r\n\t\t\t\treturn operand1 !== operand2;\r\n\t\t\tcase '^=':\r\n\t\t\t\treturn _isString(operand1) && operand1.startsWith(operand2);\r\n\t\t\tcase '$=':\r\n\t\t\t\treturn _isString(operand1) && operand1.endsWith(operand2);\r\n\t\t\tcase '*=':\r\n\t\t\t\t// Contains\r\n\t\t\t\treturn _isArray(operand2) || _isString(operand2) ? operand1.indexOf(operand2) > -1 : false;\r\n\t\t\tcase '~=':\r\n\t\t\t\t// Contains word\r\n\t\t\t\treturn _isString(operand1) && _isString(operand2) && (' ' + operand1 + ' ').indexOf(' ' + operand2 + ' ') > -1;\r\n\t\t\tcase '>=<': // Between\r\n\t\t\t\t if (!(_isArray(operand2) && operand2.length === 2)) {\r\n\t\t\t\t\t throw new Error('A \\'Between\\' comparison requires argument 2 to be an array of exactly 2 values.');\r\n\t\t\t\t }\r\n\t\t\t\t return operand1 >= operand2[0] && operand1 <= operand2[1];\r\n\t\r\n\t\t\tcase '/**/': // Regex\r\n\t\t\t\treturn _matches(operand2, operand1);\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * Compares two operands for differences\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param bool\t \tstrict\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic diff(operand1, operand2, strict) {\r\n\t\treturn !Comparison.compare(operand1, operand2, strict ? '===' : '==');\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nComparison.operators = {\r\n\texact: {\r\n\t\tis: '===',\r\n\t\tisNull: '===',\r\n\t\tequalsTo: '==',\r\n\t\tnotEqualsTo: '!=',\r\n\t},\r\n\trelative: {\r\n\t\tlesserThan: '<',\r\n\t\tgreaterThan: '>',\r\n\t\tlesserThanOrEqualsTo: '<=',\r\n\t\tgreaterThanOrEqualsTo: '>=',\r\n\t\tbetween: '>=<',\r\n\t},\r\n\tpartial: {\r\n\t\tstartsWith: '^=',\r\n\t\tendsWith: '$=',\r\n\t\tcontains: '*=',\r\n\t\tany: '~=',\r\n\t\tin: '~=',\r\n\t\tmatches: '/**/',\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comparison;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ConditionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ConditionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ConditionInterface from './ConditionInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Condition class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Condition = class extends ConditionInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(assertion, onTrue, onFalse) {\r\n\t\tsuper();\r\n\t\tthis.assertion = assertion;\r\n\t\tthis.onTrue = onTrue;\r\n\t\tthis.onFalse = onFalse;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.assertion.eval(context, callback) \r\n\t\t\t? this.onTrue.eval(context, callback) \r\n\t\t\t: this.onFalse.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.assertion.toString(context), \r\n\t\t\tCondition.operators[0], \r\n\t\t\tthis.onTrue.toString(context),\r\n\t\t\tCondition.operators[1], \r\n\t\t\tthis.onFalse.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Condition) {\r\n\t\tvar splits = Lexer.split(expr, Static.operators);\r\n\t\tif (splits.length > 1) {\r\n\t\t\tif (splits.length === 2) {\r\n\t\t\t\tthrow new Error('Malformed ternary expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(splits[0].trim()),\r\n\t\t\t\tparseCallback(splits[1].trim()),\r\n\t\t\t\tparseCallback(splits[2].trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nCondition.operators = ['?', ':'];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Condition;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isUndefined,\r\n\t_isFunction\r\n} from '@onephrase/commons/src/Js.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport DeletionInterface from './DeletionInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Deletion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Deletion = class extends DeletionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, operator = 'delete') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tdelete cntxt[reference.name];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.operator + ' ' + this.reference.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Deletion) {\r\n\t\tvar parse = Lexer.lex(expr, Object.values(Static.operators));\r\n\t\tif (parse.matches.length === 1 && expr.startsWith(parse.matches[0] + ' ')) {\r\n\t\t\tvar reference;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.pop().trim())) instanceof ReferenceInterface)) {\r\n\t\t\t\tthrow new Error('Invalid delete directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nDeletion.operators = {\r\n\tred: 'reduce', \r\n\tdel: 'delete',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Deletion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * FuncInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'FunctionType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_copy,\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_flatten\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport FuncInterface from './FuncInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Func class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Func = class extends FuncInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(paramters, statements, wrappings = {}) {\r\n\t\tsuper();\r\n\t\tthis.paramters = paramters || {};\r\n\t\tthis.statements = statements;\r\n\t\tthis.wrappings = wrappings;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof FuncInterface) {\r\n\t\t\tvar parentParams = Object.keys(Super.paramters);\r\n\t\t\tvar ownParams = Object.keys(this.paramters);\r\n\t\t\tfor (var i = 0; i < Math.max(ownParams.length, parentParams.length); i ++) {\r\n\t\t\t\tvar nameInParent = parentParams[i];\r\n\t\t\t\tvar nameInSelf = ownParams[i];\r\n\t\t\t\tif (!nameInSelf && nameInParent) {\r\n\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInParent + ') in parent function must be implemented.');\r\n\t\t\t\t}\r\n\t\t\t\tif (nameInSelf && nameInParent) {\r\n\t\t\t\t\tvar defaultValInParent = Super.paramters[nameInParent];\r\n\t\t\t\t\tvar defaultValInSelf = this.paramters[nameInSelf];\r\n\t\t\t\t\tif (defaultValInSelf && !defaultValInParent) {\r\n\t\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInSelf + ') must not have a default value as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (defaultValInSelf && defaultValInParent && defaultValInSelf.jsenType !== defaultValInParent.jsenType) {\r\n\t\t\t\t\t\tthrow new Error('Default value for parameter #' + i + ' (' + nameInSelf + ') must be of type ' + defaultValInParent.jsenType + ' as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.sup = Super;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn (...args) => {\r\n\t\t\tvar localContext = {};\r\n\t\t\t_each(Object.keys(this.paramters), (i, name) => {\r\n\t\t\t\tvar defaultVal = this.paramters[name];\r\n\t\t\t\tif (args.length - 1 < i && !defaultVal) {\r\n\t\t\t\t\tthrow new Error('The parameter \"' + name + '\" is required.');\r\n\t\t\t\t}\r\n\t\t\t\tlocalContext[name] = args.length > i \r\n\t\t\t\t\t? args[i] \r\n\t\t\t\t\t: (this.paramters[name] \r\n\t\t\t\t\t\t? this.paramters[name].eval(context, callback) \r\n\t\t\t\t\t\t: null);\r\n\t\t\t});\r\n\t\t\tvar multipleContexts = new Contexts(localContext);\r\n\t\t\t// But this newer context should come last\r\n\t\t\tif (context instanceof Contexts) {\r\n\t\t\t\tmultipleContexts = context.concat(multipleContexts);\r\n\t\t\t} else if (context) {\r\n\t\t\t\tmultipleContexts.unshift(context);\r\n\t\t\t}\r\n\t\t\treturn this.statements.eval(multipleContexts, callback);\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar paramters = [];\r\n\t\t_each(this.paramters, (name, value) => {\r\n\t\t\tparamters.push(name + (value ? '=' + value.toString(context) : ''));\r\n\t\t});\r\n\t\tvar headNoWrap = this.wrappings.head === false || (paramters.length === 1 && paramters[0].indexOf('=') === -1);\r\n\t\tvar bodyNoWrap = this.wrappings.body === false\r\n\t\treturn (headNoWrap ? paramters[0] : '(' + paramters.join(', ') + ')')\r\n\t\t+ ' => ' + (bodyNoWrap ? this.statements.toString(context) : '{' + this.statements.toString(context) + '}');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Func) {\r\n\t\tvar splits = Lexer.split(expr, _flatten(Static.operators));\r\n\t\tif (splits.length === 2) {\r\n\t\t\tvar funcHead = splits.shift().trim();\r\n\t\t\tvar funcBody = splits.shift().trim();\r\n\t\t\tvar wrappings = {};\r\n\t\t\tif (_wrapped(funcHead, '(', ')')) {\r\n\t\t\t\tfuncHead = _unwrap(funcHead, '(', ')');\r\n\t\t\t} else {\r\n\t\t\t\twrappings.head = false;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(funcBody, '{', '}')) {\r\n\t\t\t\tfuncBody = _unwrap(funcBody, '{', '}');\r\n\t\t\t} else {\r\n\t\t\t\twrappings.body = false;\r\n\t\t\t}\r\n\t\t\tvar paramters = {};\r\n\t\t\tLexer.split(funcHead, [',']).forEach(param => {\r\n\t\t\t\tvar paramSplit = param.split('=');\r\n\t\t\t\tif (paramSplit[1]) {\r\n\t\t\t\t\tparamters[paramSplit[0].trim()] = parseCallback(paramSplit[1].trim());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparamters[param.trim()] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar statements = parseCallback(funcBody);\r\n\t\t\treturn new Static(paramters, statements, wrappings);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nFunc.operators = ['=>',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Func;","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * MathInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'MathExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_flatten,\r\n\t_intersect,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\nimport MathInterface from './MathInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Math class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Math = class extends MathInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(val, exprs) {\r\n\t\tsuper();\r\n\t\tthis.val = val;\r\n\t\tthis.exprs = exprs;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.reduce((currentTotal, expr) => {\r\n\t\t\tvar val = expr.val.eval(context, callback);\r\n\t\t\tvar operator = expr.operator.trim();\r\n\t\t\tif ((!_isNumeric(currentTotal) || !_isNumeric(val)) && operator !== '+') {\r\n\t\t\t\tthrow new Error('Invalid Math expression: ' + this.toString() + '!');\r\n\t\t\t}\r\n\t\t\tswitch(operator) {\r\n\t\t\t\tcase '+':\r\n\t\t\t\t\treturn currentTotal + val;\r\n\t\t\t\tcase '-':\r\n\t\t\t\t\treturn currentTotal - val;\r\n\t\t\t\tcase '*':\r\n\t\t\t\t\treturn currentTotal * val;\r\n\t\t\t\tcase '/':\r\n\t\t\t\t\treturn currentTotal / val;\r\n\t\t\t}\r\n\t\t}, this.val.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.val.toString(context)].concat(\r\n\t\t\tthis.exprs.map(expr => expr.operator + ' ' + expr.val.toString(context))\r\n\t\t).join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Math) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1 && parse.matches.length === parse.tokens.length - 1) {\r\n\t\t\tvar operators = _unique(parse.matches);\r\n\t\t\tif (_intersect(operators, Math.operators.sup).length && _intersect(operators, Math.operators.sub).length) {\r\n\t\t\t\tthrow new Error('\"Addition/subtraction\" and \"multiplication/division\" operators cannot be used in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(parse.tokens.shift().trim()),\r\n\t\t\t\tparse.tokens.map((expr, i) => {return {\r\n\t\t\t\t\toperator: parse.matches[i],\r\n\t\t\t\t\tval: parseCallback(expr.trim())\r\n\t\t\t\t};})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nMath.operators = {\r\n\tsup: ['*', '/'],\r\n\tsub: [' + ', ' - '],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Math;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * NumInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'NumberType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\nimport NumInterface from './NumInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Num (number) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Num = class extends NumInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(int, dec = 0) {\r\n\t\tsuper();\r\n\t\tthis.int = int;\r\n\t\tthis.dec = dec;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn parseFloat(this.int + (this.dec ? '.' + this.dec : null));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.int + (this.dec ? '.' + this.dec : null);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Num) {\r\n\t\tif (_isNumeric(expr)) {\r\n\t\t\tvar expr = expr.split('.');\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseInt(expr.shift()),\r\n\t\t\t\tparseInt(expr.shift())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Num;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ObjInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ObjectType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_first,\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport ObjInterface from './ObjInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Object utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Obj = class extends ObjInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries) {\r\n\t\tsuper();\r\n\t\tthis.entries = entries || {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ObjInterface) {\r\n\t\t\t_each(Super.entries, (name, val) => {\r\n\t\t\t\tif (!(name in this.entries)) {\r\n\t\t\t\t\tthis.entries[name] = val;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar items = {};\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\titems[key] = expr.eval(context, callback);\r\n\t\t});\r\n\t\treturn items;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar str = [];\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\tstr.push(key + Obj.operators.sub + expr.toString(context));\r\n\t\t});\r\n\t\treturn '{' + str.join(Obj.operators.sup) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Obj) {\r\n\t\tif (_wrapped(expr, '{', '}') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar entries = {};\r\n\t\t\tvar _entriesSplit = Lexer.split(_unwrap(expr, '{', '}'), [Obj.operators.sup])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n);\r\n\t\t\t_each(_entriesSplit, (key, expr) => {\r\n\t\t\t\tvar entry = Lexer.split(expr, [Obj.operators.sub], {limit:1}/*IMPORTANT*/);\r\n\t\t\t\tentries[_first(entry).trim()] = parseCallback(_last(entry).trim());\r\n\t\t\t});\r\n\t\t\treturn new Static(entries);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nObj.operators = {\r\n\tsup: ',',\r\n\tsub: ':',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Obj;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_isUndefined,\r\n\t_isFunction\r\n} from '@onephrase/commons/src/Js.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport ExprInterface from '../ExprInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Reference class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Reference = class extends ReferenceInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(context, name, backticks = false) {\r\n\t\tsuper();\r\n\t\tthis.context = context;\r\n\t\tthis.name = name;\r\n\t\tthis.backticks = backticks;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tgetEval(context = null, callback = null) {\r\n\t\tvar sourceContext = context, name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = name.eval(context, callback);\r\n\t\t\t}\r\n\t\t\tsourceContext = this.context.eval(context, callback);\r\n\t\t}\r\n\t\treturn {context:sourceContext, name:name,};\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar parts = this.getEval(context, callback);\r\n\t\tif (!_isUndefined(parts.context) && !_isUndefined(parts.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, parts.context, parts.name);\r\n\t\t\t}\r\n\t\t\tvar _contexts = parts.context instanceof Contexts \r\n\t\t\t\t? parts.context.slice() \r\n\t\t\t\t: [parts.context];\r\n\t\t\twhile(_contexts.length) {\r\n\t\t\t\tvar cntxt = _contexts.pop(), val = cntxt[parts.name];\r\n\t\t\t\tif (!_isUndefined(val)) {\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tvar subjectContext = this.context.toString(context);\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = '[' + name.toString(context) + ']';\r\n\t\t\t} else if (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar subjectContext = context;\r\n\t\t\tif (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (subjectContext || '') + (subjectContext && !name.startsWith('[') ? Reference.separator : '') + name;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Reference) {\r\n\t\tif (!Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(expr, []);\r\n\t\t\t// ------------------------\r\n\t\t\t// name, first\r\n\t\t\t// ------------------------\r\n\t\t\tvar context, name = splits.pop(), backticks;\r\n\t\t\tvar nameSplit = Lexer.split(name.trim(), [Static.separator], {preserveDelims:true});\r\n\t\t\tif (nameSplit.length > 1) {\r\n\t\t\t\tname = nameSplit.pop().substr(1);\r\n\t\t\t\tsplits = splits.concat(nameSplit);\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '`', '`')) {\r\n\t\t\t\tname = _unwrap(name, '`', '`');\r\n\t\t\t\tbackticks = true;\r\n\t\t\t}\r\n\t\t\t// ------------------------\r\n\t\t\t// context, second\r\n\t\t\t// ------------------------\r\n\t\t\tif (splits.length) {\r\n\t\t\t\tcontext = parseCallback(splits.join(''));\r\n\t\t\t\tcontext.isContext = true;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '[', ']')) {\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Invalid reference: ' + expr + '!');\r\n\t\t\t\t}\r\n\t\t\t\tname = parseCallback(_unwrap(name, '[', ']'));\r\n\t\t\t}\r\n\t\t\treturn new Static(context, name, backticks);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop string\r\n */\r\nReference.separator = '.';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reference;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReturnInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ReturnDirective'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Ret (return) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Return = class extends ReturnInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr ? this.expr.eval(context, callback) : undefined;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.expr ? 'return ' + this.expr.toString(context) : 'return';\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Return) {\r\n\t\tvar exprLc = expr.toLowerCase();\r\n\t\tif (exprLc.startsWith('return ') || exprLc === 'return') {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(expr.substr(6).trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Return;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StatementsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Statements'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_flatten\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport StatementsInterface from './StatementsInterface.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Statements class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Statements = class extends StatementsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(stmts, delim) {\r\n\t\tsuper();\r\n\t\tthis.stmts = exprs;\r\n\t\tthis.delim = delim;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar exprs = [];\r\n\t\tfor (var i = 0; i < this.stmts.length; i ++) {\r\n\t\t\tif (this.stmts[i] instanceof ReturnInterface) {\r\n\t\t\t\treturn this.stmts[i].eval(context, callback);\r\n\t\t\t} else {\r\n\t\t\t\texprs[i] = this.stmts[i].eval(context, callback);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn exprs;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.stmts.map(expr => expr.toString(context)).join(this.delim);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Statements) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr)),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop array\r\n */\r\nStatements.operators = [\r\n\t';',\r\n\t\"\\r\\n\",\r\n];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Statements;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'StringType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport StrInterface from './StrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\nimport Bool from './Bool.js';\r\n\r\n/**\r\n * ---------------------------\r\n * String utils\r\n * ---------------------------\r\n */\r\n\r\nconst Str = class extends StrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr, quote) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t\tthis.quote = quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.expr;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.quote + this.expr + this.quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Str) {\r\n\t\texpr = expr.trim();\r\n\t\tif ((_wrapped(expr, '\"', '\"') || _wrapped(expr, \"'\", \"'\")) \r\n\t\t&& !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar quote = _wrapped(expr, '\"', '\"') ? '\"' : \"'\";\r\n\t\t\treturn new Static(\r\n\t\t\t\t_unwrap(expr, quote, quote),\r\n\t\t\t\tquote\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Str;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport * as _Arr from './Arr.js';\r\nimport * as _Js from './Js.js';\r\nimport * as _Num from './Num.js';\r\nimport * as _Obj from './Obj.js';\r\nimport * as _Str from './Str.js';\r\n\r\n/**\r\n * Standardize functions as\r\n * prototype methods.\r\n */\r\nconst standardize = (a, prototype, prefix = '') => Object.keys(a).reduce((prototype, funcName) => _Obj._with(prototype, prefix + funcName, function() {\r\n\treturn a[funcName](this, ...arguments);\r\n}), prototype);\r\n\r\n/**\r\n * Deliver functions without\r\n * their initial underscore.\r\n */\r\nconst rename = (a, b = {}) => Object.keys(a).reduce((b, funcName) => _Obj._with(b, funcName.substr(1), a[funcName]), b);\r\nconst Arr = rename(_Arr);\r\nconst Js = rename(_Js);\r\nconst Num = rename(_Num);\r\nconst Obj = rename(_Obj);\r\nconst Str = rename(_Str);\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {Arr, Js, Num, Obj, Str, standardize};","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen from './Jsen.js';\r\nimport ExprInterface from './ExprInterface.js';\r\nimport Lexer from './Lexer.js';\r\nimport Contexts from './Contexts.js';\r\nimport Abstraction from './Expr/Abstraction.js';\r\nimport AbstractionInterface from './Expr/AbstractionInterface.js';\r\nimport Arr from './Expr/Arr.js';\r\nimport ArrInterface from './Expr/ArrInterface.js';\r\nimport Arguments from './Expr/Arguments.js';\r\nimport ArgumentsInterface from './Expr/ArgumentsInterface.js';\r\nimport Assertion from './Expr/Assertion.js';\r\nimport AssertionInterface from './Expr/AssertionInterface.js';\r\nimport Assignment from './Expr/Assignment.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport Bool from './Expr/Bool.js';\r\nimport BoolInterface from './Expr/BoolInterface.js';\r\nimport Call from './Expr/Call.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\nimport Comments from './Expr/Comments.js';\r\nimport CommentsInterface from './Expr/CommentsInterface.js';\r\nimport Comparison from './Expr/Comparison.js';\r\nimport ComparisonInterface from './Expr/ComparisonInterface.js';\r\nimport Condition from './Expr/Condition.js';\r\nimport ConditionInterface from './Expr/ConditionInterface.js';\r\nimport Deletion from './Expr/Deletion.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport Func from './Expr/Func.js';\r\nimport FuncInterface from './Expr/FuncInterface.js';\r\nimport Math from './Expr/Math.js';\r\nimport MathInterface from './Expr/MathInterface.js';\r\nimport Num from './Expr/Num.js';\r\nimport NumInterface from './Expr/NumInterface.js';\r\nimport Obj from './Expr/Obj.js';\r\nimport ObjInterface from './Expr/ObjInterface.js';\r\nimport Reference from './Expr/Reference.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport Return from './Expr/Return.js';\r\nimport ReturnInterface from './Expr/ReturnInterface.js';\r\nimport Statements from './Expr/Statements.js';\r\nimport StatementsInterface from './Expr/StatementsInterface.js';\r\nimport Str from './Expr/Str.js';\r\nimport StrInterface from './Expr/StrInterface.js';\r\nimport * as Commons from '@onephrase/commons';\r\n\r\n/**\r\n * @var object\r\n */\r\nJsen.grammars = {\r\n\tComments: Comments,\t\t\t// // single-line | /* double-line */\r\n\tReturn: Return,\t\t\t\t// return field1\r\n\tStatements: Statements,\t\t// field1 = 3; field2 = val2\r\n\tDeletion: Deletion,\t\t\t// delete field1\r\n\tAssignment: Assignment,\t\t// field1[key1].key2 = k\r\n\tFunc: Func,\t\t\t\t\t// (field1, field2) => {}\r\n\tAbstraction: Abstraction,\t// (field1)\r\n\tCondition: Condition,\t\t// field1 > field2 ? val1 : val2\r\n\tAssertion: Assertion,\t\t// !field1 && field2\r\n\tComparison: Comparison,\t\t// field1 > field2\r\n\tMath: Math,\t\t\t\t\t// field1 + field2\r\n\tArr: Arr,\t\t\t\t\t// [field1, field2]\r\n\tObj: Obj,\t\t\t\t\t// {field1:val1, field2:val2}\r\n\tNum: Num,\t\t\t\t\t// [0-9]\r\n\tStr: Str,\t\t\t\t\t// \"\"\r\n\tBool: Bool,\t\t\t\t\t// true\r\n\tCall: Call,\t\t\t\t\t// field1()\r\n\tReference: Reference,\t\t\t\t// field1\r\n};\r\n\r\nCall.utils = Commons;\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tExprInterface,\r\n\tLexer,\r\n\tContexts\r\n};\r\nexport {\r\n\tAbstraction,\r\n\tArr,\r\n\tArguments,\r\n\tAssertion,\r\n\tAssignment,\r\n\tBool,\r\n\tCall,\r\n\tComments,\r\n\tComparison,\r\n\tCondition,\r\n\tDeletion,\r\n\tFunc,\r\n\tMath,\r\n\tNum,\r\n\tObj,\r\n\tReference,\r\n\tReturn,\r\n\tStr,\r\n\tStatements\r\n};\r\nexport {\r\n\tAbstractionInterface,\r\n\tArrInterface,\r\n\tArgumentsInterface,\r\n\tAssertionInterface,\r\n\tAssignmentInterface,\r\n\tBoolInterface,\r\n\tCallInterface,\r\n\tCommentsInterface,\r\n\tComparisonInterface,\r\n\tConditionInterface,\r\n\tDeletionInterface,\r\n\tFuncInterface,\r\n\tMathInterface,\r\n\tNumInterface,\r\n\tObjInterface,\r\n\tReferenceInterface,\r\n\tReturnInterface,\r\n\tStrInterface,\r\n\tStatementsInterface\r\n};\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isClass\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_inherit\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport Observable from '@onephrase/observable';\r\n\r\n/**\r\n * ---------------------------\r\n * The App class\r\n * ---------------------------\r\n *\r\n * This class provides window-like functionality as a component.\r\n */\r\n\t\t\t\r\nconst Component = class extends Observable {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper(state, _inherit({}, params, Component.params));\r\n\t}\r\n\t\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Finds and instantiates a registered component.\r\n\t *\r\n\t * @param string\t\t\t\tname\r\n\t * @param array\t\t\t\t\t...args\r\n\t *\r\n\t * @return Component\r\n\t */\r\n\tstatic use(name, ...args) {\r\n\t\tvar construtor, instance;\r\n\t\tif (construtor = Component.registry[name]) {\r\n\t\t\tif (construtor.singletonInstance) {\r\n\t\t\t\treturn construtor.singletonInstance;\r\n\t\t\t}\r\n\t\t\tif (_isClass(construtor.component)) {\r\n\t\t\t\tinstance = new construtor.component(...args);\r\n\t\t\t} else {\r\n\t\t\t\tinstance = construtor.component(...args);\r\n\t\t\t}\r\n\t\t\tif (construtor.singleton) {\r\n\t\t\t\tconstrutor.singletonInstance = instance;\r\n\t\t\t}\r\n\t\t\treturn instance;\r\n\t\t}\r\n\t\tthrow new Error('The \"' + name + '\" component is undefined!');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Registers a logical component.\r\n\t *\r\n\t * @param string\t\t\t\tname\r\n\t * @param Component|function\tcomponent\r\n\t * @param bool\t\t\t\t\tsingleton\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic register(name, component, singleton = false) {\r\n\t\tComponent.registry[name] = {component:component, singleton:singleton};\r\n\t}\r\n};\r\n\r\n/**\r\n * @object\r\n */\r\nComponent.registry = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nComponent.params = {\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Component;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nconst Event = class {\r\n\r\n\t/**\r\n\t * Initializes an Event instance.\r\n\t *\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(params) {\r\n\t\tthis.$ = {\r\n\t\t\tisPropagationStopped: false,\r\n\t\t\tisDefaultPrevented: false,\r\n\t\t\tpromises: [],\r\n\t\t};\r\n\t\t_each(params, (name, value) => {\r\n\t\t\tthis[name] = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.isPropagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget isPropagationStopped() {\r\n\t\treturn this.$.isPropagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.isDefaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget isDefaultPrevented() {\r\n\t\treturn this.$.isDefaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\treturn this.$.promises.length ? Promise.all(this.$.promises) : null;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Event;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_even,\r\n\t_get\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_remove,\r\n\t_concatUnique,\r\n\t_from,\r\n\t_difference,\r\n\t_intersect,\r\n\t_exclude,\r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isNull,\r\n\t_isFunction,\r\n\t_getType,\r\n\t_isString,\r\n\t_isArray\r\n} from '@onephrase/commons/src/Js.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nconst EventController = class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.$ = {\r\n\t\t\tlisteners: [],\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a listener object.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return void\r\n\t */\r\n\taddListener(eventNames, callback, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback;\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t\t}\r\n\t\tvar listener = {\r\n\t\t\teventNames: eventNames, \r\n\t\t\tcallback: callback, \r\n\t\t\tparams: params,\r\n\t\t\ttag: tag,\r\n\t\t\tremove: () => {\r\n\t\t\t\t_remove(this.$.listeners, listener);\r\n\t\t\t},\r\n\t\t};\r\n\t\tthis.$.listeners.push(listener);\r\n\t\treturn listener;\r\n\t}\r\n\r\n\t/**\r\n\t * Unregisters an listener.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tremoveListener(eventNames, callback = null, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback || {};\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tvar success = false;\r\n\t\tfor (var i = 0; i < this.$.listeners.length; i ++) {\r\n\t\t\tif ((_isNull(eventNames) || _even(_arr_from(this.$.listeners[i].eventNames), _arr_from(eventNames))) \r\n\t\t\t&& (_isNull(callback) || this.$.listeners[i].callback === callback)\r\n\t\t\t&& (_isNull(params) || _even(this.$.listeners[i].params, params))\r\n\t\t\t&& (_isNull(tag) || this.$.listeners[i].tag === tag)) {\r\n\t\t\t\tif (this.$.listeners[i].removeCallback) {\r\n\t\t\t\t\tthis.$.listeners[i].removeCallback();\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.listeners[i].remove();\r\n\t\t\t\tsuccess = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Returns the list of params being listend.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\teventsAll() {\r\n\t\tvar eventsAll = [];\r\n\t\t(this.$.listeners || []).forEach(listener => {\r\n\t\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t\teventsAll = _concatUnique(eventsAll, _from(listener.eventNames));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn eventsAll;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires listeners that are bound to the given events.\r\n\t *\r\n\t * @param string|array\t \teventNames\r\n\t * @param object \t\t\tdetails\r\n\t *\r\n\t * @return bool|Promise\r\n\t */\r\n\tfire(eventNames, details) {\r\n\t\tvar e = details instanceof Event ? details : new Event(details);\r\n\t\t// We handle multiple events actually...\r\n\t\teventNames = _from(eventNames);\r\n\t\t// And fields already firing should trigger a refire\r\n\t\tthis.$.currentlyFiring = this.$.currentlyFiring || [];\r\n\t\tvar eventNamesAntiRecursion = _difference(eventNames, this.$.currentlyFiring);\r\n\t\tif (!eventNamesAntiRecursion.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_concatUnique(this.$.currentlyFiring, eventNamesAntiRecursion)\r\n\t\t// Initialize evteters for \"return\"\r\n\t\tfor (var i = 0; i < (this.$.listeners || []).length; i ++) {\r\n\t\t\tif (e.isPropagationStopped) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar listener = this.$.listeners[i];\r\n\t\t\tvar listenerParams = listener.params || {};\r\n\t\t\tvar listenerEventNames = _from(listener.eventNames).map(str => str.replace(/\\`/g, ''));\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-1 filtering...\r\n\t\t\t// Match listenerEventNames to firingEventNames\r\n\t\t\t// --------------------------\r\n\t\t\tvar matches;\r\n\t\t\tif (listenerEventNames.length) {\r\n\t\t\t\tmatches = listenerEventNames.filter(listenerEventName => {\r\n\t\t\t\t\tvar firingEventNames = e.bubbling && listenerEventName.indexOf('.') > -1 ? e.bubbling\r\n\t\t\t\t\t\t: (!e.bubbling || listenerParams.allowBubbling ? eventNamesAntiRecursion : []);\r\n\t\t\t\t\treturn firingEventNames.filter(firingEventName => (listenerEventName + '.').startsWith(firingEventName + '.')).length;\r\n\t\t\t\t}).length;\r\n\t\t\t} else {\r\n\t\t\t\tmatches = !e.bubbling || listenerParams.allowBubbling;\r\n\t\t\t}\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-2 filtering...\r\n\t\t\t// --------------------------\r\n\t\t\tif (matches && this._shouldFire(listener, eventNames, e)) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar dispostn = this._doFire(listener, eventNames, e), proms;\r\n\t\t\t\tif ((dispostn === false) || (dispostn instanceof Event && dispostn.isPropagationStopped)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t} else if ((dispostn === false) || (dispostn instanceof Event && dispostn.isDefaultPrevented)) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t} else if ((dispostn instanceof Promise && (proms = dispostn))\r\n\t\t\t\t|| (dispostn instanceof Event && (proms = dispostn.promises))) {\r\n\t\t\t\t\te.promise(proms);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t_exclude(this.$.currentlyFiring, ...eventNamesAntiRecursion)\r\n\t\t// -----------------------------\r\n\t\t// The overall return value\r\n\t\t// -----------------------------\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Fires the listener at entry \"i\".\r\n\t * Returns listener's disposition.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\t_doFire(listener, eventNames, e) {\r\n\t\tvar context = e.context || {};\r\n\t\tvar _context = e._context || {};\r\n\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t// Call listener...\r\n\t\t\tvar data = [];\r\n\t\t\tvar _data = [];\r\n\t\t\tvar result = _from(listener.eventNames).forEach(eventName => {\r\n\t\t\t\teventName = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\t\tdata.push(_get(context, eventName));\r\n\t\t\t\t_data.push(_get(_context, eventName));\r\n\t\t\t});\r\n\t\t\treturn _isArray(listener.eventNames) \r\n\t\t\t\t? listener.callback(data, _data, e)\r\n\t\t\t\t: listener.callback(data[0], _data[0], e);\r\n\t\t}\r\n\t\tvar data = {};\r\n\t\tvar _data = {};\r\n\t\teventNames.forEach(eventName => {\r\n\t\t\tvar path = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\tdata[eventName] = _get(context, path);\r\n\t\t\t_data[eventName] = _get(_context, path);\r\n\t\t});\r\n\t\t// Call listener...\r\n\t\treturn listener.callback(data, _data, e);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default EventController;","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen, {\r\n\tArgumentsInterface,\r\n\tCallInterface,\r\n\tReferenceInterface,\r\n\tContexts\r\n} from '@onephrase/jsen';\r\nimport {\r\n\t_isArray,\r\n\t_isString,\r\n\t_isObject,\r\n\t_isFunction,\r\n\t_isNumber,\r\n\t_isNumeric,\r\n\t_isObservable,\r\n\t_proxy,\r\n\t_isProxy,\r\n\t_getProxyTarget,\r\n\t_isUndefined,\r\n\t_isNull\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_from,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_inherit,\r\n\t_copy,\r\n\t_each,\r\n\t_even,\r\n\t_get\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport EventController from './EventController.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observable\r\n * ---------------------------\r\n */\r\n \r\nconst Observable = class extends EventController {\r\n\r\n\t/**\r\n\t * Handles initializations.\r\n\t *\r\n\t * @param object\t\t\tstate\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper();\r\n\t\t// @see ObservableCore.init()\r\n\t\tthis.$.params = _inherit({}, params, Observable.params);\r\n\t\tthis.$.bubblers = {};\r\n\t\tthis.$.state = state;\r\n\t\tthis.$._state = _isArray(state) ? state.slice() : _copy(1, state);\r\n\t\t_each(this.$.state, (prop, value) => {\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @param object|null\t\toffsetParent\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tsetOffsetParent(offsetParent) {\r\n\t\tthis.$.offsetParent = offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @return object|null\r\n\t */\r\n\tgetOffsetParent() {\r\n\t\treturn this.$.offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of addListener.\r\n\t *\r\n\t * @see addListener()\r\n\t */\r\n\tobserve(...args) {\r\n\t\treturn this.addListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of removeListener.\r\n\t *\r\n\t * @see removeListener()\r\n\t */\r\n\tunobserve(...args) {\r\n\t\treturn this.removeListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Pushes data into a given property, or list of properties.\r\n\t *\r\n\t * @param string\t\tprops\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tset(prop, value) {\r\n\t\tvar data = {};\r\n\t\tif (_isString(prop) || _isNumber(prop)) {\r\n\t\t\tdata[prop] = value;\r\n\t\t} else if (_isArray(prop)) {\r\n\t\t\tprop.forEach(p => {\r\n\t\t\t\tdata[p] = value;\r\n\t\t\t})\r\n\t\t} else if (_isObject(prop)) {\r\n\t\t\tdata = prop;\r\n\t\t}\r\n\t\tvar changedProps = Object.keys(data);\r\n\t\tif (_isArray(this.$.state)) {\r\n\t\t\tchangedProps = changedProps.map(key => parseInt(key));\r\n\t\t}\r\n\t\t// ------------------\r\n\t\tvar entries = [];\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t} else {\r\n\t\t\t\tentries.push(prop);\r\n\t\t\t}\r\n\t\t\t// Incoming...\r\n\t\t\t// ------------------\r\n\t\t\tvar value = data[prop];\r\n\t\t\t// When observables come as proxies,\r\n\t\t\t// we'll save them real\r\n\t\t\tif (_isProxy(value)) {\r\n\t\t\t\tvar _value = _getProxyTarget(value);\r\n\t\t\t\tif (_isObservable(_value)) {\r\n\t\t\t\t\tvalue = _value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t\t// Set now...\r\n\t\t\t// ------------------\r\n\t\t\tthis.$.state[prop] = value;\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(changedProps, {context: this.$.state, _context: this.$._state, entries: entries, exits: []});\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tthis.$._state[prop] = this.$.state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Unsets the property or list of properties from the object.\r\n\t *\r\n\t * @param string|array\t\tprop\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tdel(prop) {\r\n\t\tvar props = _from(prop);\r\n\t\tvar exits = [];\r\n\t\tprops.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\texits.push(prop);\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t}\r\n\t\t\tdelete this.$.state[prop];\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(props, {context: this.$.state, _context: this.$._state, entries: [], exits: exits});\r\n\t\tprops.forEach(prop => {\r\n\t\t\tdelete this.$._state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Evaluates a property name to see if it's a request for instance method\r\n\t * as against state property.\r\n\t *\r\n\t * This is especially useful for _jsenGetters.\r\n\t *\r\n\t * @param string\t\t\tprop\r\n\t *\r\n\t * @return function|undefined\r\n\t */\r\n\tasOwnMethod(prop) {\r\n\t\tif (_isString(prop) && this.$.params.methodPrefix && prop.startsWith(this.$.params.methodPrefix)) {\r\n\t\t\tvar ownMethod = prop.substr(this.$.params.methodPrefix.length);\r\n\t\t\tif (ownMethod && _isFunction(ownMethod = this[ownMethod])) {\r\n\t\t\t\treturn ownMethod.bind(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns a field's value.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(prop) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(prop);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tif (prop === '_') {\r\n\t\t\treturn this.getOffsetParent();\r\n\t\t}\r\n\t\tif (prop === '__') {\r\n\t\t\tvar parent = this.getOffsetParent();\r\n\t\t\treturn (parent ? parent.get('__') : parent) || parent;\r\n\t\t}\r\n\t\tvar value = this.$.state[prop];\r\n\t\tif (_isArray(this.$.state) && !_isNumeric(prop) && _isFunction(value)) {\r\n\t\t\treturn (...args) => {\r\n\t\t\t\tvar copy = this.$.state.slice();\r\n\t\t\t\tvar ret = value.apply(this.$.state, args);\r\n\t\t\t\tvar changedKeys = _unique(Object.keys(copy).concat(Object.keys(this.$.state))).filter(k => {\r\n\t\t\t\t\tk = parseInt(k);\r\n\t\t\t\t\tif (this.$.state[k] !== copy[k]) {\r\n\t\t\t\t\t\tif (!(k in this.$.state)) {\r\n\t\t\t\t\t\t\t// Outgoing...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._outgoing(k, copy[k]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Incoming...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._incoming(k, this.$.state[k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (changedKeys.length) {\r\n\t\t\t\t\tthis.fire(changedKeys, {context: this.$.state, _context: this.$._state});\r\n\t\t\t\t\tthis.$._state = this.$.state.slice();\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Tells if a a field exists.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\thas(prop) {\r\n\t\treturn (prop in this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Keys of current entries.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tkeys() {\r\n\t\treturn Object.keys(this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Utility for deeply running JSEN expressions on the instance.\r\n\t *\r\n\t * @param string\t\t\texpr\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tjsenEval(expr, params = {}) {\r\n\t\tvar exprObj = Jsen.parse(expr, null, params);\r\n\t\tif (exprObj) {\r\n\t\t\treturn exprObj.eval(this, this.jsenGetter());;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * A getter callback for JSEN evaluators.\r\n\t *\r\n\t * @param array \t\tvars\r\n\t *\r\n\t * @return function\r\n\t */\r\n\tjsenGetter(vars = []) {\r\n\t\treturn ((caller, context, name, args = []) => {\r\n\t\t\tif (caller instanceof CallInterface || caller instanceof ReferenceInterface) {\r\n\t\t\t\tif (!caller.isContext) {\r\n\t\t\t\t\tvars.push(caller);\r\n\t\t\t\t}\r\n\t\t\t\tvar value, advance = true;\r\n\t\t\t\tvar _contexts = context instanceof Contexts ? context.slice() : [context];\r\n\t\t\t\tvar __contexts = _contexts.slice();\r\n\t\t\t\twhile(_isUndefined(value) && advance && _contexts.length) {\r\n\t\t\t\t\tvar cntxt = _contexts.pop();\r\n\t\t\t\t\tif (_isObservable(cntxt)) {\r\n\t\t\t\t\t\tvalue = cntxt.get(name);\r\n\t\t\t\t\t} else if (cntxt) {\r\n\t\t\t\t\t\tvalue = cntxt[name];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ((caller instanceof CallInterface) && !_isUndefined(value)) {\r\n\t\t\t\t\t\tif (!_isFunction(value)) {\r\n\t\t\t\t\t\t\tthis.error(name + '() is not callable in the expression ' + caller.toString() + '!');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvalue = value.apply(cntxt, args);\r\n\t\t\t\t\t\tadvance = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (advance && caller instanceof CallInterface) {\r\n\t\t\t\t\tthis.error('\"' + caller + '\" is not a function. (Called on ' + __contexts.map(c => typeof c).join(', ') + ')');\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tthis.error('Operation \"' + caller + '\" is not supported!');\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\tvar passes = 0, failures = 0;\r\n\t\t// One CACHE across listeners\r\n\t\t// IMPORTANT: This cache must\r\n\t\t// be destroyed before bubbling the (e) object\r\n\t\tif (!('CACHE' in e.$)) {\r\n\t\t\te.$.CACHE = {};\r\n\t\t\te.$._CACHE = {};\r\n\t\t}\r\n\t\tvar listenerParams = listener.params || {};\r\n\t\t(!_isNull(listener.eventNames) ? _from(listener.eventNames) : eventNames).forEach(prop => {\r\n\t\t\tif (!(prop in e.$.CACHE)) {\r\n\t\t\t\te.$.CACHE[prop] = {};\r\n\t\t\t\te.$._CACHE[prop] = {};\r\n\t\t\t\t// > ACCESS\r\n\t\t\t\tvar existsReciever = {};\r\n\t\t\t\tvar _existsReciever = {};\r\n\t\t\t\tvar path = _isString(prop) ? prop.split('.') : prop;\r\n\t\t\t\te.$.CACHE[prop].val = _get(e.context, path, existsReciever);\r\n\t\t\t\te.$._CACHE[prop].val = _get(e._context, path, _existsReciever);\r\n\t\t\t\te.$.CACHE[prop].existence = existsReciever.exists;\r\n\t\t\t\te.$._CACHE[prop].existence = _existsReciever.exists;\r\n\t\t\t\t// > DIFFING\r\n\t\t\t\tif (listenerParams.diff !== false && !('diffing' in e.$.CACHE[prop])) {\r\n\t\t\t\t\te.$.CACHE[prop].diffing = e.bubbling\r\n\t\t\t\t\t|| e.$.CACHE[prop].existence !== e.$._CACHE[prop].existence \r\n\t\t\t\t\t|| (_isObject(e.$.CACHE[prop].val) && _isObject(e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t? !_even(e.$.CACHE[prop].val, e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t: e.$.CACHE[prop].val !== e.$._CACHE[prop].val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Delta...\r\n\t\t\tif (_isNumeric(listenerParams.pulse) && e.context && e._context) {\r\n\t\t\t\tif (listenerParams.pulse === 0 && e.$.CACHE[prop].val && !e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t} else if (listenerParams.pulse === 1 && !e.$.CACHE[prop].val && e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Diff...\r\n\t\t\tif (listenerParams.diff === false || e.$.CACHE[prop].diffing) {\r\n\t\t\t\tpasses ++;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn !failures && passes && super._shouldFire(listener, eventNames, e);\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures outgoing objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_outgoing(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tif (prop in this.$.bubblers) {\r\n\t\t\t\tvalue.unobserve(this.$.bubblers[prop], {allowBubbling:true});\r\n\t\t\t}\r\n\t\t\tif (_isFunction(value.getOffsetParent) && value.getOffsetParent() === this) {\r\n\t\t\t\tvalue.setOffsetParent(null);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures incoming objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_incoming(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tvalue.observe(this._getBubbler(prop), {allowBubbling:true});\r\n\t\t\tif (_isFunction(value.getOffsetParent) && !value.getOffsetParent()) {\r\n\t\t\t\tvalue.setOffsetParent(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a function that observes changes in child observables and bubble them up here.\r\n\t *\r\n\t * @param string\t\tname\r\n\t *\r\n\t * @return function\r\n\t */\r\n\t_getBubbler(prop) {\r\n\t\tthis.$.bubblers = this.$.bubblers || {};\r\n\t\tthis.$.bubblers[prop] = (changes, _changes, e) => {\r\n\t\t\tvar _e = {};\r\n\t\t\t_e.context = this.$.state;\r\n\t\t\t_e._context = this.$._state;\r\n\t\t\t_e.entries = (e.entries || []).slice();\r\n\t\t\t_e.exits = (e.exits || []).slice();\r\n\t\t\t_e.bubbling = (e.bubbling ? _from(e.bubbling) : Object.keys(changes))\r\n\t\t\t\t.map(subFieldName => prop + '.' + subFieldName);\r\n\t\t\treturn this.fire(prop, _e);\r\n\t\t};\r\n\t\treturn this.$.bubblers[prop];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Warning handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\twarn(msg) {\r\n\t\tconsole.error(msg);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Error handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\terror(msg) {\r\n\t\tif (this.$.params.strictDebug) {\r\n\t\t\tthrow new Error(msg);\r\n\t\t} else {\r\n\t\t\tconsole.error(msg);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Constructs a proxy wrapper for the target.\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tproxy() {\r\n\t\treturn _proxy(this, {\r\n\t\t\t// -----------------------\r\n\t\t\t// The 4 cardinal points...\r\n\t\t\t// -----------------------\r\n\t\t\tget: function(target, prop) {\r\n\t\t\t\tvar value = target.get(prop);\r\n\t\t\t\tif (_isObject(value) && _isFunction(value.proxy)) {\r\n\t\t\t\t\tvalue = value.proxy();\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\t\t\tset: function(target, prop, val) {\r\n\t\t\t\ttarget.set(prop, val);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\thas: function(target, prop) {\r\n\t\t\t\treturn target.has(prop);\r\n\t\t\t},\r\n\t\t\tdeleteProperty: function(target, prop) {\r\n\t\t\t\treturn target.del(prop);\r\n\t\t\t},\r\n\t\t\t// -----------------------\r\n\t\t\t// Unimportant additions...\r\n\t\t\t// -----------------------\r\n\t\t\townKeys: function(target) {\r\n\t\t\t\t//TODO:return Reflect.ownKeys(target.$.state);\r\n\t\t\t\treturn Object.keys(target.$.state);\r\n\t\t\t},\r\n\t\t\tdefineProperty: function(target, prop, descriptor) {\r\n\t\t\t\tObject.defineProperty(target.$.state, prop, descriptor);\r\n\t\t\t\ttarget.set(prop, target.$.state[prop]);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyDescriptor: function(target, prop) {\r\n\t\t\t\treturn Object.getOwnPropertyDescriptor(target.$.state, prop);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertySymbols: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertySymbols(target.$.state);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyNames: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertyNames(target.$.state);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nObservable.params = {\r\n\tmethodPrefix: '$',\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport Observable from './Observable.js';\r\nimport EventController from './EventController.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tEventController,\r\n\tEvent\r\n};\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport {_isObject} from './Js.js';\r\nimport {_each} from './Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Num (number) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n\r\n/**\r\n * In an array of numbers, returns the item closest to the given value.\r\n *\r\n * @param array|object \tarr\r\n * @param int \t \t\tnum\r\n * @param bool \t \t\tbyKey\r\n *\r\n * @return number\r\n */\r\nconst _closest = function(arr, num, byKey = false) {\r\n\tvar keys = null;\r\n\tvar entries = arr;\r\n\tif (byKey || _isObject(entries)) {\r\n\t\tkeys = Object.keys(entries);\r\n\t\tentries = keys.map(key => entries[key]);\r\n\t}\r\n\tvar closest = entries.reduce((prev, curr) => {\r\n\t  return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);\r\n\t}, undefined);\r\n\treturn keys ? keys[entries.indexOf(closest)] : closest;\r\n};\r\n\r\n/**\r\n * Converts words to numbers\r\n * Adapted from Crunz\\Utils | 22-07-17;\r\n *\r\n * @param  text\r\n *\r\n * @return string\r\n */\r\nconst _fromWords = function(text) {\r\n\tvar data = strtr(text, {\r\n\t\tzero:       '0',\r\n\t\ta:          '1',\r\n\t\tone:        '1',\r\n\t\ttwo:        '2',\r\n\t\tthree:      '3',\r\n\t\tfour:       '4',\r\n\t\tfive:       '5',\r\n\t\tsix:        '6',\r\n\t\tseven:      '7',\r\n\t\teight:      '8',\r\n\t\tnine:       '9',\r\n\t\tten:        '10',\r\n\t\televen:     '11',\r\n\t\ttwelve:     '12',\r\n\t\tthirteen:   '13',\r\n\t\tfourteen:   '14',\r\n\t\tfifteen:    '15',\r\n\t\tsixteen:    '16',\r\n\t\tseventeen: \t'17',\r\n\t\teighteen:   '18',\r\n\t\tnineteen:   '19',\r\n\t\ttwenty:     '20',\r\n\t\tthirty:     '30',\r\n\t\tforty:      '40',\r\n\t\tfourty:     '40',\r\n\t\tfifty:      '50',\r\n\t\tsixty:      '60',\r\n\t\tseventy:    '70',\r\n\t\teighty:     '80',\r\n\t\tninety:     '90',\r\n\t\thundred:    '100',\r\n\t\tthousand:   '1000',\r\n\t\tmillion:    '1000000',\r\n\t\tbillion:    '1000000000',\r\n\t\tand:        '',\r\n\t});\r\n\r\n\t// Coerce all tokens to numbers\r\n\tvar parts = data.split('/[\\s-]+/').map(val => parseFloat(val));\r\n\r\n\tvar tmp   = null;\r\n\tvar sum   = 0;\r\n\tvar last  = null;\r\n\r\n\t_each(parts, (i, part) => {           \r\n\t\tif (tmp !== '') {                \r\n\t\t\tif (tmp > part) {\r\n\t\t\t\tif (last >= 1000) {                                       \r\n\t\t\t\t\tsum += tmp;\r\n\t\t\t\t\ttmp = part;\r\n\t\t\t\t} else {          \r\n\t\t\t\t\ttmp = tmp + part;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttmp = tmp * part;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttmp = part;\r\n\t\t}\r\n\t\t\r\n\t\tlast = part;\r\n\t});\r\n\r\n\treturn sum + tmp;    \r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_closest,\r\n\t_fromWords\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Binds callbacks to requestAnimationFrame()\r\n * to create a central \"read/write\" phases for DOM access.\r\n * ---------------------------\r\n */\r\n\t\t\t\r\nconst Reflow = {\r\n\t\r\n\t/**\r\n\t * Holds all callbacks bound to the \"read\" phase.\r\n\t *\r\n\t * @var array\r\n\t */\r\n\treadCallbacks: [],\r\n\t\r\n\t/**\r\n\t * Holds all callbacks bound to the \"write\" phase.\r\n\t *\r\n\t * @var array\r\n\t */\r\n\twriteCallbacks: [],\r\n\r\n\t/**\r\n\t * Starts the loop.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\t_run: function() {\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tReflow.readCallbacks.forEach((callback, i) => {\r\n\t\t\t\tif (callback && !callback()) {\r\n\t\t\t\t\tReflow.readCallbacks[i] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tReflow.writeCallbacks.forEach((callback, i) => {\r\n\t\t\t\tif (callback && !callback()) {\r\n\t\t\t\t\tReflow.writeCallbacks[i] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tReflow._run();\r\n\t\t});\r\n\t},\r\n\t\r\n\t/**\r\n\t * Binds a callback to the \"read\" phase.\r\n\t *\r\n\t * @param function \tcallback\r\n\t * @param bool\t\twithPromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tonread: function(callback, withPromise = false) {\r\n\t\tif (withPromise) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tReflow.readCallbacks.push(() => {\r\n\t\t\t\t\tcallback(resolve, reject);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tReflow.readCallbacks.push(callback);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Binds a callback to the \"write\" phase.\r\n\t *\r\n\t * @param function \tcallback\r\n\t * @param bool\t\twithPromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tonwrite: function(callback, withPromise = false) {\r\n\t\tif (withPromise) {\r\n\t\t\treturn new Promise((resolve, reject) => {\r\n\t\t\t\tReflow.writeCallbacks.push(() => {\r\n\t\t\t\t\tcallback(resolve, reject);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\t\tReflow.writeCallbacks.push(callback);\r\n\t},\r\n\t\r\n\t/**\r\n\t * A special construct for DOM manipulations that span\r\n\t * one or more read/write cycles.\r\n\t *\r\n\t * @param function \tread\r\n\t * @param function \twrite\r\n\t * @param mixed\t\tprevTransaction\r\n\t *\r\n\t * @return void|mixed\r\n\t */\r\n\tcycle: function(read, write, prevTransaction) {\r\n\t\tReflow.onread(() => {\r\n\t\t\t// Record initial values\r\n\t\t\tvar readReturn = read(prevTransaction);\r\n\t\t\tif (readReturn) {\r\n\t\t\t\t// Call erite, the transation\r\n\t\t\t\tvar callWrite = (readReturn) => {\r\n\t\t\t\t\tReflow.onwrite(() => {\r\n\t\t\t\t\t\tvar writeReturn = write(readReturn, prevTransaction);\r\n\t\t\t\t\t\tif (writeReturn) {\r\n\t\t\t\t\t\t\t// Repeat transaction\r\n\t\t\t\t\t\t\tvar repeatTransaction = (writeReturn) => {\r\n\t\t\t\t\t\t\t\tReflow.cycle(read, write, writeReturn);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t// ---------------------------------------\r\n\t\t\t\t\t\t\t// If \"write\" returns a promise, we wait until it is resolved\r\n\t\t\t\t\t\t\t// ---------------------------------------\r\n\t\t\t\t\t\t\tif (writeReturn instanceof window.Promise) {\r\n\t\t\t\t\t\t\t\twriteReturn.then(repeatTransaction);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\trepeatTransaction();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t};\r\n\t\t\t\t// ---------------------------------------\r\n\t\t\t\t// If \"read\" returns a promise, we wait until it is resolved\r\n\t\t\t\t// ---------------------------------------\r\n\t\t\t\tif (readReturn instanceof window.Promise) {\r\n\t\t\t\t\treadReturn.then(callWrite);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcallWrite();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t},\r\n};\r\nReflow._run();\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reflow;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isBoolean,\r\n\t_isString,\r\n\t_isObject,\r\n\t_isUndefined\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_remove,\r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_each,\r\n\t_from as _obj_from\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_toCamel\r\n} from '@onephrase/commons/src/Str.js';\r\nimport Reflow from './Reflow.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Element manipulation utilites.\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Creates a DOM element\r\n * from any of markup, selector, HTMLElement.\r\n *\r\n * @param mixed \t\t\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst from = function(input) {\r\n\tif (_isString(input)) {\r\n\t\tvar el;\r\n\t\tif (input.trim().startsWith('<')) {\r\n\t\t\t// Create a node from markup\r\n\t\t\tvar temp = document.createElement('div');\r\n\t\t\ttemp.innerHtml = input;\r\n\t\t\tel = temp.firstChild;\r\n\t\t} else {\r\n\t\t\tel = find(input);\r\n\t\t}\r\n\t\treturn el;\r\n\t}\r\n\treturn input;\r\n};\r\n\r\n/**\r\n * Queries a DOM context for the first element matching\r\n * the given selector.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n *\r\n * @return HTMLElement\r\n */\r\nconst find = function(selector, context = document) {\r\n\treturn _find(selector, context, false/*all*/);\r\n};\r\n\r\n/**\r\n * Queries a DOM context for all elements matching\r\n * the given selector.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n *\r\n * @return DOMNodeList\r\n */\r\nconst findAll = function(selector, context = document) {\r\n\treturn _find(selector, context);\r\n};\r\n\r\n/**\r\n * DOM query.\r\n *\r\n * @param string \t\t\t\tselector\r\n * @param DOMElement \t\t\tcontext\r\n * @param bool\t\t \t\t\tall\r\n *\r\n * @return DOMNodeList|HTMLElement\r\n */\r\nconst _find = function(selector, context = document, all = true) {\r\n\tvar matchedItems, method = all ? 'querySelectorAll' : 'querySelector';\r\n\ttry {\r\n\t\tmatchedItems = context[method](selector);\r\n\t} catch(e) {\r\n\t\ttry {\r\n\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':matches('));\r\n\t\t} catch(e) {\r\n\t\t\ttry {\r\n\t\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':-webkit-any('));\r\n\t\t\t} catch(e) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tmatchedItems = context[method](selector.replace(/\\:is\\(/g, ':-moz-any('));\r\n\t\t\t\t} catch(e) {\r\n\t\t\t\t\tthrow e;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn matchedItems;\r\n};\r\n\r\n/**\r\n * @polyfills\r\n */\r\n\r\nif (!Element.prototype.matches) {\r\n\tElement.prototype.matches = \r\n\tElement.prototype.matchesSelector || \r\n\tElement.prototype.mozMatchesSelector ||\r\n\tElement.prototype.msMatchesSelector || \r\n\tElement.prototype.oMatchesSelector || \r\n\tElement.prototype.webkitMatchesSelector ||\r\n\tfunction(s) {\r\n\t\tvar matches = (this.document || this.ownerDocument).querySelectorAll(s),\r\n\t\t\ti = matches.length;\r\n\t\twhile (--i >= 0 && matches.item(i) !== this) {}\r\n\t\treturn i > -1;            \r\n\t};\r\n}\r\n\r\n/**\r\n * Gets or sets custom data.\r\n *\r\n * @param DOMElement\t\t\tel \r\n * @param string|array|object\trequestOrPayload\r\n * @param mixed|void\t\t\tval\r\n *\r\n * @return mixed\r\n */\r\nconst domData = function(el, requestOrPayload, val = null) {\r\n\tif (!el.dataset.__customDatasetKey) {\r\n\t\tel.dataset.__customDatasetKey = customDatasets.length;\r\n\t\tcustomDatasets[el.dataset.__customDatasetKey] = {};\r\n\t}\r\n\tvar customDataset = customDatasets[el.dataset.__customDatasetKey];\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(requestOrPayload)) {\r\n\t\t\treturn customDataset[_toCamel(requestOrPayload)];\r\n\t\t}\r\n\t\tif (_isArray(requestOrPayload)) {\r\n\t\t\tvar vals = {};\r\n\t\t\trequestOrPayload.forEach(key => {\r\n\t\t\t\tvals[key] = customDataset[_toCamel(key)];\r\n\t\t\t});\r\n\t\t\treturn vals;\r\n\t\t}\r\n\t}\r\n\tvar payload = requestOrPayload;\r\n\tif (!_isObject(requestOrPayload)) {\r\n\t\tpayload = _obj_from(requestOrPayload, val);\r\n\t}\r\n\t_each(payload, (key, val) => {\r\n\t\tcustomDataset[_toCamel(key)] = val;\r\n\t});\r\n};\r\nconst customDatasets = [];\r\n \r\n/**\r\n * ---------------------\r\n * MANIPULATION METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * Gets an attribute or a list of attributes,\r\n * or sets an attribute or a list of attributes.\r\n *\r\n * @param DOMElement\t\t\tel \r\n * @param string|array|object\trequestOrPayload\r\n * @param string|bool|void\t\tvalOrMutation\r\n * @param bool|void\t\t\t\tsubValMutation\r\n *\r\n * @return mixed\r\n */\r\nconst domAttr = function(el, requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(requestOrPayload)) {\r\n\t\t\treturn el.getAttribute(requestOrPayload);\r\n\t\t}\r\n\t\tif (_isArray(requestOrPayload)) {\r\n\t\t\tvar vals = {};\r\n\t\t\trequestOrPayload.forEach(request => {\r\n\t\t\t\tvals[request] = el.getAttribute(request);\r\n\t\t\t});\r\n\t\t\treturn vals;\r\n\t\t}\r\n\t}\r\n\tvar payload = requestOrPayload;\r\n\tif (!_isObject(payload)) {\r\n\t\tpayload = _obj_from(requestOrPayload, valOrMutation);\r\n\t} else {\r\n\t\tsubValMutation = valOrMutation;\r\n\t}\r\n\t_each(payload, (name, valOrMutation) => {\r\n\t\tif (arguments.length > 3 || (_isObject(payload) && arguments.length > 2)) {\r\n\t\t\tvar substr = _isString(valOrMutation) ? valOrMutation.trim() : valOrMutation;\r\n\t\t\tvar currentVal = el.getAttribute(name);\r\n\t\t\tvar currentValArray = currentVal ? currentVal.split(' ').map(val => val.trim()) : [];\r\n\t\t\tif (!subValMutation && currentValArray.includes(substr)) {\r\n\t\t\t\t// Add...\r\n\t\t\t\tel.setAttribute(name, _remove(currentValArray, substr).join(' '));\r\n\t\t\t} else if (subValMutation && !currentValArray.includes(substr)) {\r\n\t\t\t\t// Remove...\r\n\t\t\t\tel.setAttribute(name, currentValArray.concat(substr).join(' '));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (valOrMutation === false) {\r\n\t\t\t\tel.removeAttribute(name);\r\n\t\t\t} else {\r\n\t\t\t\tel.setAttribute(name, valOrMutation === true ? 'true' : valOrMutation);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\treturn el;\r\n};\r\n\r\n/**\r\n * Sets or gets HTML content.\r\n *\r\n * @param string|HTMLElement\tcontent\r\n *\r\n * @return void|string\r\n */\r\nconst domHtml = function(el, content = null) {\r\n\tif (arguments.length > 1) {\r\n\t\tif (_isString(content)) {\r\n\t\t\tel.innerHTML = content;\r\n\t\t} else {\r\n\t\t\tel.innerHTML = '';\r\n\t\t\tif (!_isUndefined(content)) {\r\n\t\t\t\tel.append(content);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn el;\r\n\t}\r\n\treturn el.innerHTML;  \r\n};\r\n\r\n/**\r\n * Sets or gets text content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return void|string\r\n */\r\nconst domText = function(el, content = null) {\r\n\tif (arguments.length > 1) {\r\n\t\tel.innerText = _isUndefined(content) ? '' : content;\r\n\t\treturn el;\r\n\t}\r\n\treturn el.innerText;  \r\n};\r\n\r\n/**\r\n * Appends new content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return HTMLElement\r\n */\r\nconst domAppend = function(el, content) {\r\n\tel.append(_isUndefined(content) ? '' : content); \r\n\treturn el; \r\n};\r\n\r\n/**\r\n * Prepends new content.\r\n *\r\n * @param string \t\t\t\tcontent\r\n *\r\n * @return HTMLElement\r\n */\r\nconst domPrepend = function(el, content) {\r\n\tel.prepend(_isUndefined(content) ? '' : content);  \r\n\treturn el; \r\n};\r\n \r\n/**\r\n * ---------------------\r\n * ASYNC METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * The async type of domAttr().\r\n *\r\n * @see domAttr()\r\n *\r\n * @return Promise\r\n */\r\nconst domAttrAsync = function(el, requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\tif (arguments.length === 2) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domAttr(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domAttr(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domHtml().\r\n *\r\n * @see domHtml()\r\n *\r\n * @return Promise\r\n */\r\nconst domHtmlAsync = function(el, write = null) {\r\n\tif (arguments.length > 1) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domHtml(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domHtml(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domText().\r\n *\r\n * @see domText()\r\n *\r\n * @return Promise\r\n */\r\nconst domTextAsync = function(el, write = null) {\r\n\tif (arguments.length > 1) {\r\n\t\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\t\ttry {\r\n\t\t\t\tresolve(domText(...arguments));\r\n\t\t\t} catch(e) {\r\n\t\t\t\treject(e);\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domText(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domAppend().\r\n *\r\n * @see domAppend()\r\n *\r\n * @return Promise\r\n */\r\nconst domAppendAsync = function(el, write) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domAppend(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of domPrepend().\r\n *\r\n * @see domPrepend()\r\n *\r\n * @return Promise\r\n */\r\nconst domPrependAsync = function(el, write) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(domPrepend(...arguments));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n \r\n/**\r\n * ---------------------\r\n * OTHER METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * Returns all, only text nodes.\r\n *\r\n * @param DOMElement \t\t\tel\r\n *\r\n * @return array\r\n */\r\nconst domTextNodes = function(el) {\r\n\t// Filter\r\n\tvar rejectScriptTextFilter = {\r\n\t\tacceptNode: function(node) {\r\n\t\t\tif (node.parentNode.nodeName !== 'SCRIPT') {\r\n\t\t\t\treturn NodeFilter.FILTER_ACCEPT;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t// Walker\r\n\tvar walker = document.createTreeWalker(el, NodeFilter.SHOW_TEXT, rejectScriptTextFilter, false);\r\n\tvar node;\r\n\tvar textNodes = [];\r\n\twhile(node = walker.nextNode()) {\r\n\t\ttextNodes.push(node.nodeValue);\r\n\t}\r\n\treturn textNodes;\r\n};\r\n\r\n/**\r\n * Observes when the given elements or selectors are added or removed\r\n * from the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param int\t\t\t\t\t\ttest\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domMutationCallback = function(els, callback, test = null, context = null, observeContext = true) {\r\n\tvar search = (el, nodeListArray) => {\r\n\t\tif (_isString(el)) {\r\n\t\t\t// Is directly mutated...\r\n\t\t\tvar matches = nodeListArray.filter(node => node.matches(el));\r\n\t\t\tif (matches.length) {\r\n\t\t\t\treturn matches;\r\n\t\t\t}\r\n\t\t\t// Is contextly mutated...\r\n\t\t\tif (observeContext) {\r\n\t\t\t\tmatches = nodeListArray\r\n\t\t\t\t\t.reduce((collection, node) => collection.concat(_arr_from(node.querySelectorAll(el))), []);\r\n\t\t\t\tif (matches.length) {\r\n\t\t\t\t\treturn matches;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Is directly mutated...\r\n\t\t\tif (nodeListArray.includes(el)) {\r\n\t\t\t\treturn el;\r\n\t\t\t}\r\n\t\t\t// Is contextly mutated...\r\n\t\t\tif (observeContext && nodeListArray.length) {\r\n\t\t\t\tvar parentNode = el;\r\n\t\t\t\twhile(!success && (parentNode = parentNode.parentNode)) {\r\n\t\t\t\t\tif (nodeListArray.includes(parentNode)) {\r\n\t\t\t\t\t\treturn el;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\tvar mo = new MutationObserver(mutations => {\r\n\t\tif (test !== 0) {\r\n\t\t\tvar matchedAddedNodes = [];\r\n\t\t\t_arr_from(els).forEach(el => {\r\n\t\t\t\tif (_isString(el)) {\r\n\t\t\t\t\tmatchedAddedNodes = mutations\r\n\t\t\t\t\t\t.reduce((matches, mut) => matches.concat(search(el, _arr_from(mut.addedNodes)), matchedAddedNodes));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar matchedAsAddedNode = mutations\r\n\t\t\t\t\t\t.reduce((match, mut) => match || search(el, _arr_from(mut.addedNodes)), null);\r\n\t\t\t\t\tif (matchedAsAddedNode) {\r\n\t\t\t\t\t\tmatchedAddedNodes.push(matchedAsAddedNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (matchedAddedNodes.length) {\r\n\t\t\t\tcallback(1, ...matchedAddedNodes);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (test !== 1) {\r\n\t\t\tvar matchedRemovedNodes = [];\r\n\t\t\t_arr_from(els).forEach(el => {\r\n\t\t\t\tif (_isString(el)) {\r\n\t\t\t\t\tmatchedRemovedNodes = mutations\r\n\t\t\t\t\t\t.reduce((matches, mut) => matches.concat(search(el, _arr_from(mut.removedNodes)), matchedRemovedNodes));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar matchedAsRemovedNode = mutations\r\n\t\t\t\t\t\t.reduce((match, mut) => match || search(el, _arr_from(mut.removedNodes)), null);\r\n\t\t\t\t\tif (matchedAsRemovedNode) {\r\n\t\t\t\t\t\tmatchedRemovedNodes.push(matchedAsRemovedNode);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (matchedRemovedNodes.length) {\r\n\t\t\t\tcallback(0, ...matchedRemovedNodes);\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tmo.observe(context || document.body, {childList:true, subtree:true});\r\n\treturn mo;\r\n};\r\n\r\n/**\r\n * Shortcut function to connectedCallback().\r\n *\r\n * Observes when the given elements or selectors are added\r\n * to the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domConnectedCallback = function(els, callback, context = null, observeContext = true) {\r\n\treturn connectedCallback(els, (test, ...els) => {\r\n\t\tcallback(...els);\r\n\t}, 1/*test*/, context, observeContext);\r\n};\r\n\r\n/**\r\n * Shortcut function to connectedCallback().\r\n *\r\n * Observes when the given elements or selectors are removed\r\n * from the given context.\r\n *\r\n * @param array|HTMLElement|string\tels\r\n * @param function\t\t\t\t\tcallback\r\n * @param HTMLElement|string\t\tcontext\r\n * @param bool\t\t\t\t\t\tobserveContext\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domDisconnectedCallback = function(els, callback, context = null, observeContext = true) {\r\n\treturn connectedCallback(els, (test, ...els) => {\r\n\t\tcallback(...els);\r\n\t}, 0/*test*/, context, observeContext);\r\n};\r\n\r\n/**\r\n * Observes changes in attributes of the given element.\r\n *\r\n * @param HTMLElement\t\t\t\tel\r\n * @param function\t\t\t\t\tcallback\r\n * @param array\t\t\t\t\t\tfilter\r\n *\r\n * @return MutationObserver\r\n */\r\nconst domAttrChangeCallback = function(el, callback, filter = []) {\r\n\tvar observer = new MutationObserver(mutations => {\r\n\t\tmutations.forEach(m => {\r\n\t\t\tcallback(m);\r\n\t\t});\r\n\t});\r\n\tvar params = {attributes:true, attributeOldValue:true};\r\n\tif (filter) {\r\n\t\tparams.attributeFilter = filter;\r\n\t}\r\n\tobserver.observe(el, params);\r\n\treturn observer;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tfrom,\r\n\tfind,\r\n\tfindAll,\r\n\tdomData,\r\n\tdomAttr,\r\n\tdomHtml,\r\n\tdomText,\r\n\tdomAppend,\r\n\tdomPrepend,\r\n\tdomAttrAsync,\r\n\tdomHtmlAsync,\r\n\tdomTextAsync,\r\n\tdomAppendAsync,\r\n\tdomPrependAsync,\r\n\tdomTextNodes,\r\n\tdomMutationCallback,\r\n\tdomConnectedCallback,\r\n\tdomDisconnectedCallback,\r\n\tdomAttrChangeCallback,\r\n};","\r\n/**\r\n * ---------------------------\r\n * A collection of Vendor utilities.\r\n * ---------------------------\r\n */\r\n \t\r\n/**\r\n* The vendor prefix in different format.\r\n*\r\n* @param object\r\n*/\r\nconst vendorPrefix = (function() {\r\n\tvar styles = window.getComputedStyle(document.documentElement, '');\r\n\tvar prefix = (Array.prototype.slice.call(styles).join('').match(/-(moz|webkit|ms)-/) || styles.Olink === '' && ['', 'o'])[1];\r\n\tvar api = ('WebKit|Moz|Ms|O').match(new RegExp('(' + prefix + ')', 'i'))[1];\r\n\treturn {prefix:prefix, css:'-' + prefix + '-', api:api,};\r\n})();\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tvendorPrefix,\r\n}","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isObject,\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\n\r\n/**\r\n * ----------------------------------------\r\n * Establishes an operatiom that can be rolledback\r\n * without altering similar operation by other code.\r\n * ----------------------------------------\r\n */\r\n \r\nconst Transaction = class {\r\n\r\n\t/**\r\n\t * Creates a new transaction instance.\r\n\t *\r\n\t * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel \r\n\t * @param string|array|object\tparams\r\n\t * @param function\t \t\t\treadCallback\r\n\t * @param function\t \t\t\twriteCallback\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params, readCallback, writeCallback) {\r\n\t\tthis.el = el;\r\n\t\tthis.params = _arr_from(params);\r\n\t\tthis.readCallback = readCallback;\r\n\t\tthis.writeCallback = writeCallback;\r\n\t\tthis.$savepoints = [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a savepoint that can be later rolled back to.\r\n\t *\r\n\t * @return Promise|mixed\r\n\t */\r\n\tsave() {\r\n\t\tvar readerDisposition = this.readCallback(this.el, this.params);\r\n\t\tif (readerDisposition instanceof Promise) {\r\n\t\t\treturn readerDisposition.then(data => this.$savepoints.push(data));\r\n\t\t} else if (_isObject(readerDisposition)) {\r\n\t\t\treturn this.$savepoints.push(readerDisposition);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Marks recods a commited.\r\n\t *\r\n\t * @param int\tsavepoint\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tcommit(savepoint = 0) {\r\n\t\tfor (var i = 0; i <= savepoint && savepoint < this.$savepoints.length; i ++) {\r\n\t\t\tthis.$savepoints[i] = null;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Rolls the transaction back to a savepoint.\r\n\t *\r\n\t * @param int\tsavepoint\r\n\t *\r\n\t * @return void}Promise\r\n\t */\r\n\trollback(savepoint = 0) {\r\n\t\tif (!_isNumeric(savepoint)) {\r\n\t\t\tthrow new Error('A valid transaction ID transaction must be provided!');\r\n\t\t}\r\n\t\t// -----------------------\r\n\t\tvar getRollbackData = currentRead => {\r\n\t\t\tvar savepoints = this.$savepoints.splice(savepoint);\r\n\t\t\t// ToSavepoint is our target point\r\n\t\t\tvar toSavepoint = savepoints.shift();\r\n\t\t\tif (!toSavepoint) {\r\n\t\t\t\treturn {};\r\n\t\t\t}\r\n\t\t\t// FromSavepoint is our last point before current,\r\n\t\t\t// which we need to validate with current\r\n\t\t\tvar fromSavepoint = savepoints.pop();\r\n\t\t\tvar data = {};\r\n\t\t\t// Restore only what's applicable.\r\n\t\t\tthis.params.forEach(param => {\r\n\t\t\t\t// We'll restore only values that have\r\n\t\t\t\t// NOT changed from what we earlier COMMITTED...\r\n\t\t\t\tif (fromSavepoint && currentRead[param] !== fromSavepoint[param]) {\r\n\t\t\t\t\treturn\r\n\t\t\t\t}\r\n\t\t\t\t// We'll restore only values that\r\n\t\t\t\t// HAVE changed from what we earlier RECORDED...\r\n\t\t\t\tif (currentRead[param] !== toSavepoint[param]) {\r\n\t\t\t\t\tdata[param] = toSavepoint[param];\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn data;\r\n\t\t};\r\n\t\t// -----------------------\r\n\t\tvar currentRead = this.readCallback(this.el, this.params);\r\n\t\tif (currentRead instanceof Promise) {\r\n\t\t\treturn currentRead.then(currentRead => this.writeCallback(this.el, getRollbackData(currentRead)));\r\n\t\t}\r\n\t\treturn this.writeCallback(this.el, getRollbackData(currentRead));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns the number of pushes.\r\n\t *\r\n\t * @return int\r\n\t */\r\n\tdepth() {\r\n\t\treturn this.$savepoints.length;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Transaction;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_isArray,\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\n\r\n/**\r\n * ------------------------------\r\n * The little transform utility class\r\n * and stringifyer classes.\r\n * ------------------------------\r\n */\r\nconst TransformRule = class {\r\n\t\r\n\t/**\r\n\t * Creates a new TransformRule instance\r\n\t * and each rule's appropriate class.\r\n\t *\r\n\t * @param object\t\t transformRules\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(transformRules) {\r\n\t\t_each(transformRules, (rule, value) => {\r\n\t\t\tif (['rotate', 'scale', 'skew', 'translate'].includes(rule)) {\r\n\t\t\t\tthis[rule] = _isArray(value)\r\n\t\t\t\t\t? new TransformRule[rule](...value)\r\n\t\t\t\t\t: new TransformRule[rule](value);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Stringifies the transformRules in a CSS-compatible format.\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\treturn ['rotate', 'scale', 'skew', 'translate'].reduce(\r\n\t\t\t(str, rule) => str + (this[rule] && this[rule].length ? ' ' + this[rule] : ''), ''\r\n\t\t).trim();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Unmatrix: parse the values of the matrix\r\n\t *\r\n\t * Algorithm from:\r\n\t *\r\n\t * https://github.com/matthewmueller/unmatrix/blob/master/index.js\r\n\t * @see http://hg.mozilla.org/mozilla-central/file/7cb3e9795d04/layout/style/nsStyleAnimation.cpp\r\n\t *\r\n\t * @param string \t str\r\n\t *\r\n\t * @return {Object}\r\n\t */\r\n\tstatic parse(str) {\r\n\t\t// String to matrix\r\n\t\tvar stom = function(transformStr) {\r\n\t\t\tvar m = [];\r\n\t\t\tif (window.WebKitCSSMatrix) {\r\n\t\t\t\tm = new window.WebKitCSSMatrix(transformStr);\r\n\t\t\t\treturn [m.a, m.b, m.c, m.d, m.e, m.f];\r\n\t\t\t}\r\n\t\t\tvar rdigit = /[\\d\\.\\-]+/g;\r\n\t\t\tvar n;\r\n\t\t\twhile(n = rdigit.exec(transformStr)) {\r\n\t\t\t\tm.push(+n);\r\n\t\t\t}\r\n\t\t\treturn m;\r\n\t\t};\r\n\t\t// Round to the nearest hundredth\r\n\t\tvar round = function(n) {\r\n\t\t\treturn Math.round(n * 100) / 100;\r\n\t\t};\r\n\t\t// Radians to degrees\r\n\t\tvar r2d = function(radians) {\r\n\t\t\tvar deg = radians * 180 / Math.PI;\r\n\t\t\treturn round(deg);\r\n\t\t};\r\n\t\t// ---------------------------------\r\n\t\tvar m = stom(str);\r\n\t\tvar A = m[0];\r\n\t\tvar B = m[1];\r\n\t\tvar C = m[2];\r\n\t\tvar D = m[3];\r\n\t\tif (A * D == B * C) throw new Error('Dramatic.parseTransform: matrix is singular');\r\n\t\t// step (3)\r\n\t\tvar scaleX = Math.sqrt(A * A + B * B);\r\n\t\tA /= scaleX;\r\n\t\tB /= scaleX;\r\n\t\t// step (4)\r\n\t\tvar skew = A * C + B * D;\r\n\t\tC -= A * skew;\r\n\t\tD -= B * skew;\r\n\t\t// step (5)\r\n\t\tvar scaleY = Math.sqrt(C * C + D * D);\r\n\t\tC /= scaleY;\r\n\t\tD /= scaleY;\r\n\t\tskew /= scaleY;\r\n\t\t// step (6)\r\n\t\tif ( A * D < B * C ) {\r\n\t\t\tA = -A;\r\n\t\t\tB = -B;\r\n\t\t\tskew = -skew;\r\n\t\t\tscaleX = -scaleX;\r\n\t\t}\r\n\t\treturn new TransformRule({\r\n\t\t\ttranslate: [/*x*/m[4], /*y*/m[5],],\r\n\t\t\tscale: [/*x*/round(scaleX), /*y*/round(scaleY),],\r\n\t\t\trotate: r2d(Math.atan2(B, A)),\r\n\t\t\tskew: r2d(Math.atan(skew)),\r\n\t\t});\r\n\t};\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"rotate\" value class\r\n * -------------\r\n */\r\nTransformRule.rotate = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"rotate\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'deg' : val);\r\n\t\treturn 'rotate(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"scale\" array class\r\n * -------------\r\n */\r\nTransformRule.scale = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"scale\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\treturn 'scale(' + this.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"skew\" array class\r\n * -------------\r\n */\r\nTransformRule.skew = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"skew\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'deg' : val);\r\n\t\treturn 'skew(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * -------------\r\n * The \"translate\" array class\r\n * -------------\r\n */\r\nTransformRule.translate = class extends Array {\r\n\t\r\n\t/**\r\n\t * Returns \"translate\" values as a CSS function\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoString() {\r\n\t\tvar values = this.map(val => _isNumeric(val) ? val + 'px' : val);\r\n\t\treturn 'translate(' + values.join(', ') + ')';\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default TransformRule;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_fromCamel,\r\n\t_toCamel\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_isArray,\r\n\t_isObject,\r\n\t_isFunction,\r\n\t_isString,\r\n\t_isNumeric,\r\n\t_isUndefined\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_flatten,\r\n\t_replace,\r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_copyPlain,\r\n\t_each,\r\n\t_from as _obj_from\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\tvendorPrefix\r\n} from '../../App/Client.js';\r\nimport Transaction from '../Transaction.js';\r\nimport Reflow from '../Reflow.js';\r\nimport TransformRule from './TransformRule.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Returns computed CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|array\t\tprops\r\n * @param string\t\t\tpsuedo\r\n *\r\n * @return object|string\r\n */\r\nconst cssRead = function(el, props, psuedo = null) {\r\n\tvar style = window.getComputedStyle(el, psuedo), rect;\r\n\treturn ruleCallback(props, (prop, rawProp) => {\r\n\t\tvar val = style.getPropertyValue(vendorize(prop) || prop);\r\n\t\tif ((prop === 'width' || prop === 'height') && val === '') {\r\n\t\t\tval = '0px';\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// We return an object for the \"transform\" property\r\n\t\t// -----------------------------\r\n\t\tif (prop === 'transform') {\r\n\t\t\tval = TransformRule.parse(val);\r\n\t\t}\r\n\t\treturn val;\r\n\t}, false/*withVendorVersion*/);\r\n};\r\n\r\n/**\r\n * Sets new CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tnameOrProps\r\n * @param string|number\t\tval\r\n *\r\n * @return HTMLElement\r\n */\r\nconst cssWrite = function(el, nameOrProps, val = null) {\r\n\tnameOrProps = typeof nameOrProps === 'string' \r\n\t\t? _obj_from(nameOrProps, val)\r\n\t\t: nameOrProps;\r\n\tvar destructables = {\r\n\t\tinset: ['top', 'right', 'bottom', 'left'],\r\n\t\tmargin: ['top', 'right', 'bottom', 'left'],\r\n\t\tpadding: ['top', 'right', 'bottom', 'left'],\r\n\t};\r\n\truleCallback(Object.keys(nameOrProps), (prop, rawProp) => {\r\n\t\tvar val = nameOrProps[rawProp];\r\n\t\t// -----------------------------\r\n\t\t// We can destucture things like \"inset\"(\"left\", \"top\", \"right\", \"bottom\"), etc\r\n\t\t// -----------------------------\r\n\t\t_each(destructables, (destructableProp, meaning) => {\r\n\t\t\tif (prop === destructableProp) {\r\n\t\t\t\tif (_isObject(val)) {\r\n\t\t\t\t\tval = meaning.map(key => val[key]).filter(val => !_isUndefined(val));\r\n\t\t\t\t}\r\n\t\t\t\tif (_isArray(val)) {\r\n\t\t\t\t\tval = val.join(' ');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\t// -----------------------------\r\n\t\t// We accept an object for the \"transform\" property\r\n\t\t// -----------------------------\r\n\t\tif (prop === 'transform' && _isObject(val) && !(val instanceof TransformRule)) {\r\n\t\t\tval = (new TransformRule(val)).toString();\r\n\t\t}\r\n\t\tel.style[prop] = autopx.includes(prop) && _isNumeric(val)\r\n\t\t\t? val + 'px'\r\n\t\t\t: val;\r\n\t}, 'auto'/*withVendorVersion*/);\r\n\treturn el;\r\n};\r\n \r\n/**\r\n * The cssRead() and cssWrite() function in one signature.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param array\t\t\t\t...args\r\n *\r\n * @return mixed\r\n */\r\nconst css = function(el, ...args) {\r\n\tif ((args.length > 1 && _isString(args[0])) || _isObject(args[0])) {\r\n\t\treturn cssWrite(el, ...args);\r\n\t}\r\n\treturn cssRead(el, ...args);\r\n};\r\n \r\n/**\r\n * ---------------------\r\n * ASYNC METHODS\r\n * ---------------------\r\n */\r\n\r\n/**\r\n * The async type of cssRead().\r\n *\r\n * @see cssRead()\r\n *\r\n * @return Promise\r\n */\r\nconst cssReadAsync = function(el, props, psuedo = null) {\r\n\treturn Reflow.onread((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(_isFunction(props) ? props(el) : cssRead(el, props, psuedo));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n\r\n/**\r\n * The async type of cssWrite().\r\n *\r\n * @see cssWrite()\r\n *\r\n * @return Promise\r\n */\r\nconst cssWriteAsync = function(el, nameOrProps, val = null) {\r\n\treturn Reflow.onwrite((resolve, reject) => {\r\n\t\ttry {\r\n\t\t\tresolve(cssWrite(el, nameOrProps, val));\r\n\t\t} catch(e) {\r\n\t\t\treject(e);\r\n\t\t}\r\n\t}, true/*withPromise*/);\r\n};\r\n \r\n/**\r\n * The async type of css().\r\n *\r\n * @see css()\r\n *\r\n * @return Promise\r\n */\r\nconst cssAsync = function(el, ...args) {\r\n\tif ((args.length > 1 && _isString(args[0])) || _isObject(args[0])) {\r\n\t\treturn cssWriteAsync(el, ...args);\r\n\t}\r\n\treturn cssReadAsync(el, ...args);\r\n};\r\n\r\n/**\r\n * Applies some CSS within a transaction, gets computed values for use before rolling back.\r\n * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n *\r\n * @param HTMLElement\t\tel \r\n * @param string|object\t\tnameOrProps\r\n * @param string|number\t\tval\r\n * @param function\t\t\treadCallback\r\n *\r\n * @return Promise\r\n */\r\nconst cssComputeAsync = function(el, nameOrProps, val = null, readCallback = null) {\r\n\tvar propsToRead = _isObject(nameOrProps) ? Object.keys(nameOrProps) : nameOrProps;\r\n\treadCallback = _isObject(nameOrProps) ? val : readCallback;\r\n\t// -------------\r\n\tvar inlineSavepoint = cssReadInline(el, propsToRead);\r\n\treturn cssWriteAsync(el, nameOrProps, val).then(() => {\r\n\t\treturn cssReadAsync(el, readCallback || propsToRead).then(computedValues => {\r\n\t\t\t// We return the computedValues in a promise\r\n\t\t\treturn cssWriteAsync(el, inlineSavepoint).then(() => {\r\n\t\t\t\treturn computedValues;\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n};\r\n\r\n/**\r\n * Establishes a CSS operatiom that can be rolledback without altering similar operation by other code.\r\n * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n *\r\n * @param HTMLElement\t\t\tel \r\n * @param string|array\t\t\tprops\r\n *\r\n * @return Transaction\r\n */\r\nconst cssTransaction = function(el, props) {\r\n\treturn new Transaction(el, props, (el, props) => {\r\n\t\treturn cssReadInline(el, props);\r\n\t}, (el, data) => {\r\n\t\treturn cssWriteAsync(el, data);\r\n\t});\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Stylesheet functions.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Returns inline-only CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tprop\r\n * @param bool|string\t\twithVendorVersions\r\n *\r\n * @return mixed\r\n */\r\nconst cssReadInline = function(el, props, withVendorVersion = 'auto') {\r\n\tvar style = el.getAttribute('style');\r\n\tif (props === 'all') {\r\n\t\tprops = style.split(';').map(str => str.split(':')[0]);\r\n\t}\r\n\treturn ruleCallback(props, prop => {\r\n\t\tvar regex = new RegExp(';[ ]*?' + prop + ':([^;]+);?', 'g');\r\n\t\treturn (regex.exec(';' + style) || ['', ''])[1].trim();\r\n\t}, withVendorVersion);\r\n};\r\n\r\n/**\r\n * Returns inline-only CSS properties.\r\n *\r\n * @param HTMLElement\t\tel\r\n * @param string|object\t\tprop\r\n * @param bool\t\t\t\tnoCache\r\n * @param bool\t\t\t\twithVendorVersions\r\n *\r\n * @return jQuery|object|string\r\n */\r\nconst cssReadStylesheet = function(el, props, noCache, withVendorVersion = 'auto') {\r\n\t// Ask cache first...\r\n\tvar cacheKey = _isArray(props) ? props.join('|') : props;\r\n\tif (!noCache && stylesheetCache[cacheKey] && stylesheetCache[cacheKey].el === el) {\r\n\t\treturn stylesheetCache[cacheKey]._remove(el);\r\n\t}\r\n\t// Find rules\r\n\tvar allRules = [];\r\n\tstylesheetRuleCallback(ruleDefinition => {\r\n\t\tif (ruleDefinition.type === window.CSSRule.STYLE_RULE && el.matches(ruleDefinition.selectorText)) {\r\n\t\t\tvar propsList = props;\r\n\t\t\tif (!props/*original*/) {\r\n\t\t\t\tpropsList = [];\r\n\t\t\t\tfor (var i = 0; i < ruleDefinition.style.length; i ++) {\r\n\t\t\t\t\tpropsList.push(ruleDefinition.style[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tallRules.push(ruleCallback(propsList, prop => {\r\n\t\t\t\treturn ruleDefinition.style[prop];\r\n\t\t\t}, withVendorVersion));\r\n\t\t}\r\n\t});\r\n\t// Handle priority\r\n\tallRules.forEach(rules => {});\r\n\t// Save\r\n\tif (!stylesheetCache) {\r\n\t\tstylesheetCache = {};\r\n\t}\r\n\tstylesheetCache[cacheKey] = allRules.slice();\r\n\tstylesheetCache[cacheKey].el = el;\r\n\treturn allRules;\r\n};\r\n\t\t\r\n/**\r\n * FInds the keyframes of the given animation name(s) across all stylesheets.\r\n *\r\n * @param string|array\t\tname\r\n * @param bool\t\t\t\tnoCache\r\n * @param bool\t\t\t\tnormalize\r\n *\r\n * @return NULL|bool\r\n */\r\nconst cssReadKeyframes = function(name, noCache, normalize = true) {\r\n\t// Ask cache first...\r\n\tvar cacheKey = _isArray(name) ? name.join('|') : name;\r\n\tif (!noCache && stylesheetKeyframesCache[cacheKey]) {\r\n\t\treturn stylesheetKeyframesCache[cacheKey];\r\n\t}\r\n\t// Parse keyframes rule\r\n\tvar parseKeyframes = function(ruleDefinition) {\r\n\t\tvar keyframes = [];\r\n\t\tfor (var i = 0; i < ruleDefinition.cssRules.length; i ++) {\r\n\t\t\tvar keyframeRule = ruleDefinition.cssRules[i];\r\n\t\t\tvar keyframe = parseRules(keyframeRule.cssText\r\n\t\t\t\t.replace(keyframeRule.keyText, '').replace('{', '').replace('}', '').trim()\r\n\t\t\t);\r\n\t\t\tvar offsets = (keyframeRule.keyText || ' ').split(',').map(key => key === 'from' ? 0 : (key === 'to' ? 1 : (parseInt(key) / 100)));\r\n\t\t\tif (normalize) {\r\n\t\t\t\tnormalizeToWAAPI(keyframe, ['animation-', 'transition-']);\r\n\t\t\t\twhile(offsets.length) {\r\n\t\t\t\t\tvar _keyframe = _copyPlain(keyframe);\r\n\t\t\t\t\t_keyframe.offset = offsets.shift();\r\n\t\t\t\t\tkeyframes.push(_keyframe);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tkeyframe.offset = offsets.length > 1 ? offsets : offsets[0];\r\n\t\t\t\tkeyframes.push(keyframe);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn keyframes.sort((a, b) => a.offset === b.offset ? 0 : a.offset > b.offset ? 1 : -1);\r\n\t};\r\n\t// Find keyframes\r\n\tvar allKeyframes = [];\r\n\tstylesheetRuleCallback(ruleDefinition => {\r\n\t\tif ((ruleDefinition.type === window.CSSRule.KEYFRAMES_RULE || ruleDefinition.type === window.CSSRule[vendorPrefix.api.toUpperCase() + '_KEYFRAMES_RULE'])\r\n\t\t&& (_isArray(name) ? name : [name]).indexOf(ruleDefinition.name) > -1) {\r\n\t\t\tallKeyframes = allKeyframes.concat(allKeyframes, parseKeyframes(ruleDefinition));\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}, true/*reversed*/);\r\n\t// Save\r\n\tstylesheetKeyframesCache[cacheKey] = allKeyframes;\r\n\treturn allKeyframes;\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Other utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Tells if the element's width is defined as auto.\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return bool\r\n */\r\nconst isAutoWidth = function(el) {\r\n};\r\n\r\n/**\r\n * Tells if the element's height is defined as auto.\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return bool\r\n */\r\nconst isAutoHeight = function(el) {\r\n};\r\n\r\n/**\r\n * Parses/decodes the element's transform rule\r\n *\r\n * @param HTMLElement el\r\n *\r\n * @return object\r\n */\r\nconst transformRule = function(el) {\r\n};\r\n\t\t\r\n/**\r\n * Returns preset easing functions from CSS variables.\r\n *\r\n * @param string \tname\r\n *\r\n * @return string|NULL\r\n */\r\nconst cssVarRead = function(name) {\r\n\t var name = !name.indexOf('-') ? _fromCamel(name, '-') : name;\r\n\treturn window.getComputedStyle(document.body).getPropertyValue('--' + name);\r\n};\r\n\r\n// -----------------------------------------\r\n// -----------------------------------------\r\n\r\n/**\r\n * Normalizes CSS animation properties to WAAPI compatible properties\r\n *\r\n * @param object\t\t\tanimationProps\r\n * @param string|arrau\t\tprefix\r\n * @param string|arrau\t\toffset\r\n *\r\n * @return null\r\n */\r\nconst normalizeToWAAPI = function(animationProps, offset, prefix = '') {\r\n\tif (_isArray(prefix)) {\r\n\t\tprefix.forEach(pref => {normalizeToWAAPI(animationProps, pref)});\r\n\t\treturn;\r\n\t}\r\n\tif (animationProps[prefix + 'timing-function']) {\r\n\t\tanimationProps.easing = animationProps[prefix + 'timing-function'];\r\n\t\tdelete animationProps[prefix + 'timing-function'];\r\n\t}\r\n\tif (animationProps[prefix + 'fill-mode']) {\r\n\t\tanimationProps.fill = animationProps[prefix + 'fill-mode'];\r\n\t\tdelete animationProps[prefix + 'fill-mode'];\r\n\t}\r\n\tif (animationProps[prefix + 'iteration-count']) {\r\n\t\tanimationProps.iterations = animationProps[prefix + 'iteration-count'];\r\n\t\tdelete animationProps[prefix + 'iteration-count'];\r\n\t\tif (animationProps.iterations === 'infinite') {\r\n\t\t\tanimationProps.iterations = Infinity;\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Loops thru all keys in props calls callback to obtain their value.\r\n *\r\n * @param string|array\t\tprops\r\n * @param function\t\t\tcallback\r\n * @param bool\t\t\t\twithVendorVersion\r\n *\r\n * @return NULL|bool\r\n */\r\nconst ruleCallback = function(props, callback, withVendorVersion) {\r\n\tvar valsList = {};\r\n\tvar propsList = _arr_from(props);\r\n\tvar callCallback = (i, prop) => {\r\n\t\t// We use the key as given, but we obtain value with\r\n\t\t// We support camel cases, but return their normalized versions\r\n\t\tvar normalProp = _fromCamel(prop, '-').toLowerCase();\r\n\t\t// With vendor verison?\r\n\t\t// We set the vendor version first if support for this property\r\n\t\tif (withVendorVersion === 'auto') {\r\n\t\t\tvalsList[normalProp] = callback(vendorize(normalProp) || normalProp, propsList[i]);\r\n\t\t} else {\r\n\t\t\tif (withVendorVersion) {\r\n\t\t\t\tvar vendorizedProp = vendorize(normalProp);\r\n\t\t\t\tif (vendorizedProp) {\r\n\t\t\t\t\tvalsList[vendorizedProp] = callback(vendorizedProp, propsList[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalsList[normalProp] = callback(normalProp, propsList[i]);\r\n\t\t}\r\n\t};\r\n\t_each(propsList, (i, prop) => {\r\n\t\tcallCallback(i, prop);\r\n\t});\r\n\treturn _isArray(props) || withVendorVersion || props === 'size' || props === 'offsets' \r\n\t\t? valsList \r\n\t\t: valsList[props];\r\n};\r\n\r\n/**\r\n * Loops thru all rules in all stylesheets (in reverse order possible).\r\n *\r\n * @param function\t\t\tcallback\r\n * @param bool\t\t\t\treversed\r\n *\r\n * @return NULL|bool\r\n */\r\nconst stylesheetRuleCallback = function(callback, reversed) {\r\n\tvar stylesheets = document.styleSheets;\r\n\tvar stylesheetCallback = function(stylesheet) {\r\n\t\ttry {\r\n\t\t\tfor (var k = 0; k < stylesheet.cssRules.length; k ++) {\r\n\t\t\t\tvar ruleDefinition = stylesheet.cssRules[k];\r\n\t\t\t\tif (callback(ruleDefinition) === true) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (e) {}\r\n\t}\r\n\tif (reversed) {\r\n\t\tfor (var i = stylesheets.length - 1; i >= 0; i --) {\r\n\t\t\tif (stylesheetCallback(stylesheets[i]) === true) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tfor (var i = 0; i < stylesheets.length; i ++) {\r\n\t\t\tif (stylesheetCallback(stylesheets[i]) === true) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Parses/decodes transform rule\r\n *\r\n * @param string str\r\n *\r\n * @return object\r\n */\r\nconst stylesheetTransformRuleParse = function(str) {\r\n\tvar transform = {};\r\n\tvar regex = /(\\w+)\\((.+?)\\)/g;\r\n\tvar match = null;\r\n\twhile(match = regex.exec(str)) {\r\n\t\ttransform[match[1]] = (match[2].indexOf(',') > -1 ? match[2].replace(' ', '').split(',') : match[2]);\r\n\t}\r\n\treturn transform;\r\n};\r\n\t\t\r\n/**\r\n * Helper method: parses a CSS string into an associative array.\r\n *\r\n * @param string\t \tcss\r\n *\r\n * @return object\r\n */\r\nconst parseRules = function(css) {\r\n\tvar split = {};\r\n\t_each(css.split(';'), (i, rule) => {\r\n\t\trule = rule.split(':');\r\n\t\tsplit[rule[0].trim()] = rule[1].trim();\r\n\t});\r\n\treturn split;\r\n};\r\n\r\n/**\r\n * Helper method: stringifies an associative array into a CSS string.\r\n *\r\n * @param object\t \tcss\r\n *\r\n * @return string\r\n */\r\nconst stringifyRules = function(css) {\r\n\tvar str = [];\r\n\t_each(css, (propName, value) => {\r\n\t\tstr.push(propName + ': ' + value);\r\n\t});\r\n\treturn str.join('; ');\r\n};\r\n\t\t\r\n/**\r\n * Gets an accurate width of the device scrollbar by running a test.\r\n * (Adapted from bootstrap.js)\r\n *\r\n * @return int\r\n */\r\nconst standardScrollbarWidth = function() {\r\n\tvar style = 'position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll';\r\n\tvar d = $('<div style=\"' + style + '\"></div>');\r\n\tdocument.body.appendChild(d);\r\n\t// Answer 2\r\n\tc = d[0].offsetWidth - d[0].clientWidth;\r\n\tdocument.body.removeChild(d);\r\n\treturn c;\r\n};\r\n\r\n/**\r\n * Returns the vendor-specific css property if supported. NULL if not.\r\n *\r\n * @param string \tprop\r\n *\r\n * @return string|NULL\r\n */\r\nconst vendorize = function(prop) {\r\n\tvar camelCasedProp = _toCamel(prop, true);\r\n\tif (vendorPrefix.api + camelCasedProp in document.body.style) {\r\n\t\treturn vendorPrefix.css + _fromCamel(prop, '-');\r\n\t}\r\n};\r\n\r\n/**\r\n * CSS properties that must have a default pixel unit.\r\n *\r\n * @var array\r\n */\r\nconst autopx = ['width', 'height', 'top', 'left', 'right', 'bottom',\r\n\t'padding', 'padding-top', 'padding-left', 'padding-right', 'padding-bottom',\r\n\t'margin', 'margin-top', 'margin-left', 'margin-right', 'margin-bottom',\r\n\t'border-width', 'border-top-width', 'border-left-width', 'border-right-width', 'border-bottom-width',\r\n\t'outline-width', 'outline-top-width', 'outline-left-width', 'outline-right-width', 'outline-bottom-width',\r\n];\r\n\t\r\n/**\r\n * @var object\r\n */\r\nconst stylesheetCache = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nconst stylesheetKeyframesCache = {};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tcssRead,\r\n\tcssWrite,\r\n\tcss,\r\n\tcssReadAsync,\r\n\tcssWriteAsync,\r\n\tcssAsync,\r\n\tcssReadInline,\r\n\tcssComputeAsync,\r\n\tcssTransaction,\r\n\tcssReadStylesheet,\r\n\tcssReadKeyframes,\r\n\tisAutoWidth,\r\n\tisAutoHeight,\r\n\ttransformRule,\r\n\tcssVarRead,\r\n\tstandardScrollbarWidth,\r\n\tvendorize,\r\n\tautopx,\r\n};\r\nexport default css;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_from as _obj_from\r\n} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Custom events\r\n * ---------------------------\r\n *\r\n * @var object\r\n */\t\t\t\t\r\nconst CustomEvents = {};\r\n\r\n/**\r\n * Multitap events\r\n */\r\nconst Multitap = {\r\n\t\r\n\t/**\r\n\t * Binds all multitap events.\r\n\t */\r\n\tsetup(fireCallback, el, hammertime, eventName) {\r\n\t\tvar allSetup = true;\r\n\t\tvar recognizers = Multitap.events.map((tapType, i) => {\r\n\t\t\tvar recognizer = hammertime.get(tapType);\r\n\t\t\tif (!recognizer) {\r\n\t\t\t\tallSetup = false;\r\n\t\t\t\trecognizer = new Hammer.Tap({\r\n\t\t\t\t\tevent: tapType,\r\n\t\t\t\t\ttaps: Multitap.events.length - i,\r\n\t\t\t\t});\r\n\t\t\t\thammertime.add(recognizer);\r\n\t\t\t}\r\n\t\t\treturn recognizer;\r\n\t\t});\r\n\t\tif (!allSetup) {\r\n\t\t\t// From left to right, recognizeWith all others ahead\r\n\t\t\tvar recgzr, recgzrs = recognizers.slice();\r\n\t\t\twhile((recgzr = recgzrs.shift()) && recgzrs.length) {\r\n\t\t\t\trecgzr.recognizeWith(recgzrs);\r\n\t\t\t}\r\n\t\t\t// From right to left, recognizeWith all others behind\r\n\t\t\tvar recgzr2, recgzrs2 = recognizers.slice();\r\n\t\t\twhile((recgzr2 = recgzrs2.pop()) && recgzrs2.length) {\r\n\t\t\t\trecgzr2.requireFailure(recgzrs2);\r\n\t\t\t}\r\n\t\t}\r\n\t\thammertime.on(eventName, e => fireCallback(e.type, {\r\n\t\t\tcontext:_obj_from(e.type, e)\r\n\t\t}));\r\n\t},\r\n\t\r\n\t/**\r\n\t * Unbinds all multitap events.\r\n\t */\r\n\tteardown(el, hammertime, eventName) {\r\n\t\thammertime.off(eventName);\r\n\t},\r\n\t\r\n\t/**\r\n\t * Now additional taps is achieved by\r\n\t * simply prepending to this array.\r\n\t */\r\n\tevents: ['tripletap', 'doubletap', 'singletap'],\r\n};\r\n// Add all to CustomEvents\r\nMultitap.events.forEach(event => {\r\n\tCustomEvents[event] = Multitap;\r\n});\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tMultitap\r\n};\r\nexport default CustomEvents;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_toTitle\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_find,\r\n\t_from as _obj_from\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_isString,\r\n\t_isFunction,\r\n\t_isArray\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\tEventController as _EventController,\r\n\tEvent\r\n} from '@onephrase/observable';\r\nimport {\r\n\tdomData\r\n} from '../Dom.js';\r\nimport CustomEvents from './CustomEvents.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Router class\r\n * ---------------------------\r\n *\r\n * This class provides additional functionality over native events.\r\n * \r\n * The EventController.fire() method has support for a listener's \"return false\"\r\n * and the consolidated Promise of \"sync\" listeners.\r\n *\r\n * EventController.addListener() can also be used to observe other \"events\" that the native addEventListener() does not support:\r\n * customEvents, @ownMutationEvents, @attributeMutationEvents, #childTreeMutationEvents, :states, ~gestures.\r\n *\r\n * EventController.unobserve() goes with a decision to use EventController.observe().\r\n */\t\t\t\t\r\nconst EventController = class extends _EventController {\r\n\r\n\t/**\r\n\t * Constructs a new observable and returns a proxy wrapper.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.el = el;\r\n\t\tthis.$.params = params;\r\n\t\tthis.$.activeHooks = {};\r\n\t\tthis.$.hammertime = new Hammer.Manager(this.el);\r\n\t}\r\n\r\n\t/**\r\n\t * Sets up an event type when its first listener is added.\r\n\t *\r\n\t * @param string NAME \r\n\t * @param object params \r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_setup(NAME, params) {\r\n\t\t// We register an event only once.\r\n\t\tif (this.$.activeHooks[NAME]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (CustomEvents[NAME]) {\r\n\t\t\tif (_isString(CustomEvents[NAME])) {\r\n\t\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_obj_from(NAME, e)});\r\n\t\t\t\t// Setup: we'll observe CustomEvents[NAME] to process and push the CUSTOM event/state.\r\n\t\t\t\tthis.addListener(CustomEvents[NAME], this.$.activeHooks[NAME]);\r\n\t\t\t} else if (_isFunction(CustomEvents[NAME].setup)) {\r\n\t\t\t\tthis.$.activeHooks[NAME] = true;\r\n\t\t\t\t// Custom setup. We supply the this.observe, this.trigger methods incase they'll be needed.\r\n\t\t\t\tCustomEvents[NAME].setup((firedEvents, firedEventsDetails) => {\r\n\t\t\t\t\tif (!_isFunction(CustomEvents[NAME].validate) \r\n\t\t\t\t\t|| CustomEvents[NAME].validate(firedEvents, firedEventsDetails, NAME, params)) {\r\n\t\t\t\t\t\tthis.fire(firedEvents, firedEventsDetails)\r\n\t\t\t\t\t}\r\n\t\t\t\t}, this.el, this.$.hammertime, NAME);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('The \"' + NAME + '\" event hook must have a \"setup\" function!');\r\n\t\t\t}\r\n\t\t} else if (recognizeGesture(NAME.split('+')[0])) {\r\n\t\t\t// Lets work as if if always a list\r\n\t\t\tvar recognizers = NAME.split('+').map(gestureName => {\r\n\t\t\t\tvar mainGestureName = recognizeGesture(gestureName);\r\n\t\t\t\tvar recognizer = this.$.hammertime.get(mainGestureName);\r\n\t\t\t\tif (!recognizer) {\r\n\t\t\t\t\trecognizer = new Hammer[_toTitle(mainGestureName)];\r\n\t\t\t\t\tthis.$.hammertime.add(recognizer);\r\n\t\t\t\t}\r\n\t\t\t\treturn recognizer;\r\n\t\t\t});\r\n\t\t\t// From right to left, recognizeWith all others ahead\r\n\t\t\trecognizers.forEach((recognizer, i) => {\r\n\t\t\t\trecognizer.recognizeWith(recognizers.slice(i + 1));\r\n\t\t\t});\r\n\t\t\t// Listen now...\r\n\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_obj_from(NAME, e)});\r\n\t\t\tthis.$.hammertime.on(NAME.split('+').join(' '), this.$.activeHooks[NAME]);\r\n\t\t} else {\r\n\t\t\tthis.$.activeHooks[NAME] = e => this.fire(NAME, {context:_obj_from(NAME, e)});\r\n\t\t\t// Setup: we'll observe a native event to process and push ours.\r\n\t\t\tthis.el.addEventListener(NAME, this.$.activeHooks[NAME]);\r\n\t\t}\r\n\t\t\r\n\t}\r\n\r\n\t/**\r\n\t * Tears down an event type when its last listener is removed.\r\n\t *\r\n\t * @param string NAME \r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_teardown(NAME) {\r\n\t\t// We register an event only once.\r\n\t\tif (!this.$.activeHooks[NAME]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (CustomEvents[NAME]) {\r\n\t\t\tif (_isString(CustomEvents[NAME])) {\r\n\t\t\t\t// Level1 custom event\r\n\t\t\t\tthis.removeListener(CustomEvents[NAME], this.$.activeHooks[NAME]);\r\n\t\t\t} else if (_isFunction(CustomEvents[NAME].teardown)) {\r\n\t\t\t\t// Level2 custom event. We supply the this.unobserve method incase it'll be needed.\r\n\t\t\t\tCustomEvents[NAME].teardown(this.el, this.$.hammertime, NAME);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('The \"' + NAME + '\" event hook must have a \"teardown\" function!');\r\n\t\t\t}\r\n\t\t} else if (recognizeGesture(NAME.split('+')[0])) {\r\n\t\t\tthis.$.hammertime.off(NAME.split('+').join(' '), this.$.activeHooks[NAME]);\r\n\t\t} else {\r\n\t\t\t// Native event\r\n\t\t\tthis.el.removeEventListener(NAME, this.$.activeHooks[NAME]);\r\n\t\t}\r\n\t\tdelete this.$.activeHooks[NAME];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see super.observe()\r\n\t *\r\n\t * Captures the params being observed and sets up their hooks\r\n\t * when their first listener just gets added.\r\n\t */\r\n\taddListener(...args) {\r\n\t\tvar listener = super.addListener(...args);\r\n\t\t_arr_from(listener.eventNames).forEach(NAME => {\r\n\t\t\tthis._setup(NAME, listener.params);\r\n\t\t});\r\n\t\tlistener.removeCallback = () => {\r\n\t\t\t_arr_from(listener.eventNames).forEach(NAME => {\r\n\t\t\t\tthis._teardown(NAME);\r\n\t\t\t});\r\n\t\t};\r\n\t\treturn listener;\r\n\t}\r\n};\r\n\r\n/**\r\n * Gesture reference.\r\n */\r\nconst gestureIndex = {\r\n\tpress: \t['press', 'pressup',], \r\n\trotate:\t['rotate', 'rotatestart', 'rotatemove', 'rotateend', 'rotatecancel',],\r\n\tpinch: \t['pinch', 'pinchstart', 'pinchmove', 'pinchend', 'pinchcancel', 'pinchin', 'pinchout',], \r\n\tpan: \t['pan', 'panstart', 'panmove', 'panend', 'pancancel', 'panleft', 'panright', 'panup', 'pandown',],\r\n\tswipe: \t['swipe', 'swipeleft', 'swiperight', 'swipeup', 'swipedown',],\r\n\ttap: \t['tap',],\r\n};\r\n\r\n/**\r\n * Finds the recognizer for a gestureName.\r\n *\r\n * @param string\tgestureName\r\n *\r\n * @return string\r\n */\r\nconst recognizeGesture = function(gestureName) {\r\n\treturn _find(gestureIndex, list => list.includes(gestureName), false/*deep*/);\r\n};\r\n\r\n/**\r\n * Binds listeners to an element's event controller.\r\n *\r\n * @param DOMElement \t\t\tel\r\n * @param array\t\t \t\t\t...args\r\n *\r\n * @return object\r\n */\r\nconst addListener = function(el, ...args) {\r\n\tif (!domData(el, 'eventController')) {\r\n\t\tdomData(el, 'eventController', new EventController(el));\r\n\t}\r\n\treturn domData(el, 'eventController').addListener(...args);\r\n};\r\n\r\n/**\r\n * Unbinds listeners from an element's event controller.\r\n *\r\n * @param DOMElement \t\t\tel\r\n * @param array\t\t \t\t\t...args\r\n *\r\n * @return bool\r\n */\r\nconst removeListener = function(el, ...args) {\r\n\tif (domData(el, 'eventController')) {\r\n\t\treturn domData(el, 'eventController').removeListener(...args);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\taddListener,\r\n\tremoveListener,\r\n};\r\nexport default EventController;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_exclude,\r\n\t_pushUnique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isArray,\r\n\t_isFunction,\r\n\t_isNumber,\r\n\t_isNumeric,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isUndefined\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\tcssRead,\r\n\tcssWrite,\r\n\tcssComputeAsync,\r\n\tcssReadKeyframes,\r\n\tcssVarRead,\r\n\tautopx as cssAutopx\r\n} from '../Css/Css.js';\r\nimport TransformRule from '../Css/TransformRule.js';\r\nimport Reflow from '../Reflow.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\t\t\t\r\nconst Anim = class {\r\n\t\r\n\t/**\r\n\t * Creates an amiation from\r\n\t * any of keyframes, CSS keyframe name, or CSS object.\r\n\t *\r\n\t * @param DOMNode\t\t\t\tel\r\n\t * @param array|object|string\teffect\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el, effect, params = {}) {\r\n\t\t// Private properties\r\n\t\tthis.el = el;\r\n\t\tthis.$ = {\r\n\t\t\treadyCallbacks: [],\r\n\t\t\tfinishCallbacks: [],\r\n\t\t\tcancelCallbacks: [],\r\n\t\t\tparams: params,\r\n\t\t};\r\n\t\t// -----------------------------\r\n\t\t// Normalize params...\r\n\t\t// -----------------------------\r\n\t\tparams.fill = params.fill || 'both';\r\n\t\tif (!('duration' in params)) {\r\n\t\t\tparams.duration = 400;\r\n\t\t}\r\n\t\t// Convert certain easing strings to beizier curves\r\n\t\tif (params.easing && ['ease-in', 'ease-out', 'ease-in-out'].indexOf(params.easing) === -1 && params.easing.indexOf('(') === -1) {\r\n\t\t\t// Native easings, custom cubic-beziers, or Dramatic's cubic-beziers\r\n\t\t\tparams.easing = cssVarRead(params.easing) || params.easing;\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Normalize keyframes...\r\n\t\t// -----------------------------\r\n\t\tvar destructables = {\r\n\t\t\tinset: ['top', 'right', 'bottom', 'left'],\r\n\t\t\tmargin: ['top', 'right', 'bottom', 'left'],\r\n\t\t\tpadding: ['top', 'right', 'bottom', 'left'],\r\n\t\t};\r\n\t\tconst init = keyframes => {\r\n\t\t\tkeyframes = keyframes.slice();\r\n\t\t\t// Mine out end-state properties\r\n\t\t\tvar firstFrame = {};\r\n\t\t\tvar lastFrame = {};\r\n\t\t\t_each(keyframes, (i, keyframe) => {\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t// We can destucture things like \"inset\"(\"left\", \"top\", \"right\", \"bottom\"), etc\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t_each(destructables, (destructableProp, meaning) => {\r\n\t\t\t\t\tif (keyframe[destructableProp]) {\r\n\t\t\t\t\t\tif (_isObject(keyframe[destructableProp])) {\r\n\t\t\t\t\t\t\tkeyframe[destructableProp] = meaning.map(key => keyframe[destructableProp][key]).filter(val => !_isUndefined(val));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (_isArray(keyframe[destructableProp])) {\r\n\t\t\t\t\t\t\tkeyframe[destructableProp] = keyframe[destructableProp].join(' ');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\t// We accept an object for the \"transform\" property\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\tif (keyframe.transform && _isObject(keyframe.transform) && !(keyframe.transform instanceof TransformRule)) {\r\n\t\t\t\t\tkeyframe.transform = (new TransformRule(keyframe.transform)).toString();\r\n\t\t\t\t}\r\n\t\t\t\t// Marshal out its properties\r\n\t\t\t\t_exclude(Object.keys(keyframe), 'offset', 'easing').forEach(prop => {\r\n\t\t\t\t\t// Auto-px\r\n\t\t\t\t\tif (cssAutopx.includes(prop) && _isNumeric(keyframe[prop])) {\r\n\t\t\t\t\t\tkeyframe[prop] += 'px';\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Save last seen value of this property\r\n\t\t\t\t\t// across all keyframes...\r\n\t\t\t\t\tfirstFrame[prop] = typeof firstFrame[prop] === 'undefined' ? keyframe[prop] : firstFrame[prop];\r\n\t\t\t\t\tlastFrame[prop] = keyframe[prop];\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t// -----------------------------\r\n\t\t\t// The animation...\r\n\t\t\t// -----------------------------\r\n\t\t\ttry {\r\n\t\t\t\tvar anim = this.el.animate(keyframes, params);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tthis.$.error = e;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// Reverse\r\n\t\t\tif (params.reverse) {\r\n\t\t\t\tanim.reverse();\r\n\t\t\t}\r\n\t\t\t// A little polifyll\r\n\t\t\tif (!anim.effect) {\r\n\t\t\t\tanim.effect = {};\r\n\t\t\t}\r\n\t\t\tif (!anim.effect.duration) {\r\n\t\t\t\tanim.effect.duration = params.duration;\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\t// \"onfinish\" and \"oncancel\" listener\r\n\t\t\t// -----------------------------\r\n\t\t\tanim.onfinish = () => {\r\n\t\t\t\t// As getter, as it were\r\n\t\t\t\tif (params.cancelForCss) {\r\n\t\t\t\t\tanim.cancel();\r\n\t\t\t\t\tif (params.fill === 'forwards' || params.fill === 'both') {\r\n\t\t\t\t\t\tcssWrite(this.el, lastFrame);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.finishCallbacks.forEach(callback => {\r\n\t\t\t\t\tcallback(this.el);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// oncancel listener\r\n\t\t\tanim.oncancel = () => {\r\n\t\t\t\t// As getter, as it were\r\n\t\t\t\tthis.$.cancelCallbacks.forEach(callback => {\r\n\t\t\t\t\tcallback(this.el);\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\t// -------------------\r\n\t\t\tthis.$.anim = anim;\r\n\t\t\tthis.$.firstFrame = firstFrame;\r\n\t\t\tthis.$.lastFrame = lastFrame;\r\n\t\t\tif (this.$.readyCallbacks.length) {\r\n\t\t\t\tthis.$.readyCallbacks.forEach(callback => callback(anim, params, firstFrame, lastFrame));\r\n\t\t\t}\r\n\t\t\t// -------------------\r\n\t\t};\r\n\t\tif (_isFunction(effect)) {\r\n\t\t\teffect(el, init);\r\n\t\t} else {\r\n\t\t\tAnim.createCallback(el, effect, init, error => {\r\n\t\t\t\t// -------------------\r\n\t\t\t\tthis.$.error = error;\r\n\t\t\t\t// -------------------\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Animation-ready callback.\r\n\t *\r\n\t * @param function\t\tsucces\r\n\t * @param function\t\terror\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tready(succes, error) {\r\n\t\tif (this.$.error) {\r\n\t\t\tif (error) {\r\n\t\t\t\terror(this.$.error);\r\n\t\t\t}\r\n\t\t} else if (this.$.anim) {\r\n\t\t\tsucces(this.$.anim, this.$.params, this.$.firstFrame, this.$.lastFrame);\r\n\t\t} else {\r\n\t\t\tthis.$.readyCallbacks.push(succes);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a function to the \"onfinish\" event.\r\n\t *\r\n\t * @param function callback\r\n\t *\r\n\t * @return this\r\n\t *\r\n\t */\r\n\tonfinish(callback) {\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error(\"Onfinish() accepts only a function.\");\r\n\t\t}\r\n\t\tthis.$.finishCallbacks.push(callback);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a function to the \"oncancel\" event.\r\n\t *\r\n\t * @param function callback\r\n\t *\r\n\t * @return this\r\n\t *\r\n\t */\r\n\toncancel(callback) {\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error(\"Oncancel() accepts only a function.\");\r\n\t\t}\r\n\t\tthis.$.cancelCallbacks.push(callback);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Seeks the animation to a time.\r\n\t *\r\n\t * @param number to\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tseek(to) {\r\n\t\tif (!_isNumber(to)) {\r\n\t\t\tthrow new Error(\"Seek() accepts only a numeric value.\");\r\n\t\t}\r\n\t\tthis.ready((anim, effect) => {\r\n\t\t\tanim.currentTime = Math.min(to * effect.duration, effect.duration);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns the animation's progress.\r\n\t *\r\n\t * @return number\r\n\t */\r\n\tprogress() {\r\n\t\tif (this.$.anim) {\r\n\t\t\treturn this.$.anim.currentTime / this.$.anim.effect.duration;\r\n\t\t}\r\n\t\treturn 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Reverses the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\treverse() {\r\n\t\tthis.ready(anim => anim.reverse());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Plays the animation.\r\n\t * Returns an \"onfinish\" promise.\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tplay() {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.ready(anim => {\r\n\t\t\t\tanim.play();\r\n\t\t\t\tthis.onfinish(() => resolve(this));\r\n\t\t\t\tthis.oncancel(() => reject(this));\r\n\t\t\t}, reject);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Pauses the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tpause() {\r\n\t\tthis.ready(anim => anim.pause());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finishes the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tfinish() {\r\n\t\tthis.ready(anim => anim.finish());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Cancels the animation.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tcancel() {\r\n\t\tthis.ready(anim => anim.cancel());\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves the given effect into valid keyframes.\r\n\t *\r\n\t * Effect can be CSS animation name,\r\n\t * or an object of CSS properties that represent the end keyframe.\r\n\t *\r\n\t * @param DOMNode\t\t\t\tel\r\n\t * @param array|object|string\teffect\r\n\t * @param function\t\t\t\tready\r\n\t * @param function\t\t\t\terror\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic createCallback(el, effect, ready, error) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve firstFrame from current state?\r\n\t\t// -----------------------------\r\n\t\tif (_isObject(effect)) {\r\n\t\t\t// Get first keyframe from current state\r\n\t\t\tReflow.onread(() => {\r\n\t\t\t\tAnim.createCallback(el, [cssRead(el, Object.keys(effect)), effect], ready, error);\r\n\t\t\t});\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Create keyframes from CSS animation name...\r\n\t\t// -----------------------------\r\n\t\tif (_isString(effect)) {\r\n\t\t\t// Retrieve keyframes of the given animation name from css\r\n\t\t\tvar animationName = effect;\r\n\t\t\teffect = cssReadKeyframes(el, animationName);\r\n\t\t\tif (!effect.length && error) {\r\n\t\t\t\terror('Animation name \"' + animationName + '\" not found in any stylesheet!');\r\n\t\t\t}\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Resolve auto pixels...\r\n\t\t// -----------------------------\r\n\t\tif (_isArray(effect)) {\r\n\t\t\tvar keyframesWithAutoSizes = [];\r\n\t\t\t_each(effect, (i, keyframe) => {\r\n\t\t\t\t// We can animate to auto width and height\r\n\t\t\t\tif (keyframe.height === 'auto') {\r\n\t\t\t\t\t_pushUnique(keyframesWithAutoSizes, i);\r\n\t\t\t\t}\r\n\t\t\t\tif (keyframe.width === 'auto') {\r\n\t\t\t\t\t_pushUnique(keyframesWithAutoSizes, i);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (keyframesWithAutoSizes.length) {\r\n\t\t\t\t// apply() will be called when ready\r\n\t\t\t\t// We return cssComputeAsync(), which in itself returns the return of apply()\r\n\t\t\t\tcssComputeAsync(el, {width:'auto', height:'auto'}, el => el.getBoundingClientRect()).then(result => {\r\n\t\t\t\t\tkeyframesWithAutoSizes.forEach(i => {\r\n\t\t\t\t\t\tif (effect[i].width === 'auto') {\r\n\t\t\t\t\t\t\teffect[i].width = result.width + 'px';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (effect[i].height === 'auto') {\r\n\t\t\t\t\t\t\teffect[i].height = result.height + 'px';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tready(effect);\r\n\t\t\t\t});\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// Return result...\r\n\t\t// -----------------------------\r\n\t\t// We return the return of success()\r\n\t\tready(effect);\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Anim;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_any,\r\n\t_intersect,\r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_each,\r\n\t_copy,\r\n\t_merge,\r\n\t_with\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\tcssRead\r\n} from '../Css/Css.js';\r\nimport TransformRule from '../Css/TransformRule.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Element utility class\r\n * ---------------------------\r\n */\r\n\t\t\t\r\n/**\r\n * Gets the element's width/height values or left/top offsets or both.\r\n *\r\n * A context can be specified from which to resolve left/top distances.\r\n * document origins are used by default.\r\n *\r\n * This function can calculate the rect of 3 different types of object:\r\n * - DOM element: offsets are calculated from el.getBoundingClientRect() and resolved relative to the specified offsetOrigin.\r\n *\t\twidth and height are calculated from el.getBoundingClientRect().\r\n * - Event object: offsets are calculated as the event's (client|offset|page) x/y, depending on the specified offsetOrigin.\r\n *\t\twidth and height are always 0, 0.\r\n * - Window object: offsets are calculated as the current left/top scroll, as determined by the value of offsetOrigin.\r\n *\t\twidth and height are always the window's inner width/height values.\r\n *\r\n * @param DOMElement|Event|window \tel\r\n * @param bool\t \t\t\t\t\tsize\r\n * @param DOMElement|window\t \t\toffsetOrigin\r\n *\r\n * @return object\r\n */\r\nconst rect = function(el, size = true, offsetOrigin = null) {\r\n\tvar rectProps = ['width', 'height', 'top', 'right', 'bottom', 'left'];\r\n\tvar eventProps = ['clientX', 'clientY', 'offsetX', 'offsetY', 'pageX', 'pageY', 'screenX', 'screenY'];\r\n\tvar _isElement = obj => obj instanceof HTMLElement || obj instanceof HTMLDocument;\r\n\tvar _rect = {};\r\n\tif (_isObject(el) && _any(eventProps, prop => prop in el)) {\r\n\t\t_rect = size !== false ? {width:0, height:0,} : {};\r\n\t\tif (offsetOrigin === window || _isElement(offsetOrigin)) {\r\n\t\t\t_rect.left = el.clientX;\r\n\t\t\t_rect.top = el.clientY;\r\n\t\t} else if (offsetOrigin === true) {\r\n\t\t\t_rect.left = el.offsetX;\r\n\t\t\t_rect.top = el.offsetY;\r\n\t\t} else if (offsetOrigin !== false) {\r\n\t\t\t_rect.left = el.pageX;\r\n\t\t\t_rect.top = el.pageY;\r\n\t\t}\r\n\t} else if (el === window) {\r\n\t\t_rect = size !== false ? {width:window.innerWidth, height:window.innerHeight,} : {};\r\n\t\tif (offsetOrigin === window || offsetOrigin === true || _isElement(offsetOrigin)) {\r\n\t\t\t_rect.left = 0;\r\n\t\t\t_rect.top = 0;\r\n\t\t} else if (offsetOrigin !== false) {\r\n\t\t\t_rect.left = window.pageXOffset || document.documentElement.scrollLeft;\r\n\t\t\t_rect.top = window.pageYOffset || document.documentElement.scrollTop;\r\n\t\t}\r\n\t} else if (_isElement(el)) {\r\n\t\t_rect = el.getBoundingClientRect().toJSON();\r\n\t\tdelete _rect.x;\r\n\t\tdelete _rect.y;\r\n\t\tdelete _rect.right;\r\n\t\tdelete _rect.bottom;\r\n\t\tif (size === false) {\r\n\t\t\tdelete _rect.width;\r\n\t\t\tdelete _rect.height;\r\n\t\t}\r\n\t\tif (offsetOrigin === true) {\r\n\t\t\toffsetOrigin = el.offsetParent;\r\n\t\t} else if (offsetOrigin === false) {\r\n\t\t\tdelete _rect.left;\r\n\t\t\tdelete _rect.top;\r\n\t\t} else if (offsetOrigin !== window && !_isElement(offsetOrigin)) {\r\n\t\t\t_rect.left += (window.pageXOffset || document.documentElement.scrollLeft);\r\n\t\t\t_rect.top += (window.pageYOffset || document.documentElement.scrollTop);\r\n\t\t}\r\n\t} else if (_isObject(el) && _any(rectProps, prop => prop in el)) {\r\n\t\t_rect = _copy(el, rectProps);\r\n\t} else {\r\n\t\tthrow new Error('Unknown object type!');\r\n\t}\r\n\tif (_isElement(offsetOrigin)) {\r\n\t\tvar contextOffset = rect(offsetOrigin, false, window);\r\n\t\t_rect.left -= contextOffset.left;\r\n\t\t_rect.top -= contextOffset.top;\r\n\t}\r\n\treturn _rect;\r\n};\r\n\r\n/**\r\n * Returns an object containing the element's width or height or both.\r\n *\r\n * @param DOMElement\t\tel \r\n * @param object\t\t\taxis \r\n *\r\n * @return object\r\n */\r\nconst size = function(el, axis) {\r\n\tvar _size = rect(el, true, false);\r\n\tvar axes = axis ? _arr_from(axis) : ['x', 'y'];\r\n\tif (!axes.includes('x')) {\r\n\t\tdelete _size.width;\r\n\t}\r\n\tif (!axes.includes('y')) {\r\n\t\tdelete _size.height;\r\n\t}\r\n\treturn _size;\r\n};\r\n\r\n/**\r\n * Returns an object containing the element's left/top.\r\n *\r\n * @param DOMElement\t\tel \r\n * @param object\t\t\taxis \r\n * @param string|bool\t\toffsetOrigin \r\n *\r\n * @return object\r\n */\r\nconst offsets = function(el, axis, origin = null) {\r\n\tvar _offsets = rect(el, false, origin);\r\n\tvar axes = axis ? _arr_from(axis) : ['x', 'y'];\r\n\tif (!axes.includes('x')) {\r\n\t\tdelete _offsets.left;\r\n\t}\r\n\tif (!axes.includes('y')) {\r\n\t\tdelete _offsets.top;\r\n\t}\r\n\treturn _offsets;\r\n};\r\n\r\n/**\r\n * Simulates, does not actually effect, a DOMElement to a some CSS position and\r\n * uses rect() to calculate its rects at that virtual position.\r\n *\r\n * @param DOMElement\t\t\t\tel \r\n * @param object \t\t\t\t\toffsets\r\n *\r\n * @return object\r\n */\r\nconst rectAtOffsets = function(el, offsets) {\r\n\tvar _rect = rect(el);\r\n\tvar positionType = cssRead(el, 'position');\r\n\tif (positionType !== 'static') {\r\n\t\tif (positionType === 'absolute') {\r\n\t\t\tvar offsetParentRect = rect(el.offsetParent);\r\n\t\t\t_rect.top = offsetParentRect.top;\r\n\t\t\t_rect.left = offsetParentRect.left;\r\n\t\t} else if (positionType === 'fixed') {\r\n\t\t\tvar offsetParentRect = rect(window);\r\n\t\t\t_rect.top = 0;\r\n\t\t\t_rect.left = 0;\r\n\t\t}\r\n\t\t_rect.top = _isNumeric(offsets.top) ? _rect.top + parseFloat(offsets.top) \r\n\t\t\t: (_isNumeric(offsets.bottom) ? (offsetParentRect \r\n\t\t\t\t? (offsetParentRect.top + offsetParentRect.height) - (_rect.height + offsets.bottom)\r\n\t\t\t\t: _rect.top - offsets.bottom\r\n\t\t\t) : 0);\r\n\t\t_rect.left = _isNumeric(offsets.left) ? _rect.left + parseFloat(offsets.left) \r\n\t\t\t: (_isNumeric(offsets.right) ? (offsetParentRect \r\n\t\t\t\t? (offsetParentRect.left + offsetParentRect.width) - (_rect.width + offsets.right)\r\n\t\t\t\t: _rect.left - offsets.right\r\n\t\t\t) : 0);\r\n\t}\r\n\treturn _rect;\r\n};\r\n\r\n/**\r\n * Calculates the length on an axis of an intersection.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param object\t\t \t\t\t_rect\r\n * @param object\t\t \t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst coordsAtRect = function(el, _rect, options = {}) {\r\n\tvar _intersection = intersection(rect(options.using || el), _rect);\r\n\tvar length = {x:'width', y:'height'};\r\n\tvar start = {x:'left', y:'top'};\r\n\tvar end = {x:'right', y:'bottom'};\r\n\tvar coords = {};\r\n\tvar _alignment = {};\r\n\t['x', 'y'].forEach(axis => {\r\n\t\tif (options[axis] === false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar rect1Length = _intersection.rect1[length[axis]/*height*/];\r\n\t\t// Distinguish and predicate\r\n\t\t_alignment[axis] = parsePlacement(options[axis] || '');\r\n\t\tswitch(_alignment[axis].keyword) {\r\n\t\t\tcase 'before':\r\n\t\t\t\t// Pull beyond start\r\n\t\t\t\tcoords[axis] = - (_intersection[start[axis]/*top*/] + rect1Length);\r\n\t\t\tbreak;\r\n\t\t\tcase 'after':\r\n\t\t\t\t// Push beyond end\r\n\t\t\t\tcoords[axis] = _intersection[end[axis]/*bottom*/] + rect1Length;\r\n\t\t\tbreak;\r\n\t\t\tcase 'start':\r\n\t\t\t\t// Pull to start\r\n\t\t\t\tcoords[axis] = - _intersection[start[axis]/*top*/];\r\n\t\t\tbreak;\r\n\t\t\tcase 'end':\r\n\t\t\t\t// Push to end\r\n\t\t\t\tcoords[axis] = _intersection[end[axis]/*bottom*/];\r\n\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\t// Align to center\r\n\t\t\t\tcoords[axis] = _intersection.delta[axis];\r\n\t\t}\r\n\t\t// Apply predicates\r\n\t\tif (_alignment[axis].predicates) {\r\n\t\t\tcoords[axis] += evalPredicates(_alignment[axis].predicates, rect1Length);\r\n\t\t}\r\n\t});\r\n\tcoords.alignment = _alignment;\r\n\tcoords.intersection = _intersection;\r\n\treturn coords;\r\n};\r\n\r\n/**\r\n * Manipulates an element's translate.translate to place it with another element.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst translateTo = function(el, el2, options = {}) {\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar _coordsFormatted = {\r\n\t\tfrom: new TransformRule({translate: [],}),\r\n\t\tto: new TransformRule({translate: [],}),\r\n\t\tcurrent: {\r\n\t\t\tfrom: new TransformRule({translate: [],}),\r\n\t\t\tto: new TransformRule({translate: [],}),\r\n\t\t\tprogress: {},\r\n\t\t},\r\n\t};\r\n\t// -----------\r\n\tvar activeTransform = cssRead(el, 'transform');\r\n\t['x', 'y'].forEach((axis, i) => {\r\n\t\tif (axis in _coords) {\r\n\t\t\t_coordsFormatted.from.translate[i] = 0;\r\n\t\t\t_coordsFormatted.to.translate[i] = _coords[axis] + activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.current.to.translate[i] = _coords[axis];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = Math.abs(activeTransform.translate[i] / (_coords[axis] + activeTransform.translate[i]));\r\n\t\t} else {\r\n\t\t\t_coordsFormatted.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.to.translate[i] = activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from.translate[i] = activeTransform.translate[i];\r\n\t\t\t_coordsFormatted.current.to.translate[i] = activeTransform.translate[i];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = 0;\r\n\t\t}\r\n\t});\r\n\treturn _coordsFormatted;\r\n};\r\n\r\n/**\r\n * Calculates an element's offset where it to be at the given rect.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst offsetTo = function(el, el2, options = {}) {\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar start = {x:'left', y:'top'};\r\n\tvar end = {x:'right', y:'bottom'};\r\n\tvar _offsets = _intersect(['x', 'y'], Object.keys(_coords)).reduce((obj, axis) => {\r\n\t\tswitch(_coords.alignment[axis].keyword) {\r\n\t\t\tcase 'before':\r\n\t\t\t\treturn options.alternateAnchors ? _with(obj, start[axis], _coords[axis]) : _with(obj, end[axis], - _coords[axis]);\r\n\t\t\tcase 'after':\r\n\t\t\t\treturn options.alternateAnchors ? _with(obj, end[axis], - _coords[axis]) : _with(obj, start[axis], _coords[axis]);\r\n\t\t\tcase 'end':\r\n\t\t\t\treturn _with(obj, end[axis], - _coords[axis]);\r\n\t\t\tdefault: // center,start\r\n\t\t\t\treturn _with(obj, start[axis], _coords[axis]);\r\n\t\t}\r\n\t}, {});\r\n\t// -----------\r\n\tvar _offsetsFormatted = {from: {}, to: {}, current: {\r\n\t\t\tfrom: {}, to: {}, progress: {},\r\n\t\t},\r\n\t};\r\n\t// -----------\r\n\tvar currentOffsets = positioningOffsets(el, Object.keys(_offsets));\r\n\t['left', 'right', 'top', 'bottom'].forEach(name => {\r\n\t\tif (name in _offsets) {\r\n\t\t\t_offsetsFormatted.from[name] = 0;\r\n\t\t\t_offsetsFormatted.to[name] = _offsets[name] + currentOffsets[name];\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.from[name] = currentOffsets[name];\r\n\t\t\t_offsetsFormatted.current.to[name] = _offsets[name];\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.progress[name] = Math.abs(currentOffsets[name] / (_offsets[name] + currentOffsets[name]));\r\n\t\t} else {\r\n\t\t\t_offsetsFormatted.from[name] = 'auto';\r\n\t\t\t_offsetsFormatted.to[name] = 'auto';\r\n\t\t\t// ----------------\r\n\t\t\t_offsetsFormatted.current.from[name] = 'auto';\r\n\t\t\t_offsetsFormatted.current.to[name] = 'auto';\r\n\t\t}\r\n\t});\r\n\treturn _offsetsFormatted;\r\n};\r\n\r\n/**\r\n * Scrolls an element to the position of another element\r\n * within its scrollable parent.\r\n *\r\n * @param HTMLElement|Event|window \tel\r\n * @param HTMLElement|Event|window\tel2\r\n * @param object \t\t\t\t\toptions\r\n *\r\n * @return object\r\n */\r\nconst scrollTo = function(el, el2, options = {}) {\r\n\tvar viewport = options.scrollAnchor || scrollParent(el);\r\n\tviewport = viewport === document.body ? window : viewport;\r\n\tif (!scrolls(viewport)) {\r\n\t\treturn;\r\n\t}\r\n\t// -----------\r\n\tvar _coords = coordsAtRect(el, rect(el2), options);\r\n\t// -----------\r\n\tvar _offsetsFormatted = {from: {}, to: {}, current: {\r\n\t\t\tfrom: {}, to: {}, progress: {},\r\n\t\t},\r\n\t\tviewport: viewport,\r\n\t};\r\n\t// -----------\r\n\tvar currentScroll = {\r\n\t\tscrollLeft: viewport[viewport === window ? 'pageXOffset' : 'scrollLeft'],\r\n\t\tscrollTop: viewport[viewport === window ? 'pageYOffset' : 'scrollTop'],\r\n\t};\r\n\t['x', 'y'].forEach((axis, i) => {\r\n\t\tvar axisProp = axis === 'x' ? 'scrollLeft' : 'scrollTop';\r\n\t\tif (axis in _coords) {\r\n\t\t\t_coordsFormatted.from[axisProp] = 0;\r\n\t\t\t_coordsFormatted.to[axisProp] = _coords[axis] + currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.current.to[axisProp] = _coords[axis];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = Math.abs(currentScroll[axisProp] / (_coords[axis] + currentScroll[axisProp]));\r\n\t\t} else {\r\n\t\t\t_coordsFormatted.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.to[axisProp] = currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.from[axisProp] = currentScroll[axisProp];\r\n\t\t\t_coordsFormatted.current.to[axisProp] = currentScroll[axisProp];\r\n\t\t\t// ----------------\r\n\t\t\t_coordsFormatted.current.progress[axis] = 0;\r\n\t\t}\r\n\t});\r\n\treturn _coordsFormatted;\r\n};\r\n\r\n/**\r\n * Observes when any of the given elements\r\n * changes in size.\r\n *\r\n * @param [HTMLElement]\t\t\t \tels\r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return ResizeObserver\r\n */\r\nconst resizeCallback = function(els, callback) {\r\n\tvar sizings = Object.keys(els);\r\n\tvar ro = new ResizeObserver(entries => {\r\n\t\tfor (let entry of entries) {\r\n\t\t\tsizings[els.indexOf(entry.target)] = {\r\n\t\t\t\twidth: entry.contentRect.left + entry.contentRect.right, \r\n\t\t\t\theight: entry.contentRect.top + entry.contentRect.bottom,\r\n\t\t\t};\r\n\t\t}\r\n\t\tsizings = sizings.map((sizing, i) => !_isObject(sizing) ? _copyPlain(rect(els[i]), ['width', 'height',]) : sizing);\r\n\t\tcallback.call(...sizings);\r\n\t});\r\n\tels.forEach(el => {\r\n\t\tro.observe(el);\r\n\t});\r\n\treturn ro;\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * A set of utilities for processing rects.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Computes the percentage proximity between two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n * @param string|array\taxis\r\n * @param object\t\tpreviousProximity\r\n *\r\n * @return object\r\n */\r\nconst proximity = function(rect1, rect2, axis, previousProximity) {\r\n\tvar _proximity = {intersection: intersection(rect1, rect2)};\t\t\t\t\r\n\t_proximity.x = _proximity.x || {};\r\n\t_proximity.y = _proximity.y || {};\r\n\tpreviousProximity = _copy(previousProximity);\r\n\t// X,Y processing...\r\n\t(axis ? _arr_from(axis) : ['x', 'y']).forEach(axis => {\r\n\t\t// In the context of the given axis...\r\n\t\tvar distanceBefore = axis === 'x' ? 'left' : 'top';\r\n\t\tvar distanceAfter = axis === 'x' ? 'right' : 'bottom';\r\n\t\tvar rect1Length = rect1[axis === 'x' ? 'width' : 'height'];\r\n\t\tvar rect2Length = rect2[axis === 'x' ? 'width' : 'height'];\r\n\t\t// ----- In which direction are we moving\r\n\t\t_proximity[axis].moving = 'positive';\r\n\t\tif (previousProximity.intersection) {\r\n\t\t\t_proximity[axis].moving = previousProximity.intersection[distanceBefore] > _proximity.intersection[distanceBefore] \r\n\t\t\t\t? 'negative' : (previousProximity.intersection[distanceBefore] < _proximity.intersection[distanceBefore] \r\n\t\t\t\t\t? 'positive' : previousProximity[axis].moving);\r\n\t\t}\r\n\t\t// ----- Cross-in percentage\r\n\t\tvar percentageIn = 0;\r\n\t\t// Element topline touches or passes Anchor bottom line\r\n\t\tif (_proximity.intersection[distanceBefore] <= rect2Length\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor bottom line\r\n\t\t&& _proximity.intersection[distanceAfter] <= 0) {\r\n\t\t\tpercentageIn = (rect1Length - Math.abs(_proximity.intersection[distanceAfter])) / rect1Length;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > 0) {\r\n\t\t\tpercentageIn = 1;\r\n\t\t}\r\n\t\t// ----- Cross-out percentage\r\n\t\tvar percentageOut = 0;\r\n\t\t// Element topline touches or passes Anchor top line\r\n\t\tif (_proximity.intersection[distanceBefore] <= 0\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor top line\r\n\t\t&& _proximity.intersection[distanceAfter] <= rect2Length) {\r\n\t\t\tpercentageOut = Math.abs(_proximity.intersection[distanceBefore]) / rect1Length;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > rect2Length) {\r\n\t\t\tpercentageOut = 1;\r\n\t\t}\r\n\t\t// ----- Cross-pass percentage\r\n\t\tvar percentagePass = 0;\r\n\t\t// Element topline touches or passes Anchor bottom line\r\n\t\tif (_proximity.intersection[distanceBefore] <= rect2Length\r\n\t\t// Element bottom line is yet to touch, or is just touches Anchor top line\r\n\t\t&& _proximity.intersection[distanceAfter] <= rect2Length) {\r\n\t\t\tvar totalDistance = rect2Length + rect1Length;\r\n\t\t\tvar currentPass = proximity.intersection[distanceBefore] + rect1Length;\r\n\t\t\tpercentagePass = (totalDistance - currentPass) / totalDistance;\r\n\t\t} else if (_proximity.intersection[distanceAfter] > rect2Length) {\r\n\t\t\tpercentagePass = 1;\r\n\t\t}\r\n\t\t// ----- Cross-overflow percentage\r\n\t\tvar percentageContained = 0;\r\n\t\tif (rect1Length > rect2Length) {\r\n\t\t\t// Element is larger than, and covering Anchor top/bottom lines\r\n\t\t\tif (_proximity.intersection[distanceBefore] <= 0\r\n\t\t\t&& _proximity.intersection[distanceAfter] <= 0) {\r\n\t\t\t\tvar lengthDifference = rect1Length - rect2Length;\r\n\t\t\t\tpercentageContained = Math.abs(_proximity.intersection[distanceBefore]) / lengthDifference;\r\n\t\t\t} else if (_proximity.intersection[distanceAfter] > 0) {\r\n\t\t\t\tpercentageContained = 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Element is smaller than, and within Anchor top/bottom lines\r\n\t\t\tif (_proximity.intersection[distanceBefore] >= 0\r\n\t\t\t&& _proximity.intersection[distanceAfter] >= 0) {\r\n\t\t\t\tvar lengthDifference = rect2Length - rect1Length;\r\n\t\t\t\tpercentageContained = _proximity.intersection[distanceAfter] / lengthDifference;\r\n\t\t\t} else if (_proximity.intersection[distanceBefore] < 0) {\r\n\t\t\t\tpercentageContained = 1;\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ------ Bind the values to the instance object\r\n\t\tif (_proximity[axis].moving === 'negative') {\r\n\t\t\t_proximity[axis].percentageIn = percentageIn;\r\n\t\t\t_proximity[axis].percentageOut = percentageOut;\r\n\t\t\t_proximity[axis].percentagePass = percentagePass;\r\n\t\t\t_proximity[axis].percentageContained = percentageContained;\r\n\t\t} else {\r\n\t\t\t_proximity[axis].percentageIn = 1 - percentageOut;\r\n\t\t\t_proximity[axis].percentageOut = 1 - percentageIn;\r\n\t\t\t_proximity[axis].percentagePass = 1 - percentagePass;\r\n\t\t\t_proximity[axis].percentageContained = 1 - percentageContained;\r\n\t\t}\r\n\t\tif (rect1Length > rect2Length) {\r\n\t\t\t_proximity[axis].percentageContained *= -1;\r\n\t\t}\r\n\t});\r\n\treturn _proximity;\r\n};\r\n\r\n/**\r\n * Returns coordinates of the intersection between two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n *\r\n * @return object\r\n */\r\nconst intersection = function(rect1, rect2) {\r\n\tvar _intersection = {\r\n\t\tleft: rect1.left - rect2.left,\r\n\t\ttop: rect1.top - rect2.top,\r\n\t\tright: (rect2.left + rect2.width) - (rect1.left + rect1.width),\r\n\t\tbottom: (rect2.top + rect2.height) - (rect1.top + rect1.height),\r\n\t};\r\n\t// More offsets\r\n\tvar leftline = Math.max(rect1.left, rect2.left);\r\n\tvar rightline = Math.min(rect1.left + rect1.width, rect2.left + rect2.width);\r\n\tvar topline = Math.max(rect1.top, rect2.top);\r\n\tvar bottomline = Math.min(rect1.top + rect1.height, rect2.top + rect2.height);\r\n\t_intersection.width = rightline > leftline ? rightline - leftline : 0;\r\n\t_intersection.height = bottomline > topline ? bottomline - topline : 0;\r\n\t// The raw values\r\n\t_intersection.rect1 = rect1;\r\n\t_intersection.rect2 = rect2;\r\n\t_intersection.delta = delta(rect1, rect2);\r\n\treturn _intersection;\r\n};\r\n\r\n/**\r\n * Returns coordinates of two rects as one.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n *\r\n * @return object\r\n */\r\nconst union = function(rect1, rect2) {\r\n\tvar _union = {\r\n\t\tleft: Math.min(rect1.left, rect2.left),\r\n\t\ttop: Math.min(rect1.top, rect2.top),\r\n\t\tright: Math.max((rect1.left + rect1.width), (rect2.left + rect2.width)),\r\n\t\tbottom: Math.max((rect1.top + rect1.height), (rect2.top + rect2.height)),\r\n\t};\r\n\t// More offsets\r\n\t_union.width = _union.right - _union.left;\r\n\t_union.height = _union.bottom - _union.top;\r\n\t// The raw values\r\n\t_union.rect1 = rect1;\r\n\t_union.rect2 = rect2;\r\n\t_union.delta = delta(rect1, rect2);\r\n\treturn _union;\r\n};\r\n\r\n/**\r\n * Returns distances in x, y, and z between the centers of two rects.\r\n *\r\n * @param object\t\trect1\r\n * @param object\t\trect2\r\n * @param bool\t\t\twithAngle\r\n *\r\n * @return object\r\n */\r\nconst delta = function(rect1, rect2, withAngle = false) {\r\n\tvar _delta = {};\r\n\t_delta.x = (rect2.left + (rect2.width / 2)) - (rect1.left + (rect1.width / 2));\r\n\t_delta.y = (rect2.top + (rect2.height / 2)) - (rect1.top + (rect1.height / 2));\r\n\t_delta.z = Math.sqrt(Math.pow(_delta.x, 2) + Math.pow(_delta.y, 2));\r\n\tif (withAngle) {\r\n\t\t_delta = _merge(_delta, deltaAngle(_delta));\r\n\t}\r\n\treturn _delta;\r\n};\r\n\r\n/**\r\n * Returns distances in x, y, and z between the centers of two rects.\r\n *\r\n * @param object\t\tdelta\r\n *\r\n * @return object\r\n */\r\nconst deltaAngle = function(delta) {\r\n\tif (_isNumeric(delta.y) && _isNumeric(delta.x)) {\r\n\t\tvar angleOfElevation = Math.atan(delta.y/delta.x);\r\n\t} else if (_isNumeric(delta.x) && _isNumeric(delta.z)) {\r\n\t\tvar angleOfElevation = Math.acos(delta.x/delta.z);\r\n\t} else if (_isNumeric(delta.y) && _isNumeric(delta.z)) {\r\n\t\tvar angleOfElevation = Math.asin(delta.y/delta.z);\r\n\t}\r\n\tvar angleOfDepression = 180 - 90 - angleOfElevation;\r\n\treturn {\r\n\t\tangle:angleOfElevation, \r\n\t\tangle2:angleOfDepression, \r\n\t\tisHorizontal:angleOfElevation < 45, \r\n\t\tisVertical:angleOfDepression < 45,\r\n\t};\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Other Utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Gets the element's left,top,bottom,right values\r\n * with \"auto\"s resolved.\r\n *\r\n * @param HTMLElement\t\t\tel \r\n * @param array\t\t\t\t\tanchors \r\n *\r\n * @return object\r\n */\r\nconst positioningOffsets = function(el, anchors = ['left', 'top', 'right', 'bottom']) {\r\n\tvar inverses = {right:'left', left:'right', bottom:'top', top:'bottom'};\r\n\tvar currentOffsets = cssRead(el, anchors.concat('position'));\r\n\tvar intersectionWithAnchor = null;\r\n\tanchors.forEach(name => {\r\n\t\tif (currentOffsets[name] === 'auto') {\r\n\t\t\t// Get what anchor value would be...\r\n\t\t\t// on current position type\r\n\t\t\tif (currentOffsets.position === 'relative') {\r\n\t\t\t\tcurrentOffsets[name] = - parseFloat(currentOffsets[inverses[name]]);\r\n\t\t\t} else if (currentOffsets.position === 'fixed') {\r\n\t\t\t\tintersectionWithAnchor = intersectionWithAnchor || intersection(rect(el), rect(window));\r\n\t\t\t\tcurrentOffsets[name] = intersectionWithAnchor[name];\r\n\t\t\t} else if (currentOffsets.position === 'absolute') {\r\n\t\t\t\tintersectionWithAnchor = intersectionWithAnchor || intersection(rect(el), rect(el.offsetParent));\r\n\t\t\t\tcurrentOffsets[name] = intersectionWithAnchor[name];\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcurrentOffsets[name] = parseFloat(currentOffsets[name]);\r\n\t\t}\r\n\t});\r\n\tdelete currentOffsets.position;\r\n\treturn currentOffsets;\r\n};\r\n\r\n/**\r\n * Returns the heighest z-index attained by any of its descendants,\r\n * starting from its stacking context.\r\n *\r\n * @param DOMElement\t\tel \r\n *\r\n * @return int\r\n */\r\nconst zHeight = function(el) {\r\n\tvar zIndex = 0;\r\n\t_arr_from(el.children).forEach((el, i) => {\r\n\t\tzIndex = Math.max(zIndex, parseInt(cssRead(el, 'z-index')) || 0);\r\n\t});\r\n\treturn zIndex;\r\n};\r\n\r\n/**\r\n * Parses the total width of the element's vertical borders.\r\n *\r\n * @param DOMElement \t\tel\r\n *\r\n * @return int\r\n */\r\nconst yBorders = function(el) {\r\n\tvar borderWidth = 0;\r\n\tborderWidth += parseInt(cssRead(el, 'border-left-width'));\r\n\tborderWidth += parseInt(cssRead(el, 'border-right-width'));\r\n\treturn borderWidth;\r\n};\r\n\r\n/**\r\n * Parses the total height of the element's horizontal borders.\r\n *\r\n * @param DOMElement \t\tel\r\n *\r\n * @return int\r\n */\r\nconst xBorders = function(el) {\r\n\tvar borderHeight = 0;\r\n\tborderHeight += parseInt(cssRead(el, 'border-top-width'));\r\n\tborderHeight += parseInt(cssRead(el, 'border-bottom-width'));\r\n\treturn borderHeight;\r\n};\r\n\r\n/**\r\n * Gets an element's nearest scrollable parent.\r\n *\r\n * @param DOMNode\t\tel\r\n *\r\n * @return jQuery\r\n */\r\nconst scrollParent = function(el) {\r\n\tvar style = window.getComputedStyle(el);\r\n\tvar excludeStaticParent = style.position === 'absolute';\r\n\tvar overflowRegex = false/*includeHidden*/ ? /(auto|scroll|hidden)/ : /(auto|scroll)/;\r\n\tif (style.position !== 'fixed') {\r\n\t\tfor (var parent = el; (parent = parent.parentElement);) {\r\n\t\t\tstyle = window.getComputedStyle(parent);\r\n\t\t\tif (excludeStaticParent && style.position === 'static') {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tif (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) {\r\n\t\t\t\treturn parent;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn document.body;\r\n};\r\n\r\n/**\r\n * Tells if an element is scrollable due to overflowing content.\r\n *\r\n * @param DOMNode\t\tel\r\n *\r\n * @return bool\r\n */\r\nconst scrolls = function(el) {\r\n\treturn el === window \r\n\t\t? (el.pageYOffset || el.pageYOffset) \r\n\t\t: (el.scrollHeight > el.clientHeight);\r\n};\r\n\r\n/**\r\n * ------------------------------\r\n * Still other Utils.\r\n * ------------------------------\r\n */\r\n\r\n/**\r\n * Parses a directive to obtain a placement keyword and modifiers.\r\n *\r\n * @param string\t\t\t \texpr\r\n *\r\n * @return object\r\n */\r\nconst parsePlacement = function(expr) {\r\n\tvar regPlacement = new RegExp('(before|after|start|end|center)', 'g');\r\n\tvar regModifiers = new RegExp('[\\-\\+][0-9]+(%)?', 'g');\r\n\treturn {\r\n\t\tkeyword: (expr.match(regPlacement) || [])[0],\r\n\t\tpredicates: expr.match(regModifiers),\r\n\t};\r\n};\r\n\r\n/**\r\n * Sums a list of Mathematical expressions.\r\n *\r\n * @param array\t\t\t\t \tmodifiers\r\n * @param number \t\t\t\tpercentageContext\r\n *\r\n * @return number\r\n */\r\nconst evalPredicates = function(modifiers, percentageContext) {\r\n\treturn modifiers.reduce((total, modifier) => total + (modifier.endsWith('%') \r\n\t\t? parseFloat(modifier) / 100 * percentageContext\r\n\t\t: parseFloat(modifier)\r\n\t), 0);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\trect,\r\n\tsize,\r\n\toffsets,\r\n\trectAtOffsets,\r\n\tcoordsAtRect,\r\n\ttranslateTo,\r\n\toffsetTo,\r\n\tscrollTo,\r\n\tresizeCallback,\r\n\tproximity,\r\n\tunion,\r\n\tintersection,\r\n\tdelta,\r\n\tdeltaAngle,\r\n\tzHeight,\r\n\tyBorders,\r\n\txBorders,\r\n\tscrollParent,\r\n\tscrolls,\r\n};\r\nexport default rect;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_remove,\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isUndefined,\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\tfrom as domFrom,\r\n\tfind as domFind,\r\n\tdomData,\r\n\tdomAttr,\r\n\tdomHtml,\r\n\tdomText,\r\n\tdomAppend,\r\n\tdomPrepend,\r\n\tdomAttrAsync,\r\n\tdomHtmlAsync,\r\n\tdomTextAsync,\r\n\tdomAppendAsync,\r\n\tdomPrependAsync,\r\n} from './Dom.js';\r\nimport {\r\n\tcss,\r\n\tcssAsync,\r\n\tcssComputeAsync,\r\n\tcssTransaction,\r\n} from './Css/Css.js';\r\nimport {\r\n\taddListener,\r\n\tremoveListener,\r\n} from './Event/EventController.js';\r\nimport Anim from './Anim/Anim.js';\r\nimport Reflow from './Reflow.js';\r\nimport {\r\n\ttranslateTo,\r\n\toffsetTo,\r\n\tscrollTo,\r\n} from './Geometry/Rect.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Element manipulation library.\r\n * ---------------------------\r\n */\r\nconst Element = class {\r\n\t\r\n\t/**\r\n\t * General element creator.\r\n\t * Accepts any of markup, selector, HTMLElement.\r\n\t *\r\n\t * @param string \t\t\t\tinput\r\n\t *\r\n\t * @return Element\r\n\t */\r\n\tstatic from(input) {\r\n\t\treturn new Element(domFrom(input));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Creates an instance over an element.\r\n\t *\r\n\t * @param HTMLElement\t\t\tel\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(el) {\r\n\t\tthis.el = el;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Strategically returns a HTMLElement.\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\t_el() {\r\n\t\treturn this.el || document.createElement('div');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Automatically returns the current instance in place\r\n\t * of the element.\r\n\t *\r\n\t * @param mixed\t\t\t\t\tret\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_ret(ret) {\r\n\t\treturn this.el && ret === this.el ? this : ret;\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Queries the current element.\r\n\t *\r\n\t * @param string \t\t\t\tselector\r\n\t *\r\n\t * @return DOMNodeList\r\n\t */\r\n\tfind(selector) {\r\n\t\treturn new Element(this.el ? domFind(selector, this.el) : undefined);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see domData\r\n\t *\r\n\t * @return mixed|this\r\n\t */\r\n\tdata(requestOrPayload, val = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domData function is sensitive to argument count\r\n\t\treturn this._ret(domData(this._el(), ...arguments));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see css\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcss(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// css function is sensitive to argument count\r\n\t\treturn this._ret(css(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAttr\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tattr(requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domAttr function is sensitive to argument count\r\n\t\treturn this._ret(domAttr(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domHtml\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\thtml(content = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domHtml function is sensitive to argument count\r\n\t\treturn this._ret(domHtml(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domText\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\ttext(content = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domText function is sensitive to argument count\r\n\t\treturn this._ret(domText(this._el(), ...arguments));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAppend\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tappend(content) {\r\n\t\treturn this._ret(domAppend(this._el(), content));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domPrepend\r\n\t *\r\n\t * @return string|this\r\n\t */\r\n\tprepend(content) {\r\n\t\treturn this._ret(domPrepend(this._el(), content));\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see cssAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcssAsync(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// cssAsync function is sensitive to argument count\r\n\t\treturn cssAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAttrAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tattrAsync(requestOrPayload, valOrMutation = null, subValMutation = null) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domAttrAsync function is sensitive to argument count\r\n\t\treturn domAttrAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domHtmlAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\thtmlAsync(content) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domHtmlAsync function is sensitive to argument count\r\n\t\treturn domHtmlAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domTextAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\ttextAsync(content) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// domTextAsync function is sensitive to argument count\r\n\t\treturn domTextAsync(this._el(), ...arguments).then(ret => {\r\n\t\t\treturn this.el && ret === this.el ? this : ret;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domAppendAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tappendAsync(content) {\r\n\t\treturn domAppendAsync(this._el(), ...arguments).then(() => {\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see domPrependAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tprependAsync(content) {\r\n\t\treturn domPrependAsync(this._el(), ...arguments).then(() => {\r\n\t\t\treturn this;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see cssComputeAsync\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tcssComputeAsync(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// cssComputeAsync function is sensitive to argument count\r\n\t\treturn cssComputeAsync(this._el(), ...arguments);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Establishes a CSS operatiom that can be rolledback without altering similar operation by other code.\r\n\t * If a callback is provided, it synces the entire operation with Reflow's normal read/write cycles.\r\n\t *\r\n\t * @param string|array\t\t\tprops\r\n\t *\r\n\t * @return Transaction\r\n\t */\r\n\tcssTransaction(props) {\r\n\t\treturn cssTransaction(this._el(), props);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * @see addListener\r\n\t */\r\n\tobserve(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// addListener function is sensitive to argument count\r\n\t\treturn addListener(this._el(), ...arguments);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @see removeListener\r\n\t */\r\n\tunobserve(...args) {\r\n\t\t// The ...arguments is important as the\r\n\t\t// removeListener function is sensitive to argument count\r\n\t\treturn removeListener(this._el(), ...arguments);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Creates and plays an amiation.\r\n\t * @see Animation\r\n\t *\r\n\t * @param array|object|string\teffect\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tplay(effect, params = {}) {\r\n\t\tif (!('cancelForCss' in params)) {\r\n\t\t\tparams.cancelForCss = true;\r\n\t\t}\r\n\t\treturn (new Anim(this._el(), effect, params)).play();\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\t\r\n\t/**\r\n\t * Translates an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\ttranslateTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = translateTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tresolve(this.play([\r\n\t\t\t\t\t{transform: trans.current.from},\r\n\t\t\t\t\t{transform: trans.to},\r\n\t\t\t\t], options.play));\r\n\t\t\t} else {\r\n\t\t\t\tresolve(this.css({transform: trans.to}));\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Offsets an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\toffsetTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = offsetTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tresolve(this.play([trans.current.from, trans.to], options.play));\r\n\t\t\t} else {\r\n\t\t\t\tresolve(this.css(trans.to));\r\n\t\t\t}\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Scrolls an element to a reference point in the UI.\r\n\t *\r\n\t * @param HTMLElement|Event|window|Chtml \treference\r\n\t * @param object\t\t\t\t\t\t\toptions\r\n\t *\r\n\t * @return Promise\r\n\t */\r\n\tscrollTo(reference, options = {}) {\r\n\t\tvar refPoint = reference instanceof Element ? reference.el : reference;\r\n\t\treturn Reflow.onread((resolve, reject) => {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\treturn reject();\r\n\t\t\t}\r\n\t\t\tvar trans = scrollTo(this.el, refPoint, options);\r\n\t\t\tif (options.play) {\r\n\t\t\t\tconsole.log('scrollTo() does not currently support animation.');\r\n\t\t\t}\r\n\t\t\tresolve(trans.viewport.scrollTo(trans.to.scrollLeft, trans.to.scrollTop));\r\n\t\t}, true/*withPromise*/);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Element;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_sort\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isObject\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_copy,\r\n\t_with\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport Component from '../Component.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Router class\r\n * ---------------------------\r\n *\r\n * This class provides additional functionality over\r\n * the native document.history object and the \"onpopstate\" event.\r\n */\r\n\t\t\t\r\nconst Router = class extends Component {\r\n\r\n\t/**\r\n\t * Constructs a new Router instance. Typically,\r\n\t * only one instance would be needed app-wide. So an should\r\n\t * be used as a singleton.\r\n\t *\r\n\t * @param object\t\t\t\tstate\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper(state, params);\r\n\t\t// -----------------------\r\n\t\t// This event is triggered by\r\n\t\t// either the browser back button,\r\n\t\t// the window.history.back(),\r\n\t\t// the window.history.forward(),\r\n\t\t// or the window.history.go() action.\r\n\t\tvar getProps = (urlObj, state = null) => {\r\n\t\t\turlObj = _copy(urlObj, urlProperties);\r\n\t\t\turlObj.path = Router.parsePath(urlObj.pathname);\r\n\t\t\turlObj.query = Router.parseQuery(urlObj.search);\r\n\t\t\treturn state ? _with(urlObj, 'state', state) : urlObj;\r\n\t\t};\r\n\t\twindow.addEventListener('popstate', e => {\r\n\t\t\t// Needed to alow document.location\r\n\t\t\t// to update to window.location\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tthis.set(getProps(document.location, window.history.state));\r\n\t\t\t}, 0);\r\n\t\t});\r\n\t\tif (!this.get('href')) {\r\n\t\t\t// Startup route\r\n\t\t\tthis.set(getProps(document.location));\r\n\t\t}\r\n\t\tif (!this.get('state') && window.history) {\r\n\t\t\t// Startup state\r\n\t\t\tthis.set('state', window.history.state);\r\n\t\t}\r\n\t\t// -----------------------\r\n\t\t// Capture all link-clicks\r\n\t\t// and fire to this router.\r\n\t\twindow.addEventListener('click', e => {\r\n\t\t\t// TODO: remove without issues\r\n\t\t\te.preventDefault();\r\n\t\t\tvar anchor, href, target;\r\n\t\t\tif ((anchor = e.target.closest('a')) \r\n\t\t\t&& (href = anchor.getAttribute('href'))) {\r\n\t\t\t\tvar e2 = this.route(href, null, anchor.getAttribute('target'));\r\n\t\t\t\tif (e2.isDefaultPrevented) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets new URL and state data and fires the change.\r\n\t *\r\n\t * For the benefit of calling observers and accessing listeners' disposition,\r\n\t * this function should be used instead of window.history.pushState() and window.history.replaceState().\r\n\t *\r\n\t * @param string \thref\r\n\t * @param object \tstate\r\n\t * @param string \ttarget\r\n\t *\r\n\t * @return void|false|Promise\r\n\t */\r\n\troute(href, state = null, target = null) {\r\n\t\tvar urlObj = Router.parseUrl(href);\r\n\t\tif (!_isObject(state)) {\r\n\t\t\tstate = window.history.state;\r\n\t\t}\r\n\t\t// -----------------\r\n\t\tvar listenersDisposition = this.set(_with(_with(urlObj, 'state', state), 'target', target));\r\n\t\tif (urlObj.href === document.location.href) {\r\n\t\t\twindow.history.replaceState(state, '', href);\r\n\t\t} else {\r\n\t\t\twindow.history.pushState(state, '', href);\r\n\t\t}\r\n\t\tif (listenersDisposition instanceof Promise) {\r\n\t\t\tlistenersDisposition.catch(() => {\r\n\t\t\t\tthis.back();\r\n\t\t\t});\r\n\t\t}\r\n\t\t// -----------------\r\n\t\treturn listenersDisposition;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Updates the current url with new state data.\r\n\t *\r\n\t * For the benefit of calling observers and accessing listeners' disposition,\r\n\t * this function should be used instead of window.history.replaceState().\r\n\t *\r\n\t * @param object \tstate\r\n\t *\r\n\t * @return void|false|Promise\r\n\t */\r\n\tupdate(state) {\r\n\t\twindow.history.replaceState(state, '', document.location);\r\n\t\treturn this.set('data', state);\r\n\t}\r\n\r\n\t/**\r\n\t * Forwards to a visited route using window.history.forward()\r\n\t *\r\n\t * This function eventually calls observers via \"popstate\" event bound in the constructor.\r\n\t * But this won't return a Promise as Router.route() would.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tforward() {\r\n\t\twindow.history.forward();\r\n\t}\r\n\r\n\t/**\r\n\t * Returns to a previous route using window.history.back()\r\n\t *\r\n\t * This function eventually calls observers via \"popstate\" event bound in the constructor.\r\n\t * But this won't return a Promise as Router.route() would.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tback() {\r\n\t\twindow.history.back();\r\n\t}\r\n\r\n\t/**\r\n\t * Goes to a specific history entry using window.history.go()\r\n\t *\r\n\t * This function eventually calls observers via \"popstate\" event bound in the constructor.\r\n\t * But this won't return a Promise as Router.route() would.\r\n\t *\r\n\t * @param int key\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tgo(key) {\r\n\t\twindow.history.go(key);\r\n\t}\r\n\r\n\t/**\r\n\t * Tells if the given URL matches the router's current URL\r\n\t *\r\n\t * @param string\t\t\thref\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tmatches(href) {\r\n\t\tvar urlObj = Router.parseUrl(href);\r\n\t\treturn (this.get('href') + '/').startsWith(!urlObj.href.endsWith('/') ? urlObj.href + '/' : urlObj.href);\r\n\t}\r\n\r\n\t/**\r\n\t * Parses an URL and returns its properties\r\n\t *\r\n\t * @param string\t\t\thref\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseUrl(href) {\r\n\t\tvar a = document.createElement('a');\r\n\t\ta.href = href;\r\n\t\tvar urlObj = urlProperties.reduce((obj, prop) => _with(obj, prop, a[prop]), {});\r\n\t\turlObj.path = Router.parsePath(urlObj.pathname);\r\n\t\turlObj.query = Router.parseQuery(urlObj.search);\r\n\t\treturn urlObj;\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the input path and returns its parts named\r\n\t *\r\n\t * @param string\t\t\tpath\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parsePath(path) {\r\n\t\tvar pathArr = path.split('/').filter(k => k);\r\n\t\tvar pathStr = path === '/' ? path : '/' + pathArr.join('/') + '/';\r\n\t\tvar pathnaming = _sort(Object.keys(Router.pathnaming), 'desc').reduce((_pathnames, _path) => {\r\n\t\t\treturn _pathnames || (pathStr.startsWith(_path === '/' ? _path : '/' + _path.split('/').filter(k => k).join('/') + '/') ? Router.pathnaming[_path] : null);\r\n\t\t}, null);\r\n\t\tvar pathObj = pathArr.reduce((obj, pathItem, i) => pathnaming[i] ? _with(obj, pathnaming[i], pathItem) : obj, {});\r\n\t\treturn {\r\n\t\t\tstr:pathStr,\r\n\t\t\tarr:pathArr,\r\n\t\t\tobj:pathObj,\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the input query string and returns its parts named\r\n\t *\r\n\t * @param string\t\t\tquery\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseQuery(query) {\r\n\t\tvar queryArr = (query.startsWith('?') ? query.substr(1) : query)\r\n\t\t\t.split('&').map(q => q.split('=').map(str => str.trim()));\r\n\t\treturn queryArr.reduce((obj, q) => _with(obj, q[0], q[1]), {});\r\n\t}\r\n};\r\n\r\n/**\r\n * These are standard\r\n * and shouldnt'/can't be modified\r\n *\r\n * @array\r\n */\r\nconst urlProperties = [\r\n\t'hash',\r\n\t'host',\r\n\t'hostname',\r\n\t'href',\r\n\t'origin',\r\n\t'pathname',\r\n\t'port',\r\n\t'protocol',\r\n\t'search',\r\n];\r\n\r\n/**\r\n * @array\r\n */\r\nRouter.pathnaming = {\r\n\t'/': ['controller', 'resourceType', 'resourceId', 'action',],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Router;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isObject\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_pushUnique,\r\n\t_intersect\r\n} from '@onephrase/commons/src/Arr.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The HTML Context Model Schema.\r\n\t// @see https://html.spec.whatwg.org/multipage\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * @object\r\n */\r\nconst Schema = {\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\tstd: {\r\n\t\t/**\r\n\t\t * @uncategorized\r\n\t\t */\r\n\t\thtml: {\r\n\t\t\ttype: ['#sectioning-root'],\r\n\t\t\tmodel: ['head', 'body'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcaption: {\r\n\t\t\tmodel: ['#flow', '!table'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcol: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tcolgroup: {\r\n\t\t\tmodel: [{'colgroup[span]': ['#nothing']}, {':not(colgroup[span])': ['col', 'template']}],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tdd: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'definition',\r\n\t\t},\r\n\t\tdt: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tfigcaption: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thead: {\r\n\t\t\tmodel: ['#metadata'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlegend: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tli: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'listitem',\r\n\t\t},\r\n\t\toptgroup: {\r\n\t\t\tmodel: ['option', '#script-supporting'],\r\n\t\t\timplicitRole: 'group',\r\n\t\t},\r\n\t\toption: {\r\n\t\t\tmodel: [{'option[label][value]': ['#nothing']}, {'option[label]:not(option[value])': ['#text']}, {':not(option[label])': ['#text']}],\r\n\t\t},\r\n\t\tparam: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\trp: {\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\trt: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsource: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#phrasing', '#heading'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttrack: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttbody: {\r\n\t\t\tmodel: ['#script-supporting', 'tr'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t},\r\n\t\ttfoot: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tthead: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttr: {\r\n\t\t\tmodel: ['#script-supporting', 'td', 'th'],\r\n\t\t},\r\n\t\t/**\r\n\t\t * @categorized\r\n\t\t */\r\n\t\ta: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'a[href]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#interactive', '!a'],\r\n\t\t},\r\n\t\tabbr: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing',],\r\n\t\t},\r\n\t\taddress: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer', '!address',],\r\n\t\t},\r\n\t\t// If a child of <map>\r\n\t\tarea: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tarticle: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'article',\r\n\t\t\tacceptableRoles: ['application', 'article', 'document', 'main',],\r\n\t\t},\r\n\t\taside: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'complementary',\r\n\t\t\tacceptableRoles: ['complementary', 'note', 'search',],\r\n\t\t},\r\n\t\taudio: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'audio[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(audio[src])': ['source']}],\r\n\t\t},\r\n\t\tb: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbase: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbdi: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbdo: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tblockquote: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\tbody: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow', '@banner', '@contentinfo', '@complementary', '@main'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tbutton: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#phrasing', '!#interactive'],\r\n\t\t},\r\n\t\tcanvas: {\r\n\t\t\ttype: ['#embedded', '#flow', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#transparent', '!#interactive', 'a', 'img[usemap]', 'button', 'input[type=\"button\"]', 'input[type=\"radio\"]', 'input[type=\"checkbox\"]', 'select[multiple]', 'select[size>=1]', /*has tabindex but not #interactive*/'[tabindex]!#interactive'],\r\n\t\t},\r\n\t\tcite: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tcode: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdatalist: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '#script-supporting', 'option'],\r\n\t\t},\r\n\t\tdel: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tdetails: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow', 'summary'],\r\n\t\t},\r\n\t\tdfn: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '!dfn'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tdialog: {\r\n\t\t\ttype: ['#flow', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'dialog',\r\n\t\t},\r\n\t\tdiv: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [{'dl > div': ['dt', 'dd']}, {':not(dl > div)': ['#flow']}],\r\n\t\t},\r\n\t\tdl: {\r\n\t\t\t/*complicated*/\r\n\t\t\ttype: ['#flow', /*{:contains(> * name-value group): ['#palpable']}*/],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#script-supporting', 'dl', 'dt', 'div'],\r\n\t\t},\r\n\t\tem: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tembed: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tfieldset: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['legend', '#flow'],\r\n\t\t},\r\n\t\tfigure: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['#flow', 'figcaption'],\r\n\t\t\timplicitRole: 'figure',\r\n\t\t},\r\n\t\tfooter: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['contentinfo',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tform: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!form'],\r\n\t\t},\r\n\t\th1: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th2: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th3: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th4: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th5: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th6: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\theader: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['banner',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thgroup: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '#script-supporting'],\r\n\t\t},\r\n\t\thr: {\r\n\t\t\ttype: ['#flow'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\timplicitRole: 'separator',\r\n\t\t},\r\n\t\ti: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tiframe: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\timg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'img[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tinput: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'input:not([type!=\"hidden\"])': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tins: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tkbd: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!label'],\r\n\t\t},\r\n\t\tlink: {\r\n\t\t\ttype: ['#metadata', {'body link': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tmain: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'main',\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tmap: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmark: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmath: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\tmenu: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tmeta: {\r\n\t\t\ttype: ['#metadata', {'meta[itemprop]': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tnames: ['application-name', 'author', 'description', 'generator', 'keywords', 'referrer', 'theme-color'],\r\n\t\t},\r\n\t\tmeter: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tnav: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'navigation',\r\n\t\t\tacceptableRoles: ['navigation',],\r\n\t\t},\r\n\t\tnoscript: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing'], \r\n\t\t\tmodel: [{'head link': ['style', 'meta', 'link']}, {':not(head link)': ['#transparent', '!noscript']}],\r\n\t\t},\r\n\t\tobject: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'object[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', 'param'],\r\n\t\t},\r\n\t\tol: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\toutput: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tp: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tpicture: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing'], \r\n\t\t\tmodel: ['source', 'img', '#acript-supporting'],\r\n\t\t},\r\n\t\tpre: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tprogress: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!progress'],\r\n\t\t},\r\n\t\tq: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\truby: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'],\r\n\t\t\t/*complicated*/ \r\n\t\t\tmodel: ['rp', 'rt'],\r\n\t\t},\r\n\t\ts: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsamp: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tscript: {\r\n\t\t\ttype: ['#flow', '#metadata', '#phrasing', '#acript-supporting'], \r\n\t\t\tmodel: [{'script[src]': []}],\r\n\t\t},\r\n\t\tsection: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'region',\r\n\t\t\tacceptableRoles: ['alert', 'alertdialog', 'application', 'contentinfo', 'dialog', 'document', 'log', 'main', 'marquee', 'region', 'search', 'status',],\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['option', 'optgroup', '#acript-supporting'],\r\n\t\t},\r\n\t\tslot: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tsmall: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tspan: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstrong: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstyle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\tsub: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsup: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsvg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\ttable: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['caption', 'colgroup', 'thead', 'tbody', 'tr', 'tfoot', '#script-supporting'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\ttemplate: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing', '#script-supporting'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\ttime: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: [{'time[datetime]': ['#phrasing']}, {':not(time[datetime])': ['#text']}],\r\n\t\t},\r\n\t\ttitle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tu: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tul: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tvar: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tvideo: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'video[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(video[src])': ['source']}],\r\n\t\t},\r\n\t\twbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\taria: {\r\n\t\tbanner: {\r\n\t\t\ttype: ['@banner'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcontentinfo: {\r\n\t\t\ttype: ['@contentinfo'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcomplementary: {\r\n\t\t\ttype: ['@complementary'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tnavigation: {\r\n\t\t\ttype: ['@navigation'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlist: {\r\n\t\t\ttype: ['@list'], \r\n\t\t},\r\n\t\tlistitem: {\r\n\t\t\ttype: ['@listitem'], \r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic content model for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetContentModelFor(el) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\treturn Schema.std[elTagName] ? Schema.expandRules(el, Schema.std[elTagName].model || []) : [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic categories for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param bool\t\t\t\t\t\troleInclusive\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCategoriesFor(el, roleInclusive = true) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\tvar elSchema = Schema.std[elTagName] || Schema.aria[elTagName] || {};\r\n\t\tvar currentElCategories = [];\r\n\t\tif (roleInclusive && !el.nodeName.startsWith('#') \r\n\t\t&& (el.hasAttribute('role') || elSchema.implicitRole)) {\r\n\t\t\t// Current el's impliable/acceptable roles\r\n\t\t\t// (These take precedence over native semantics)\r\n\t\t\tif (el.hasAttribute('role')) {\r\n\t\t\t\tvar definedRoles = el.getAttribute('role').split(' ');\r\n\t\t\t\tel.getAttribute('role').split(' ').forEach(role => {\r\n\t\t\t\t\tif (elSchema && elSchema.acceptableRoles && !elSchema.acceptableRoles.includes(role)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trole = role.trim();\r\n\t\t\t\t\tcurrentElCategories.push('@' + role);\r\n\t\t\t\t\tif (Schema.aria[role] && Schema.aria[role].type) {\r\n\t\t\t\t\t\tcurrentElCategories = currentElCategories.concat(Schema.expandRules(el, Schema.aria[role].type || []));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (elSchema.implicitRole) {\r\n\t\t\t\t_pushUnique(currentElCategories, '@' + elSchema.implicitRole, elTagName);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Current node's categories/tagname\r\n\t\t\tvar currentElCategories = _pushUnique(Schema.expandRules(el, elSchema.type || []), elTagName);\r\n\t\t}\r\n\t\treturn currentElCategories;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node belongs in the context's content model\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tcontext\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInContentModel(context, node) {\r\n\t\tvar contextModel = context instanceof HTMLElement \r\n\t\t\t? Schema.getContentModelFor(context)\r\n\t\t\t: context;\r\n\t\tvar nodeCategories = node instanceof HTMLElement \r\n\t\t\t? Schema.getCategoriesFor(node)\r\n\t\t\t: node;\r\n\t\tif (_intersect(contextModel, ['#nothing', '#text']).length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar valid;\r\n\t\t// So current content model has to list either this node's categories,\r\n\t\t// tagname, or impliable/acceptable roles\r\n\t\tcontextModel.forEach(allowedNode => {\r\n\t\t\tif (allowedNode.startsWith('!')) {\r\n\t\t\t\tvar disallowedNode = allowedNode.substr(1);\r\n\t\t\t\tif (nodeCategories.includes(disallowedNode)) {\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t}\r\n\t\t\t} else if (valid !== false) {\r\n\t\t\t\tif (nodeCategories.includes(allowedNode)) {\r\n\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn valid && true;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node is associated to the context directly\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tscope\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t * @param object\t\t\t\t\tnodeSchema\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInScopeAs(scope, node, nodeSchema = null) {\r\n\t\tvar contextCategories = Schema.getCategoriesFor(scope);\r\n\t\tvar closest, current = node, nodeModel;\r\n\t\twhile (!closest && (current = current.parentNode)) {\r\n\t\t\tif (_intersect(contextCategories, Schema.getCategoriesFor(current)).length\r\n\t\t\t\t&& Schema.assertNodeBelongsInContentModel(current, nodeSchema ? (nodeSchema.type || node) : node)\r\n\t\t\t) {\r\n\t\t\t\tclosest = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn closest === scope;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Flattens the schema rules for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param array\t\t\t\t\t\trules\r\n\t *\r\n\t * @return array\r\n\t */\r\n\texpandRules(el, rules) {\r\n\t\tvar rles = rules.reduce((categories, rule) => {\r\n\t\t\tif (_isObject(rule)) {\r\n\t\t\t\tif (el.matches(Object.keys(rule)[0])) {\r\n\t\t\t\t\tcategories = categories.concat(Object.values(rule)[0]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcategories.push(rule);\r\n\t\t\t}\r\n\t\t\treturn categories;\r\n\t\t}, []);\r\n\t\tif (rles.includes('#sectioning-root')) {\r\n\t\t\trles.push('#sectioning-content');\r\n\t\t}\r\n\t\treturn rles;\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Schema;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_from\r\n} from '@onephrase/commons/src/Arr.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Matrix loader\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Matrix = class {\r\n\t\r\n\t/**\r\n\t * Creates a new Matrix instance.\r\n\t *\r\n\t * @param array \t\t\tsources\r\n\t * @param string|array \t\tnamespace\r\n\t * @param function \t\t\tgetter\r\n\t * @param MatrixInterface\tcarry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(sources, namespace, getter, carry = null) {\r\n\t\tthis.sources = _from(sources);\r\n\t\tthis.namespace = _from(namespace);\r\n\t\tthis.getter = getter;\r\n\t\tthis.carry = carry;\r\n\t\tthis.collections = {};\r\n\t\tthis.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Enters into a sub collection if exists.\r\n\t *\r\n\t * @param string \t\t\tname\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tenter(name) {\r\n\t\tif (!(name in this.collections)) {\r\n\t\t\tthis.collections[name] = new Matrix(\r\n\t\t\t\tthis.sources, \r\n\t\t\t\tthis.namespace.concat(name),\r\n\t\t\t\tthis.getter,\r\n\t\t\t\tthis \r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this.collections[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Leaves the current current collection into the super collection if exists.\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tleave() {\r\n\t\treturn this.carry;\r\n\t}\r\n\r\n\t/**\r\n\t * Lazy-loads a property from sources.\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget() {\r\n\t\tif (!this.value) {\r\n\t\t\tvar namespace = this.namespace.slice();\r\n\t\t\tvar value = this.carry ? this.carry.get() : null;\r\n\t\t\tthis.sources.forEach((source, i) => {\r\n\t\t\t\tif (value = this.getter.call(null, source, namespace, value, i)) {\r\n\t\t\t\t\tthis.value = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the most-specific module for the given namespace from sources.\r\n\t *\r\n\t * @param sting\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tfind(namespace) {\r\n\t\tvar nsArray = namespace.split('/');\r\n\t\tvar subMatrix, nsKey, nsDrill = this;\r\n\t\twhile((nsKey = nsArray.shift()) && (nsDrill = nsDrill.enter(nsKey))) {\r\n\t\t\tsubMatrix = nsDrill; \r\n\t\t}\r\n\t\t// Clone now...\r\n\t\tvar el = subMatrix.get();\r\n\t\tif (el) {\r\n\t\t\treturn el.cloneNode(true);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Matrix;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_copy\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Def = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(key, value, flag = null) {\r\n\t\tthis.key = key;\r\n\t\tthis.value = value;\r\n\t\tthis.flag = flag;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.key + ': ' + this.value + (this.flag ? ' ' + this.flag : '');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return Def\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tif (expr) {\r\n\t\t\tvar _opts = _copy(opts);\r\n\t\t\t_opts.limit = 1;\r\n\t\t\tvar defSplit = Lexer.split(expr, [':'], _opts);\r\n\t\t\tif (defSplit.length < 2) {\r\n\t\t\t\tthrow new Error('Malformed def: ' + expr);\r\n\t\t\t}\r\n\t\t\tvar key = defSplit.shift().trim();\r\n\t\t\tvar value, flag, vf = Lexer.split(defSplit.shift().trim(), [' '], opts);\r\n\t\t\tif (vf.length > 1) {\r\n\t\t\t\tif (Def.flags.includes(_last(vf).trim().toLowerCase())) {\r\n\t\t\t\t\tflag = vf.pop().trim().toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalue = vf.join(' ');\r\n\t\t\treturn new Def(key, value, flag);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nDef.flags = ['!replace', '!incase',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Def;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport Def from './Def.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefBlock = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries = []) {\r\n\t\t// We must add them through the door\r\n\t\tthis.entries = [];\r\n\t\tentries.forEach(entry => this.add(entry));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns valid entries.\r\n\t *\r\n\t * @param bool\t\twithDuplicates\r\n\t * @param bool\t\twithOverRidden\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfilter(withDuplicate = false, withOverRidden = false) {\r\n\t\treturn this.entries.filter(entry => (!entry.isDuplicate || withDuplicate) && (!entry.overridden || withOverRidden));\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\treturn this.filter(withDuplicate, withOverRidden).map(def => def.toString(context)).join('; ') + ';';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds an entry to the list with overRiding resolved.\r\n\t *\r\n\t * @param object\t\tentry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tadd(newDef) {\r\n\t\tif (!newDef.key || !newDef.value) {\r\n\t\t\tthrow new Error('Def must contain a valid key and value!');\r\n\t\t}\r\n\t\tif (!(newDef instanceof Def)) {\r\n\t\t\tnewDef = new Def(newDef.key, newDef.value, newDef.flag);\r\n\t\t}\r\n\t\tthis.entries.forEach(existingDef => {\r\n\t\t\tif (existingDef.isDuplicate || existingDef.overridden) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar key_a = existingDef.key.toString();\r\n\t\t\tvar value_a = existingDef.value.toString();\r\n\t\t\tvar value_aUnwrapped = _wrapped(value_a, '(', ')') ? _unwrap(value_a, '(', ')') : value_a;\r\n\t\t\tvar key_b = newDef.key.toString();\r\n\t\t\tvar value_b = newDef.value.toString();\r\n\t\t\tvar value_bUnwrapped = _wrapped(value_b, '(', ')') ? _unwrap(value_b, '(', ')') : value_b;\r\n\t\t\tvar incase_a = (existingDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_a = (existingDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tvar incase_b = (newDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_b = (newDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tif (key_a === key_b) {\r\n\t\t\t\tif ((value_a === value_b || value_aUnwrapped === value_bUnwrapped) \r\n\t\t\t\t&& (important_a === important_b || incase_a === incase_b)) {\r\n\t\t\t\t\tnewDef.isDuplicate = true;\r\n\t\t\t\t} else if (important_b || incase_a) {\r\n\t\t\t\t\texistingDef.overridden = true;\r\n\t\t\t\t} else if ((important_a || incase_b)) {\r\n\t\t\t\t\tnewDef.overridden = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.entries.push(newDef);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return DefBlock\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\treturn new DefBlock(\r\n\t\t\tLexer.split(expr, [';'], opts).filter(def => def.trim()).map(def => Def.parse(def.trim()))\r\n\t\t);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefBlock;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport {\r\n\t_copy,\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_isArray,\r\n\t_isObject\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport DefBlock from './DefBlock.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefSheet = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(block = {}) {\r\n\t\tthis.block = {};\r\n\t\tthis.apply(block);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\tvar str = [];\r\n\t\t_each(this.block, (type, defBlock) => {\r\n\t\t\tstr.push('@' + type);\r\n\t\t\tstr.push('{' + defBlock.toString(context, withDuplicate, withOverRidden) + '}');\r\n\t\t});\r\n\t\treturn str.join(' ');\r\n\t}\r\n\t \r\n\t/**\r\n\t * Merges a DefSheet instance or a block of entries into the current instance.\r\n\t *\r\n\t * @param array|DefSheet\tdefSheet\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapply(defSheet) {\r\n\t\tvar block = defSheet;\r\n\t\tif (defSheet instanceof DefSheet) {\r\n\t\t\tblock = defSheet.block;\r\n\t\t} else if (!_isObject(defSheet)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an object or an instance of ./DefSheet!');\r\n\t\t}\r\n\t\t_each(block, (section, defBlock) => {\r\n\t\t\tthis.applyTo(section, defBlock);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * Adds entries to the list of entries for the given type.\r\n\t *\r\n\t * @param string\t\t\tsection\r\n\t * @param array|DefBlock\tdefBlock\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapplyTo(section, defBlock) {\r\n\t\tvar entries = defBlock;\r\n\t\tif (defBlock instanceof DefBlock) {\r\n\t\t\tentries = defBlock.entries;\r\n\t\t} else if (!_isArray(defBlock)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an array or an instance of ./DefBlock!');\r\n\t\t}\r\n\t\tif (!this.block[section]) {\r\n\t\t\tthis.block[section] = new DefBlock;\r\n\t\t}\r\n\t\tentries.forEach(entry => this.block[section].add(_copy(entry)));\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tvar splits = Lexer.split(expr, [], opts);\r\n\t\tvar type, expr, defBlock, block = {};\r\n\t\twhile ((type = splits.shift()) && (defBlock = splits.shift())) {\r\n\t\t\tblock[type.trim().toLowerCase().substr(1)] = DefBlock.parse(_unwrap(defBlock.trim(), '{', '}'), opts);\r\n\t\t}\r\n\t\treturn new DefSheet(block);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefSheet;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isString,\r\n\t_isFunction,\r\n\t_isProxy,\r\n\t_getProxyTarget\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_from as _arr_from,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_even,\r\n\t_each,\r\n\t_copy\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_before,\r\n\t_after\r\n} from '@onephrase/commons/src/Str.js';\r\nimport Jsen, {\r\n\tArgumentsInterface,\r\n\tCallInterface,\r\n\tReferenceInterface,\r\n\tArguments,\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport Observable from '@onephrase/observable';\r\nimport Matrix from './Def/Matrix.js';\r\nimport DefSheet from './Def/DefSheet.js';\r\nimport DefBlock from './Def/DefBlock.js';\r\nimport Schema from './Schema.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst ChtmlCore = class extends Observable {\r\n\r\n\t/**\r\n\t * Initializes the new Chtml instance.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper({}, params);\r\n\t\t// -----------------------------\r\n\t\t// ROOT RESOLUTION:\r\n\t\t// -----------------------------\r\n\t\tthis.root = this.el = el;\r\n\t\tif (el.nodeName === '#document') {\r\n\t\t\tthis.el = el.querySelector('html');\r\n\t\t} else if (!(el instanceof HTMLElement)) {\r\n\t\t\tthrow new Error('Argument #1 must be instanceof of HTMLElement or the document object!');\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// BINDINGS/DIRECTIVES\r\n\t\t// -----------------------------\r\n\t\t// The parsed namespace ($ns)\r\n\t\tthis.$.ns = ChtmlCore.parseNamespace(this.el);\r\n\t\t// The parsed Cascaded Definition Sheet ($defs)\r\n\t\tthis.$.defs = ChtmlCore.parseCascadedDefSheet(this.el);\r\n\t\t// Initialize...\r\n\t\tthis.init();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Executes one-off initialization directives.\r\n\t *\r\n\t * Then executes reactive bindings and keeps them bound.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinit() {\r\n\t\t// -----------------------\r\n\t\t// Free the instance first...\r\n\t\tthis.free(false);\r\n\t\t// -----------------------\r\n\t\t// One-off init\r\n\t\tthis.getCpsBlock('init', true/*asDirectives*/).forEach(directive => directive.eval(this));\r\n\t\t// -----------------------\r\n\t\t// Reactive bindings\r\n\t\tthis.$.bindingsListeners = [];\r\n\t\t// Apply bindings...\r\n\t\tvar stringifyEach = list => _unique(list.map(expr => _before(_before(expr.toString(), '['), '(')));\r\n\t\tthis.getCpsBlock('bindings', true/*asDirectives*/).forEach(binding => {\r\n\t\t\tif (!this.$.params.observeOnly) {\r\n\t\t\t\tbinding.eval(this, this.jsenGetter());\r\n\t\t\t}\r\n\t\t\t// We'll execute binding on the appriopriate changes\r\n\t\t\tvar listenerObj = this.observe(stringifyEach(binding.meta.vars), (newState, oldState, params) => {\r\n\t\t\t\t// Next eval() should be triggered by only the changes in the vars that participated in this eval()\r\n\t\t\t\tvar evalReturn = binding.eval(this, this.jsenGetter());\r\n\t\t\t\t// If the result of this evaluation is false,\r\n\t\t\t\t// e.stopPropagation will be called and subsequent expressions\r\n\t\t\t\t// will not be evaluated. So we must not allow false to be returned.\r\n\t\t\t\t// All expressions are meant to be evaluated in parallel, independent of each other.\r\n\t\t\t\tif (evalReturn !== false) {\r\n\t\t\t\t\treturn evalReturn;\r\n\t\t\t\t}\r\n\t\t\t}, {diff: this.$.params.diff});\r\n\t\t\tthis.$.bindingsListeners.push(listenerObj);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Frees the instance of either observed bindings\r\n\t * or entire available listeners.\r\n\t *\r\n\t * @param bool\t\t\t\t\tall\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tfree(all = true) {\r\n\t\tif (all) {\r\n\t\t\t// Remove all available listeners\r\n\t\t\tsuper.removeListener();\r\n\t\t} else if (this.$.bindingsListeners) {\r\n\t\t\t// Remove all observed bindings\r\n\t\t\tthis.$.bindingsListeners.forEach(listener => listener.remove());\r\n\t\t\tthis.$.bindingsListeners.splice();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Clones the instance using a serialize/deserialize strategy.\r\n\t *\r\n\t * @param bool\t \t\tcleanCopy\r\n\t *\r\n\t * @return ChtmlInterface\r\n\t */\r\n\tclone(cleanCopy = true) {\r\n\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t}\r\n\t\tvar el = this.el.cloneNode(true);\r\n\t\t// -------------------------------\r\n\t\t// We'll remove all aprsable components of the element\r\n\t\t// as we already have the most accurate available\r\n\t\t// -------------------------------\r\n\t\tvar attrCache = {};\r\n\t\t[ChtmlCore.attributeMap.related, ChtmlCore.attributeMap.bindings].forEach(type => {\r\n\t\t\tvar attrValue;\r\n\t\t\tif (attrValue = el.getAttribute(type)) {\r\n\t\t\t\tattrCache.type = attrValue;\r\n\t\t\t\tel.removeAttribute(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar dataBlockScript;\r\n\t\tif (dataBlockScript = _arr_from(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0]) {\r\n\t\t\tdataBlockScript.remove();\r\n\t\t}\r\n\t\t// -------------------------------\r\n\t\t// Instantiate now...\r\n\t\t// -------------------------------\r\n\t\tvar instance = this.$.params.componentCallback(el, this.$.params, false/*resolveInheritance*/);\r\n\t\tvar _instance = _isProxy(instance) ? _getProxyTarget(instance) : instance;\r\n\t\t// Serialize/deserialize definitions\r\n\t\t_instance.$defs = DefSheet.parse(this.$.defs.toString(null/*context*/, !cleanCopy/*withDuplicate*/, true/*withOverRidden*/));\r\n\t\t// -------------------------------\r\n\t\t// Restore parsable components of the element just for the records\r\n\t\t// -------------------------------\r\n\t\t_each(attrCache, (type, attrValue) => {\r\n\t\t\tel.setAttribute(type, attrValue);\r\n\t\t});\r\n\t\tif (dataBlockScript) {\r\n\t\t\tel.prepend(dataBlockScript);\r\n\t\t}\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evalutes the bindings for the component;\r\n\t * caches the result for subsequent calls.\r\n\t *\r\n\t * @param string\t\tkey\r\n\t * @param bool\t\t\tasDirectives\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCpsBlock(key, asDirectives = false) {\r\n\t\tvar cpsBlockDefs = this.$.defs.block[key] ? this.$.defs.block[key].filter() : [];\r\n\t\tif (asDirectives) {\r\n\t\t\tvar directives = [];\r\n\t\t\tcpsBlockDefs.forEach(def => {\r\n\t\t\t\tvar argsExpr = (this.$.params.chainableDirectives === false || !def.value.trim().startsWith('(') ? [def.value] : Lexer.split(def.value, ['.']))\r\n\t\t\t\t\t.map(expr => Jsen.parse(expr, [Arguments], {assert:false}) || Jsen.parse(expr));\r\n\t\t\t\tif (argsExpr.length !== argsExpr.filter(a => a).length) {\r\n\t\t\t\t\tthis.error('Malformed argument in the CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar directive, _directive = def.key + (argsExpr.length > 1 || argsExpr[0] instanceof ArgumentsInterface ? argsExpr.join('.') : '(' + argsExpr[0].toString() + ')');\r\n\t\t\t\tif (!(directive = Jsen.parse(_directive, null, {explain: this.$.params.explainJsen}))) {\r\n\t\t\t\t\tthis.error('Malformed CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdirectives.push(directive);\r\n\t\t\t});\r\n\t\t\treturn directives;\r\n\t\t}\r\n\t\treturn cpsBlockDefs;\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to resolve a node as related node.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|ChtmlInterface\r\n\t */\r\n\tgetRelatedNode(requestNodeName) {\r\n\t\tvar computeQuery, node, vars = [];\r\n\t\tif (!this.computedRelated) {\r\n\t\t\tthis.computedRelated = {};\r\n\t\t\tthis.getCpsBlock('related', false/*asDirectives*/).forEach(entry => {\r\n\t\t\t\tthis.computedRelated[entry.key] = Jsen.parse(entry.value);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif ((computeQuery = this.computedRelated[requestNodeName]) \r\n\t\t&& (node = computeQuery.eval(this, this.jsenGetter(vars)))) {\r\n\t\t\tif (_isFunction(node)) {\r\n\t\t\t\tnode = node(this.el, requestNodeName);\r\n\t\t\t\tif (!_isString(node) && !(node instanceof HTMLElement)) {\r\n\t\t\t\t\tthrow new Error('The callback for node \"' + requestNodeName + '\" returned an invalid type.');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (_isString(node)) {\r\n\t\t\t\t// Markup or plain selector string....\r\n\t\t\t\tnode = ChtmlCore.toElement(node);\r\n\t\t\t}\r\n\t\t\tif (!(node instanceof HTMLElement)) {\r\n\t\t\t\tthrow new Error('\"' + requestNodeName + '\" could not be resolved to a valid node instance.');\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from explicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tgetExplicitNode(requestNodeName) {\r\n\t\t// If given a rolecase, we can perform a query if we understand the semantics.\r\n\t\tif ((this.$.roles && this.$.roles.length)\r\n\t\t|| (this.$.roles = (this.el.getAttribute(ChtmlCore.attributeMap.superrole) || '').replace('  ', ' ').split(' ')).length) {\r\n\t\t\tvar roles = this.$.params.rolecase ? [this.$.params.rolecase] : this.$.roles;\r\n\t\t\t// Find matches...\r\n\t\t\treturn roles.reduce((matchedNode, role) => {\r\n\t\t\t\tif (!matchedNode) {\r\n\t\t\t\t\tvar closestSuperSelector = '[' + ChtmlCore.attributeMap.superrole + '~=\"' + role + '\"]';\r\n\t\t\t\t\tvar nodeSelector = '[' + ChtmlCore.attributeMap.subrole + '~=\"' + role + '-' + requestNodeName + '\"]';\r\n\t\t\t\t\tvar closestSuper, _matchedNode;\r\n\t\t\t\t\tif ((_matchedNode = (this.el.shadowRoot || this.el).querySelector(nodeSelector))\r\n\t\t\t\t\t// If this.el has a shadowRoot, we don't expect _matchedNode to be able to find is superRole element.\r\n\t\t\t\t\t// If it finds one, then its not for the curren superRole element.\r\n\t\t\t\t\t&& ((this.el.shadowRoot && !(_matchedNode.parentNode.closest && _matchedNode.parentNode.closest(closestSuperSelector)))\r\n\t\t\t\t\t// _matchedNode must find this.el as its superRole element to qualify.\r\n\t\t\t\t\t\t|| (!this.el.shadowRoot && _matchedNode.parentNode && (closestSuper = _matchedNode.parentNode.closest(closestSuperSelector)) && closestSuper.isSameNode(this.el))\r\n\t\t\t\t\t)) {\r\n\t\t\t\t\t\tmatchedNode = _matchedNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn matchedNode;\r\n\t\t\t}, null);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from implicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|array\r\n\t */\r\n\tgetImplicitNode(requestNodeName) {\r\n\t\tif (requestNodeName.match(/[^a-zA-Z0-9\\-]/)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Use schema...\r\n\t\tvar nodeSchema, nodeSelector = [];\r\n\t\tvar tries = [];\r\n\t\tif (ChtmlCore.schema.aria[requestNodeName]) {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: ['[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.std[requestNodeName] || ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: [requestNodeName, '[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t}\r\n\t\t_each(ChtmlCore.schema.std, (tagname, schema) => {\r\n\t\t\tif (schema.implicitRole === requestNodeName) {\r\n\t\t\t\ttries.push({\r\n\t\t\t\t\tschema: schema,\r\n\t\t\t\t\tselector: [tagname],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar matches = null;\r\n\t\ttries.forEach(trie => {\r\n\t\t\t(this.el.shadowRoot || this.el).querySelectorAll(trie.selector.join(',')).forEach(node => {\r\n\t\t\t\tif (ChtmlCore.schema.assertNodeBelongsInScopeAs(this.el, node, trie.schema)) {\r\n\t\t\t\t\tif (trie.schema && trie.schema.singleton) {\r\n\t\t\t\t\t\tmatches = node;\r\n\t\t\t\t\t} else if (!matches || _isArray(matches)) {\r\n\t\t\t\t\t\tmatches = matches || [];\r\n\t\t\t\t\t\tmatches.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Makes a node object following the nodeCallback rules\r\n\t * for the instance.\r\n\t *\r\n\t * @param string|int\t nodeName\r\n\t * @param mixed\t\t\t node\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tcreateNode(nodeName, node) {\r\n\t\tvar _node = node;\r\n\t\tif (this.$.params.drilldown) {\r\n\t\t\tif (node === this.root || node === this.el) {\r\n\t\t\t\tnode = this;\r\n\t\t\t} else if (node) {\r\n\t\t\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t\t\t}\r\n\t\t\t\tvar params = _copy(this.$.params);\r\n\t\t\t\tparams.alias = nodeName;\r\n\t\t\t\tnode = _isArray(node) \r\n\t\t\t\t\t? node.map(node => this.$.params.componentCallback(node, params, true/*resolveInheritance*/)) \r\n\t\t\t\t\t: this.$.params.componentCallback(node, params, true/*resolveInheritance*/);\r\n\t\t\t}\r\n\t\t} else if (_isFunction(this.$.params.nodeCallback)) {\r\n\t\t\tnode = _isArray(node) \r\n\t\t\t\t? node.map(node => this.$.params.nodeCallback(node)) \r\n\t\t\t\t: this.$.params.nodeCallback(node);\r\n\t\t}\r\n\t\tthis.set(nodeName, node);\r\n\t\tif (_node && _node !== this.root && _node !== this.el && !_isArray(_node)) {\r\n\t\t\tChtmlCore.disconnectedCallback(_node, () => {\r\n\t\t\t\tthis.del(nodeName);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn node;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds a node by name; caches result.\r\n\t *\r\n\t * @param string \t\tnodeName\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(nodeName) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(nodeName);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tvar node;\r\n\t\tif (nodeName === '_' || nodeName === '__') {\r\n\t\t\treturn super.get(nodeName);\r\n\t\t}\r\n\t\tif ((nodeName === 'root' && (node = this.root)) \r\n\t\t|| (nodeName === 'el' && (node = this.el))) {\r\n\t\t\treturn _isFunction(this.$.params.nodeCallback) \r\n\t\t\t\t? this.$.params.nodeCallback(node) \r\n\t\t\t\t: node;\r\n\t\t}\r\n\t\tif (!(nodeName in this.$.state)) {\r\n\t\t\tif ((node = this.getRelatedNode(nodeName))\r\n\t\t\t|| (!this.$.params.implicitOnly && (node = this.getExplicitNode(nodeName)))\r\n\t\t\t|| (!this.$.params.explicitOnly && (node = this.getImplicitNode(nodeName)))) {\r\n\t\t\t\tthis.createNode(nodeName, node);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.$.state[nodeName];\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * UTILITY METHODS\r\n\t * -------------------\r\n\t */\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML namespace.\r\n\t * This explains how an element's namespace is used in CHTML.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseNamespace(el) {\r\n\t\tvar namespaceParse = {roadmap: el.getAttribute(ChtmlCore.attributeMap.ns)};\r\n\t\tif (namespaceParse.roadmap) {\r\n\t\t\tnamespaceParse.namespace = _before(namespaceParse.roadmap, '//');\r\n\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.roadmap, '//');\r\n\t\t\t// In case this is the /// spot...\r\n\t\t\tif (namespaceParse.subnamespace.startsWith('/')) {\r\n\t\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.subnamespace, '/');\r\n\t\t\t}\r\n\t\t\tif (namespaceParse.subnamespace.endsWith('//') && namespaceParse.subnamespace.indexOf('///') === -1) {\r\n\t\t\t\tnamespaceParse.subnamespace = namespaceParse.subnamespace + namespaceParse.namespace + '//';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn namespaceParse;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML definitions (related, bindings)\r\n\t * both from attributes and from an embedded script data block.\r\n\t *\r\n\t * Where both attributes and data block are set, definitions in attributes inherit from those in data block.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return DefSheet\r\n\t */\r\n\tstatic parseCascadedDefSheet(el) {\r\n\t\tvar dataBlockScript, defsheet;\r\n\t\tif (!(dataBlockScript = _arr_from(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0])\r\n\t\t|| !(defsheet = DefSheet.parse((dataBlockScript.textContent || '').trim()))) {\r\n\t\t\tdefsheet = new DefSheet;\r\n\t\t}\r\n\t\tvar attr, defBlock;\r\n\t\t['related', 'bindings',].forEach(type => {\r\n\t\t\tif ((attr = el.getAttribute(ChtmlCore.attributeMap[type])) && (defBlock = DefBlock.parse(attr))) {\r\n\t\t\t\tdefsheet.applyTo(type, defBlock);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn defsheet;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Composes a component from a super component.\r\n\t *\r\n\t * All definitions (related, bindings) will be inherited.\r\n\t * If the idea is to import, the super component's element will be returned,\r\n\t * (On import, nodes in component (as defined, if) will be uploaded into slots in the super component.)\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recompose(elTo, elFrom) {\r\n\t\tif (elTo.matches(ChtmlCore.elementMap.import)) {\r\n\t\t\telFrom = elFrom.cloneNode(true);\r\n\t\t\tvar elToNs = elTo.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromNs = elFrom.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromRoles = (elFrom.getAttribute(ChtmlCore.attributeMap.superrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t// -------------------------\r\n\t\t\t// So we concat() the role attribute\r\n\t\t\t// -------------------------\r\n\t\t\telFrom.setAttribute(ChtmlCore.attributeMap.ns, elToNs);\r\n\t\t\t// We will prepend defs from the elTo into elFrom\r\n\t\t\tChtmlCore.recomposeDefs(elFrom, elTo, 'append');\r\n\t\t\t// -------------------------\r\n\t\t\t// Upload nodes into elFrom just the way slots work in Web Compoonents\r\n\t\t\t// -------------------------\r\n\t\t\t_arr_from((elTo.shadowRoot || elTo).children).forEach((replacementNode, i) => {\r\n\t\t\t\tif (replacementNode.matches(ChtmlCore.elementMap.defsheet)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treplacementNode = replacementNode.cloneNode(true);\r\n\t\t\t\tvar applicableContextRoles = [], applicableReplacementNodeRoles = [];\r\n\t\t\t\tvar replacementNodeRoles = (replacementNode.getAttribute(ChtmlCore.attributeMap.subrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t\treplacementNodeRoles.forEach(replacementNodeRole => {\r\n\t\t\t\t\tvar _applicableContextRoles = elFromRoles.filter(contextRole => replacementNodeRole.startsWith(contextRole + '-'));\r\n\t\t\t\t\tif (_applicableContextRoles.length) {\r\n\t\t\t\t\t\tapplicableContextRoles.push(_applicableContextRoles[0]);\r\n\t\t\t\t\t\tapplicableReplacementNodeRoles.push(replacementNodeRole);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (applicableContextRoles.length) {\r\n\t\t\t\t\tvar slotNodes;\r\n\t\t\t\t\tvar contextSelector = applicableContextRoles.map(contextRole => '[' + ChtmlCore.attributeMap.superrole + '~=\"' + contextRole + '\"]');\r\n\t\t\t\t\tvar slotNodeSelector = applicableReplacementNodeRoles.map(replacementNodeRole => '[' + ChtmlCore.attributeMap.subrole + '~=\"' + replacementNodeRole + '\"]');\r\n\t\t\t\t\tif ((elFrom.shadowRoot && (slotNodes = elFrom.shadowRoot.querySelectorAll(slotNodeSelector)))\r\n\t\t\t\t\t|| ((slotNodes = elFrom.querySelectorAll(slotNodeSelector)).length === 1 && slotNodes[0].closest(contextSelector) === elFrom)) {\r\n\t\t\t\t\t\t// We will prepend defs from the slot node into replacement node\r\n\t\t\t\t\t\tChtmlCore.recomposeDefs(replacementNode, slotNodes[0], 'prepend');\r\n\t\t\t\t\t\t// Port to target...\r\n\t\t\t\t\t\tslotNodes[0].replaceWith(replacementNode);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.error('Composition Error: Node #' + i + ' (at ' + elToNs + ') must match exactly one targetNode in ' + elFromNs + '! (' + slotNodes.length + ' matched)');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\telFrom.append(replacementNode);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn elFrom;\r\n\t\t}\r\n\t\t// We will append defs from the elFrom into elTo\r\n\t\tChtmlCore.recomposeDefs(elTo, elFrom, 'prepend');\r\n\t\treturn elTo;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Composes definitions (related, bindings) from elFrom into elTo.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t * @param string\t\t\t\t\tappendOrPrepend\r\n\t * @param array\t\t\t\t\t\tnorecompose\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recomposeDefs(elTo, elFrom, appendOrPrepend, norecompose = []) {\r\n\t\tnorecompose = norecompose.concat([ChtmlCore.attributeMap.ns, ...ChtmlCore.attributeMap.nocompose]);\r\n\t\tif (elTo.hasAttribute('norecompose')) {\r\n\t\t\tnorecompose = norecompose.concat((elTo.getAttribute('norecompose') || '*').split(' ').map(val => val.trim()));\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Custom Composition...\r\n\t\t// ----------------------------\r\n\t\tif (_isFunction(ChtmlCore.recomposeCallback)) {\r\n\t\t\tvar disposition = ChtmlCore.recomposeCallback(elTo, elFrom, appendOrPrepend, norecompose);\r\n\t\t\tif (disposition === false) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (_isString(disposition) || _isArray(disposition)) {\r\n\t\t\t\tnorecompose = norecompose.concat(disposition);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Merge list attributes...\r\n\t\t// ----------------------------\r\n\t\t_unique([ChtmlCore.attributeMap.superrole, ChtmlCore.attributeMap.subrole, 'role', 'class']).forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointList = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointList = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, _unique(jointList.join(' ').split(' ').map(r => r.trim())).join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Merge definition attributes...\r\n\t\t// ----------------------------\r\n\t\t[ChtmlCore.attributeMap.related, ChtmlCore.attributeMap.bindings, 'style'].forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointDefs = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t\tif (!jointDefs[0].trim().endsWith(';')) {\r\n\t\t\t\t\t\tjointDefs[0] = jointDefs[0] + ';';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointDefs = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, jointDefs.join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Port all other attributes...\r\n\t\t// ----------------------------\r\n\t\tfor (var i = 0; i < elFrom.attributes.length; i ++) {\r\n\t\t\tvar attr = elFrom.attributes[i];\r\n\t\t\tif (!norecompose.includes(attr.name) && !norecompose.includes('*') && !elTo.hasAttribute(attr.name)) {\r\n\t\t\t\telTo.setAttribute(attr.name, attr.value);\r\n\t\t\t\tnorecompose.push(attr.name);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// For data blocks...\r\n\t\t// ----------------------------\r\n\t\tif (!norecompose.includes('@cps') && !norecompose.includes('*')) {\r\n\t\t\tvar elToDefs = _arr_from((elTo.shadowRoot || elTo).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tvar elFromDefs = _arr_from((elFrom.shadowRoot || elFrom).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tif (elFromDefs.length) {\r\n\t\t\t\tif (elToDefs.length) {\r\n\t\t\t\t\telToDefs[0][appendOrPrepend](elFromDefs[0].textContent);\r\n\t\t\t\t} else {\r\n\t\t\t\t\telTo.prepend(elFromDefs[0].cloneNode(true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic toElement(input) {\r\n\t\tif (ChtmlCore.ctxt.document) {\r\n\t\t\tvar el;\r\n\t\t\tif (input.trim().startsWith('<')) {\r\n\t\t\t\t// Create a node from markup\r\n\t\t\t\tvar temp = ChtmlCore.ctxt.document.createElement('div');\r\n\t\t\t\ttemp.innerHtml = input;\r\n\t\t\t\tel = temp.firstChild;\r\n\t\t\t} else {\r\n\t\t\t\tel = ChtmlCore.ctxt.document.querySelector(input);\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t * @param function\t\t\t\t\tcallback\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic disconnectedCallback(el, callback) {\r\n\t\tif (el.parentNode) {\r\n\t\t\tvar called = false;\r\n\t\t\tvar observer = new MutationObserver(mutations => {\r\n\t\t\t\tmutations.forEach(m => {\r\n\t\t\t\t\tif (!called && _arr_from(m.removedNodes).includes(el)) {\r\n\t\t\t\t\t\tcalled = true;\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tobserver.observe(el.parentNode, {childList:true});\r\n\t\t\tChtmlCore.disconnectedCallback(el.parentNode, () => {\r\n\t\t\t\tif (!called) {\r\n\t\t\t\t\tcalled = true;\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.ctxt = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.schema = Schema;\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.elementMap = {\r\n\tdefsheet: 'script[type=\"application/chtml-cps\"]',\r\n\tbundle: 'chtml-bundle',\r\n\timport: 'chtml-import',\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.attributeMap = {\r\n\tns: 'chtml-ns',\r\n\trelated: 'chtml-related',\r\n\tbindings: 'chtml-bindings',\r\n\tsuperrole: 'chtml-role',\r\n\tsubrole: 'chtml-role',\r\n\tnocompose: ['nocompose', 'shadow',],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default ChtmlCore;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_mixin,\r\n\t_isString,\r\n\t_isNumeric,\r\n\t_isEmpty,\r\n\t_isNumber,\r\n\t_isFunction,\r\n\t_isObservable,\r\n\t_isProxy,\r\n\t_isUndefined,\r\n\t_getProxyTarget\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_all,\r\n\t_following\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_before,\r\n\t_beforeLast\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_closest\r\n} from '@onephrase/commons/src/Num.js';\r\nimport {\r\n\t_inherit\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Chtml = class extends ChtmlCore {\r\n\r\n\t/**\r\n\t * Constructs a new Chtml and optionally returns a proxy wrapper.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper(el, _inherit({}, params, Chtml.params));\r\n\t\t// -----------------------------\r\n\t\t// OBSERVABILITY\r\n\t\t// -----------------------------\r\n\t\t// Bind populable context\r\n\t\tthis.observe(this.$.params.dataKey, (context, _context) => {\r\n\t\t\tif (this.$.ns.subnamespace && !_isString(context) && !_isNumber(context) && !_isUndefined(context)) {\r\n\t\t\t\t// Initial Sync...\r\n\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback);\r\n\t\t\t\t// Reactive Sync?\r\n\t\t\t\tif (_isObservable(context)) {\r\n\t\t\t\t\tcontext.observe(changes => {\r\n\t\t\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback, Object.keys(changes));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) context object or logical object to the instance.\r\n\t *\r\n\t * @param object \t\tcontext\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tbind(context) {\r\n\t\tthis.set(this.$.params.dataKey, context);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) list context to the instance.\r\n\t * Childnodes will be automatically created/removed per key.\r\n\t *\r\n\t * @param array \t\tlistContext\r\n\t * @param string \t\tsubnamespace\r\n\t * @param function \t\titemCallback\r\n\t * @param array \t\tonlyKeys\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tpopulate(listContext, subnamespace, itemCallback = null, onlyKeys = []) {\r\n\t\tif (_isObservable(listContext) && !_isProxy(listContext)) {\r\n\t\t\tlistContext = listContext.proxy();\r\n\t\t}\r\n\t\t(arguments.length > 3 ? onlyKeys : Object.keys(listContext)).forEach(k => {\r\n\t\t\tk = _isNumeric(k) ? parseInt(k) : k;\r\n\t\t\tvar item = this.has(k) ? this.get(k) : null;\r\n\t\t\tif (!_isUndefined(listContext[k])) {\r\n\t\t\t\tvar isNewItem = false;\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\tvar itemNamespaceArray = subnamespace.split('//');\r\n\t\t\t\t\t// Create a namespace hash...\r\n\t\t\t\t\titemNamespaceArray[0] += '/' + k;\r\n\t\t\t\t\tvar itemEl = Chtml.import(itemNamespaceArray.join('//'));\r\n\t\t\t\t\tif (itemEl) {\r\n\t\t\t\t\t\tvar following = _following(Object.keys(listContext), k + ''/*numeric k needs this*/, true/*length*/)\r\n\t\t\t\t\t\t\t.reduce((closest, _k) => closest || (this.has(_k) ? this.get(_k) : null), null);\r\n\t\t\t\t\t\tif (following) {\r\n\t\t\t\t\t\t\tfollowing.el.before(itemEl);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.el.append(itemEl);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem = this.createNode(k, itemEl);\r\n\t\t\t\t\t\tisNewItem = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (item) {\r\n\t\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\t\titemCallback(item, listContext[k], k, isNewItem);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.bind(listContext[k]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (item) {\r\n\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\tvar unbindReturn = itemCallback(item, false, k);\r\n\t\t\t\t\tif (('Promise' in ChtmlCore.ctxt) && unbindReturn instanceof ChtmlCore.ctxt.Promise) {\r\n\t\t\t\t\t\tunbindReturn.then(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.free();\r\n\t\t\t\t\titem.el.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * INSTANCE-RELATED METHODS\r\n\t * -------------------\r\n\t */\r\n\r\n\t/**\r\n\t * Creates a Chtml over a root resolved from definition or markup string.\r\n\t *\r\n\t * @param string|document|HTMLElement\tinput\r\n\t * @param object\t\t\t\t\t\tparams\r\n\t * @param bool\t\t\t\t\t\t\tresolveInheritance\r\n\t * @param object\t\t\t\t\t\tStatic\r\n\t *\r\n\t * @return Chtml\r\n\t */\r\n\tstatic from(input, params = {}, resolveInheritance = true, Static = Chtml) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve element from input\r\n\t\t// -----------------------------\r\n\t\tvar el = input;\r\n\t\tif (_isString(input) && !input.trim().startsWith('<') && input.indexOf('/') !== -1) {\r\n\t\t\tif (!ChtmlCore.bundles || !(el = Chtml.import(_before(input, '//')))) {\r\n\t\t\t\tthrow new Error('No element found on the namespace \"' + input + '\"!');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (_isString(input)) {\r\n\t\t\t\tif (!(el = ChtmlCore.toElement(input))) {\r\n\t\t\t\t\tthrow new Error('Could not resolve the string \"' +input + '\" to an element!');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (resolveInheritance && ChtmlCore.bundles) {\r\n\t\t\t\tvar ns, superNs, superEl, isImport = el.matches(ChtmlCore.elementMap.import);\r\n\t\t\t\tif ((ns = _before(el.getAttribute(ChtmlCore.attributeMap.ns) || '', '//'))\r\n\t\t\t\t// The entire namespace is used for elements of type import.\r\n\t\t\t\t// The supernamespace is used for normal elements\r\n\t\t\t\t&& ((isImport && (superNs = ns)) || (superNs = _beforeLast(ns, '/')) && superNs.indexOf('/') > -1)\r\n\t\t\t\t&& (superEl = Chtml.import(superNs))) {\r\n\t\t\t\t\tvar _el = el;\r\n\t\t\t\t\tel = ChtmlCore.recompose(el, superEl);\r\n\t\t\t\t\tif (isImport) {\r\n\t\t\t\t\t\t_el.replaceWith(el);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (ns) {\r\n\t\t\t\t\tconsole.warn('Namespace resolution failed: ' + ns);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn new Static(el, params);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Imports a module from bundles.\r\n\t *\r\n\t * @param string\t\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic import(namespace) {\r\n\t\treturn ChtmlCore.bundles.find(namespace);\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtml.params = {\r\n\tdiff: true,\r\n\tdataKey: '$',\r\n\tdrilldown: false,\r\n\tnodeCallback: null,\r\n\tcomponentCallback: Chtml.from,\r\n\tobserveOnly: false,\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Chtml;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_before\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {  \r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport Schema from './Schema.js';\r\nimport Matrix from './Def/Matrix.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\nimport Chtml from './Chtml.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Configure CHTM with\r\n * a global document.\r\n */\r\nChtmlCore.ctxt = window;\r\n\r\n/**\r\n * Create a \"ready\" construct that\r\n * init-related functionality can leverage.\r\n */\r\nvar contentLoadedPromise = new Promise(resolve => {\r\n\tif (document.readyState === 'complete') {\r\n\t\tresolve(); return;\r\n\t}\r\n\tdocument.addEventListener('DOMContentLoaded', resolve, false);\r\n\twindow.addEventListener('load', resolve, false);\r\n});\r\n// ------------------------------------\r\nChtmlCore.ready = (callback, waitForBundles = true) => {\r\n\tcontentLoadedPromise.then(() => {\r\n\t\tif (!waitForBundles) {\r\n\t\t\tcallback(); return;\r\n\t\t}\r\n\t\tChtmlCore.initObj.loadingBundlesPromise.then(callback);\r\n\t});\r\n};\r\n\r\n/**\r\n * Create an initialization object that all\r\n * init-related functionality can build on.\r\n */\r\ncontentLoadedPromise.then(() => {\r\n\t// ------------------------------------\r\n\tChtmlCore.initObj = (() => {\r\n\t\tvar bundles = _arr_from(document.querySelectorAll('template[is=\"' + ChtmlCore.elementMap.bundle + '\"]')).reverse();\r\n\t\tvar remoteBundles = bundles.filter(b => b.hasAttribute('src') && !b.content.children.length);\r\n\t\tvar loadingBundles = remoteBundles.map(b => new Promise(resolve => {\r\n\t\t\tb.addEventListener('bundleloadsuccess', resolve);\r\n\t\t\tb.addEventListener('bundleloaderror', resolve);\r\n\t\t}));\r\n\t\tvar loadingBundlesPromise = Promise.all(loadingBundles).then(() => {\r\n\t\t\tloadingBundles.splice(0);\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tcontentLoadedPromise,\r\n\t\t\tloadingBundlesPromise,\r\n\t\t\tbundles,\r\n\t\t\tremoteBundles,\r\n\t\t\tloadingBundles\r\n\t\t};\r\n\t})();\r\n\t// ------------------------------------\r\n\t// Configure CHTM with bundle sources.\r\n\t// ------------------------------------\r\n\tvar warnedEarlyBundleAccess;\r\n\tvar anticyclicBundlesQuery = [];\r\n\tChtmlCore.bundles = new Matrix(ChtmlCore.initObj.bundles/*sources*/, []/*namespace*/, (bundle, namespace, superEl, bundleIndex) => {\r\n\t\tif (ChtmlCore.initObj.loadingBundles.length && !warnedEarlyBundleAccess) {\r\n\t\t\twarnedEarlyBundleAccess = true;\r\n\t\t\tconsole.warn('Remote bundles are still loading at this time! You should probabbly wrap bundle-dependent code within Chtml.ready(callback[, true/*waitForBundles*/]).');\r\n\t\t}\r\n\t\tvar _namespace = namespace.join('/');\r\n\t\tif (anticyclicBundlesQuery.includes(_namespace)) {\r\n\t\t\treturn ChtmlCore.bundles.find(namespace.slice(0, -1).join('/'));\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.push(_namespace);\r\n\t\tvar el = bundle.content.querySelector('[' + ChtmlCore.attributeMap.ns + '=\"' + _namespace + '\"]');\r\n\t\tif (el && superEl) {\r\n\t\t\ttry {\r\n\t\t\t\tvar norecompose = [];\r\n\t\t\t\tif (bundle.hasAttribute('norecompose')) {\r\n\t\t\t\t\tnorecompose = (bundle.getAttribute('norecompose') || '*').split(' ').map(val => val.trim());\r\n\t\t\t\t}\r\n\t\t\t\tel = ChtmlCore.recompose(el, superEl, 'prepend', norecompose);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error('[Inheritance error at source #' + bundleIndex + ']: ' + e.message);\r\n\t\t\t}\r\n\t\t\tanticyclicBundlesQuery.pop();\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.pop();\r\n\t\treturn el ? el.cloneNode(true) \r\n\t\t\t: (superEl ? superEl.cloneNode(true) : null);\r\n\t}/*getter*/);\r\n});\r\n\t\t\t\r\n/**\r\n * Define the customized built-in template element\r\n * that supports remote content.\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.bundle, class extends HTMLTemplateElement {\r\n\r\n\t/**\r\n\t * This handles both triggers remote loading\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (newValue) {\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt to load remote content if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tload() {\r\n\t\tvar src = this.getAttribute('src');\r\n\t\tif (src && this.content.children.length) {\r\n\t\t\tconsole.warn('A CHTML bundle must define only either a remote content or local content! Bundle ignored.');\r\n\t\t} else if (src) {\r\n\t\t\tfetch(src).then(response => {\r\n\t\t\t\treturn response.ok ? response.text() : Promise.reject(response.statusText);\r\n\t\t\t}).then(content => {\r\n\t\t\t\tthis.innerHTML = content;\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloadsuccess'));\r\n\t\t\t}).catch(error => {\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tconsole.warn('Error fetching the bundle at ' + src + '. (' + error + ')');\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloaderror'));\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['src'];\r\n\t}\r\n}, {extends: 'template'});\r\n\t\t\t\r\n/**\r\n * Define the custom import element\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.import, class extends HTMLElement {\r\n\r\n\t/**\r\n\t * Tests if conditions are right to resolve the import.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tshouldResolve() {\r\n\t\treturn !this.hasAttribute('ondemand')\r\n\t\t\t&& !this.closest('template')\r\n\t\t\t&& !this.closest(ChtmlCore.elementMap.import + '[ondemand]');\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconnectedCallback() {\r\n\t\tthis.processed = false;\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt self-replacement if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tresolve() {\r\n\t\tChtml.ready(() => {\r\n\t\t\tif (!this.parentNode) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar replacement, namespace, namespaceAttr = ChtmlCore.attributeMap.ns;\r\n\t\t\tif ((namespace = _before(this.getAttribute(namespaceAttr) || '', '//'))\r\n\t\t\t&& (namespace !== this.__namespace)) {\r\n\t\t\t\tthis.__namespace = namespace;\r\n\t\t\t\tif (!(replacement = Chtml.import(namespace))) {\r\n\t\t\t\t\tthis.innnerText = 'No element found on the namespace \"' + namespace + '\"!';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar resolved = ChtmlCore.recompose(this, replacement);\r\n\t\t\t\t\tif (this.hasAttribute('shadow')) {\r\n\t\t\t\t\t\tif (!this.parentNode.shadowRoot) {\r\n\t\t\t\t\t\t\tthis.parentNode.attachShadow({mode: 'open'});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.parentNode.shadowRoot.append(resolved);\r\n\t\t\t\t\t\tthis.remove();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.replaceWith(resolved);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['ondemand', ChtmlCore.attributeMap.ns];\r\n\t}\r\n});\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tChtmlCore,\r\n\tSchema,\r\n\tMatrix,\r\n};\r\nexport default Chtml;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_mixin\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_inherit\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport _Chtml from '@onephrase/chtml';\r\nimport Element from './Element/Element.js';\r\nimport Component from './Component.js';\r\n\r\n/**\r\n * ---------------------------\r\n * A reactive Element library.\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Tells if an object is a DOM element.\r\n *\r\n * @param mixed \t\t\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst Chtml = class extends _Chtml {\r\n\t\r\n\t/**\r\n\t * Overrides the Static paramter in super.from() with self.\r\n\t *\r\n\t * @see super.from()\r\n\t */\r\n\tstatic from(input, params = {}, resolveInheritance = true, Static = Chtml) {\r\n\t\treturn super.from(input, params, resolveInheritance, Static);\r\n\t}\r\n\r\n\t// ----------------------------------------\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper(el, _inherit({}, params, Chtml.params));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds a component to the instance;\r\n\t * saves it at an automatically-derived name.\r\n\t *\r\n\t * @param string \t\tname\t\r\n\t * @param array \t\t...args\t\r\n\t *\r\n\t * @inheritdoc\r\n\t */\r\n\tuse(name, ...args) {\r\n\t\treturn this.useAs(name, '$' + name, ...args);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds a component to the instance;\r\n\t * saves it at the given key.\r\n\t *\r\n\t * @param string \t\tname\t\r\n\t * @param string \t\tkey\t\r\n\t * @param array \t\t...args\t\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tuseAs(name, key, ...args) {\r\n\t\tvar componentInstance = Component.use(name, ...args);\r\n\t\tthis.set(key, componentInstance);\r\n\t\treturn componentInstance;\r\n\t}\r\n};\r\n\r\n/**\r\n * Deep override the default factory method.\r\n */\r\nChtml.params.drilldown = true;\r\nChtml.params.observeOnly = false;\r\nChtml.params.nodeCallback = el => new Element(el);\r\nChtml.params.componentCallback = Chtml.from;\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Chtml;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_sort\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_isArray,\r\n\t_isFunction,\r\n\t_isClass\r\n} from '@onephrase/commons/src/Js.js';\r\nimport Component from '../Component.js';\r\nimport Frame from './Frame.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Frameset class\r\n * ---------------------------\r\n *\r\n * This class manages multiple Frame instances.\r\n */\r\n\t\t\t\r\nconst Frameset = class extends Component {\r\n\r\n\t/**\r\n\t * Matches and activates frames;\r\n\t * deactivates unmacthed frames.\r\n\t *\r\n\t * @param string\t\t\t\tkeyExpr\r\n\t *\r\n\t * @return int\r\n\t */\r\n\tselect(selectExpr) {\r\n\t\treturn this.filterCallback(\r\n\t\t\t(name, frame) => (new RegExp(name)).test(selectExpr),\r\n\t\t\t(name, frame) => frame.active(true),\r\n\t\t\t(name, frame) => frame.active(false),\r\n\t\t);\r\n\t}\r\n\r\n\t/**\r\n\t * Passes each item through a filter into\r\n\t * success and failure callbacks.\r\n\t *\r\n\t * @param function\t\t\t\tfilterCallback\r\n\t * @param function\t\t\t\tsuccessCallback\r\n\t * @param function\t\t\t\tfailureCallback\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfilterCallback(filterCallback, successCallback, failureCallback) {\r\n\t\tvar passes = {}, failures = {};\r\n\t\t_each(this.getFrames(), (name, frame) => {\r\n\t\t\tif (filterCallback(name, frame)) {\r\n\t\t\t\tpasses[name] = frame;\r\n\t\t\t} else {\r\n\t\t\t\tfailures[name] = frame;\r\n\t\t\t}\r\n\t\t});\r\n\t\t_each(passes, successCallback);\r\n\t\t_each(failures, failureCallback);\r\n\t\treturn passes;\r\n\t}\r\n\r\n\t/**\r\n\t * Returns items.\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tgetFrames() {\r\n\t\tvar frames = {};\r\n\t\tthis.keys().forEach(name => {\r\n\t\t\tif (this.get(name) instanceof Frame) {\r\n\t\t\t\tframes[name] = this.get(name);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn frames;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates Frames from declarations.\r\n\t *\r\n\t * @param array\t\t\tframesList\r\n\t *\r\n\t * @return Frameset\r\n\t */\r\n\tstatic create(framesList) {\r\n\t\tvar frames = {};\r\n\t\t_each(framesList, (name, frameConstructor) => {\r\n\t\t\tframes[name] = frameConstructor instanceof Frame ? frameConstructor\r\n\t\t\t\t: (_isClass(frameConstructor) ? new frameConstructor \r\n\t\t\t\t\t: (_isFunction(frameConstructor) ? frameConstructor(match) \r\n\t\t\t\t\t\t: new Frame(frameConstructor || {})));\r\n\t\t});\r\n\t\treturn new Frameset(frames);\r\n\t}\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Frameset;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_copy,\r\n\t_first as _obj_first\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_isObject,\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\nimport Component from '../Component.js';\r\nimport Frameset from './Frameset.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Frame class\r\n * ---------------------------\r\n *\r\n * This class represents a given route and manages\r\n * its sub-route.\r\n */\r\n\t\t\t\r\nconst Frame = class extends Component {\r\n\r\n\t/**\r\n\t * Constructs a new Frame instance.\r\n\t * Sub-views may also be listed.\r\n\t *\r\n\t * Its content could either be static or remote.\r\n\t *\r\n\t * @param object\t\t\t\tstate\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tif (state.children && !(state.children instanceof Frameset)) {\r\n\t\t\tstate = _copy(0, state);\r\n\t\t\tstate.children = Frameset.create(state.children);\r\n\t\t}\r\n\t\tsuper(state, params);\r\n\t\t// -----------------------\r\n\t\t// Observe the Frame's route-slot\r\n\t\tvar routerInstance = Component.use('router');\r\n\t\tvar routePathSlot = this.get('routePathSlot') || 0;\r\n\t\tconst select = (children, path) => {\r\n\t\t\tif (children && path) {\r\n\t\t\t\tvar routePathSlotVal = _isNumeric(routePathSlot) ? path.arr[routePathSlot] : path.obj[routePathSlot];\r\n\t\t\t\tvar activeChild = _obj_first(children.select(routePathSlotVal));\r\n\t\t\t\treturn this.set({\r\n\t\t\t\t\tactiveChild: activeChild,\r\n\t\t\t\t\thasActiveChild: activeChild ? true : false,\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn this.set({\r\n\t\t\t\t\tactiveChild: undefined,\r\n\t\t\t\t\thasActiveChild: false,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t};\r\n\t\t// -----------------------\r\n\t\trouterInstance.observe('path', path => {\r\n\t\t\treturn select(this.get('children'), path);\r\n\t\t}, {diff:true});\r\n\t\t// -----------------------\r\n\t\tthis.observe('children', (children, _children, e) => {\r\n\t\t\t// Immediate children that are entering and leaving...\r\n\t\t\tif ((!e.bubbling || !e.bubbling.filter(path => path.split('.').length > 2).length)\r\n\t\t\t&& (e.entries.length || e.exits.length)) {\r\n\t\t\t\treturn select(children, routerInstance.get('path'));\r\n\t\t\t}\r\n\t\t}, {allowBubbling:true, diff:true});\r\n\t\t// -----------------------\r\n\t\tthis.observe(['activeChild', 'active'], states => {\r\n\t\t\tif (states[0]) {\r\n\t\t\t\treturn states[0].active(state[1]);\r\n\t\t\t}\r\n\t\t}, {diff:true});\r\n\t}\r\n\r\n\t/**\r\n\t * Controls the Frame's active state.\r\n\t *\r\n\t * @param bool\t\t\t\tstate\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tactive(state = true) {\r\n\t\treturn this.set('active', state);\r\n\t}\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Frame;","\r\n    import Observable from '@onephrase/observable';\r\n    import Chtml from '../src/Chtml.js';\r\n    import Router from '../src/App/Router.js';\r\n    import Frame from '../src/App/Frame.js';\r\n    import Comp from '../src/Component.js';\r\n    \r\n    Comp.register('router', Router, true);\r\n    const router = Comp.use('router');\r\n\r\n    var Main = new Frame({\r\n        active: true,\r\n        content: {\r\n            title:'This is Home page!',\r\n        },\r\n\t\troutePathSlot: 2,\r\n        children: {\r\n            documentation: {\r\n                content: {\r\n                    title:'This is documentation page!',\r\n                },\r\n\t\t\t\troutePathSlot: 3,\r\n\t\t\t\tchildren: {\r\n\t\t\t\t\tintro: {\r\n\t\t\t\t\t\tcontent: {\r\n\t\t\t\t\t\t\ttitle:'Welcome to Rosewell!',\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n            },\r\n            download: {\r\n                content: {\r\n                    title:'This is download page!',\r\n                },\r\n            },\r\n\t\t}\r\n    });\r\n\t\r\n\tChtml.ready(() => {\r\n\t\tChtml.from('#app').bind(Main);\r\n\t});\r\n\t"],"sourceRoot":""}